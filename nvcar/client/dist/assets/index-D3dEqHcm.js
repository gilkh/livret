var Q8=Object.defineProperty;var Hw=e=>{throw TypeError(e)};var J8=(e,t,r)=>t in e?Q8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var vx=(e,t,r)=>J8(e,typeof t!="symbol"?t+"":t,r),bx=(e,t,r)=>t.has(e)||Hw("Cannot "+r);var Ce=(e,t,r)=>(bx(e,t,"read from private field"),r?r.call(e):t.get(e)),Qt=(e,t,r)=>t.has(e)?Hw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),At=(e,t,r,s)=>(bx(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),dr=(e,t,r)=>(bx(e,t,"access private method"),r);var Jp=(e,t,r,s)=>({set _(i){At(e,t,i,r)},get _(){return Ce(e,t,s)}});function Z8(e,t){for(var r=0;r<t.length;r++){const s=t[r];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in e)){const a=Object.getOwnPropertyDescriptor(s,i);a&&Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();function Ya(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var W_={exports:{}},Lg={},U_={exports:{}},lr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lp=Symbol.for("react.element"),eR=Symbol.for("react.portal"),tR=Symbol.for("react.fragment"),rR=Symbol.for("react.strict_mode"),nR=Symbol.for("react.profiler"),sR=Symbol.for("react.provider"),iR=Symbol.for("react.context"),aR=Symbol.for("react.forward_ref"),oR=Symbol.for("react.suspense"),lR=Symbol.for("react.memo"),cR=Symbol.for("react.lazy"),Yw=Symbol.iterator;function dR(e){return e===null||typeof e!="object"?null:(e=Yw&&e[Yw]||e["@@iterator"],typeof e=="function"?e:null)}var H_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y_=Object.assign,K_={};function fd(e,t,r){this.props=e,this.context=t,this.refs=K_,this.updater=r||H_}fd.prototype.isReactComponent={};fd.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};fd.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function V_(){}V_.prototype=fd.prototype;function i1(e,t,r){this.props=e,this.context=t,this.refs=K_,this.updater=r||H_}var a1=i1.prototype=new V_;a1.constructor=i1;Y_(a1,fd.prototype);a1.isPureReactComponent=!0;var Kw=Array.isArray,q_=Object.prototype.hasOwnProperty,o1={current:null},G_={key:!0,ref:!0,__self:!0,__source:!0};function X_(e,t,r){var s,i={},a=null,o=null;if(t!=null)for(s in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)q_.call(t,s)&&!G_.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)i[s]===void 0&&(i[s]=l[s]);return{$$typeof:lp,type:e,key:a,ref:o,props:i,_owner:o1.current}}function uR(e,t){return{$$typeof:lp,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function l1(e){return typeof e=="object"&&e!==null&&e.$$typeof===lp}function pR(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Vw=/\/+/g;function jx(e,t){return typeof e=="object"&&e!==null&&e.key!=null?pR(""+e.key):t.toString(36)}function Wf(e,t,r,s,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case lp:case eR:o=!0}}if(o)return o=e,i=i(o),e=s===""?"."+jx(o,0):s,Kw(i)?(r="",e!=null&&(r=e.replace(Vw,"$&/")+"/"),Wf(i,t,r,"",function(u){return u})):i!=null&&(l1(i)&&(i=uR(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Vw,"$&/")+"/")+e)),t.push(i)),1;if(o=0,s=s===""?".":s+":",Kw(e))for(var l=0;l<e.length;l++){a=e[l];var c=s+jx(a,l);o+=Wf(a,t,r,c,i)}else if(c=dR(e),typeof c=="function")for(e=c.call(e),l=0;!(a=e.next()).done;)a=a.value,c=s+jx(a,l++),o+=Wf(a,t,r,c,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Zp(e,t,r){if(e==null)return e;var s=[],i=0;return Wf(e,s,"","",function(a){return t.call(r,a,i++)}),s}function fR(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ms={current:null},Uf={transition:null},hR={ReactCurrentDispatcher:ms,ReactCurrentBatchConfig:Uf,ReactCurrentOwner:o1};function Q_(){throw Error("act(...) is not supported in production builds of React.")}lr.Children={map:Zp,forEach:function(e,t,r){Zp(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Zp(e,function(){t++}),t},toArray:function(e){return Zp(e,function(t){return t})||[]},only:function(e){if(!l1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};lr.Component=fd;lr.Fragment=tR;lr.Profiler=nR;lr.PureComponent=i1;lr.StrictMode=rR;lr.Suspense=oR;lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hR;lr.act=Q_;lr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Y_({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=o1.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)q_.call(t,c)&&!G_.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:lp,type:e.type,key:i,ref:a,props:s,_owner:o}};lr.createContext=function(e){return e={$$typeof:iR,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:sR,_context:e},e.Consumer=e};lr.createElement=X_;lr.createFactory=function(e){var t=X_.bind(null,e);return t.type=e,t};lr.createRef=function(){return{current:null}};lr.forwardRef=function(e){return{$$typeof:aR,render:e}};lr.isValidElement=l1;lr.lazy=function(e){return{$$typeof:cR,_payload:{_status:-1,_result:e},_init:fR}};lr.memo=function(e,t){return{$$typeof:lR,type:e,compare:t===void 0?null:t}};lr.startTransition=function(e){var t=Uf.transition;Uf.transition={};try{e()}finally{Uf.transition=t}};lr.unstable_act=Q_;lr.useCallback=function(e,t){return ms.current.useCallback(e,t)};lr.useContext=function(e){return ms.current.useContext(e)};lr.useDebugValue=function(){};lr.useDeferredValue=function(e){return ms.current.useDeferredValue(e)};lr.useEffect=function(e,t){return ms.current.useEffect(e,t)};lr.useId=function(){return ms.current.useId()};lr.useImperativeHandle=function(e,t,r){return ms.current.useImperativeHandle(e,t,r)};lr.useInsertionEffect=function(e,t){return ms.current.useInsertionEffect(e,t)};lr.useLayoutEffect=function(e,t){return ms.current.useLayoutEffect(e,t)};lr.useMemo=function(e,t){return ms.current.useMemo(e,t)};lr.useReducer=function(e,t,r){return ms.current.useReducer(e,t,r)};lr.useRef=function(e){return ms.current.useRef(e)};lr.useState=function(e){return ms.current.useState(e)};lr.useSyncExternalStore=function(e,t,r){return ms.current.useSyncExternalStore(e,t,r)};lr.useTransition=function(){return ms.current.useTransition()};lr.version="18.3.1";U_.exports=lr;var p=U_.exports;const J_=Ya(p),Z_=Z8({__proto__:null,default:J_},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gR=p,mR=Symbol.for("react.element"),xR=Symbol.for("react.fragment"),yR=Object.prototype.hasOwnProperty,vR=gR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bR={key:!0,ref:!0,__self:!0,__source:!0};function eA(e,t,r){var s,i={},a=null,o=null;r!==void 0&&(a=""+r),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(s in t)yR.call(t,s)&&!bR.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)i[s]===void 0&&(i[s]=t[s]);return{$$typeof:mR,type:e,key:a,ref:o,props:i,_owner:vR.current}}Lg.Fragment=xR;Lg.jsx=eA;Lg.jsxs=eA;W_.exports=Lg;var n=W_.exports,tA={exports:{}},Xs={},rA={exports:{}},nA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(I,T){var W=I.length;I.push(T);e:for(;0<W;){var re=W-1>>>1,ae=I[re];if(0<i(ae,T))I[re]=T,I[W]=ae,W=re;else break e}}function r(I){return I.length===0?null:I[0]}function s(I){if(I.length===0)return null;var T=I[0],W=I.pop();if(W!==T){I[0]=W;e:for(var re=0,ae=I.length,Y=ae>>>1;re<Y;){var J=2*(re+1)-1,P=I[J],ce=J+1,pe=I[ce];if(0>i(P,W))ce<ae&&0>i(pe,P)?(I[re]=pe,I[ce]=W,re=ce):(I[re]=P,I[J]=W,re=J);else if(ce<ae&&0>i(pe,W))I[re]=pe,I[ce]=W,re=ce;else break e}}return T}function i(I,T){var W=I.sortIndex-T.sortIndex;return W!==0?W:I.id-T.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,f=null,h=3,m=!1,g=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(I){for(var T=r(u);T!==null;){if(T.callback===null)s(u);else if(T.startTime<=I)s(u),T.sortIndex=T.expirationTime,t(c,T);else break;T=r(u)}}function j(I){if(x=!1,k(I),!g)if(r(c)!==null)g=!0,O(_);else{var T=r(u);T!==null&&B(j,T.startTime-I)}}function _(I,T){g=!1,x&&(x=!1,v(z),z=-1),m=!0;var W=h;try{for(k(T),f=r(c);f!==null&&(!(f.expirationTime>T)||I&&!N());){var re=f.callback;if(typeof re=="function"){f.callback=null,h=f.priorityLevel;var ae=re(f.expirationTime<=T);T=e.unstable_now(),typeof ae=="function"?f.callback=ae:f===r(c)&&s(c),k(T)}else s(c);f=r(c)}if(f!==null)var Y=!0;else{var J=r(u);J!==null&&B(j,J.startTime-T),Y=!1}return Y}finally{f=null,h=W,m=!1}}var b=!1,A=null,z=-1,D=5,w=-1;function N(){return!(e.unstable_now()-w<D)}function $(){if(A!==null){var I=e.unstable_now();w=I;var T=!0;try{T=A(!0,I)}finally{T?E():(b=!1,A=null)}}else b=!1}var E;if(typeof S=="function")E=function(){S($)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,L=q.port2;q.port1.onmessage=$,E=function(){L.postMessage(null)}}else E=function(){y($,0)};function O(I){A=I,b||(b=!0,E())}function B(I,T){z=y(function(){I(e.unstable_now())},T)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(I){I.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,O(_))},e.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<I?Math.floor(1e3/I):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(I){switch(h){case 1:case 2:case 3:var T=3;break;default:T=h}var W=h;h=T;try{return I()}finally{h=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(I,T){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var W=h;h=I;try{return T()}finally{h=W}},e.unstable_scheduleCallback=function(I,T,W){var re=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?re+W:re):W=re,I){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=W+ae,I={id:d++,callback:T,priorityLevel:I,startTime:W,expirationTime:ae,sortIndex:-1},W>re?(I.sortIndex=W,t(u,I),r(c)===null&&I===r(u)&&(x?(v(z),z=-1):x=!0,B(j,W-re))):(I.sortIndex=ae,t(c,I),g||m||(g=!0,O(_))),I},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(I){var T=h;return function(){var W=h;h=T;try{return I.apply(this,arguments)}finally{h=W}}}})(nA);rA.exports=nA;var jR=rA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wR=p,Vs=jR;function st(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sA=new Set,vu={};function tc(e,t){Vc(e,t),Vc(e+"Capture",t)}function Vc(e,t){for(vu[e]=t,e=0;e<t.length;e++)sA.add(t[e])}var Ra=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zy=Object.prototype.hasOwnProperty,SR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qw={},Gw={};function kR(e){return zy.call(Gw,e)?!0:zy.call(qw,e)?!1:SR.test(e)?Gw[e]=!0:(qw[e]=!0,!1)}function NR(e,t,r,s){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function CR(e,t,r,s){if(t===null||typeof t>"u"||NR(e,t,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function xs(e,t,r,s,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var Hn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Hn[e]=new xs(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Hn[t]=new xs(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Hn[e]=new xs(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Hn[e]=new xs(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Hn[e]=new xs(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Hn[e]=new xs(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Hn[e]=new xs(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Hn[e]=new xs(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Hn[e]=new xs(e,5,!1,e.toLowerCase(),null,!1,!1)});var c1=/[\-:]([a-z])/g;function d1(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(c1,d1);Hn[t]=new xs(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(c1,d1);Hn[t]=new xs(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(c1,d1);Hn[t]=new xs(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Hn[e]=new xs(e,1,!1,e.toLowerCase(),null,!1,!1)});Hn.xlinkHref=new xs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Hn[e]=new xs(e,1,!1,e.toLowerCase(),null,!0,!0)});function u1(e,t,r,s){var i=Hn.hasOwnProperty(t)?Hn[t]:null;(i!==null?i.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(CR(t,r,i,s)&&(r=null),s||i===null?kR(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,s=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,s?e.setAttributeNS(s,t,r):e.setAttribute(t,r))))}var Ka=wR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ef=Symbol.for("react.element"),pc=Symbol.for("react.portal"),fc=Symbol.for("react.fragment"),p1=Symbol.for("react.strict_mode"),Ly=Symbol.for("react.profiler"),iA=Symbol.for("react.provider"),aA=Symbol.for("react.context"),f1=Symbol.for("react.forward_ref"),$y=Symbol.for("react.suspense"),Dy=Symbol.for("react.suspense_list"),h1=Symbol.for("react.memo"),ao=Symbol.for("react.lazy"),oA=Symbol.for("react.offscreen"),Xw=Symbol.iterator;function Ld(e){return e===null||typeof e!="object"?null:(e=Xw&&e[Xw]||e["@@iterator"],typeof e=="function"?e:null)}var Vr=Object.assign,wx;function tu(e){if(wx===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);wx=t&&t[1]||""}return`
`+wx+e}var Sx=!1;function kx(e,t){if(!e||Sx)return"";Sx=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),a=s.stack.split(`
`),o=i.length-1,l=a.length-1;1<=o&&0<=l&&i[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==a[l]){var c=`
`+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{Sx=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?tu(e):""}function _R(e){switch(e.tag){case 5:return tu(e.type);case 16:return tu("Lazy");case 13:return tu("Suspense");case 19:return tu("SuspenseList");case 0:case 2:case 15:return e=kx(e.type,!1),e;case 11:return e=kx(e.type.render,!1),e;case 1:return e=kx(e.type,!0),e;default:return""}}function My(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case fc:return"Fragment";case pc:return"Portal";case Ly:return"Profiler";case p1:return"StrictMode";case $y:return"Suspense";case Dy:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case aA:return(e.displayName||"Context")+".Consumer";case iA:return(e._context.displayName||"Context")+".Provider";case f1:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case h1:return t=e.displayName||null,t!==null?t:My(e.type)||"Memo";case ao:t=e._payload,e=e._init;try{return My(e(t))}catch{}}return null}function AR(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return My(t);case 8:return t===p1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Mo(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function lA(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ER(e){var t=lA(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function tf(e){e._valueTracker||(e._valueTracker=ER(e))}function cA(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=lA(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function hh(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function By(e,t){var r=t.checked;return Vr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Qw(e,t){var r=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;r=Mo(t.value!=null?t.value:r),e._wrapperState={initialChecked:s,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function dA(e,t){t=t.checked,t!=null&&u1(e,"checked",t,!1)}function Fy(e,t){dA(e,t);var r=Mo(t.value),s=t.type;if(r!=null)s==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Wy(e,t.type,r):t.hasOwnProperty("defaultValue")&&Wy(e,t.type,Mo(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Jw(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Wy(e,t,r){(t!=="number"||hh(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var ru=Array.isArray;function Cc(e,t,r,s){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&s&&(e[r].defaultSelected=!0)}else{for(r=""+Mo(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,s&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Uy(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(st(91));return Vr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Zw(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(st(92));if(ru(r)){if(1<r.length)throw Error(st(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Mo(r)}}function uA(e,t){var r=Mo(t.value),s=Mo(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),s!=null&&(e.defaultValue=""+s)}function eS(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function pA(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hy(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?pA(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var rf,fA=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,s,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,s,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(rf=rf||document.createElement("div"),rf.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=rf.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function bu(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var cu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},PR=["Webkit","ms","Moz","O"];Object.keys(cu).forEach(function(e){PR.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),cu[t]=cu[e]})});function hA(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||cu.hasOwnProperty(e)&&cu[e]?(""+t).trim():t+"px"}function gA(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var s=r.indexOf("--")===0,i=hA(r,t[r],s);r==="float"&&(r="cssFloat"),s?e.setProperty(r,i):e[r]=i}}var IR=Vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yy(e,t){if(t){if(IR[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(st(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(st(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(st(61))}if(t.style!=null&&typeof t.style!="object")throw Error(st(62))}}function Ky(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vy=null;function g1(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var qy=null,_c=null,Ac=null;function tS(e){if(e=up(e)){if(typeof qy!="function")throw Error(st(280));var t=e.stateNode;t&&(t=Fg(t),qy(e.stateNode,e.type,t))}}function mA(e){_c?Ac?Ac.push(e):Ac=[e]:_c=e}function xA(){if(_c){var e=_c,t=Ac;if(Ac=_c=null,tS(e),t)for(e=0;e<t.length;e++)tS(t[e])}}function yA(e,t){return e(t)}function vA(){}var Nx=!1;function bA(e,t,r){if(Nx)return e(t,r);Nx=!0;try{return yA(e,t,r)}finally{Nx=!1,(_c!==null||Ac!==null)&&(vA(),xA())}}function ju(e,t){var r=e.stateNode;if(r===null)return null;var s=Fg(r);if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(st(231,t,typeof r));return r}var Gy=!1;if(Ra)try{var $d={};Object.defineProperty($d,"passive",{get:function(){Gy=!0}}),window.addEventListener("test",$d,$d),window.removeEventListener("test",$d,$d)}catch{Gy=!1}function TR(e,t,r,s,i,a,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(d){this.onError(d)}}var du=!1,gh=null,mh=!1,Xy=null,RR={onError:function(e){du=!0,gh=e}};function OR(e,t,r,s,i,a,o,l,c){du=!1,gh=null,TR.apply(RR,arguments)}function zR(e,t,r,s,i,a,o,l,c){if(OR.apply(this,arguments),du){if(du){var u=gh;du=!1,gh=null}else throw Error(st(198));mh||(mh=!0,Xy=u)}}function rc(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function jA(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function rS(e){if(rc(e)!==e)throw Error(st(188))}function LR(e){var t=e.alternate;if(!t){if(t=rc(e),t===null)throw Error(st(188));return t!==e?null:e}for(var r=e,s=t;;){var i=r.return;if(i===null)break;var a=i.alternate;if(a===null){if(s=i.return,s!==null){r=s;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return rS(i),e;if(a===s)return rS(i),t;a=a.sibling}throw Error(st(188))}if(r.return!==s.return)r=i,s=a;else{for(var o=!1,l=i.child;l;){if(l===r){o=!0,r=i,s=a;break}if(l===s){o=!0,s=i,r=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===r){o=!0,r=a,s=i;break}if(l===s){o=!0,s=a,r=i;break}l=l.sibling}if(!o)throw Error(st(189))}}if(r.alternate!==s)throw Error(st(190))}if(r.tag!==3)throw Error(st(188));return r.stateNode.current===r?e:t}function wA(e){return e=LR(e),e!==null?SA(e):null}function SA(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=SA(e);if(t!==null)return t;e=e.sibling}return null}var kA=Vs.unstable_scheduleCallback,nS=Vs.unstable_cancelCallback,$R=Vs.unstable_shouldYield,DR=Vs.unstable_requestPaint,tn=Vs.unstable_now,MR=Vs.unstable_getCurrentPriorityLevel,m1=Vs.unstable_ImmediatePriority,NA=Vs.unstable_UserBlockingPriority,xh=Vs.unstable_NormalPriority,BR=Vs.unstable_LowPriority,CA=Vs.unstable_IdlePriority,$g=null,Zi=null;function FR(e){if(Zi&&typeof Zi.onCommitFiberRoot=="function")try{Zi.onCommitFiberRoot($g,e,void 0,(e.current.flags&128)===128)}catch{}}var Ti=Math.clz32?Math.clz32:HR,WR=Math.log,UR=Math.LN2;function HR(e){return e>>>=0,e===0?32:31-(WR(e)/UR|0)|0}var nf=64,sf=4194304;function nu(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function yh(e,t){var r=e.pendingLanes;if(r===0)return 0;var s=0,i=e.suspendedLanes,a=e.pingedLanes,o=r&268435455;if(o!==0){var l=o&~i;l!==0?s=nu(l):(a&=o,a!==0&&(s=nu(a)))}else o=r&~i,o!==0?s=nu(o):a!==0&&(s=nu(a));if(s===0)return 0;if(t!==0&&t!==s&&!(t&i)&&(i=s&-s,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(s&4&&(s|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)r=31-Ti(t),i=1<<r,s|=e[r],t&=~i;return s}function YR(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function KR(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-Ti(a),l=1<<o,c=i[o];c===-1?(!(l&r)||l&s)&&(i[o]=YR(l,t)):c<=t&&(e.expiredLanes|=l),a&=~l}}function Qy(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function _A(){var e=nf;return nf<<=1,!(nf&4194240)&&(nf=64),e}function Cx(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function cp(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ti(t),e[t]=r}function VR(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-Ti(r),a=1<<i;t[i]=0,s[i]=-1,e[i]=-1,r&=~a}}function x1(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-Ti(r),i=1<<s;i&t|e[s]&t&&(e[s]|=t),r&=~i}}var Cr=0;function AA(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var EA,y1,PA,IA,TA,Jy=!1,af=[],Co=null,_o=null,Ao=null,wu=new Map,Su=new Map,uo=[],qR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sS(e,t){switch(e){case"focusin":case"focusout":Co=null;break;case"dragenter":case"dragleave":_o=null;break;case"mouseover":case"mouseout":Ao=null;break;case"pointerover":case"pointerout":wu.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Su.delete(t.pointerId)}}function Dd(e,t,r,s,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:a,targetContainers:[i]},t!==null&&(t=up(t),t!==null&&y1(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function GR(e,t,r,s,i){switch(t){case"focusin":return Co=Dd(Co,e,t,r,s,i),!0;case"dragenter":return _o=Dd(_o,e,t,r,s,i),!0;case"mouseover":return Ao=Dd(Ao,e,t,r,s,i),!0;case"pointerover":var a=i.pointerId;return wu.set(a,Dd(wu.get(a)||null,e,t,r,s,i)),!0;case"gotpointercapture":return a=i.pointerId,Su.set(a,Dd(Su.get(a)||null,e,t,r,s,i)),!0}return!1}function RA(e){var t=pl(e.target);if(t!==null){var r=rc(t);if(r!==null){if(t=r.tag,t===13){if(t=jA(r),t!==null){e.blockedOn=t,TA(e.priority,function(){PA(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Hf(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Zy(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);Vy=s,r.target.dispatchEvent(s),Vy=null}else return t=up(r),t!==null&&y1(t),e.blockedOn=r,!1;t.shift()}return!0}function iS(e,t,r){Hf(e)&&r.delete(t)}function XR(){Jy=!1,Co!==null&&Hf(Co)&&(Co=null),_o!==null&&Hf(_o)&&(_o=null),Ao!==null&&Hf(Ao)&&(Ao=null),wu.forEach(iS),Su.forEach(iS)}function Md(e,t){e.blockedOn===t&&(e.blockedOn=null,Jy||(Jy=!0,Vs.unstable_scheduleCallback(Vs.unstable_NormalPriority,XR)))}function ku(e){function t(i){return Md(i,e)}if(0<af.length){Md(af[0],e);for(var r=1;r<af.length;r++){var s=af[r];s.blockedOn===e&&(s.blockedOn=null)}}for(Co!==null&&Md(Co,e),_o!==null&&Md(_o,e),Ao!==null&&Md(Ao,e),wu.forEach(t),Su.forEach(t),r=0;r<uo.length;r++)s=uo[r],s.blockedOn===e&&(s.blockedOn=null);for(;0<uo.length&&(r=uo[0],r.blockedOn===null);)RA(r),r.blockedOn===null&&uo.shift()}var Ec=Ka.ReactCurrentBatchConfig,vh=!0;function QR(e,t,r,s){var i=Cr,a=Ec.transition;Ec.transition=null;try{Cr=1,v1(e,t,r,s)}finally{Cr=i,Ec.transition=a}}function JR(e,t,r,s){var i=Cr,a=Ec.transition;Ec.transition=null;try{Cr=4,v1(e,t,r,s)}finally{Cr=i,Ec.transition=a}}function v1(e,t,r,s){if(vh){var i=Zy(e,t,r,s);if(i===null)Lx(e,t,s,bh,r),sS(e,s);else if(GR(i,e,t,r,s))s.stopPropagation();else if(sS(e,s),t&4&&-1<qR.indexOf(e)){for(;i!==null;){var a=up(i);if(a!==null&&EA(a),a=Zy(e,t,r,s),a===null&&Lx(e,t,s,bh,r),a===i)break;i=a}i!==null&&s.stopPropagation()}else Lx(e,t,s,null,r)}}var bh=null;function Zy(e,t,r,s){if(bh=null,e=g1(s),e=pl(e),e!==null)if(t=rc(e),t===null)e=null;else if(r=t.tag,r===13){if(e=jA(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return bh=e,null}function OA(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MR()){case m1:return 1;case NA:return 4;case xh:case BR:return 16;case CA:return 536870912;default:return 16}default:return 16}}var wo=null,b1=null,Yf=null;function zA(){if(Yf)return Yf;var e,t=b1,r=t.length,s,i="value"in wo?wo.value:wo.textContent,a=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(s=1;s<=o&&t[r-s]===i[a-s];s++);return Yf=i.slice(e,1<s?1-s:void 0)}function Kf(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function of(){return!0}function aS(){return!1}function Qs(e){function t(r,s,i,a,o){this._reactName=r,this._targetInst=i,this.type=s,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(r=e[l],this[l]=r?r(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?of:aS,this.isPropagationStopped=aS,this}return Vr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=of)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=of)},persist:function(){},isPersistent:of}),t}var hd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},j1=Qs(hd),dp=Vr({},hd,{view:0,detail:0}),ZR=Qs(dp),_x,Ax,Bd,Dg=Vr({},dp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:w1,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Bd&&(Bd&&e.type==="mousemove"?(_x=e.screenX-Bd.screenX,Ax=e.screenY-Bd.screenY):Ax=_x=0,Bd=e),_x)},movementY:function(e){return"movementY"in e?e.movementY:Ax}}),oS=Qs(Dg),eO=Vr({},Dg,{dataTransfer:0}),tO=Qs(eO),rO=Vr({},dp,{relatedTarget:0}),Ex=Qs(rO),nO=Vr({},hd,{animationName:0,elapsedTime:0,pseudoElement:0}),sO=Qs(nO),iO=Vr({},hd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),aO=Qs(iO),oO=Vr({},hd,{data:0}),lS=Qs(oO),lO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uO(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=dO[e])?!!t[e]:!1}function w1(){return uO}var pO=Vr({},dp,{key:function(e){if(e.key){var t=lO[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Kf(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?cO[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:w1,charCode:function(e){return e.type==="keypress"?Kf(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Kf(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),fO=Qs(pO),hO=Vr({},Dg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cS=Qs(hO),gO=Vr({},dp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:w1}),mO=Qs(gO),xO=Vr({},hd,{propertyName:0,elapsedTime:0,pseudoElement:0}),yO=Qs(xO),vO=Vr({},Dg,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),bO=Qs(vO),jO=[9,13,27,32],S1=Ra&&"CompositionEvent"in window,uu=null;Ra&&"documentMode"in document&&(uu=document.documentMode);var wO=Ra&&"TextEvent"in window&&!uu,LA=Ra&&(!S1||uu&&8<uu&&11>=uu),dS=" ",uS=!1;function $A(e,t){switch(e){case"keyup":return jO.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DA(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var hc=!1;function SO(e,t){switch(e){case"compositionend":return DA(t);case"keypress":return t.which!==32?null:(uS=!0,dS);case"textInput":return e=t.data,e===dS&&uS?null:e;default:return null}}function kO(e,t){if(hc)return e==="compositionend"||!S1&&$A(e,t)?(e=zA(),Yf=b1=wo=null,hc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return LA&&t.locale!=="ko"?null:t.data;default:return null}}var NO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pS(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!NO[e.type]:t==="textarea"}function MA(e,t,r,s){mA(s),t=jh(t,"onChange"),0<t.length&&(r=new j1("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var pu=null,Nu=null;function CO(e){XA(e,0)}function Mg(e){var t=xc(e);if(cA(t))return e}function _O(e,t){if(e==="change")return t}var BA=!1;if(Ra){var Px;if(Ra){var Ix="oninput"in document;if(!Ix){var fS=document.createElement("div");fS.setAttribute("oninput","return;"),Ix=typeof fS.oninput=="function"}Px=Ix}else Px=!1;BA=Px&&(!document.documentMode||9<document.documentMode)}function hS(){pu&&(pu.detachEvent("onpropertychange",FA),Nu=pu=null)}function FA(e){if(e.propertyName==="value"&&Mg(Nu)){var t=[];MA(t,Nu,e,g1(e)),bA(CO,t)}}function AO(e,t,r){e==="focusin"?(hS(),pu=t,Nu=r,pu.attachEvent("onpropertychange",FA)):e==="focusout"&&hS()}function EO(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Mg(Nu)}function PO(e,t){if(e==="click")return Mg(t)}function IO(e,t){if(e==="input"||e==="change")return Mg(t)}function TO(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Li=typeof Object.is=="function"?Object.is:TO;function Cu(e,t){if(Li(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var i=r[s];if(!zy.call(t,i)||!Li(e[i],t[i]))return!1}return!0}function gS(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mS(e,t){var r=gS(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=gS(r)}}function WA(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?WA(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function UA(){for(var e=window,t=hh();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=hh(e.document)}return t}function k1(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function RO(e){var t=UA(),r=e.focusedElem,s=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&WA(r.ownerDocument.documentElement,r)){if(s!==null&&k1(r)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,a=Math.min(s.start,i);s=s.end===void 0?a:Math.min(s.end,i),!e.extend&&a>s&&(i=s,s=a,a=i),i=mS(r,a);var o=mS(r,s);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>s?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var OO=Ra&&"documentMode"in document&&11>=document.documentMode,gc=null,ev=null,fu=null,tv=!1;function xS(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;tv||gc==null||gc!==hh(s)||(s=gc,"selectionStart"in s&&k1(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),fu&&Cu(fu,s)||(fu=s,s=jh(ev,"onSelect"),0<s.length&&(t=new j1("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=gc)))}function lf(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var mc={animationend:lf("Animation","AnimationEnd"),animationiteration:lf("Animation","AnimationIteration"),animationstart:lf("Animation","AnimationStart"),transitionend:lf("Transition","TransitionEnd")},Tx={},HA={};Ra&&(HA=document.createElement("div").style,"AnimationEvent"in window||(delete mc.animationend.animation,delete mc.animationiteration.animation,delete mc.animationstart.animation),"TransitionEvent"in window||delete mc.transitionend.transition);function Bg(e){if(Tx[e])return Tx[e];if(!mc[e])return e;var t=mc[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in HA)return Tx[e]=t[r];return e}var YA=Bg("animationend"),KA=Bg("animationiteration"),VA=Bg("animationstart"),qA=Bg("transitionend"),GA=new Map,yS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vo(e,t){GA.set(e,t),tc(t,[e])}for(var Rx=0;Rx<yS.length;Rx++){var Ox=yS[Rx],zO=Ox.toLowerCase(),LO=Ox[0].toUpperCase()+Ox.slice(1);Vo(zO,"on"+LO)}Vo(YA,"onAnimationEnd");Vo(KA,"onAnimationIteration");Vo(VA,"onAnimationStart");Vo("dblclick","onDoubleClick");Vo("focusin","onFocus");Vo("focusout","onBlur");Vo(qA,"onTransitionEnd");Vc("onMouseEnter",["mouseout","mouseover"]);Vc("onMouseLeave",["mouseout","mouseover"]);Vc("onPointerEnter",["pointerout","pointerover"]);Vc("onPointerLeave",["pointerout","pointerover"]);tc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tc("onBeforeInput",["compositionend","keypress","textInput","paste"]);tc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$O=new Set("cancel close invalid load scroll toggle".split(" ").concat(su));function vS(e,t,r){var s=e.type||"unknown-event";e.currentTarget=r,zR(s,t,void 0,e),e.currentTarget=null}function XA(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],i=s.event;s=s.listeners;e:{var a=void 0;if(t)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==a&&i.isPropagationStopped())break e;vS(i,l,u),a=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==a&&i.isPropagationStopped())break e;vS(i,l,u),a=c}}}if(mh)throw e=Xy,mh=!1,Xy=null,e}function Lr(e,t){var r=t[av];r===void 0&&(r=t[av]=new Set);var s=e+"__bubble";r.has(s)||(QA(t,e,2,!1),r.add(s))}function zx(e,t,r){var s=0;t&&(s|=4),QA(r,e,s,t)}var cf="_reactListening"+Math.random().toString(36).slice(2);function _u(e){if(!e[cf]){e[cf]=!0,sA.forEach(function(r){r!=="selectionchange"&&($O.has(r)||zx(r,!1,e),zx(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[cf]||(t[cf]=!0,zx("selectionchange",!1,t))}}function QA(e,t,r,s){switch(OA(t)){case 1:var i=QR;break;case 4:i=JR;break;default:i=v1}r=i.bind(null,t,r,e),i=void 0,!Gy||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),s?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function Lx(e,t,r,s,i){var a=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=pl(l),o===null)return;if(c=o.tag,c===5||c===6){s=a=o;continue e}l=l.parentNode}}s=s.return}bA(function(){var u=a,d=g1(r),f=[];e:{var h=GA.get(e);if(h!==void 0){var m=j1,g=e;switch(e){case"keypress":if(Kf(r)===0)break e;case"keydown":case"keyup":m=fO;break;case"focusin":g="focus",m=Ex;break;case"focusout":g="blur",m=Ex;break;case"beforeblur":case"afterblur":m=Ex;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=oS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=tO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=mO;break;case YA:case KA:case VA:m=sO;break;case qA:m=yO;break;case"scroll":m=ZR;break;case"wheel":m=bO;break;case"copy":case"cut":case"paste":m=aO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=cS}var x=(t&4)!==0,y=!x&&e==="scroll",v=x?h!==null?h+"Capture":null:h;x=[];for(var S=u,k;S!==null;){k=S;var j=k.stateNode;if(k.tag===5&&j!==null&&(k=j,v!==null&&(j=ju(S,v),j!=null&&x.push(Au(S,j,k)))),y)break;S=S.return}0<x.length&&(h=new m(h,g,null,r,d),f.push({event:h,listeners:x}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",h&&r!==Vy&&(g=r.relatedTarget||r.fromElement)&&(pl(g)||g[Oa]))break e;if((m||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=u,g=g?pl(g):null,g!==null&&(y=rc(g),g!==y||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=u),m!==g)){if(x=oS,j="onMouseLeave",v="onMouseEnter",S="mouse",(e==="pointerout"||e==="pointerover")&&(x=cS,j="onPointerLeave",v="onPointerEnter",S="pointer"),y=m==null?h:xc(m),k=g==null?h:xc(g),h=new x(j,S+"leave",m,r,d),h.target=y,h.relatedTarget=k,j=null,pl(d)===u&&(x=new x(v,S+"enter",g,r,d),x.target=k,x.relatedTarget=y,j=x),y=j,m&&g)t:{for(x=m,v=g,S=0,k=x;k;k=oc(k))S++;for(k=0,j=v;j;j=oc(j))k++;for(;0<S-k;)x=oc(x),S--;for(;0<k-S;)v=oc(v),k--;for(;S--;){if(x===v||v!==null&&x===v.alternate)break t;x=oc(x),v=oc(v)}x=null}else x=null;m!==null&&bS(f,h,m,x,!1),g!==null&&y!==null&&bS(f,y,g,x,!0)}}e:{if(h=u?xc(u):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var _=_O;else if(pS(h))if(BA)_=IO;else{_=EO;var b=AO}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(_=PO);if(_&&(_=_(e,u))){MA(f,_,r,d);break e}b&&b(e,h,u),e==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&Wy(h,"number",h.value)}switch(b=u?xc(u):window,e){case"focusin":(pS(b)||b.contentEditable==="true")&&(gc=b,ev=u,fu=null);break;case"focusout":fu=ev=gc=null;break;case"mousedown":tv=!0;break;case"contextmenu":case"mouseup":case"dragend":tv=!1,xS(f,r,d);break;case"selectionchange":if(OO)break;case"keydown":case"keyup":xS(f,r,d)}var A;if(S1)e:{switch(e){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else hc?$A(e,r)&&(z="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(z="onCompositionStart");z&&(LA&&r.locale!=="ko"&&(hc||z!=="onCompositionStart"?z==="onCompositionEnd"&&hc&&(A=zA()):(wo=d,b1="value"in wo?wo.value:wo.textContent,hc=!0)),b=jh(u,z),0<b.length&&(z=new lS(z,e,null,r,d),f.push({event:z,listeners:b}),A?z.data=A:(A=DA(r),A!==null&&(z.data=A)))),(A=wO?SO(e,r):kO(e,r))&&(u=jh(u,"onBeforeInput"),0<u.length&&(d=new lS("onBeforeInput","beforeinput",null,r,d),f.push({event:d,listeners:u}),d.data=A))}XA(f,t)})}function Au(e,t,r){return{instance:e,listener:t,currentTarget:r}}function jh(e,t){for(var r=t+"Capture",s=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=ju(e,r),a!=null&&s.unshift(Au(e,a,i)),a=ju(e,t),a!=null&&s.push(Au(e,a,i))),e=e.return}return s}function oc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function bS(e,t,r,s,i){for(var a=t._reactName,o=[];r!==null&&r!==s;){var l=r,c=l.alternate,u=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&u!==null&&(l=u,i?(c=ju(r,a),c!=null&&o.unshift(Au(r,c,l))):i||(c=ju(r,a),c!=null&&o.push(Au(r,c,l)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var DO=/\r\n?/g,MO=/\u0000|\uFFFD/g;function jS(e){return(typeof e=="string"?e:""+e).replace(DO,`
`).replace(MO,"")}function df(e,t,r){if(t=jS(t),jS(e)!==t&&r)throw Error(st(425))}function wh(){}var rv=null,nv=null;function sv(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var iv=typeof setTimeout=="function"?setTimeout:void 0,BO=typeof clearTimeout=="function"?clearTimeout:void 0,wS=typeof Promise=="function"?Promise:void 0,FO=typeof queueMicrotask=="function"?queueMicrotask:typeof wS<"u"?function(e){return wS.resolve(null).then(e).catch(WO)}:iv;function WO(e){setTimeout(function(){throw e})}function $x(e,t){var r=t,s=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(s===0){e.removeChild(i),ku(t);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=i}while(r);ku(t)}function Eo(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function SS(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var gd=Math.random().toString(36).slice(2),Xi="__reactFiber$"+gd,Eu="__reactProps$"+gd,Oa="__reactContainer$"+gd,av="__reactEvents$"+gd,UO="__reactListeners$"+gd,HO="__reactHandles$"+gd;function pl(e){var t=e[Xi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Oa]||r[Xi]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=SS(e);e!==null;){if(r=e[Xi])return r;e=SS(e)}return t}e=r,r=e.parentNode}return null}function up(e){return e=e[Xi]||e[Oa],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(st(33))}function Fg(e){return e[Eu]||null}var ov=[],yc=-1;function qo(e){return{current:e}}function Dr(e){0>yc||(e.current=ov[yc],ov[yc]=null,yc--)}function Tr(e,t){yc++,ov[yc]=e.current,e.current=t}var Bo={},ns=qo(Bo),_s=qo(!1),Dl=Bo;function qc(e,t){var r=e.type.contextTypes;if(!r)return Bo;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in r)i[a]=t[a];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function As(e){return e=e.childContextTypes,e!=null}function Sh(){Dr(_s),Dr(ns)}function kS(e,t,r){if(ns.current!==Bo)throw Error(st(168));Tr(ns,t),Tr(_s,r)}function JA(e,t,r){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var i in s)if(!(i in t))throw Error(st(108,AR(e)||"Unknown",i));return Vr({},r,s)}function kh(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Bo,Dl=ns.current,Tr(ns,e),Tr(_s,_s.current),!0}function NS(e,t,r){var s=e.stateNode;if(!s)throw Error(st(169));r?(e=JA(e,t,Dl),s.__reactInternalMemoizedMergedChildContext=e,Dr(_s),Dr(ns),Tr(ns,e)):Dr(_s),Tr(_s,r)}var va=null,Wg=!1,Dx=!1;function ZA(e){va===null?va=[e]:va.push(e)}function YO(e){Wg=!0,ZA(e)}function Go(){if(!Dx&&va!==null){Dx=!0;var e=0,t=Cr;try{var r=va;for(Cr=1;e<r.length;e++){var s=r[e];do s=s(!0);while(s!==null)}va=null,Wg=!1}catch(i){throw va!==null&&(va=va.slice(e+1)),kA(m1,Go),i}finally{Cr=t,Dx=!1}}return null}var vc=[],bc=0,Nh=null,Ch=0,si=[],ii=0,Ml=null,Na=1,Ca="";function ol(e,t){vc[bc++]=Ch,vc[bc++]=Nh,Nh=e,Ch=t}function eE(e,t,r){si[ii++]=Na,si[ii++]=Ca,si[ii++]=Ml,Ml=e;var s=Na;e=Ca;var i=32-Ti(s)-1;s&=~(1<<i),r+=1;var a=32-Ti(t)+i;if(30<a){var o=i-i%5;a=(s&(1<<o)-1).toString(32),s>>=o,i-=o,Na=1<<32-Ti(t)+i|r<<i|s,Ca=a+e}else Na=1<<a|r<<i|s,Ca=e}function N1(e){e.return!==null&&(ol(e,1),eE(e,1,0))}function C1(e){for(;e===Nh;)Nh=vc[--bc],vc[bc]=null,Ch=vc[--bc],vc[bc]=null;for(;e===Ml;)Ml=si[--ii],si[ii]=null,Ca=si[--ii],si[ii]=null,Na=si[--ii],si[ii]=null}var Ys=null,Us=null,Fr=!1,_i=null;function tE(e,t){var r=oi(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function CS(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ys=e,Us=Eo(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ys=e,Us=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Ml!==null?{id:Na,overflow:Ca}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=oi(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Ys=e,Us=null,!0):!1;default:return!1}}function lv(e){return(e.mode&1)!==0&&(e.flags&128)===0}function cv(e){if(Fr){var t=Us;if(t){var r=t;if(!CS(e,t)){if(lv(e))throw Error(st(418));t=Eo(r.nextSibling);var s=Ys;t&&CS(e,t)?tE(s,r):(e.flags=e.flags&-4097|2,Fr=!1,Ys=e)}}else{if(lv(e))throw Error(st(418));e.flags=e.flags&-4097|2,Fr=!1,Ys=e}}}function _S(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ys=e}function uf(e){if(e!==Ys)return!1;if(!Fr)return _S(e),Fr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!sv(e.type,e.memoizedProps)),t&&(t=Us)){if(lv(e))throw rE(),Error(st(418));for(;t;)tE(e,t),t=Eo(t.nextSibling)}if(_S(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(st(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Us=Eo(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Us=null}}else Us=Ys?Eo(e.stateNode.nextSibling):null;return!0}function rE(){for(var e=Us;e;)e=Eo(e.nextSibling)}function Gc(){Us=Ys=null,Fr=!1}function _1(e){_i===null?_i=[e]:_i.push(e)}var KO=Ka.ReactCurrentBatchConfig;function Fd(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(st(309));var s=r.stateNode}if(!s)throw Error(st(147,e));var i=s,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var l=i.refs;o===null?delete l[a]:l[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(st(284));if(!r._owner)throw Error(st(290,e))}return e}function pf(e,t){throw e=Object.prototype.toString.call(t),Error(st(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function AS(e){var t=e._init;return t(e._payload)}function nE(e){function t(v,S){if(e){var k=v.deletions;k===null?(v.deletions=[S],v.flags|=16):k.push(S)}}function r(v,S){if(!e)return null;for(;S!==null;)t(v,S),S=S.sibling;return null}function s(v,S){for(v=new Map;S!==null;)S.key!==null?v.set(S.key,S):v.set(S.index,S),S=S.sibling;return v}function i(v,S){return v=Ro(v,S),v.index=0,v.sibling=null,v}function a(v,S,k){return v.index=k,e?(k=v.alternate,k!==null?(k=k.index,k<S?(v.flags|=2,S):k):(v.flags|=2,S)):(v.flags|=1048576,S)}function o(v){return e&&v.alternate===null&&(v.flags|=2),v}function l(v,S,k,j){return S===null||S.tag!==6?(S=Yx(k,v.mode,j),S.return=v,S):(S=i(S,k),S.return=v,S)}function c(v,S,k,j){var _=k.type;return _===fc?d(v,S,k.props.children,j,k.key):S!==null&&(S.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ao&&AS(_)===S.type)?(j=i(S,k.props),j.ref=Fd(v,S,k),j.return=v,j):(j=Zf(k.type,k.key,k.props,null,v.mode,j),j.ref=Fd(v,S,k),j.return=v,j)}function u(v,S,k,j){return S===null||S.tag!==4||S.stateNode.containerInfo!==k.containerInfo||S.stateNode.implementation!==k.implementation?(S=Kx(k,v.mode,j),S.return=v,S):(S=i(S,k.children||[]),S.return=v,S)}function d(v,S,k,j,_){return S===null||S.tag!==7?(S=Pl(k,v.mode,j,_),S.return=v,S):(S=i(S,k),S.return=v,S)}function f(v,S,k){if(typeof S=="string"&&S!==""||typeof S=="number")return S=Yx(""+S,v.mode,k),S.return=v,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ef:return k=Zf(S.type,S.key,S.props,null,v.mode,k),k.ref=Fd(v,null,S),k.return=v,k;case pc:return S=Kx(S,v.mode,k),S.return=v,S;case ao:var j=S._init;return f(v,j(S._payload),k)}if(ru(S)||Ld(S))return S=Pl(S,v.mode,k,null),S.return=v,S;pf(v,S)}return null}function h(v,S,k,j){var _=S!==null?S.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return _!==null?null:l(v,S,""+k,j);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case ef:return k.key===_?c(v,S,k,j):null;case pc:return k.key===_?u(v,S,k,j):null;case ao:return _=k._init,h(v,S,_(k._payload),j)}if(ru(k)||Ld(k))return _!==null?null:d(v,S,k,j,null);pf(v,k)}return null}function m(v,S,k,j,_){if(typeof j=="string"&&j!==""||typeof j=="number")return v=v.get(k)||null,l(S,v,""+j,_);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case ef:return v=v.get(j.key===null?k:j.key)||null,c(S,v,j,_);case pc:return v=v.get(j.key===null?k:j.key)||null,u(S,v,j,_);case ao:var b=j._init;return m(v,S,k,b(j._payload),_)}if(ru(j)||Ld(j))return v=v.get(k)||null,d(S,v,j,_,null);pf(S,j)}return null}function g(v,S,k,j){for(var _=null,b=null,A=S,z=S=0,D=null;A!==null&&z<k.length;z++){A.index>z?(D=A,A=null):D=A.sibling;var w=h(v,A,k[z],j);if(w===null){A===null&&(A=D);break}e&&A&&w.alternate===null&&t(v,A),S=a(w,S,z),b===null?_=w:b.sibling=w,b=w,A=D}if(z===k.length)return r(v,A),Fr&&ol(v,z),_;if(A===null){for(;z<k.length;z++)A=f(v,k[z],j),A!==null&&(S=a(A,S,z),b===null?_=A:b.sibling=A,b=A);return Fr&&ol(v,z),_}for(A=s(v,A);z<k.length;z++)D=m(A,v,z,k[z],j),D!==null&&(e&&D.alternate!==null&&A.delete(D.key===null?z:D.key),S=a(D,S,z),b===null?_=D:b.sibling=D,b=D);return e&&A.forEach(function(N){return t(v,N)}),Fr&&ol(v,z),_}function x(v,S,k,j){var _=Ld(k);if(typeof _!="function")throw Error(st(150));if(k=_.call(k),k==null)throw Error(st(151));for(var b=_=null,A=S,z=S=0,D=null,w=k.next();A!==null&&!w.done;z++,w=k.next()){A.index>z?(D=A,A=null):D=A.sibling;var N=h(v,A,w.value,j);if(N===null){A===null&&(A=D);break}e&&A&&N.alternate===null&&t(v,A),S=a(N,S,z),b===null?_=N:b.sibling=N,b=N,A=D}if(w.done)return r(v,A),Fr&&ol(v,z),_;if(A===null){for(;!w.done;z++,w=k.next())w=f(v,w.value,j),w!==null&&(S=a(w,S,z),b===null?_=w:b.sibling=w,b=w);return Fr&&ol(v,z),_}for(A=s(v,A);!w.done;z++,w=k.next())w=m(A,v,z,w.value,j),w!==null&&(e&&w.alternate!==null&&A.delete(w.key===null?z:w.key),S=a(w,S,z),b===null?_=w:b.sibling=w,b=w);return e&&A.forEach(function($){return t(v,$)}),Fr&&ol(v,z),_}function y(v,S,k,j){if(typeof k=="object"&&k!==null&&k.type===fc&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case ef:e:{for(var _=k.key,b=S;b!==null;){if(b.key===_){if(_=k.type,_===fc){if(b.tag===7){r(v,b.sibling),S=i(b,k.props.children),S.return=v,v=S;break e}}else if(b.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ao&&AS(_)===b.type){r(v,b.sibling),S=i(b,k.props),S.ref=Fd(v,b,k),S.return=v,v=S;break e}r(v,b);break}else t(v,b);b=b.sibling}k.type===fc?(S=Pl(k.props.children,v.mode,j,k.key),S.return=v,v=S):(j=Zf(k.type,k.key,k.props,null,v.mode,j),j.ref=Fd(v,S,k),j.return=v,v=j)}return o(v);case pc:e:{for(b=k.key;S!==null;){if(S.key===b)if(S.tag===4&&S.stateNode.containerInfo===k.containerInfo&&S.stateNode.implementation===k.implementation){r(v,S.sibling),S=i(S,k.children||[]),S.return=v,v=S;break e}else{r(v,S);break}else t(v,S);S=S.sibling}S=Kx(k,v.mode,j),S.return=v,v=S}return o(v);case ao:return b=k._init,y(v,S,b(k._payload),j)}if(ru(k))return g(v,S,k,j);if(Ld(k))return x(v,S,k,j);pf(v,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,S!==null&&S.tag===6?(r(v,S.sibling),S=i(S,k),S.return=v,v=S):(r(v,S),S=Yx(k,v.mode,j),S.return=v,v=S),o(v)):r(v,S)}return y}var Xc=nE(!0),sE=nE(!1),_h=qo(null),Ah=null,jc=null,A1=null;function E1(){A1=jc=Ah=null}function P1(e){var t=_h.current;Dr(_h),e._currentValue=t}function dv(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function Pc(e,t){Ah=e,A1=jc=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ns=!0),e.firstContext=null)}function di(e){var t=e._currentValue;if(A1!==e)if(e={context:e,memoizedValue:t,next:null},jc===null){if(Ah===null)throw Error(st(308));jc=e,Ah.dependencies={lanes:0,firstContext:e}}else jc=jc.next=e;return t}var fl=null;function I1(e){fl===null?fl=[e]:fl.push(e)}function iE(e,t,r,s){var i=t.interleaved;return i===null?(r.next=r,I1(t)):(r.next=i.next,i.next=r),t.interleaved=r,za(e,s)}function za(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var oo=!1;function T1(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aE(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ea(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Po(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,xr&2){var i=s.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),s.pending=t,za(e,r)}return i=s.interleaved,i===null?(t.next=t,I1(s)):(t.next=i.next,i.next=t),s.interleaved=t,za(e,r)}function Vf(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,x1(e,r)}}function ES(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var i=null,a=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};a===null?i=a=o:a=a.next=o,r=r.next}while(r!==null);a===null?i=a=t:a=a.next=t}else i=a=t;r={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:s.shared,effects:s.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Eh(e,t,r,s){var i=e.updateQueue;oo=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?a=u:o.next=u,o=c;var d=e.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(a!==null){var f=i.baseState;o=0,d=u=c=null,l=a;do{var h=l.lane,m=l.eventTime;if((s&h)===h){d!==null&&(d=d.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var g=e,x=l;switch(h=t,m=r,x.tag){case 1:if(g=x.payload,typeof g=="function"){f=g.call(m,f,h);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=x.payload,h=typeof g=="function"?g.call(m,f,h):g,h==null)break e;f=Vr({},f,h);break e;case 2:oo=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=i.effects,h===null?i.effects=[l]:h.push(l))}else m={eventTime:m,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=m,c=f):d=d.next=m,o|=h;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;h=l,l=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(d===null&&(c=f),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=d,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);Fl|=o,e.lanes=o,e.memoizedState=f}}function PS(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],i=s.callback;if(i!==null){if(s.callback=null,s=r,typeof i!="function")throw Error(st(191,i));i.call(s)}}}var pp={},ea=qo(pp),Pu=qo(pp),Iu=qo(pp);function hl(e){if(e===pp)throw Error(st(174));return e}function R1(e,t){switch(Tr(Iu,t),Tr(Pu,e),Tr(ea,pp),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Hy(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Hy(t,e)}Dr(ea),Tr(ea,t)}function Qc(){Dr(ea),Dr(Pu),Dr(Iu)}function oE(e){hl(Iu.current);var t=hl(ea.current),r=Hy(t,e.type);t!==r&&(Tr(Pu,e),Tr(ea,r))}function O1(e){Pu.current===e&&(Dr(ea),Dr(Pu))}var Yr=qo(0);function Ph(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Mx=[];function z1(){for(var e=0;e<Mx.length;e++)Mx[e]._workInProgressVersionPrimary=null;Mx.length=0}var qf=Ka.ReactCurrentDispatcher,Bx=Ka.ReactCurrentBatchConfig,Bl=0,Kr=null,vn=null,Rn=null,Ih=!1,hu=!1,Tu=0,VO=0;function Xn(){throw Error(st(321))}function L1(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Li(e[r],t[r]))return!1;return!0}function $1(e,t,r,s,i,a){if(Bl=a,Kr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,qf.current=e===null||e.memoizedState===null?QO:JO,e=r(s,i),hu){a=0;do{if(hu=!1,Tu=0,25<=a)throw Error(st(301));a+=1,Rn=vn=null,t.updateQueue=null,qf.current=ZO,e=r(s,i)}while(hu)}if(qf.current=Th,t=vn!==null&&vn.next!==null,Bl=0,Rn=vn=Kr=null,Ih=!1,t)throw Error(st(300));return e}function D1(){var e=Tu!==0;return Tu=0,e}function Yi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rn===null?Kr.memoizedState=Rn=e:Rn=Rn.next=e,Rn}function ui(){if(vn===null){var e=Kr.alternate;e=e!==null?e.memoizedState:null}else e=vn.next;var t=Rn===null?Kr.memoizedState:Rn.next;if(t!==null)Rn=t,vn=e;else{if(e===null)throw Error(st(310));vn=e,e={memoizedState:vn.memoizedState,baseState:vn.baseState,baseQueue:vn.baseQueue,queue:vn.queue,next:null},Rn===null?Kr.memoizedState=Rn=e:Rn=Rn.next=e}return Rn}function Ru(e,t){return typeof t=="function"?t(e):t}function Fx(e){var t=ui(),r=t.queue;if(r===null)throw Error(st(311));r.lastRenderedReducer=e;var s=vn,i=s.baseQueue,a=r.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}s.baseQueue=i=a,r.pending=null}if(i!==null){a=i.next,s=s.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((Bl&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=f,o=s):c=c.next=f,Kr.lanes|=d,Fl|=d}u=u.next}while(u!==null&&u!==a);c===null?o=s:c.next=l,Li(s,t.memoizedState)||(Ns=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=c,r.lastRenderedState=s}if(e=r.interleaved,e!==null){i=e;do a=i.lane,Kr.lanes|=a,Fl|=a,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Wx(e){var t=ui(),r=t.queue;if(r===null)throw Error(st(311));r.lastRenderedReducer=e;var s=r.dispatch,i=r.pending,a=t.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);Li(a,t.memoizedState)||(Ns=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),r.lastRenderedState=a}return[a,s]}function lE(){}function cE(e,t){var r=Kr,s=ui(),i=t(),a=!Li(s.memoizedState,i);if(a&&(s.memoizedState=i,Ns=!0),s=s.queue,M1(pE.bind(null,r,s,e),[e]),s.getSnapshot!==t||a||Rn!==null&&Rn.memoizedState.tag&1){if(r.flags|=2048,Ou(9,uE.bind(null,r,s,i,t),void 0,null),zn===null)throw Error(st(349));Bl&30||dE(r,t,i)}return i}function dE(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Kr.updateQueue,t===null?(t={lastEffect:null,stores:null},Kr.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function uE(e,t,r,s){t.value=r,t.getSnapshot=s,fE(t)&&hE(e)}function pE(e,t,r){return r(function(){fE(t)&&hE(e)})}function fE(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Li(e,r)}catch{return!0}}function hE(e){var t=za(e,1);t!==null&&Ri(t,e,1,-1)}function IS(e){var t=Yi();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ru,lastRenderedState:e},t.queue=e,e=e.dispatch=XO.bind(null,Kr,e),[t.memoizedState,e]}function Ou(e,t,r,s){return e={tag:e,create:t,destroy:r,deps:s,next:null},t=Kr.updateQueue,t===null?(t={lastEffect:null,stores:null},Kr.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e)),e}function gE(){return ui().memoizedState}function Gf(e,t,r,s){var i=Yi();Kr.flags|=e,i.memoizedState=Ou(1|t,r,void 0,s===void 0?null:s)}function Ug(e,t,r,s){var i=ui();s=s===void 0?null:s;var a=void 0;if(vn!==null){var o=vn.memoizedState;if(a=o.destroy,s!==null&&L1(s,o.deps)){i.memoizedState=Ou(t,r,a,s);return}}Kr.flags|=e,i.memoizedState=Ou(1|t,r,a,s)}function TS(e,t){return Gf(8390656,8,e,t)}function M1(e,t){return Ug(2048,8,e,t)}function mE(e,t){return Ug(4,2,e,t)}function xE(e,t){return Ug(4,4,e,t)}function yE(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function vE(e,t,r){return r=r!=null?r.concat([e]):null,Ug(4,4,yE.bind(null,t,e),r)}function B1(){}function bE(e,t){var r=ui();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&L1(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function jE(e,t){var r=ui();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&L1(t,s[1])?s[0]:(e=e(),r.memoizedState=[e,t],e)}function wE(e,t,r){return Bl&21?(Li(r,t)||(r=_A(),Kr.lanes|=r,Fl|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ns=!0),e.memoizedState=r)}function qO(e,t){var r=Cr;Cr=r!==0&&4>r?r:4,e(!0);var s=Bx.transition;Bx.transition={};try{e(!1),t()}finally{Cr=r,Bx.transition=s}}function SE(){return ui().memoizedState}function GO(e,t,r){var s=To(e);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},kE(e))NE(t,r);else if(r=iE(e,t,r,s),r!==null){var i=fs();Ri(r,e,s,i),CE(r,t,s)}}function XO(e,t,r){var s=To(e),i={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(kE(e))NE(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,l=a(o,r);if(i.hasEagerState=!0,i.eagerState=l,Li(l,o)){var c=t.interleaved;c===null?(i.next=i,I1(t)):(i.next=c.next,c.next=i),t.interleaved=i;return}}catch{}finally{}r=iE(e,t,i,s),r!==null&&(i=fs(),Ri(r,e,s,i),CE(r,t,s))}}function kE(e){var t=e.alternate;return e===Kr||t!==null&&t===Kr}function NE(e,t){hu=Ih=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function CE(e,t,r){if(r&4194240){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,x1(e,r)}}var Th={readContext:di,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},QO={readContext:di,useCallback:function(e,t){return Yi().memoizedState=[e,t===void 0?null:t],e},useContext:di,useEffect:TS,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Gf(4194308,4,yE.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Gf(4194308,4,e,t)},useInsertionEffect:function(e,t){return Gf(4,2,e,t)},useMemo:function(e,t){var r=Yi();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var s=Yi();return t=r!==void 0?r(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=GO.bind(null,Kr,e),[s.memoizedState,e]},useRef:function(e){var t=Yi();return e={current:e},t.memoizedState=e},useState:IS,useDebugValue:B1,useDeferredValue:function(e){return Yi().memoizedState=e},useTransition:function(){var e=IS(!1),t=e[0];return e=qO.bind(null,e[1]),Yi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var s=Kr,i=Yi();if(Fr){if(r===void 0)throw Error(st(407));r=r()}else{if(r=t(),zn===null)throw Error(st(349));Bl&30||dE(s,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,TS(pE.bind(null,s,a,e),[e]),s.flags|=2048,Ou(9,uE.bind(null,s,a,r,t),void 0,null),r},useId:function(){var e=Yi(),t=zn.identifierPrefix;if(Fr){var r=Ca,s=Na;r=(s&~(1<<32-Ti(s)-1)).toString(32)+r,t=":"+t+"R"+r,r=Tu++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=VO++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},JO={readContext:di,useCallback:bE,useContext:di,useEffect:M1,useImperativeHandle:vE,useInsertionEffect:mE,useLayoutEffect:xE,useMemo:jE,useReducer:Fx,useRef:gE,useState:function(){return Fx(Ru)},useDebugValue:B1,useDeferredValue:function(e){var t=ui();return wE(t,vn.memoizedState,e)},useTransition:function(){var e=Fx(Ru)[0],t=ui().memoizedState;return[e,t]},useMutableSource:lE,useSyncExternalStore:cE,useId:SE,unstable_isNewReconciler:!1},ZO={readContext:di,useCallback:bE,useContext:di,useEffect:M1,useImperativeHandle:vE,useInsertionEffect:mE,useLayoutEffect:xE,useMemo:jE,useReducer:Wx,useRef:gE,useState:function(){return Wx(Ru)},useDebugValue:B1,useDeferredValue:function(e){var t=ui();return vn===null?t.memoizedState=e:wE(t,vn.memoizedState,e)},useTransition:function(){var e=Wx(Ru)[0],t=ui().memoizedState;return[e,t]},useMutableSource:lE,useSyncExternalStore:cE,useId:SE,unstable_isNewReconciler:!1};function wi(e,t){if(e&&e.defaultProps){t=Vr({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function uv(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:Vr({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Hg={isMounted:function(e){return(e=e._reactInternals)?rc(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var s=fs(),i=To(e),a=Ea(s,i);a.payload=t,r!=null&&(a.callback=r),t=Po(e,a,i),t!==null&&(Ri(t,e,i,s),Vf(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=fs(),i=To(e),a=Ea(s,i);a.tag=1,a.payload=t,r!=null&&(a.callback=r),t=Po(e,a,i),t!==null&&(Ri(t,e,i,s),Vf(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=fs(),s=To(e),i=Ea(r,s);i.tag=2,t!=null&&(i.callback=t),t=Po(e,i,s),t!==null&&(Ri(t,e,s,r),Vf(t,e,s))}};function RS(e,t,r,s,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,a,o):t.prototype&&t.prototype.isPureReactComponent?!Cu(r,s)||!Cu(i,a):!0}function _E(e,t,r){var s=!1,i=Bo,a=t.contextType;return typeof a=="object"&&a!==null?a=di(a):(i=As(t)?Dl:ns.current,s=t.contextTypes,a=(s=s!=null)?qc(e,i):Bo),t=new t(r,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Hg,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function OS(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&Hg.enqueueReplaceState(t,t.state,null)}function pv(e,t,r,s){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs={},T1(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=di(a):(a=As(t)?Dl:ns.current,i.context=qc(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(uv(e,t,a,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Hg.enqueueReplaceState(i,i.state,null),Eh(e,r,i,s),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Jc(e,t){try{var r="",s=t;do r+=_R(s),s=s.return;while(s);var i=r}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function Ux(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function fv(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var ez=typeof WeakMap=="function"?WeakMap:Map;function AE(e,t,r){r=Ea(-1,r),r.tag=3,r.payload={element:null};var s=t.value;return r.callback=function(){Oh||(Oh=!0,Sv=s),fv(e,t)},r}function EE(e,t,r){r=Ea(-1,r),r.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var i=t.value;r.payload=function(){return s(i)},r.callback=function(){fv(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(r.callback=function(){fv(e,t),typeof s!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function zS(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new ez;var i=new Set;s.set(t,i)}else i=s.get(t),i===void 0&&(i=new Set,s.set(t,i));i.has(r)||(i.add(r),e=hz.bind(null,e,t,r),t.then(e,e))}function LS(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function $S(e,t,r,s,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ea(-1,1),t.tag=2,Po(r,t,1))),r.lanes|=1),e)}var tz=Ka.ReactCurrentOwner,Ns=!1;function ds(e,t,r,s){t.child=e===null?sE(t,null,r,s):Xc(t,e.child,r,s)}function DS(e,t,r,s,i){r=r.render;var a=t.ref;return Pc(t,i),s=$1(e,t,r,s,a,i),r=D1(),e!==null&&!Ns?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,La(e,t,i)):(Fr&&r&&N1(t),t.flags|=1,ds(e,t,s,i),t.child)}function MS(e,t,r,s,i){if(e===null){var a=r.type;return typeof a=="function"&&!q1(a)&&a.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=a,PE(e,t,a,s,i)):(e=Zf(r.type,null,s,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(r=r.compare,r=r!==null?r:Cu,r(o,s)&&e.ref===t.ref)return La(e,t,i)}return t.flags|=1,e=Ro(a,s),e.ref=t.ref,e.return=t,t.child=e}function PE(e,t,r,s,i){if(e!==null){var a=e.memoizedProps;if(Cu(a,s)&&e.ref===t.ref)if(Ns=!1,t.pendingProps=s=a,(e.lanes&i)!==0)e.flags&131072&&(Ns=!0);else return t.lanes=e.lanes,La(e,t,i)}return hv(e,t,r,s,i)}function IE(e,t,r){var s=t.pendingProps,i=s.children,a=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(Sc,Ms),Ms|=r;else{if(!(r&1073741824))return e=a!==null?a.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tr(Sc,Ms),Ms|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=a!==null?a.baseLanes:r,Tr(Sc,Ms),Ms|=s}else a!==null?(s=a.baseLanes|r,t.memoizedState=null):s=r,Tr(Sc,Ms),Ms|=s;return ds(e,t,i,r),t.child}function TE(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function hv(e,t,r,s,i){var a=As(r)?Dl:ns.current;return a=qc(t,a),Pc(t,i),r=$1(e,t,r,s,a,i),s=D1(),e!==null&&!Ns?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,La(e,t,i)):(Fr&&s&&N1(t),t.flags|=1,ds(e,t,r,i),t.child)}function BS(e,t,r,s,i){if(As(r)){var a=!0;kh(t)}else a=!1;if(Pc(t,i),t.stateNode===null)Xf(e,t),_E(t,r,s),pv(t,r,s,i),s=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,u=r.contextType;typeof u=="object"&&u!==null?u=di(u):(u=As(r)?Dl:ns.current,u=qc(t,u));var d=r.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==u)&&OS(t,o,s,u),oo=!1;var h=t.memoizedState;o.state=h,Eh(t,s,o,i),c=t.memoizedState,l!==s||h!==c||_s.current||oo?(typeof d=="function"&&(uv(t,r,d,s),c=t.memoizedState),(l=oo||RS(t,r,l,s,h,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),o.props=s,o.state=c,o.context=u,s=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{o=t.stateNode,aE(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:wi(t.type,l),o.props=u,f=t.pendingProps,h=o.context,c=r.contextType,typeof c=="object"&&c!==null?c=di(c):(c=As(r)?Dl:ns.current,c=qc(t,c));var m=r.getDerivedStateFromProps;(d=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==f||h!==c)&&OS(t,o,s,c),oo=!1,h=t.memoizedState,o.state=h,Eh(t,s,o,i);var g=t.memoizedState;l!==f||h!==g||_s.current||oo?(typeof m=="function"&&(uv(t,r,m,s),g=t.memoizedState),(u=oo||RS(t,r,u,s,h,g,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=g),o.props=s,o.state=g,o.context=c,s=u):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),s=!1)}return gv(e,t,r,s,a,i)}function gv(e,t,r,s,i,a){TE(e,t);var o=(t.flags&128)!==0;if(!s&&!o)return i&&NS(t,r,!1),La(e,t,a);s=t.stateNode,tz.current=t;var l=o&&typeof r.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&o?(t.child=Xc(t,e.child,null,a),t.child=Xc(t,null,l,a)):ds(e,t,l,a),t.memoizedState=s.state,i&&NS(t,r,!0),t.child}function RE(e){var t=e.stateNode;t.pendingContext?kS(e,t.pendingContext,t.pendingContext!==t.context):t.context&&kS(e,t.context,!1),R1(e,t.containerInfo)}function FS(e,t,r,s,i){return Gc(),_1(i),t.flags|=256,ds(e,t,r,s),t.child}var mv={dehydrated:null,treeContext:null,retryLane:0};function xv(e){return{baseLanes:e,cachePool:null,transitions:null}}function OE(e,t,r){var s=t.pendingProps,i=Yr.current,a=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(i&2)!==0),l?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),Tr(Yr,i&1),e===null)return cv(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=s.children,e=s.fallback,a?(s=t.mode,a=t.child,o={mode:"hidden",children:o},!(s&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=Vg(o,s,0,null),e=Pl(e,s,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=xv(r),t.memoizedState=mv,e):F1(t,o));if(i=e.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return rz(e,t,o,s,l,i,r);if(a){a=s.fallback,o=t.mode,i=e.child,l=i.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&t.child!==i?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=Ro(i,c),s.subtreeFlags=i.subtreeFlags&14680064),l!==null?a=Ro(l,a):(a=Pl(a,o,r,null),a.flags|=2),a.return=t,s.return=t,s.sibling=a,t.child=s,s=a,a=t.child,o=e.child.memoizedState,o=o===null?xv(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~r,t.memoizedState=mv,s}return a=e.child,e=a.sibling,s=Ro(a,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=r),s.return=t,s.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function F1(e,t){return t=Vg({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ff(e,t,r,s){return s!==null&&_1(s),Xc(t,e.child,null,r),e=F1(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function rz(e,t,r,s,i,a,o){if(r)return t.flags&256?(t.flags&=-257,s=Ux(Error(st(422))),ff(e,t,o,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=s.fallback,i=t.mode,s=Vg({mode:"visible",children:s.children},i,0,null),a=Pl(a,i,o,null),a.flags|=2,s.return=t,a.return=t,s.sibling=a,t.child=s,t.mode&1&&Xc(t,e.child,null,o),t.child.memoizedState=xv(o),t.memoizedState=mv,a);if(!(t.mode&1))return ff(e,t,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var l=s.dgst;return s=l,a=Error(st(419)),s=Ux(a,s,void 0),ff(e,t,o,s)}if(l=(o&e.childLanes)!==0,Ns||l){if(s=zn,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,za(e,i),Ri(s,e,i,-1))}return V1(),s=Ux(Error(st(421))),ff(e,t,o,s)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=gz.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,Us=Eo(i.nextSibling),Ys=t,Fr=!0,_i=null,e!==null&&(si[ii++]=Na,si[ii++]=Ca,si[ii++]=Ml,Na=e.id,Ca=e.overflow,Ml=t),t=F1(t,s.children),t.flags|=4096,t)}function WS(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),dv(e.return,t,r)}function Hx(e,t,r,s,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=s,a.tail=r,a.tailMode=i)}function zE(e,t,r){var s=t.pendingProps,i=s.revealOrder,a=s.tail;if(ds(e,t,s.children,r),s=Yr.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&WS(e,r,t);else if(e.tag===19)WS(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(Tr(Yr,s),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&Ph(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),Hx(t,!1,i,r,a);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Ph(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}Hx(t,!0,r,null,a);break;case"together":Hx(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Xf(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function La(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Fl|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(st(153));if(t.child!==null){for(e=t.child,r=Ro(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Ro(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function nz(e,t,r){switch(t.tag){case 3:RE(t),Gc();break;case 5:oE(t);break;case 1:As(t.type)&&kh(t);break;case 4:R1(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,i=t.memoizedProps.value;Tr(_h,s._currentValue),s._currentValue=i;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(Tr(Yr,Yr.current&1),t.flags|=128,null):r&t.child.childLanes?OE(e,t,r):(Tr(Yr,Yr.current&1),e=La(e,t,r),e!==null?e.sibling:null);Tr(Yr,Yr.current&1);break;case 19:if(s=(r&t.childLanes)!==0,e.flags&128){if(s)return zE(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Tr(Yr,Yr.current),s)break;return null;case 22:case 23:return t.lanes=0,IE(e,t,r)}return La(e,t,r)}var LE,yv,$E,DE;LE=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};yv=function(){};$E=function(e,t,r,s){var i=e.memoizedProps;if(i!==s){e=t.stateNode,hl(ea.current);var a=null;switch(r){case"input":i=By(e,i),s=By(e,s),a=[];break;case"select":i=Vr({},i,{value:void 0}),s=Vr({},s,{value:void 0}),a=[];break;case"textarea":i=Uy(e,i),s=Uy(e,s),a=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=wh)}Yy(r,s);var o;r=null;for(u in i)if(!s.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(vu.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in s){var c=s[u];if(l=i!=null?i[u]:void 0,s.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(a||(a=[]),a.push(u,r)),r=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(a=a||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(vu.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Lr("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}r&&(a=a||[]).push("style",r);var u=a;(t.updateQueue=u)&&(t.flags|=4)}};DE=function(e,t,r,s){r!==s&&(t.flags|=4)};function Wd(e,t){if(!Fr)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Qn(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function sz(e,t,r){var s=t.pendingProps;switch(C1(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qn(t),null;case 1:return As(t.type)&&Sh(),Qn(t),null;case 3:return s=t.stateNode,Qc(),Dr(_s),Dr(ns),z1(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(uf(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,_i!==null&&(Cv(_i),_i=null))),yv(e,t),Qn(t),null;case 5:O1(t);var i=hl(Iu.current);if(r=t.type,e!==null&&t.stateNode!=null)$E(e,t,r,s,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(st(166));return Qn(t),null}if(e=hl(ea.current),uf(t)){s=t.stateNode,r=t.type;var a=t.memoizedProps;switch(s[Xi]=t,s[Eu]=a,e=(t.mode&1)!==0,r){case"dialog":Lr("cancel",s),Lr("close",s);break;case"iframe":case"object":case"embed":Lr("load",s);break;case"video":case"audio":for(i=0;i<su.length;i++)Lr(su[i],s);break;case"source":Lr("error",s);break;case"img":case"image":case"link":Lr("error",s),Lr("load",s);break;case"details":Lr("toggle",s);break;case"input":Qw(s,a),Lr("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!a.multiple},Lr("invalid",s);break;case"textarea":Zw(s,a),Lr("invalid",s)}Yy(r,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?s.textContent!==l&&(a.suppressHydrationWarning!==!0&&df(s.textContent,l,e),i=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&df(s.textContent,l,e),i=["children",""+l]):vu.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Lr("scroll",s)}switch(r){case"input":tf(s),Jw(s,a,!0);break;case"textarea":tf(s),eS(s);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(s.onclick=wh)}s=i,t.updateQueue=s,s!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=pA(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=o.createElement(r,{is:s.is}):(e=o.createElement(r),r==="select"&&(o=e,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):e=o.createElementNS(e,r),e[Xi]=t,e[Eu]=s,LE(e,t,!1,!1),t.stateNode=e;e:{switch(o=Ky(r,s),r){case"dialog":Lr("cancel",e),Lr("close",e),i=s;break;case"iframe":case"object":case"embed":Lr("load",e),i=s;break;case"video":case"audio":for(i=0;i<su.length;i++)Lr(su[i],e);i=s;break;case"source":Lr("error",e),i=s;break;case"img":case"image":case"link":Lr("error",e),Lr("load",e),i=s;break;case"details":Lr("toggle",e),i=s;break;case"input":Qw(e,s),i=By(e,s),Lr("invalid",e);break;case"option":i=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},i=Vr({},s,{value:void 0}),Lr("invalid",e);break;case"textarea":Zw(e,s),i=Uy(e,s),Lr("invalid",e);break;default:i=s}Yy(r,i),l=i;for(a in l)if(l.hasOwnProperty(a)){var c=l[a];a==="style"?gA(e,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&fA(e,c)):a==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&bu(e,c):typeof c=="number"&&bu(e,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(vu.hasOwnProperty(a)?c!=null&&a==="onScroll"&&Lr("scroll",e):c!=null&&u1(e,a,c,o))}switch(r){case"input":tf(e),Jw(e,s,!1);break;case"textarea":tf(e),eS(e);break;case"option":s.value!=null&&e.setAttribute("value",""+Mo(s.value));break;case"select":e.multiple=!!s.multiple,a=s.value,a!=null?Cc(e,!!s.multiple,a,!1):s.defaultValue!=null&&Cc(e,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=wh)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Qn(t),null;case 6:if(e&&t.stateNode!=null)DE(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(st(166));if(r=hl(Iu.current),hl(ea.current),uf(t)){if(s=t.stateNode,r=t.memoizedProps,s[Xi]=t,(a=s.nodeValue!==r)&&(e=Ys,e!==null))switch(e.tag){case 3:df(s.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&df(s.nodeValue,r,(e.mode&1)!==0)}a&&(t.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Xi]=t,t.stateNode=s}return Qn(t),null;case 13:if(Dr(Yr),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Fr&&Us!==null&&t.mode&1&&!(t.flags&128))rE(),Gc(),t.flags|=98560,a=!1;else if(a=uf(t),s!==null&&s.dehydrated!==null){if(e===null){if(!a)throw Error(st(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(st(317));a[Xi]=t}else Gc(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Qn(t),a=!1}else _i!==null&&(Cv(_i),_i=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Yr.current&1?jn===0&&(jn=3):V1())),t.updateQueue!==null&&(t.flags|=4),Qn(t),null);case 4:return Qc(),yv(e,t),e===null&&_u(t.stateNode.containerInfo),Qn(t),null;case 10:return P1(t.type._context),Qn(t),null;case 17:return As(t.type)&&Sh(),Qn(t),null;case 19:if(Dr(Yr),a=t.memoizedState,a===null)return Qn(t),null;if(s=(t.flags&128)!==0,o=a.rendering,o===null)if(s)Wd(a,!1);else{if(jn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Ph(e),o!==null){for(t.flags|=128,Wd(a,!1),s=o.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=r,r=t.child;r!==null;)a=r,e=s,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Tr(Yr,Yr.current&1|2),t.child}e=e.sibling}a.tail!==null&&tn()>Zc&&(t.flags|=128,s=!0,Wd(a,!1),t.lanes=4194304)}else{if(!s)if(e=Ph(o),e!==null){if(t.flags|=128,s=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Wd(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Fr)return Qn(t),null}else 2*tn()-a.renderingStartTime>Zc&&r!==1073741824&&(t.flags|=128,s=!0,Wd(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(r=a.last,r!==null?r.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=tn(),t.sibling=null,r=Yr.current,Tr(Yr,s?r&1|2:r&1),t):(Qn(t),null);case 22:case 23:return K1(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Ms&1073741824&&(Qn(t),t.subtreeFlags&6&&(t.flags|=8192)):Qn(t),null;case 24:return null;case 25:return null}throw Error(st(156,t.tag))}function iz(e,t){switch(C1(t),t.tag){case 1:return As(t.type)&&Sh(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Qc(),Dr(_s),Dr(ns),z1(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return O1(t),null;case 13:if(Dr(Yr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(st(340));Gc()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Dr(Yr),null;case 4:return Qc(),null;case 10:return P1(t.type._context),null;case 22:case 23:return K1(),null;case 24:return null;default:return null}}var hf=!1,Zn=!1,az=typeof WeakSet=="function"?WeakSet:Set,Pt=null;function wc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){Jr(e,t,s)}else r.current=null}function vv(e,t,r){try{r()}catch(s){Jr(e,t,s)}}var US=!1;function oz(e,t){if(rv=vh,e=UA(),k1(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var i=s.anchorOffset,a=s.focusNode;s=s.focusOffset;try{r.nodeType,a.nodeType}catch{r=null;break e}var o=0,l=-1,c=-1,u=0,d=0,f=e,h=null;t:for(;;){for(var m;f!==r||i!==0&&f.nodeType!==3||(l=o+i),f!==a||s!==0&&f.nodeType!==3||(c=o+s),f.nodeType===3&&(o+=f.nodeValue.length),(m=f.firstChild)!==null;)h=f,f=m;for(;;){if(f===e)break t;if(h===r&&++u===i&&(l=o),h===a&&++d===s&&(c=o),(m=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=m}r=l===-1||c===-1?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(nv={focusedElem:e,selectionRange:r},vh=!1,Pt=t;Pt!==null;)if(t=Pt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Pt=e;else for(;Pt!==null;){t=Pt;try{var g=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var x=g.memoizedProps,y=g.memoizedState,v=t.stateNode,S=v.getSnapshotBeforeUpdate(t.elementType===t.type?x:wi(t.type,x),y);v.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(st(163))}}catch(j){Jr(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,Pt=e;break}Pt=t.return}return g=US,US=!1,g}function gu(e,t,r){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&vv(t,r,a)}i=i.next}while(i!==s)}}function Yg(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var s=r.create;r.destroy=s()}r=r.next}while(r!==t)}}function bv(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function ME(e){var t=e.alternate;t!==null&&(e.alternate=null,ME(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xi],delete t[Eu],delete t[av],delete t[UO],delete t[HO])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function BE(e){return e.tag===5||e.tag===3||e.tag===4}function HS(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||BE(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function jv(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=wh));else if(s!==4&&(e=e.child,e!==null))for(jv(e,t,r),e=e.sibling;e!==null;)jv(e,t,r),e=e.sibling}function wv(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(wv(e,t,r),e=e.sibling;e!==null;)wv(e,t,r),e=e.sibling}var Fn=null,Ni=!1;function ro(e,t,r){for(r=r.child;r!==null;)FE(e,t,r),r=r.sibling}function FE(e,t,r){if(Zi&&typeof Zi.onCommitFiberUnmount=="function")try{Zi.onCommitFiberUnmount($g,r)}catch{}switch(r.tag){case 5:Zn||wc(r,t);case 6:var s=Fn,i=Ni;Fn=null,ro(e,t,r),Fn=s,Ni=i,Fn!==null&&(Ni?(e=Fn,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Fn.removeChild(r.stateNode));break;case 18:Fn!==null&&(Ni?(e=Fn,r=r.stateNode,e.nodeType===8?$x(e.parentNode,r):e.nodeType===1&&$x(e,r),ku(e)):$x(Fn,r.stateNode));break;case 4:s=Fn,i=Ni,Fn=r.stateNode.containerInfo,Ni=!0,ro(e,t,r),Fn=s,Ni=i;break;case 0:case 11:case 14:case 15:if(!Zn&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&vv(r,t,o),i=i.next}while(i!==s)}ro(e,t,r);break;case 1:if(!Zn&&(wc(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(l){Jr(r,t,l)}ro(e,t,r);break;case 21:ro(e,t,r);break;case 22:r.mode&1?(Zn=(s=Zn)||r.memoizedState!==null,ro(e,t,r),Zn=s):ro(e,t,r);break;default:ro(e,t,r)}}function YS(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new az),t.forEach(function(s){var i=mz.bind(null,e,s);r.has(s)||(r.add(s),s.then(i,i))})}}function ji(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var i=r[s];try{var a=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Fn=l.stateNode,Ni=!1;break e;case 3:Fn=l.stateNode.containerInfo,Ni=!0;break e;case 4:Fn=l.stateNode.containerInfo,Ni=!0;break e}l=l.return}if(Fn===null)throw Error(st(160));FE(a,o,i),Fn=null,Ni=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(u){Jr(i,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)WE(t,e),t=t.sibling}function WE(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ji(t,e),Wi(e),s&4){try{gu(3,e,e.return),Yg(3,e)}catch(x){Jr(e,e.return,x)}try{gu(5,e,e.return)}catch(x){Jr(e,e.return,x)}}break;case 1:ji(t,e),Wi(e),s&512&&r!==null&&wc(r,r.return);break;case 5:if(ji(t,e),Wi(e),s&512&&r!==null&&wc(r,r.return),e.flags&32){var i=e.stateNode;try{bu(i,"")}catch(x){Jr(e,e.return,x)}}if(s&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=r!==null?r.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&dA(i,a),Ky(l,o);var u=Ky(l,a);for(o=0;o<c.length;o+=2){var d=c[o],f=c[o+1];d==="style"?gA(i,f):d==="dangerouslySetInnerHTML"?fA(i,f):d==="children"?bu(i,f):u1(i,d,f,u)}switch(l){case"input":Fy(i,a);break;case"textarea":uA(i,a);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var m=a.value;m!=null?Cc(i,!!a.multiple,m,!1):h!==!!a.multiple&&(a.defaultValue!=null?Cc(i,!!a.multiple,a.defaultValue,!0):Cc(i,!!a.multiple,a.multiple?[]:"",!1))}i[Eu]=a}catch(x){Jr(e,e.return,x)}}break;case 6:if(ji(t,e),Wi(e),s&4){if(e.stateNode===null)throw Error(st(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(x){Jr(e,e.return,x)}}break;case 3:if(ji(t,e),Wi(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{ku(t.containerInfo)}catch(x){Jr(e,e.return,x)}break;case 4:ji(t,e),Wi(e);break;case 13:ji(t,e),Wi(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(H1=tn())),s&4&&YS(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(Zn=(u=Zn)||d,ji(t,e),Zn=u):ji(t,e),Wi(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(Pt=e,d=e.child;d!==null;){for(f=Pt=d;Pt!==null;){switch(h=Pt,m=h.child,h.tag){case 0:case 11:case 14:case 15:gu(4,h,h.return);break;case 1:wc(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){s=h,r=h.return;try{t=s,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(x){Jr(s,r,x)}}break;case 5:wc(h,h.return);break;case 22:if(h.memoizedState!==null){VS(f);continue}}m!==null?(m.return=h,Pt=m):VS(f)}d=d.sibling}e:for(d=null,f=e;;){if(f.tag===5){if(d===null){d=f;try{i=f.stateNode,u?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=hA("display",o))}catch(x){Jr(e,e.return,x)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(x){Jr(e,e.return,x)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ji(t,e),Wi(e),s&4&&YS(e);break;case 21:break;default:ji(t,e),Wi(e)}}function Wi(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(BE(r)){var s=r;break e}r=r.return}throw Error(st(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(bu(i,""),s.flags&=-33);var a=HS(e);wv(e,a,i);break;case 3:case 4:var o=s.stateNode.containerInfo,l=HS(e);jv(e,l,o);break;default:throw Error(st(161))}}catch(c){Jr(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function lz(e,t,r){Pt=e,UE(e)}function UE(e,t,r){for(var s=(e.mode&1)!==0;Pt!==null;){var i=Pt,a=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||hf;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||Zn;l=hf;var u=Zn;if(hf=o,(Zn=c)&&!u)for(Pt=i;Pt!==null;)o=Pt,c=o.child,o.tag===22&&o.memoizedState!==null?qS(i):c!==null?(c.return=o,Pt=c):qS(i);for(;a!==null;)Pt=a,UE(a),a=a.sibling;Pt=i,hf=l,Zn=u}KS(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Pt=a):KS(e)}}function KS(e){for(;Pt!==null;){var t=Pt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zn||Yg(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Zn)if(r===null)s.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:wi(t.type,r.memoizedProps);s.componentDidUpdate(i,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&PS(t,a,s);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}PS(t,o,r)}break;case 5:var l=t.stateNode;if(r===null&&t.flags&4){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&ku(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(st(163))}Zn||t.flags&512&&bv(t)}catch(h){Jr(t,t.return,h)}}if(t===e){Pt=null;break}if(r=t.sibling,r!==null){r.return=t.return,Pt=r;break}Pt=t.return}}function VS(e){for(;Pt!==null;){var t=Pt;if(t===e){Pt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Pt=r;break}Pt=t.return}}function qS(e){for(;Pt!==null;){var t=Pt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Yg(4,t)}catch(c){Jr(t,r,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var i=t.return;try{s.componentDidMount()}catch(c){Jr(t,i,c)}}var a=t.return;try{bv(t)}catch(c){Jr(t,a,c)}break;case 5:var o=t.return;try{bv(t)}catch(c){Jr(t,o,c)}}}catch(c){Jr(t,t.return,c)}if(t===e){Pt=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Pt=l;break}Pt=t.return}}var cz=Math.ceil,Rh=Ka.ReactCurrentDispatcher,W1=Ka.ReactCurrentOwner,ci=Ka.ReactCurrentBatchConfig,xr=0,zn=null,cn=null,Un=0,Ms=0,Sc=qo(0),jn=0,zu=null,Fl=0,Kg=0,U1=0,mu=null,ks=null,H1=0,Zc=1/0,ya=null,Oh=!1,Sv=null,Io=null,gf=!1,So=null,zh=0,xu=0,kv=null,Qf=-1,Jf=0;function fs(){return xr&6?tn():Qf!==-1?Qf:Qf=tn()}function To(e){return e.mode&1?xr&2&&Un!==0?Un&-Un:KO.transition!==null?(Jf===0&&(Jf=_A()),Jf):(e=Cr,e!==0||(e=window.event,e=e===void 0?16:OA(e.type)),e):1}function Ri(e,t,r,s){if(50<xu)throw xu=0,kv=null,Error(st(185));cp(e,r,s),(!(xr&2)||e!==zn)&&(e===zn&&(!(xr&2)&&(Kg|=r),jn===4&&po(e,Un)),Es(e,s),r===1&&xr===0&&!(t.mode&1)&&(Zc=tn()+500,Wg&&Go()))}function Es(e,t){var r=e.callbackNode;KR(e,t);var s=yh(e,e===zn?Un:0);if(s===0)r!==null&&nS(r),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(r!=null&&nS(r),t===1)e.tag===0?YO(GS.bind(null,e)):ZA(GS.bind(null,e)),FO(function(){!(xr&6)&&Go()}),r=null;else{switch(AA(s)){case 1:r=m1;break;case 4:r=NA;break;case 16:r=xh;break;case 536870912:r=CA;break;default:r=xh}r=QE(r,HE.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function HE(e,t){if(Qf=-1,Jf=0,xr&6)throw Error(st(327));var r=e.callbackNode;if(Ic()&&e.callbackNode!==r)return null;var s=yh(e,e===zn?Un:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Lh(e,s);else{t=s;var i=xr;xr|=2;var a=KE();(zn!==e||Un!==t)&&(ya=null,Zc=tn()+500,El(e,t));do try{pz();break}catch(l){YE(e,l)}while(!0);E1(),Rh.current=a,xr=i,cn!==null?t=0:(zn=null,Un=0,t=jn)}if(t!==0){if(t===2&&(i=Qy(e),i!==0&&(s=i,t=Nv(e,i))),t===1)throw r=zu,El(e,0),po(e,s),Es(e,tn()),r;if(t===6)po(e,s);else{if(i=e.current.alternate,!(s&30)&&!dz(i)&&(t=Lh(e,s),t===2&&(a=Qy(e),a!==0&&(s=a,t=Nv(e,a))),t===1))throw r=zu,El(e,0),po(e,s),Es(e,tn()),r;switch(e.finishedWork=i,e.finishedLanes=s,t){case 0:case 1:throw Error(st(345));case 2:ll(e,ks,ya);break;case 3:if(po(e,s),(s&130023424)===s&&(t=H1+500-tn(),10<t)){if(yh(e,0)!==0)break;if(i=e.suspendedLanes,(i&s)!==s){fs(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=iv(ll.bind(null,e,ks,ya),t);break}ll(e,ks,ya);break;case 4:if(po(e,s),(s&4194240)===s)break;for(t=e.eventTimes,i=-1;0<s;){var o=31-Ti(s);a=1<<o,o=t[o],o>i&&(i=o),s&=~a}if(s=i,s=tn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*cz(s/1960))-s,10<s){e.timeoutHandle=iv(ll.bind(null,e,ks,ya),s);break}ll(e,ks,ya);break;case 5:ll(e,ks,ya);break;default:throw Error(st(329))}}}return Es(e,tn()),e.callbackNode===r?HE.bind(null,e):null}function Nv(e,t){var r=mu;return e.current.memoizedState.isDehydrated&&(El(e,t).flags|=256),e=Lh(e,t),e!==2&&(t=ks,ks=r,t!==null&&Cv(t)),e}function Cv(e){ks===null?ks=e:ks.push.apply(ks,e)}function dz(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var i=r[s],a=i.getSnapshot;i=i.value;try{if(!Li(a(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function po(e,t){for(t&=~U1,t&=~Kg,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ti(t),s=1<<r;e[r]=-1,t&=~s}}function GS(e){if(xr&6)throw Error(st(327));Ic();var t=yh(e,0);if(!(t&1))return Es(e,tn()),null;var r=Lh(e,t);if(e.tag!==0&&r===2){var s=Qy(e);s!==0&&(t=s,r=Nv(e,s))}if(r===1)throw r=zu,El(e,0),po(e,t),Es(e,tn()),r;if(r===6)throw Error(st(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ll(e,ks,ya),Es(e,tn()),null}function Y1(e,t){var r=xr;xr|=1;try{return e(t)}finally{xr=r,xr===0&&(Zc=tn()+500,Wg&&Go())}}function Wl(e){So!==null&&So.tag===0&&!(xr&6)&&Ic();var t=xr;xr|=1;var r=ci.transition,s=Cr;try{if(ci.transition=null,Cr=1,e)return e()}finally{Cr=s,ci.transition=r,xr=t,!(xr&6)&&Go()}}function K1(){Ms=Sc.current,Dr(Sc)}function El(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,BO(r)),cn!==null)for(r=cn.return;r!==null;){var s=r;switch(C1(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Sh();break;case 3:Qc(),Dr(_s),Dr(ns),z1();break;case 5:O1(s);break;case 4:Qc();break;case 13:Dr(Yr);break;case 19:Dr(Yr);break;case 10:P1(s.type._context);break;case 22:case 23:K1()}r=r.return}if(zn=e,cn=e=Ro(e.current,null),Un=Ms=t,jn=0,zu=null,U1=Kg=Fl=0,ks=mu=null,fl!==null){for(t=0;t<fl.length;t++)if(r=fl[t],s=r.interleaved,s!==null){r.interleaved=null;var i=s.next,a=r.pending;if(a!==null){var o=a.next;a.next=i,s.next=o}r.pending=s}fl=null}return e}function YE(e,t){do{var r=cn;try{if(E1(),qf.current=Th,Ih){for(var s=Kr.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Ih=!1}if(Bl=0,Rn=vn=Kr=null,hu=!1,Tu=0,W1.current=null,r===null||r.return===null){jn=1,zu=t,cn=null;break}e:{var a=e,o=r.return,l=r,c=t;if(t=Un,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=LS(o);if(m!==null){m.flags&=-257,$S(m,o,l,a,t),m.mode&1&&zS(a,u,t),t=m,c=u;var g=t.updateQueue;if(g===null){var x=new Set;x.add(c),t.updateQueue=x}else g.add(c);break e}else{if(!(t&1)){zS(a,u,t),V1();break e}c=Error(st(426))}}else if(Fr&&l.mode&1){var y=LS(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),$S(y,o,l,a,t),_1(Jc(c,l));break e}}a=c=Jc(c,l),jn!==4&&(jn=2),mu===null?mu=[a]:mu.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var v=AE(a,c,t);ES(a,v);break e;case 1:l=c;var S=a.type,k=a.stateNode;if(!(a.flags&128)&&(typeof S.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Io===null||!Io.has(k)))){a.flags|=65536,t&=-t,a.lanes|=t;var j=EE(a,l,t);ES(a,j);break e}}a=a.return}while(a!==null)}qE(r)}catch(_){t=_,cn===r&&r!==null&&(cn=r=r.return);continue}break}while(!0)}function KE(){var e=Rh.current;return Rh.current=Th,e===null?Th:e}function V1(){(jn===0||jn===3||jn===2)&&(jn=4),zn===null||!(Fl&268435455)&&!(Kg&268435455)||po(zn,Un)}function Lh(e,t){var r=xr;xr|=2;var s=KE();(zn!==e||Un!==t)&&(ya=null,El(e,t));do try{uz();break}catch(i){YE(e,i)}while(!0);if(E1(),xr=r,Rh.current=s,cn!==null)throw Error(st(261));return zn=null,Un=0,jn}function uz(){for(;cn!==null;)VE(cn)}function pz(){for(;cn!==null&&!$R();)VE(cn)}function VE(e){var t=XE(e.alternate,e,Ms);e.memoizedProps=e.pendingProps,t===null?qE(e):cn=t,W1.current=null}function qE(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=iz(r,t),r!==null){r.flags&=32767,cn=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{jn=6,cn=null;return}}else if(r=sz(r,t,Ms),r!==null){cn=r;return}if(t=t.sibling,t!==null){cn=t;return}cn=t=e}while(t!==null);jn===0&&(jn=5)}function ll(e,t,r){var s=Cr,i=ci.transition;try{ci.transition=null,Cr=1,fz(e,t,r,s)}finally{ci.transition=i,Cr=s}return null}function fz(e,t,r,s){do Ic();while(So!==null);if(xr&6)throw Error(st(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(st(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(VR(e,a),e===zn&&(cn=zn=null,Un=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||gf||(gf=!0,QE(xh,function(){return Ic(),null})),a=(r.flags&15990)!==0,r.subtreeFlags&15990||a){a=ci.transition,ci.transition=null;var o=Cr;Cr=1;var l=xr;xr|=4,W1.current=null,oz(e,r),WE(r,e),RO(nv),vh=!!rv,nv=rv=null,e.current=r,lz(r),DR(),xr=l,Cr=o,ci.transition=a}else e.current=r;if(gf&&(gf=!1,So=e,zh=i),a=e.pendingLanes,a===0&&(Io=null),FR(r.stateNode),Es(e,tn()),t!==null)for(s=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],s(i.value,{componentStack:i.stack,digest:i.digest});if(Oh)throw Oh=!1,e=Sv,Sv=null,e;return zh&1&&e.tag!==0&&Ic(),a=e.pendingLanes,a&1?e===kv?xu++:(xu=0,kv=e):xu=0,Go(),null}function Ic(){if(So!==null){var e=AA(zh),t=ci.transition,r=Cr;try{if(ci.transition=null,Cr=16>e?16:e,So===null)var s=!1;else{if(e=So,So=null,zh=0,xr&6)throw Error(st(331));var i=xr;for(xr|=4,Pt=e.current;Pt!==null;){var a=Pt,o=a.child;if(Pt.flags&16){var l=a.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(Pt=u;Pt!==null;){var d=Pt;switch(d.tag){case 0:case 11:case 15:gu(8,d,a)}var f=d.child;if(f!==null)f.return=d,Pt=f;else for(;Pt!==null;){d=Pt;var h=d.sibling,m=d.return;if(ME(d),d===u){Pt=null;break}if(h!==null){h.return=m,Pt=h;break}Pt=m}}}var g=a.alternate;if(g!==null){var x=g.child;if(x!==null){g.child=null;do{var y=x.sibling;x.sibling=null,x=y}while(x!==null)}}Pt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Pt=o;else e:for(;Pt!==null;){if(a=Pt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:gu(9,a,a.return)}var v=a.sibling;if(v!==null){v.return=a.return,Pt=v;break e}Pt=a.return}}var S=e.current;for(Pt=S;Pt!==null;){o=Pt;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,Pt=k;else e:for(o=S;Pt!==null;){if(l=Pt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Yg(9,l)}}catch(_){Jr(l,l.return,_)}if(l===o){Pt=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,Pt=j;break e}Pt=l.return}}if(xr=i,Go(),Zi&&typeof Zi.onPostCommitFiberRoot=="function")try{Zi.onPostCommitFiberRoot($g,e)}catch{}s=!0}return s}finally{Cr=r,ci.transition=t}}return!1}function XS(e,t,r){t=Jc(r,t),t=AE(e,t,1),e=Po(e,t,1),t=fs(),e!==null&&(cp(e,1,t),Es(e,t))}function Jr(e,t,r){if(e.tag===3)XS(e,e,r);else for(;t!==null;){if(t.tag===3){XS(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Io===null||!Io.has(s))){e=Jc(r,e),e=EE(t,e,1),t=Po(t,e,1),e=fs(),t!==null&&(cp(t,1,e),Es(t,e));break}}t=t.return}}function hz(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),t=fs(),e.pingedLanes|=e.suspendedLanes&r,zn===e&&(Un&r)===r&&(jn===4||jn===3&&(Un&130023424)===Un&&500>tn()-H1?El(e,0):U1|=r),Es(e,t)}function GE(e,t){t===0&&(e.mode&1?(t=sf,sf<<=1,!(sf&130023424)&&(sf=4194304)):t=1);var r=fs();e=za(e,t),e!==null&&(cp(e,t,r),Es(e,r))}function gz(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),GE(e,r)}function mz(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(st(314))}s!==null&&s.delete(t),GE(e,r)}var XE;XE=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||_s.current)Ns=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Ns=!1,nz(e,t,r);Ns=!!(e.flags&131072)}else Ns=!1,Fr&&t.flags&1048576&&eE(t,Ch,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Xf(e,t),e=t.pendingProps;var i=qc(t,ns.current);Pc(t,r),i=$1(null,t,s,e,i,r);var a=D1();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,As(s)?(a=!0,kh(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,T1(t),i.updater=Hg,t.stateNode=i,i._reactInternals=t,pv(t,s,e,r),t=gv(null,t,s,!0,a,r)):(t.tag=0,Fr&&a&&N1(t),ds(null,t,i,r),t=t.child),t;case 16:s=t.elementType;e:{switch(Xf(e,t),e=t.pendingProps,i=s._init,s=i(s._payload),t.type=s,i=t.tag=yz(s),e=wi(s,e),i){case 0:t=hv(null,t,s,e,r);break e;case 1:t=BS(null,t,s,e,r);break e;case 11:t=DS(null,t,s,e,r);break e;case 14:t=MS(null,t,s,wi(s.type,e),r);break e}throw Error(st(306,s,""))}return t;case 0:return s=t.type,i=t.pendingProps,i=t.elementType===s?i:wi(s,i),hv(e,t,s,i,r);case 1:return s=t.type,i=t.pendingProps,i=t.elementType===s?i:wi(s,i),BS(e,t,s,i,r);case 3:e:{if(RE(t),e===null)throw Error(st(387));s=t.pendingProps,a=t.memoizedState,i=a.element,aE(e,t),Eh(t,s,null,r);var o=t.memoizedState;if(s=o.element,a.isDehydrated)if(a={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=Jc(Error(st(423)),t),t=FS(e,t,s,r,i);break e}else if(s!==i){i=Jc(Error(st(424)),t),t=FS(e,t,s,r,i);break e}else for(Us=Eo(t.stateNode.containerInfo.firstChild),Ys=t,Fr=!0,_i=null,r=sE(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Gc(),s===i){t=La(e,t,r);break e}ds(e,t,s,r)}t=t.child}return t;case 5:return oE(t),e===null&&cv(t),s=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,sv(s,i)?o=null:a!==null&&sv(s,a)&&(t.flags|=32),TE(e,t),ds(e,t,o,r),t.child;case 6:return e===null&&cv(t),null;case 13:return OE(e,t,r);case 4:return R1(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Xc(t,null,s,r):ds(e,t,s,r),t.child;case 11:return s=t.type,i=t.pendingProps,i=t.elementType===s?i:wi(s,i),DS(e,t,s,i,r);case 7:return ds(e,t,t.pendingProps,r),t.child;case 8:return ds(e,t,t.pendingProps.children,r),t.child;case 12:return ds(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(s=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,Tr(_h,s._currentValue),s._currentValue=o,a!==null)if(Li(a.value,o)){if(a.children===i.children&&!_s.current){t=La(e,t,r);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(a.tag===1){c=Ea(-1,r&-r),c.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=r,c=a.alternate,c!==null&&(c.lanes|=r),dv(a.return,r,t),l.lanes|=r;break}c=c.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(st(341));o.lanes|=r,l=o.alternate,l!==null&&(l.lanes|=r),dv(o,r,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}ds(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,s=t.pendingProps.children,Pc(t,r),i=di(i),s=s(i),t.flags|=1,ds(e,t,s,r),t.child;case 14:return s=t.type,i=wi(s,t.pendingProps),i=wi(s.type,i),MS(e,t,s,i,r);case 15:return PE(e,t,t.type,t.pendingProps,r);case 17:return s=t.type,i=t.pendingProps,i=t.elementType===s?i:wi(s,i),Xf(e,t),t.tag=1,As(s)?(e=!0,kh(t)):e=!1,Pc(t,r),_E(t,s,i),pv(t,s,i,r),gv(null,t,s,!0,e,r);case 19:return zE(e,t,r);case 22:return IE(e,t,r)}throw Error(st(156,t.tag))};function QE(e,t){return kA(e,t)}function xz(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oi(e,t,r,s){return new xz(e,t,r,s)}function q1(e){return e=e.prototype,!(!e||!e.isReactComponent)}function yz(e){if(typeof e=="function")return q1(e)?1:0;if(e!=null){if(e=e.$$typeof,e===f1)return 11;if(e===h1)return 14}return 2}function Ro(e,t){var r=e.alternate;return r===null?(r=oi(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Zf(e,t,r,s,i,a){var o=2;if(s=e,typeof e=="function")q1(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case fc:return Pl(r.children,i,a,t);case p1:o=8,i|=8;break;case Ly:return e=oi(12,r,t,i|2),e.elementType=Ly,e.lanes=a,e;case $y:return e=oi(13,r,t,i),e.elementType=$y,e.lanes=a,e;case Dy:return e=oi(19,r,t,i),e.elementType=Dy,e.lanes=a,e;case oA:return Vg(r,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case iA:o=10;break e;case aA:o=9;break e;case f1:o=11;break e;case h1:o=14;break e;case ao:o=16,s=null;break e}throw Error(st(130,e==null?e:typeof e,""))}return t=oi(o,r,t,i),t.elementType=e,t.type=s,t.lanes=a,t}function Pl(e,t,r,s){return e=oi(7,e,s,t),e.lanes=r,e}function Vg(e,t,r,s){return e=oi(22,e,s,t),e.elementType=oA,e.lanes=r,e.stateNode={isHidden:!1},e}function Yx(e,t,r){return e=oi(6,e,null,t),e.lanes=r,e}function Kx(e,t,r){return t=oi(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function vz(e,t,r,s,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cx(0),this.expirationTimes=Cx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cx(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function G1(e,t,r,s,i,a,o,l,c){return e=new vz(e,t,r,l,c),t===1?(t=1,a===!0&&(t|=8)):t=0,a=oi(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},T1(a),e}function bz(e,t,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pc,key:s==null?null:""+s,children:e,containerInfo:t,implementation:r}}function JE(e){if(!e)return Bo;e=e._reactInternals;e:{if(rc(e)!==e||e.tag!==1)throw Error(st(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(As(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(st(171))}if(e.tag===1){var r=e.type;if(As(r))return JA(e,r,t)}return t}function ZE(e,t,r,s,i,a,o,l,c){return e=G1(r,s,!0,e,i,a,o,l,c),e.context=JE(null),r=e.current,s=fs(),i=To(r),a=Ea(s,i),a.callback=t??null,Po(r,a,i),e.current.lanes=i,cp(e,i,s),Es(e,s),e}function qg(e,t,r,s){var i=t.current,a=fs(),o=To(i);return r=JE(r),t.context===null?t.context=r:t.pendingContext=r,t=Ea(a,o),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=Po(i,t,o),e!==null&&(Ri(e,i,o,a),Vf(e,i,o)),o}function $h(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function QS(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function X1(e,t){QS(e,t),(e=e.alternate)&&QS(e,t)}function jz(){return null}var e4=typeof reportError=="function"?reportError:function(e){console.error(e)};function Q1(e){this._internalRoot=e}Gg.prototype.render=Q1.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(st(409));qg(e,t,null,null)};Gg.prototype.unmount=Q1.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Wl(function(){qg(null,e,null,null)}),t[Oa]=null}};function Gg(e){this._internalRoot=e}Gg.prototype.unstable_scheduleHydration=function(e){if(e){var t=IA();e={blockedOn:null,target:e,priority:t};for(var r=0;r<uo.length&&t!==0&&t<uo[r].priority;r++);uo.splice(r,0,e),r===0&&RA(e)}};function J1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Xg(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function JS(){}function wz(e,t,r,s,i){if(i){if(typeof s=="function"){var a=s;s=function(){var u=$h(o);a.call(u)}}var o=ZE(t,s,e,0,null,!1,!1,"",JS);return e._reactRootContainer=o,e[Oa]=o.current,_u(e.nodeType===8?e.parentNode:e),Wl(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof s=="function"){var l=s;s=function(){var u=$h(c);l.call(u)}}var c=G1(e,0,!1,null,null,!1,!1,"",JS);return e._reactRootContainer=c,e[Oa]=c.current,_u(e.nodeType===8?e.parentNode:e),Wl(function(){qg(t,c,r,s)}),c}function Qg(e,t,r,s,i){var a=r._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var l=i;i=function(){var c=$h(o);l.call(c)}}qg(t,o,e,i)}else o=wz(r,t,e,i,s);return $h(o)}EA=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=nu(t.pendingLanes);r!==0&&(x1(t,r|1),Es(t,tn()),!(xr&6)&&(Zc=tn()+500,Go()))}break;case 13:Wl(function(){var s=za(e,1);if(s!==null){var i=fs();Ri(s,e,1,i)}}),X1(e,1)}};y1=function(e){if(e.tag===13){var t=za(e,134217728);if(t!==null){var r=fs();Ri(t,e,134217728,r)}X1(e,134217728)}};PA=function(e){if(e.tag===13){var t=To(e),r=za(e,t);if(r!==null){var s=fs();Ri(r,e,t,s)}X1(e,t)}};IA=function(){return Cr};TA=function(e,t){var r=Cr;try{return Cr=e,t()}finally{Cr=r}};qy=function(e,t,r){switch(t){case"input":if(Fy(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var i=Fg(s);if(!i)throw Error(st(90));cA(s),Fy(s,i)}}}break;case"textarea":uA(e,r);break;case"select":t=r.value,t!=null&&Cc(e,!!r.multiple,t,!1)}};yA=Y1;vA=Wl;var Sz={usingClientEntryPoint:!1,Events:[up,xc,Fg,mA,xA,Y1]},Ud={findFiberByHostInstance:pl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kz={bundleType:Ud.bundleType,version:Ud.version,rendererPackageName:Ud.rendererPackageName,rendererConfig:Ud.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ka.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=wA(e),e===null?null:e.stateNode},findFiberByHostInstance:Ud.findFiberByHostInstance||jz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mf.isDisabled&&mf.supportsFiber)try{$g=mf.inject(kz),Zi=mf}catch{}}Xs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sz;Xs.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!J1(t))throw Error(st(200));return bz(e,t,null,r)};Xs.createRoot=function(e,t){if(!J1(e))throw Error(st(299));var r=!1,s="",i=e4;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=G1(e,1,!1,null,null,r,!1,s,i),e[Oa]=t.current,_u(e.nodeType===8?e.parentNode:e),new Q1(t)};Xs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(st(188)):(e=Object.keys(e).join(","),Error(st(268,e)));return e=wA(t),e=e===null?null:e.stateNode,e};Xs.flushSync=function(e){return Wl(e)};Xs.hydrate=function(e,t,r){if(!Xg(t))throw Error(st(200));return Qg(null,e,t,!0,r)};Xs.hydrateRoot=function(e,t,r){if(!J1(e))throw Error(st(405));var s=r!=null&&r.hydratedSources||null,i=!1,a="",o=e4;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(a=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=ZE(t,null,e,1,r??null,i,!1,a,o),e[Oa]=t.current,_u(e),s)for(e=0;e<s.length;e++)r=s[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new Gg(t)};Xs.render=function(e,t,r){if(!Xg(t))throw Error(st(200));return Qg(null,e,t,!1,r)};Xs.unmountComponentAtNode=function(e){if(!Xg(e))throw Error(st(40));return e._reactRootContainer?(Wl(function(){Qg(null,null,e,!1,function(){e._reactRootContainer=null,e[Oa]=null})}),!0):!1};Xs.unstable_batchedUpdates=Y1;Xs.unstable_renderSubtreeIntoContainer=function(e,t,r,s){if(!Xg(r))throw Error(st(200));if(e==null||e._reactInternals===void 0)throw Error(st(38));return Qg(e,t,r,!1,s)};Xs.version="18.3.1-next-f1338f8080-20240426";function t4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t4)}catch(e){console.error(e)}}t4(),tA.exports=Xs;var Qi=tA.exports,r4,ZS=Qi;r4=ZS.createRoot,ZS.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Lu(){return Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Lu.apply(this,arguments)}var ko;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ko||(ko={}));const e2="popstate";function Nz(e){e===void 0&&(e={});function t(s,i){let{pathname:a,search:o,hash:l}=s.location;return _v("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(s,i){return typeof i=="string"?i:Dh(i)}return _z(t,r,null,e)}function rn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function n4(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Cz(){return Math.random().toString(36).substr(2,8)}function t2(e,t){return{usr:e.state,key:e.key,idx:t}}function _v(e,t,r,s){return r===void 0&&(r=null),Lu({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?md(t):t,{state:r,key:t&&t.key||s||Cz()})}function Dh(e){let{pathname:t="/",search:r="",hash:s=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function md(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function _z(e,t,r,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:a=!1}=s,o=i.history,l=ko.Pop,c=null,u=d();u==null&&(u=0,o.replaceState(Lu({},o.state,{idx:u}),""));function d(){return(o.state||{idx:null}).idx}function f(){l=ko.Pop;let y=d(),v=y==null?null:y-u;u=y,c&&c({action:l,location:x.location,delta:v})}function h(y,v){l=ko.Push;let S=_v(x.location,y,v);u=d()+1;let k=t2(S,u),j=x.createHref(S);try{o.pushState(k,"",j)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;i.location.assign(j)}a&&c&&c({action:l,location:x.location,delta:1})}function m(y,v){l=ko.Replace;let S=_v(x.location,y,v);u=d();let k=t2(S,u),j=x.createHref(S);o.replaceState(k,"",j),a&&c&&c({action:l,location:x.location,delta:0})}function g(y){let v=i.location.origin!=="null"?i.location.origin:i.location.href,S=typeof y=="string"?y:Dh(y);return S=S.replace(/ $/,"%20"),rn(v,"No window.location.(origin|href) available to create URL for href: "+S),new URL(S,v)}let x={get action(){return l},get location(){return e(i,o)},listen(y){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(e2,f),c=y,()=>{i.removeEventListener(e2,f),c=null}},createHref(y){return t(i,y)},createURL:g,encodeLocation(y){let v=g(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:h,replace:m,go(y){return o.go(y)}};return x}var r2;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(r2||(r2={}));function Az(e,t,r){return r===void 0&&(r="/"),Ez(e,t,r)}function Ez(e,t,r,s){let i=typeof t=="string"?md(t):t,a=Z1(i.pathname||"/",r);if(a==null)return null;let o=s4(e);Pz(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=Wz(a);l=Mz(o[c],u)}return l}function s4(e,t,r,s){t===void 0&&(t=[]),r===void 0&&(r=[]),s===void 0&&(s="");let i=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(rn(c.relativePath.startsWith(s),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(s.length));let u=Oo([s,c.relativePath]),d=r.concat(c);a.children&&a.children.length>0&&(rn(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),s4(a.children,t,d,u)),!(a.path==null&&!a.index)&&t.push({path:u,score:$z(u,a.index),routesMeta:d})};return e.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let c of i4(a.path))i(a,o,c)}),t}function i4(e){let t=e.split("/");if(t.length===0)return[];let[r,...s]=t,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(s.length===0)return i?[a,""]:[a];let o=i4(s.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function Pz(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Dz(t.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const Iz=/^:[\w-]+$/,Tz=3,Rz=2,Oz=1,zz=10,Lz=-2,n2=e=>e==="*";function $z(e,t){let r=e.split("/"),s=r.length;return r.some(n2)&&(s+=Lz),t&&(s+=Rz),r.filter(i=>!n2(i)).reduce((i,a)=>i+(Iz.test(a)?Tz:a===""?Oz:zz),s)}function Dz(e,t){return e.length===t.length&&e.slice(0,-1).every((s,i)=>s===t[i])?e[e.length-1]-t[t.length-1]:0}function Mz(e,t,r){let{routesMeta:s}=e,i={},a="/",o=[];for(let l=0;l<s.length;++l){let c=s[l],u=l===s.length-1,d=a==="/"?t:t.slice(a.length)||"/",f=Bz({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),h=c.route;if(!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:Oo([a,f.pathname]),pathnameBase:Kz(Oo([a,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(a=Oo([a,f.pathnameBase]))}return o}function Bz(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=Fz(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:s.reduce((u,d,f)=>{let{paramName:h,isOptional:m}=d;if(h==="*"){let x=l[f]||"";o=a.slice(0,a.length-x.length).replace(/(.)\/+$/,"$1")}const g=l[f];return m&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:o,pattern:e}}function Fz(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),n4(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),s]}function Wz(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return n4(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Z1(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&s!=="/"?null:e.slice(r)||"/"}function Uz(e,t){t===void 0&&(t="/");let{pathname:r,search:s="",hash:i=""}=typeof e=="string"?md(e):e;return{pathname:r?r.startsWith("/")?r:Hz(r,t):t,search:Vz(s),hash:qz(i)}}function Hz(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Vx(e,t,r,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Yz(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function eb(e,t){let r=Yz(e);return t?r.map((s,i)=>i===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function tb(e,t,r,s){s===void 0&&(s=!1);let i;typeof e=="string"?i=md(e):(i=Lu({},e),rn(!i.pathname||!i.pathname.includes("?"),Vx("?","pathname","search",i)),rn(!i.pathname||!i.pathname.includes("#"),Vx("#","pathname","hash",i)),rn(!i.search||!i.search.includes("#"),Vx("#","search","hash",i)));let a=e===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=r;else{let f=t.length-1;if(!s&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;i.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=Uz(i,l),u=o&&o!=="/"&&o.endsWith("/"),d=(a||o===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Oo=e=>e.join("/").replace(/\/\/+/g,"/"),Kz=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Vz=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,qz=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Gz(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const a4=["post","put","patch","delete"];new Set(a4);const Xz=["get",...a4];new Set(Xz);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $u(){return $u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},$u.apply(this,arguments)}const rb=p.createContext(null),Qz=p.createContext(null),Xo=p.createContext(null),Jg=p.createContext(null),Va=p.createContext({outlet:null,matches:[],isDataRoute:!1}),o4=p.createContext(null);function Jz(e,t){let{relative:r}=t===void 0?{}:t;xd()||rn(!1);let{basename:s,navigator:i}=p.useContext(Xo),{hash:a,pathname:o,search:l}=c4(e,{relative:r}),c=o;return s!=="/"&&(c=o==="/"?s:Oo([s,o])),i.createHref({pathname:c,search:l,hash:a})}function xd(){return p.useContext(Jg)!=null}function wn(){return xd()||rn(!1),p.useContext(Jg).location}function l4(e){p.useContext(Xo).static||p.useLayoutEffect(e)}function Sn(){let{isDataRoute:e}=p.useContext(Va);return e?u3():Zz()}function Zz(){xd()||rn(!1);let e=p.useContext(rb),{basename:t,future:r,navigator:s}=p.useContext(Xo),{matches:i}=p.useContext(Va),{pathname:a}=wn(),o=JSON.stringify(eb(i,r.v7_relativeSplatPath)),l=p.useRef(!1);return l4(()=>{l.current=!0}),p.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){s.go(u);return}let f=tb(u,JSON.parse(o),a,d.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Oo([t,f.pathname])),(d.replace?s.replace:s.push)(f,d.state,d)},[t,s,o,a,e])}function oa(){let{matches:e}=p.useContext(Va),t=e[e.length-1];return t?t.params:{}}function c4(e,t){let{relative:r}=t===void 0?{}:t,{future:s}=p.useContext(Xo),{matches:i}=p.useContext(Va),{pathname:a}=wn(),o=JSON.stringify(eb(i,s.v7_relativeSplatPath));return p.useMemo(()=>tb(e,JSON.parse(o),a,r==="path"),[e,o,a,r])}function e3(e,t){return t3(e,t)}function t3(e,t,r,s){xd()||rn(!1);let{navigator:i}=p.useContext(Xo),{matches:a}=p.useContext(Va),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=wn(),d;if(t){var f;let y=typeof t=="string"?md(t):t;c==="/"||(f=y.pathname)!=null&&f.startsWith(c)||rn(!1),d=y}else d=u;let h=d.pathname||"/",m=h;if(c!=="/"){let y=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=Az(e,{pathname:m}),x=a3(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Oo([c,i.encodeLocation?i.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:Oo([c,i.encodeLocation?i.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),a,r,s);return t&&x?p.createElement(Jg.Provider,{value:{location:$u({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:ko.Pop}},x):x}function r3(){let e=d3(),t=Gz(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),r?p.createElement("pre",{style:i},r):null,null)}const n3=p.createElement(r3,null);class s3 extends p.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?p.createElement(Va.Provider,{value:this.props.routeContext},p.createElement(o4.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function i3(e){let{routeContext:t,match:r,children:s}=e,i=p.useContext(rb);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),p.createElement(Va.Provider,{value:t},s)}function a3(e,t,r,s){var i;if(t===void 0&&(t=[]),r===void 0&&(r=null),s===void 0&&(s=null),e==null){var a;if(!r)return null;if(r.errors)e=r.matches;else if((a=s)!=null&&a.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let o=e,l=(i=r)==null?void 0:i.errors;if(l!=null){let d=o.findIndex(f=>f.route.id&&(l==null?void 0:l[f.route.id])!==void 0);d>=0||rn(!1),o=o.slice(0,Math.min(o.length,d+1))}let c=!1,u=-1;if(r&&s&&s.v7_partialHydration)for(let d=0;d<o.length;d++){let f=o[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:h,errors:m}=r,g=f.route.loader&&h[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||g){c=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((d,f,h)=>{let m,g=!1,x=null,y=null;r&&(m=l&&f.route.id?l[f.route.id]:void 0,x=f.route.errorElement||n3,c&&(u<0&&h===0?(p3("route-fallback"),g=!0,y=null):u===h&&(g=!0,y=f.route.hydrateFallbackElement||null)));let v=t.concat(o.slice(0,h+1)),S=()=>{let k;return m?k=x:g?k=y:f.route.Component?k=p.createElement(f.route.Component,null):f.route.element?k=f.route.element:k=d,p.createElement(i3,{match:f,routeContext:{outlet:d,matches:v,isDataRoute:r!=null},children:k})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?p.createElement(s3,{location:r.location,revalidation:r.revalidation,component:x,error:m,children:S(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):S()},null)}var d4=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(d4||{}),u4=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(u4||{});function o3(e){let t=p.useContext(rb);return t||rn(!1),t}function l3(e){let t=p.useContext(Qz);return t||rn(!1),t}function c3(e){let t=p.useContext(Va);return t||rn(!1),t}function p4(e){let t=c3(),r=t.matches[t.matches.length-1];return r.route.id||rn(!1),r.route.id}function d3(){var e;let t=p.useContext(o4),r=l3(),s=p4();return t!==void 0?t:(e=r.errors)==null?void 0:e[s]}function u3(){let{router:e}=o3(d4.UseNavigateStable),t=p4(u4.UseNavigateStable),r=p.useRef(!1);return l4(()=>{r.current=!0}),p.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,$u({fromRouteId:t},a)))},[e,t])}const s2={};function p3(e,t,r){s2[e]||(s2[e]=!0)}function f3(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function h3(e){let{to:t,replace:r,state:s,relative:i}=e;xd()||rn(!1);let{future:a,static:o}=p.useContext(Xo),{matches:l}=p.useContext(Va),{pathname:c}=wn(),u=Sn(),d=tb(t,eb(l,a.v7_relativeSplatPath),c,i==="path"),f=JSON.stringify(d);return p.useEffect(()=>u(JSON.parse(f),{replace:r,state:s,relative:i}),[u,f,i,r,s]),null}function Rt(e){rn(!1)}function g3(e){let{basename:t="/",children:r=null,location:s,navigationType:i=ko.Pop,navigator:a,static:o=!1,future:l}=e;xd()&&rn(!1);let c=t.replace(/^\/*/,"/"),u=p.useMemo(()=>({basename:c,navigator:a,static:o,future:$u({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof s=="string"&&(s=md(s));let{pathname:d="/",search:f="",hash:h="",state:m=null,key:g="default"}=s,x=p.useMemo(()=>{let y=Z1(d,c);return y==null?null:{location:{pathname:y,search:f,hash:h,state:m,key:g},navigationType:i}},[c,d,f,h,m,g,i]);return x==null?null:p.createElement(Xo.Provider,{value:u},p.createElement(Jg.Provider,{children:r,value:x}))}function m3(e){let{children:t,location:r}=e;return e3(Av(t),r)}new Promise(()=>{});function Av(e,t){t===void 0&&(t=[]);let r=[];return p.Children.forEach(e,(s,i)=>{if(!p.isValidElement(s))return;let a=[...t,i];if(s.type===p.Fragment){r.push.apply(r,Av(s.props.children,a));return}s.type!==Rt&&rn(!1),!s.props.index||!s.props.children||rn(!1);let o={id:s.props.id||a.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=Av(s.props.children,a)),r.push(o)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ev(){return Ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ev.apply(this,arguments)}function x3(e,t){if(e==null)return{};var r={},s=Object.keys(e),i,a;for(a=0;a<s.length;a++)i=s[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function y3(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function v3(e,t){return e.button===0&&(!t||t==="_self")&&!y3(e)}function Pv(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let s=e[r];return t.concat(Array.isArray(s)?s.map(i=>[r,i]):[[r,s]])},[]))}function b3(e,t){let r=Pv(e);return t&&t.forEach((s,i)=>{r.has(i)||t.getAll(i).forEach(a=>{r.append(i,a)})}),r}const j3=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],w3="6";try{window.__reactRouterVersion=w3}catch{}const S3="startTransition",i2=Z_[S3];function k3(e){let{basename:t,children:r,future:s,window:i}=e,a=p.useRef();a.current==null&&(a.current=Nz({window:i,v5Compat:!0}));let o=a.current,[l,c]=p.useState({action:o.action,location:o.location}),{v7_startTransition:u}=s||{},d=p.useCallback(f=>{u&&i2?i2(()=>c(f)):c(f)},[c,u]);return p.useLayoutEffect(()=>o.listen(d),[o,d]),p.useEffect(()=>f3(s),[s]),p.createElement(g3,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:o,future:s})}const N3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",C3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,rr=p.forwardRef(function(t,r){let{onClick:s,relative:i,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=t,h=x3(t,j3),{basename:m}=p.useContext(Xo),g,x=!1;if(typeof u=="string"&&C3.test(u)&&(g=u,N3))try{let k=new URL(window.location.href),j=u.startsWith("//")?new URL(k.protocol+u):new URL(u),_=Z1(j.pathname,m);j.origin===k.origin&&_!=null?u=_+j.search+j.hash:x=!0}catch{}let y=Jz(u,{relative:i}),v=_3(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:i,viewTransition:f});function S(k){s&&s(k),k.defaultPrevented||v(k)}return p.createElement("a",Ev({},h,{href:g||y,onClick:x||a?s:S,ref:r,target:c}))});var a2;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(a2||(a2={}));var o2;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(o2||(o2={}));function _3(e,t){let{target:r,replace:s,state:i,preventScrollReset:a,relative:o,viewTransition:l}=t===void 0?{}:t,c=Sn(),u=wn(),d=c4(e,{relative:o});return p.useCallback(f=>{if(v3(f,r)){f.preventDefault();let h=s!==void 0?s:Dh(u)===Dh(d);c(e,{replace:h,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,d,s,i,r,e,a,o,l])}function f4(e){let t=p.useRef(Pv(e)),r=p.useRef(!1),s=wn(),i=p.useMemo(()=>b3(s.search,r.current?null:t.current),[s.search]),a=Sn(),o=p.useCallback((l,c)=>{const u=Pv(typeof l=="function"?l(i):l);r.current=!0,a("?"+u,c)},[a,i]);return[i,o]}var fp=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},A3={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},ho,s1,P_,E3=(P_=class{constructor(){Qt(this,ho,A3);Qt(this,s1,!1)}setTimeoutProvider(e){At(this,ho,e)}setTimeout(e,t){return Ce(this,ho).setTimeout(e,t)}clearTimeout(e){Ce(this,ho).clearTimeout(e)}setInterval(e,t){return Ce(this,ho).setInterval(e,t)}clearInterval(e){Ce(this,ho).clearInterval(e)}},ho=new WeakMap,s1=new WeakMap,P_),gl=new E3;function P3(e){setTimeout(e,0)}var Ul=typeof window>"u"||"Deno"in globalThis;function Ss(){}function I3(e,t){return typeof e=="function"?e(t):e}function Iv(e){return typeof e=="number"&&e>=0&&e!==1/0}function h4(e,t){return Math.max(e+(t||0)-Date.now(),0)}function zo(e,t){return typeof e=="function"?e(t):e}function ni(e,t){return typeof e=="function"?e(t):e}function l2(e,t){const{type:r="all",exact:s,fetchStatus:i,predicate:a,queryKey:o,stale:l}=e;if(o){if(s){if(t.queryHash!==nb(o,t.options))return!1}else if(!Mu(t.queryKey,o))return!1}if(r!=="all"){const c=t.isActive();if(r==="active"&&!c||r==="inactive"&&c)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||i&&i!==t.state.fetchStatus||a&&!a(t))}function c2(e,t){const{exact:r,status:s,predicate:i,mutationKey:a}=e;if(a){if(!t.options.mutationKey)return!1;if(r){if(Du(t.options.mutationKey)!==Du(a))return!1}else if(!Mu(t.options.mutationKey,a))return!1}return!(s&&t.state.status!==s||i&&!i(t))}function nb(e,t){return((t==null?void 0:t.queryKeyHashFn)||Du)(e)}function Du(e){return JSON.stringify(e,(t,r)=>Rv(r)?Object.keys(r).sort().reduce((s,i)=>(s[i]=r[i],s),{}):r)}function Mu(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>Mu(e[r],t[r])):!1}var T3=Object.prototype.hasOwnProperty;function g4(e,t){if(e===t)return e;const r=d2(e)&&d2(t);if(!r&&!(Rv(e)&&Rv(t)))return t;const i=(r?e:Object.keys(e)).length,a=r?t:Object.keys(t),o=a.length,l=r?new Array(o):{};let c=0;for(let u=0;u<o;u++){const d=r?u:a[u],f=e[d],h=t[d];if(f===h){l[d]=f,(r?u<i:T3.call(e,d))&&c++;continue}if(f===null||h===null||typeof f!="object"||typeof h!="object"){l[d]=h;continue}const m=g4(f,h);l[d]=m,m===f&&c++}return i===o&&c===i?e:l}function Tv(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function d2(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Rv(e){if(!u2(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!u2(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function u2(e){return Object.prototype.toString.call(e)==="[object Object]"}function R3(e){return new Promise(t=>{gl.setTimeout(t,e)})}function Ov(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?g4(e,t):t}function O3(e,t,r=0){const s=[...e,t];return r&&s.length>r?s.slice(1):s}function z3(e,t,r=0){const s=[t,...e];return r&&s.length>r?s.slice(0,-1):s}var sb=Symbol();function m4(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===sb?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function L3(e,t){return typeof e=="function"?e(...t):!!e}var bl,go,zc,I_,$3=(I_=class extends fp{constructor(){super();Qt(this,bl);Qt(this,go);Qt(this,zc);At(this,zc,t=>{if(!Ul&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Ce(this,go)||this.setEventListener(Ce(this,zc))}onUnsubscribe(){var t;this.hasListeners()||((t=Ce(this,go))==null||t.call(this),At(this,go,void 0))}setEventListener(t){var r;At(this,zc,t),(r=Ce(this,go))==null||r.call(this),At(this,go,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(t){Ce(this,bl)!==t&&(At(this,bl,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Ce(this,bl)=="boolean"?Ce(this,bl):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},bl=new WeakMap,go=new WeakMap,zc=new WeakMap,I_),ib=new $3;function zv(){let e,t;const r=new Promise((i,a)=>{e=i,t=a});r.status="pending",r.catch(()=>{});function s(i){Object.assign(r,i),delete r.resolve,delete r.reject}return r.resolve=i=>{s({status:"fulfilled",value:i}),e(i)},r.reject=i=>{s({status:"rejected",reason:i}),t(i)},r}var D3=P3;function M3(){let e=[],t=0,r=l=>{l()},s=l=>{l()},i=D3;const a=l=>{t?e.push(l):i(()=>{r(l)})},o=()=>{const l=e;e=[],l.length&&i(()=>{s(()=>{l.forEach(c=>{r(c)})})})};return{batch:l=>{let c;t++;try{c=l()}finally{t--,t||o()}return c},batchCalls:l=>(...c)=>{a(()=>{l(...c)})},schedule:a,setNotifyFunction:l=>{r=l},setBatchNotifyFunction:l=>{s=l},setScheduler:l=>{i=l}}}var Wn=M3(),Lc,mo,$c,T_,B3=(T_=class extends fp{constructor(){super();Qt(this,Lc,!0);Qt(this,mo);Qt(this,$c);At(this,$c,t=>{if(!Ul&&window.addEventListener){const r=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",s)}}})}onSubscribe(){Ce(this,mo)||this.setEventListener(Ce(this,$c))}onUnsubscribe(){var t;this.hasListeners()||((t=Ce(this,mo))==null||t.call(this),At(this,mo,void 0))}setEventListener(t){var r;At(this,$c,t),(r=Ce(this,mo))==null||r.call(this),At(this,mo,t(this.setOnline.bind(this)))}setOnline(t){Ce(this,Lc)!==t&&(At(this,Lc,t),this.listeners.forEach(s=>{s(t)}))}isOnline(){return Ce(this,Lc)}},Lc=new WeakMap,mo=new WeakMap,$c=new WeakMap,T_),Mh=new B3;function F3(e){return Math.min(1e3*2**e,3e4)}function x4(e){return(e??"online")==="online"?Mh.isOnline():!0}var Lv=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function y4(e){let t=!1,r=0,s;const i=zv(),a=()=>i.status!=="pending",o=x=>{var y;if(!a()){const v=new Lv(x);h(v),(y=e.onCancel)==null||y.call(e,v)}},l=()=>{t=!0},c=()=>{t=!1},u=()=>ib.isFocused()&&(e.networkMode==="always"||Mh.isOnline())&&e.canRun(),d=()=>x4(e.networkMode)&&e.canRun(),f=x=>{a()||(s==null||s(),i.resolve(x))},h=x=>{a()||(s==null||s(),i.reject(x))},m=()=>new Promise(x=>{var y;s=v=>{(a()||u())&&x(v)},(y=e.onPause)==null||y.call(e)}).then(()=>{var x;s=void 0,a()||(x=e.onContinue)==null||x.call(e)}),g=()=>{if(a())return;let x;const y=r===0?e.initialPromise:void 0;try{x=y??e.fn()}catch(v){x=Promise.reject(v)}Promise.resolve(x).then(f).catch(v=>{var b;if(a())return;const S=e.retry??(Ul?0:3),k=e.retryDelay??F3,j=typeof k=="function"?k(r,v):k,_=S===!0||typeof S=="number"&&r<S||typeof S=="function"&&S(r,v);if(t||!_){h(v);return}r++,(b=e.onFail)==null||b.call(e,r,v),R3(j).then(()=>u()?void 0:m()).then(()=>{t?h(v):g()})})};return{promise:i,status:()=>i.status,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:l,continueRetry:c,canStart:d,start:()=>(d()?g():m().then(g),i)}}var jl,R_,v4=(R_=class{constructor(){Qt(this,jl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Iv(this.gcTime)&&At(this,jl,gl.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Ul?1/0:5*60*1e3))}clearGcTimeout(){Ce(this,jl)&&(gl.clearTimeout(Ce(this,jl)),At(this,jl,void 0))}},jl=new WeakMap,R_),wl,Dc,ri,Sl,In,np,kl,Si,ma,O_,W3=(O_=class extends v4{constructor(t){super();Qt(this,Si);Qt(this,wl);Qt(this,Dc);Qt(this,ri);Qt(this,Sl);Qt(this,In);Qt(this,np);Qt(this,kl);At(this,kl,!1),At(this,np,t.defaultOptions),this.setOptions(t.options),this.observers=[],At(this,Sl,t.client),At(this,ri,Ce(this,Sl).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,At(this,wl,f2(this.options)),this.state=t.state??Ce(this,wl),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Ce(this,In))==null?void 0:t.promise}setOptions(t){if(this.options={...Ce(this,np),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const r=f2(this.options);r.data!==void 0&&(this.setState(p2(r.data,r.dataUpdatedAt)),At(this,wl,r))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ce(this,ri).remove(this)}setData(t,r){const s=Ov(this.state.data,t,this.options);return dr(this,Si,ma).call(this,{data:s,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),s}setState(t,r){dr(this,Si,ma).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var s,i;const r=(s=Ce(this,In))==null?void 0:s.promise;return(i=Ce(this,In))==null||i.cancel(t),r?r.then(Ss).catch(Ss):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ce(this,wl))}isActive(){return this.observers.some(t=>ni(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===sb||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>zo(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!h4(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Ce(this,In))==null||r.continue()}onOnline(){var r;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Ce(this,In))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Ce(this,ri).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Ce(this,In)&&(Ce(this,kl)?Ce(this,In).cancel({revert:!0}):Ce(this,In).cancelRetry()),this.scheduleGc()),Ce(this,ri).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||dr(this,Si,ma).call(this,{type:"invalidate"})}async fetch(t,r){var c,u,d,f,h,m,g,x,y,v,S,k;if(this.state.fetchStatus!=="idle"&&((c=Ce(this,In))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Ce(this,In))return Ce(this,In).continueRetry(),Ce(this,In).promise}if(t&&this.setOptions(t),!this.options.queryFn){const j=this.observers.find(_=>_.options.queryFn);j&&this.setOptions(j.options)}const s=new AbortController,i=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(At(this,kl,!0),s.signal)})},a=()=>{const j=m4(this.options,r),b=(()=>{const A={client:Ce(this,Sl),queryKey:this.queryKey,meta:this.meta};return i(A),A})();return At(this,kl,!1),this.options.persister?this.options.persister(j,b,this):j(b)},l=(()=>{const j={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:Ce(this,Sl),state:this.state,fetchFn:a};return i(j),j})();(u=this.options.behavior)==null||u.onFetch(l,this),At(this,Dc,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((d=l.fetchOptions)==null?void 0:d.meta))&&dr(this,Si,ma).call(this,{type:"fetch",meta:(f=l.fetchOptions)==null?void 0:f.meta}),At(this,In,y4({initialPromise:r==null?void 0:r.initialPromise,fn:l.fetchFn,onCancel:j=>{j instanceof Lv&&j.revert&&this.setState({...Ce(this,Dc),fetchStatus:"idle"}),s.abort()},onFail:(j,_)=>{dr(this,Si,ma).call(this,{type:"failed",failureCount:j,error:_})},onPause:()=>{dr(this,Si,ma).call(this,{type:"pause"})},onContinue:()=>{dr(this,Si,ma).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const j=await Ce(this,In).start();if(j===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(j),(m=(h=Ce(this,ri).config).onSuccess)==null||m.call(h,j,this),(x=(g=Ce(this,ri).config).onSettled)==null||x.call(g,j,this.state.error,this),j}catch(j){if(j instanceof Lv){if(j.silent)return Ce(this,In).promise;if(j.revert){if(this.state.data===void 0)throw j;return this.state.data}}throw dr(this,Si,ma).call(this,{type:"error",error:j}),(v=(y=Ce(this,ri).config).onError)==null||v.call(y,j,this),(k=(S=Ce(this,ri).config).onSettled)==null||k.call(S,this.state.data,j,this),j}finally{this.scheduleGc()}}},wl=new WeakMap,Dc=new WeakMap,ri=new WeakMap,Sl=new WeakMap,In=new WeakMap,np=new WeakMap,kl=new WeakMap,Si=new WeakSet,ma=function(t){const r=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...b4(s.data,this.options),fetchMeta:t.meta??null};case"success":const i={...s,...p2(t.data,t.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return At(this,Dc,t.manual?i:void 0),i;case"error":const a=t.error;return{...s,error:a,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=r(this.state),Wn.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),Ce(this,ri).notify({query:this,type:"updated",action:t})})},O_);function b4(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:x4(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function p2(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function f2(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,s=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var js,ur,sp,ls,Nl,Mc,ja,xo,ip,Bc,Fc,Cl,_l,yo,Wc,wr,iu,$v,Dv,Mv,Bv,Fv,Wv,Uv,j4,z_,U3=(z_=class extends fp{constructor(t,r){super();Qt(this,wr);Qt(this,js);Qt(this,ur);Qt(this,sp);Qt(this,ls);Qt(this,Nl);Qt(this,Mc);Qt(this,ja);Qt(this,xo);Qt(this,ip);Qt(this,Bc);Qt(this,Fc);Qt(this,Cl);Qt(this,_l);Qt(this,yo);Qt(this,Wc,new Set);this.options=r,At(this,js,t),At(this,xo,null),At(this,ja,zv()),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Ce(this,ur).addObserver(this),h2(Ce(this,ur),this.options)?dr(this,wr,iu).call(this):this.updateResult(),dr(this,wr,Bv).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Hv(Ce(this,ur),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Hv(Ce(this,ur),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,dr(this,wr,Fv).call(this),dr(this,wr,Wv).call(this),Ce(this,ur).removeObserver(this)}setOptions(t){const r=this.options,s=Ce(this,ur);if(this.options=Ce(this,js).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ni(this.options.enabled,Ce(this,ur))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");dr(this,wr,Uv).call(this),Ce(this,ur).setOptions(this.options),r._defaulted&&!Tv(this.options,r)&&Ce(this,js).getQueryCache().notify({type:"observerOptionsUpdated",query:Ce(this,ur),observer:this});const i=this.hasListeners();i&&g2(Ce(this,ur),s,this.options,r)&&dr(this,wr,iu).call(this),this.updateResult(),i&&(Ce(this,ur)!==s||ni(this.options.enabled,Ce(this,ur))!==ni(r.enabled,Ce(this,ur))||zo(this.options.staleTime,Ce(this,ur))!==zo(r.staleTime,Ce(this,ur)))&&dr(this,wr,$v).call(this);const a=dr(this,wr,Dv).call(this);i&&(Ce(this,ur)!==s||ni(this.options.enabled,Ce(this,ur))!==ni(r.enabled,Ce(this,ur))||a!==Ce(this,yo))&&dr(this,wr,Mv).call(this,a)}getOptimisticResult(t){const r=Ce(this,js).getQueryCache().build(Ce(this,js),t),s=this.createResult(r,t);return Y3(this,s)&&(At(this,ls,s),At(this,Mc,this.options),At(this,Nl,Ce(this,ur).state)),s}getCurrentResult(){return Ce(this,ls)}trackResult(t,r){return new Proxy(t,{get:(s,i)=>(this.trackProp(i),r==null||r(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&Ce(this,ja).status==="pending"&&Ce(this,ja).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,i))})}trackProp(t){Ce(this,Wc).add(t)}getCurrentQuery(){return Ce(this,ur)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=Ce(this,js).defaultQueryOptions(t),s=Ce(this,js).getQueryCache().build(Ce(this,js),r);return s.fetch().then(()=>this.createResult(s,r))}fetch(t){return dr(this,wr,iu).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),Ce(this,ls)))}createResult(t,r){var D;const s=Ce(this,ur),i=this.options,a=Ce(this,ls),o=Ce(this,Nl),l=Ce(this,Mc),u=t!==s?t.state:Ce(this,sp),{state:d}=t;let f={...d},h=!1,m;if(r._optimisticResults){const w=this.hasListeners(),N=!w&&h2(t,r),$=w&&g2(t,s,r,i);(N||$)&&(f={...f,...b4(d.data,t.options)}),r._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:g,errorUpdatedAt:x,status:y}=f;m=f.data;let v=!1;if(r.placeholderData!==void 0&&m===void 0&&y==="pending"){let w;a!=null&&a.isPlaceholderData&&r.placeholderData===(l==null?void 0:l.placeholderData)?(w=a.data,v=!0):w=typeof r.placeholderData=="function"?r.placeholderData((D=Ce(this,Fc))==null?void 0:D.state.data,Ce(this,Fc)):r.placeholderData,w!==void 0&&(y="success",m=Ov(a==null?void 0:a.data,w,r),h=!0)}if(r.select&&m!==void 0&&!v)if(a&&m===(o==null?void 0:o.data)&&r.select===Ce(this,ip))m=Ce(this,Bc);else try{At(this,ip,r.select),m=r.select(m),m=Ov(a==null?void 0:a.data,m,r),At(this,Bc,m),At(this,xo,null)}catch(w){At(this,xo,w)}Ce(this,xo)&&(g=Ce(this,xo),m=Ce(this,Bc),x=Date.now(),y="error");const S=f.fetchStatus==="fetching",k=y==="pending",j=y==="error",_=k&&S,b=m!==void 0,z={status:y,fetchStatus:f.fetchStatus,isPending:k,isSuccess:y==="success",isError:j,isInitialLoading:_,isLoading:_,data:m,dataUpdatedAt:f.dataUpdatedAt,error:g,errorUpdatedAt:x,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>u.dataUpdateCount||f.errorUpdateCount>u.errorUpdateCount,isFetching:S,isRefetching:S&&!k,isLoadingError:j&&!b,isPaused:f.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:j&&b,isStale:ab(t,r),refetch:this.refetch,promise:Ce(this,ja),isEnabled:ni(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const w=E=>{z.status==="error"?E.reject(z.error):z.data!==void 0&&E.resolve(z.data)},N=()=>{const E=At(this,ja,z.promise=zv());w(E)},$=Ce(this,ja);switch($.status){case"pending":t.queryHash===s.queryHash&&w($);break;case"fulfilled":(z.status==="error"||z.data!==$.value)&&N();break;case"rejected":(z.status!=="error"||z.error!==$.reason)&&N();break}}return z}updateResult(){const t=Ce(this,ls),r=this.createResult(Ce(this,ur),this.options);if(At(this,Nl,Ce(this,ur).state),At(this,Mc,this.options),Ce(this,Nl).data!==void 0&&At(this,Fc,Ce(this,ur)),Tv(r,t))return;At(this,ls,r);const s=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,a=typeof i=="function"?i():i;if(a==="all"||!a&&!Ce(this,Wc).size)return!0;const o=new Set(a??Ce(this,Wc));return this.options.throwOnError&&o.add("error"),Object.keys(Ce(this,ls)).some(l=>{const c=l;return Ce(this,ls)[c]!==t[c]&&o.has(c)})};dr(this,wr,j4).call(this,{listeners:s()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&dr(this,wr,Bv).call(this)}},js=new WeakMap,ur=new WeakMap,sp=new WeakMap,ls=new WeakMap,Nl=new WeakMap,Mc=new WeakMap,ja=new WeakMap,xo=new WeakMap,ip=new WeakMap,Bc=new WeakMap,Fc=new WeakMap,Cl=new WeakMap,_l=new WeakMap,yo=new WeakMap,Wc=new WeakMap,wr=new WeakSet,iu=function(t){dr(this,wr,Uv).call(this);let r=Ce(this,ur).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Ss)),r},$v=function(){dr(this,wr,Fv).call(this);const t=zo(this.options.staleTime,Ce(this,ur));if(Ul||Ce(this,ls).isStale||!Iv(t))return;const s=h4(Ce(this,ls).dataUpdatedAt,t)+1;At(this,Cl,gl.setTimeout(()=>{Ce(this,ls).isStale||this.updateResult()},s))},Dv=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Ce(this,ur)):this.options.refetchInterval)??!1},Mv=function(t){dr(this,wr,Wv).call(this),At(this,yo,t),!(Ul||ni(this.options.enabled,Ce(this,ur))===!1||!Iv(Ce(this,yo))||Ce(this,yo)===0)&&At(this,_l,gl.setInterval(()=>{(this.options.refetchIntervalInBackground||ib.isFocused())&&dr(this,wr,iu).call(this)},Ce(this,yo)))},Bv=function(){dr(this,wr,$v).call(this),dr(this,wr,Mv).call(this,dr(this,wr,Dv).call(this))},Fv=function(){Ce(this,Cl)&&(gl.clearTimeout(Ce(this,Cl)),At(this,Cl,void 0))},Wv=function(){Ce(this,_l)&&(gl.clearInterval(Ce(this,_l)),At(this,_l,void 0))},Uv=function(){const t=Ce(this,js).getQueryCache().build(Ce(this,js),this.options);if(t===Ce(this,ur))return;const r=Ce(this,ur);At(this,ur,t),At(this,sp,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},j4=function(t){Wn.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(Ce(this,ls))}),Ce(this,js).getQueryCache().notify({query:Ce(this,ur),type:"observerResultsUpdated"})})},z_);function H3(e,t){return ni(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function h2(e,t){return H3(e,t)||e.state.data!==void 0&&Hv(e,t,t.refetchOnMount)}function Hv(e,t,r){if(ni(t.enabled,e)!==!1&&zo(t.staleTime,e)!=="static"){const s=typeof r=="function"?r(e):r;return s==="always"||s!==!1&&ab(e,t)}return!1}function g2(e,t,r,s){return(e!==t||ni(s.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&ab(e,r)}function ab(e,t){return ni(t.enabled,e)!==!1&&e.isStaleByTime(zo(t.staleTime,e))}function Y3(e,t){return!Tv(e.getCurrentResult(),t)}function m2(e){return{onFetch:(t,r)=>{var d,f,h,m,g;const s=t.options,i=(h=(f=(d=t.fetchOptions)==null?void 0:d.meta)==null?void 0:f.fetchMore)==null?void 0:h.direction,a=((m=t.state.data)==null?void 0:m.pages)||[],o=((g=t.state.data)==null?void 0:g.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const u=async()=>{let x=!1;const y=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(t.signal.aborted?x=!0:t.signal.addEventListener("abort",()=>{x=!0}),t.signal)})},v=m4(t.options,t.fetchOptions),S=async(k,j,_)=>{if(x)return Promise.reject();if(j==null&&k.pages.length)return Promise.resolve(k);const A=(()=>{const N={client:t.client,queryKey:t.queryKey,pageParam:j,direction:_?"backward":"forward",meta:t.options.meta};return y(N),N})(),z=await v(A),{maxPages:D}=t.options,w=_?z3:O3;return{pages:w(k.pages,z,D),pageParams:w(k.pageParams,j,D)}};if(i&&a.length){const k=i==="backward",j=k?K3:x2,_={pages:a,pageParams:o},b=j(s,_);l=await S(_,b,k)}else{const k=e??a.length;do{const j=c===0?o[0]??s.initialPageParam:x2(s,l);if(c>0&&j==null)break;l=await S(l,j),c++}while(c<k)}return l};t.options.persister?t.fetchFn=()=>{var x,y;return(y=(x=t.options).persister)==null?void 0:y.call(x,u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=u}}}function x2(e,{pages:t,pageParams:r}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,r[s],r):void 0}function K3(e,{pages:t,pageParams:r}){var s;return t.length>0?(s=e.getPreviousPageParam)==null?void 0:s.call(e,t[0],t,r[0],r):void 0}var ap,Ki,cs,Al,Vi,so,L_,V3=(L_=class extends v4{constructor(t){super();Qt(this,Vi);Qt(this,ap);Qt(this,Ki);Qt(this,cs);Qt(this,Al);At(this,ap,t.client),this.mutationId=t.mutationId,At(this,cs,t.mutationCache),At(this,Ki,[]),this.state=t.state||q3(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Ce(this,Ki).includes(t)||(Ce(this,Ki).push(t),this.clearGcTimeout(),Ce(this,cs).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){At(this,Ki,Ce(this,Ki).filter(r=>r!==t)),this.scheduleGc(),Ce(this,cs).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Ce(this,Ki).length||(this.state.status==="pending"?this.scheduleGc():Ce(this,cs).remove(this))}continue(){var t;return((t=Ce(this,Al))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,l,c,u,d,f,h,m,g,x,y,v,S,k,j,_,b,A,z,D;const r=()=>{dr(this,Vi,so).call(this,{type:"continue"})},s={client:Ce(this,ap),meta:this.options.meta,mutationKey:this.options.mutationKey};At(this,Al,y4({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(w,N)=>{dr(this,Vi,so).call(this,{type:"failed",failureCount:w,error:N})},onPause:()=>{dr(this,Vi,so).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ce(this,cs).canRun(this)}));const i=this.state.status==="pending",a=!Ce(this,Al).canStart();try{if(i)r();else{dr(this,Vi,so).call(this,{type:"pending",variables:t,isPaused:a}),await((l=(o=Ce(this,cs).config).onMutate)==null?void 0:l.call(o,t,this,s));const N=await((u=(c=this.options).onMutate)==null?void 0:u.call(c,t,s));N!==this.state.context&&dr(this,Vi,so).call(this,{type:"pending",context:N,variables:t,isPaused:a})}const w=await Ce(this,Al).start();return await((f=(d=Ce(this,cs).config).onSuccess)==null?void 0:f.call(d,w,t,this.state.context,this,s)),await((m=(h=this.options).onSuccess)==null?void 0:m.call(h,w,t,this.state.context,s)),await((x=(g=Ce(this,cs).config).onSettled)==null?void 0:x.call(g,w,null,this.state.variables,this.state.context,this,s)),await((v=(y=this.options).onSettled)==null?void 0:v.call(y,w,null,t,this.state.context,s)),dr(this,Vi,so).call(this,{type:"success",data:w}),w}catch(w){try{throw await((k=(S=Ce(this,cs).config).onError)==null?void 0:k.call(S,w,t,this.state.context,this,s)),await((_=(j=this.options).onError)==null?void 0:_.call(j,w,t,this.state.context,s)),await((A=(b=Ce(this,cs).config).onSettled)==null?void 0:A.call(b,void 0,w,this.state.variables,this.state.context,this,s)),await((D=(z=this.options).onSettled)==null?void 0:D.call(z,void 0,w,t,this.state.context,s)),w}finally{dr(this,Vi,so).call(this,{type:"error",error:w})}}finally{Ce(this,cs).runNext(this)}}},ap=new WeakMap,Ki=new WeakMap,cs=new WeakMap,Al=new WeakMap,Vi=new WeakSet,so=function(t){const r=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Wn.batch(()=>{Ce(this,Ki).forEach(s=>{s.onMutationUpdate(t)}),Ce(this,cs).notify({mutation:this,type:"updated",action:t})})},L_);function q3(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var wa,ki,op,$_,G3=($_=class extends fp{constructor(t={}){super();Qt(this,wa);Qt(this,ki);Qt(this,op);this.config=t,At(this,wa,new Set),At(this,ki,new Map),At(this,op,0)}build(t,r,s){const i=new V3({client:t,mutationCache:this,mutationId:++Jp(this,op)._,options:t.defaultMutationOptions(r),state:s});return this.add(i),i}add(t){Ce(this,wa).add(t);const r=xf(t);if(typeof r=="string"){const s=Ce(this,ki).get(r);s?s.push(t):Ce(this,ki).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Ce(this,wa).delete(t)){const r=xf(t);if(typeof r=="string"){const s=Ce(this,ki).get(r);if(s)if(s.length>1){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}else s[0]===t&&Ce(this,ki).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=xf(t);if(typeof r=="string"){const s=Ce(this,ki).get(r),i=s==null?void 0:s.find(a=>a.state.status==="pending");return!i||i===t}else return!0}runNext(t){var s;const r=xf(t);if(typeof r=="string"){const i=(s=Ce(this,ki).get(r))==null?void 0:s.find(a=>a!==t&&a.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Wn.batch(()=>{Ce(this,wa).forEach(t=>{this.notify({type:"removed",mutation:t})}),Ce(this,wa).clear(),Ce(this,ki).clear()})}getAll(){return Array.from(Ce(this,wa))}find(t){const r={exact:!0,...t};return this.getAll().find(s=>c2(r,s))}findAll(t={}){return this.getAll().filter(r=>c2(t,r))}notify(t){Wn.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Wn.batch(()=>Promise.all(t.map(r=>r.continue().catch(Ss))))}},wa=new WeakMap,ki=new WeakMap,op=new WeakMap,$_);function xf(e){var t;return(t=e.options.scope)==null?void 0:t.id}var qi,D_,X3=(D_=class extends fp{constructor(t={}){super();Qt(this,qi);this.config=t,At(this,qi,new Map)}build(t,r,s){const i=r.queryKey,a=r.queryHash??nb(i,r);let o=this.get(a);return o||(o=new W3({client:t,queryKey:i,queryHash:a,options:t.defaultQueryOptions(r),state:s,defaultOptions:t.getQueryDefaults(i)}),this.add(o)),o}add(t){Ce(this,qi).has(t.queryHash)||(Ce(this,qi).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Ce(this,qi).get(t.queryHash);r&&(t.destroy(),r===t&&Ce(this,qi).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Wn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Ce(this,qi).get(t)}getAll(){return[...Ce(this,qi).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(s=>l2(r,s))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(s=>l2(t,s)):r}notify(t){Wn.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Wn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Wn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},qi=new WeakMap,D_),Qr,vo,bo,Uc,Hc,jo,Yc,Kc,M_,Q3=(M_=class{constructor(e={}){Qt(this,Qr);Qt(this,vo);Qt(this,bo);Qt(this,Uc);Qt(this,Hc);Qt(this,jo);Qt(this,Yc);Qt(this,Kc);At(this,Qr,e.queryCache||new X3),At(this,vo,e.mutationCache||new G3),At(this,bo,e.defaultOptions||{}),At(this,Uc,new Map),At(this,Hc,new Map),At(this,jo,0)}mount(){Jp(this,jo)._++,Ce(this,jo)===1&&(At(this,Yc,ib.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ce(this,Qr).onFocus())})),At(this,Kc,Mh.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ce(this,Qr).onOnline())})))}unmount(){var e,t;Jp(this,jo)._--,Ce(this,jo)===0&&((e=Ce(this,Yc))==null||e.call(this),At(this,Yc,void 0),(t=Ce(this,Kc))==null||t.call(this),At(this,Kc,void 0))}isFetching(e){return Ce(this,Qr).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Ce(this,vo).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Ce(this,Qr).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Ce(this,Qr).build(this,t),s=r.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(zo(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return Ce(this,Qr).findAll(e).map(({queryKey:t,state:r})=>{const s=r.data;return[t,s]})}setQueryData(e,t,r){const s=this.defaultQueryOptions({queryKey:e}),i=Ce(this,Qr).get(s.queryHash),a=i==null?void 0:i.state.data,o=I3(t,a);if(o!==void 0)return Ce(this,Qr).build(this,s).setData(o,{...r,manual:!0})}setQueriesData(e,t,r){return Wn.batch(()=>Ce(this,Qr).findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Ce(this,Qr).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Ce(this,Qr);Wn.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Ce(this,Qr);return Wn.batch(()=>(r.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},s=Wn.batch(()=>Ce(this,Qr).findAll(e).map(i=>i.cancel(r)));return Promise.all(s).then(Ss).catch(Ss)}invalidateQueries(e,t={}){return Wn.batch(()=>(Ce(this,Qr).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},s=Wn.batch(()=>Ce(this,Qr).findAll(e).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let a=i.fetch(void 0,r);return r.throwOnError||(a=a.catch(Ss)),i.state.fetchStatus==="paused"?Promise.resolve():a}));return Promise.all(s).then(Ss)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Ce(this,Qr).build(this,t);return r.isStaleByTime(zo(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ss).catch(Ss)}fetchInfiniteQuery(e){return e.behavior=m2(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ss).catch(Ss)}ensureInfiniteQueryData(e){return e.behavior=m2(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Mh.isOnline()?Ce(this,vo).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ce(this,Qr)}getMutationCache(){return Ce(this,vo)}getDefaultOptions(){return Ce(this,bo)}setDefaultOptions(e){At(this,bo,e)}setQueryDefaults(e,t){Ce(this,Uc).set(Du(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Ce(this,Uc).values()],r={};return t.forEach(s=>{Mu(e,s.queryKey)&&Object.assign(r,s.defaultOptions)}),r}setMutationDefaults(e,t){Ce(this,Hc).set(Du(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Ce(this,Hc).values()],r={};return t.forEach(s=>{Mu(e,s.mutationKey)&&Object.assign(r,s.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Ce(this,bo).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=nb(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===sb&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Ce(this,bo).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Ce(this,Qr).clear(),Ce(this,vo).clear()}},Qr=new WeakMap,vo=new WeakMap,bo=new WeakMap,Uc=new WeakMap,Hc=new WeakMap,jo=new WeakMap,Yc=new WeakMap,Kc=new WeakMap,M_),w4=p.createContext(void 0),J3=e=>{const t=p.useContext(w4);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Z3=({client:e,children:t})=>(p.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),n.jsx(w4.Provider,{value:e,children:t})),S4=p.createContext(!1),eL=()=>p.useContext(S4);S4.Provider;function tL(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var rL=p.createContext(tL()),nL=()=>p.useContext(rL),sL=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},iL=e=>{p.useEffect(()=>{e.clearReset()},[e])},aL=({result:e,errorResetBoundary:t,throwOnError:r,query:s,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(i&&e.data===void 0||L3(r,[e.error,s])),oL=e=>{if(e.suspense){const r=i=>i==="static"?i:Math.max(i??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...i)=>r(s(...i)):r(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},lL=(e,t)=>e.isLoading&&e.isFetching&&!t,cL=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,y2=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function dL(e,t,r){var f,h,m,g,x;const s=eL(),i=nL(),a=J3(),o=a.defaultQueryOptions(e);(h=(f=a.getDefaultOptions().queries)==null?void 0:f._experimental_beforeQuery)==null||h.call(f,o),o._optimisticResults=s?"isRestoring":"optimistic",oL(o),sL(o,i),iL(i);const l=!a.getQueryCache().get(o.queryHash),[c]=p.useState(()=>new t(a,o)),u=c.getOptimisticResult(o),d=!s&&e.subscribed!==!1;if(p.useSyncExternalStore(p.useCallback(y=>{const v=d?c.subscribe(Wn.batchCalls(y)):Ss;return c.updateResult(),v},[c,d]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),p.useEffect(()=>{c.setOptions(o)},[o,c]),cL(o,u))throw y2(o,c,i);if(aL({result:u,errorResetBoundary:i,throwOnError:o.throwOnError,query:a.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw u.error;if((g=(m=a.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||g.call(m,o,u),o.experimental_prefetchInRender&&!Ul&&lL(u,s)){const y=l?y2(o,c,i):(x=a.getQueryCache().get(o.queryHash))==null?void 0:x.promise;y==null||y.catch(Ss).finally(()=>{c.updateResult()})}return o.notifyOnChangeProps?u:c.trackResult(u)}function v2(e,t){return dL(e,U3)}function k4(e,t){return function(){return e.apply(t,arguments)}}const{toString:uL}=Object.prototype,{getPrototypeOf:ob}=Object,{iterator:Zg,toStringTag:N4}=Symbol,em=(e=>t=>{const r=uL.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Mi=e=>(e=e.toLowerCase(),t=>em(t)===e),tm=e=>t=>typeof t===e,{isArray:yd}=Array,ed=tm("undefined");function hp(e){return e!==null&&!ed(e)&&e.constructor!==null&&!ed(e.constructor)&&Ps(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const C4=Mi("ArrayBuffer");function pL(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&C4(e.buffer),t}const fL=tm("string"),Ps=tm("function"),_4=tm("number"),gp=e=>e!==null&&typeof e=="object",hL=e=>e===!0||e===!1,eh=e=>{if(em(e)!=="object")return!1;const t=ob(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(N4 in e)&&!(Zg in e)},gL=e=>{if(!gp(e)||hp(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},mL=Mi("Date"),xL=Mi("File"),yL=Mi("Blob"),vL=Mi("FileList"),bL=e=>gp(e)&&Ps(e.pipe),jL=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ps(e.append)&&((t=em(e))==="formdata"||t==="object"&&Ps(e.toString)&&e.toString()==="[object FormData]"))},wL=Mi("URLSearchParams"),[SL,kL,NL,CL]=["ReadableStream","Request","Response","Headers"].map(Mi),_L=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mp(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let s,i;if(typeof e!="object"&&(e=[e]),yd(e))for(s=0,i=e.length;s<i;s++)t.call(null,e[s],s,e);else{if(hp(e))return;const a=r?Object.getOwnPropertyNames(e):Object.keys(e),o=a.length;let l;for(s=0;s<o;s++)l=a[s],t.call(null,e[l],l,e)}}function A4(e,t){if(hp(e))return null;t=t.toLowerCase();const r=Object.keys(e);let s=r.length,i;for(;s-- >0;)if(i=r[s],t===i.toLowerCase())return i;return null}const ml=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,E4=e=>!ed(e)&&e!==ml;function Yv(){const{caseless:e,skipUndefined:t}=E4(this)&&this||{},r={},s=(i,a)=>{const o=e&&A4(r,a)||a;eh(r[o])&&eh(i)?r[o]=Yv(r[o],i):eh(i)?r[o]=Yv({},i):yd(i)?r[o]=i.slice():(!t||!ed(i))&&(r[o]=i)};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&mp(arguments[i],s);return r}const AL=(e,t,r,{allOwnKeys:s}={})=>(mp(t,(i,a)=>{r&&Ps(i)?e[a]=k4(i,r):e[a]=i},{allOwnKeys:s}),e),EL=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),PL=(e,t,r,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},IL=(e,t,r,s)=>{let i,a,o;const l={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],(!s||s(o,e,t))&&!l[o]&&(t[o]=e[o],l[o]=!0);e=r!==!1&&ob(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},TL=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const s=e.indexOf(t,r);return s!==-1&&s===r},RL=e=>{if(!e)return null;if(yd(e))return e;let t=e.length;if(!_4(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},OL=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&ob(Uint8Array)),zL=(e,t)=>{const s=(e&&e[Zg]).call(e);let i;for(;(i=s.next())&&!i.done;){const a=i.value;t.call(e,a[0],a[1])}},LL=(e,t)=>{let r;const s=[];for(;(r=e.exec(t))!==null;)s.push(r);return s},$L=Mi("HTMLFormElement"),DL=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,i){return s.toUpperCase()+i}),b2=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),ML=Mi("RegExp"),P4=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),s={};mp(r,(i,a)=>{let o;(o=t(i,a,e))!==!1&&(s[a]=o||i)}),Object.defineProperties(e,s)},BL=e=>{P4(e,(t,r)=>{if(Ps(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=e[r];if(Ps(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},FL=(e,t)=>{const r={},s=i=>{i.forEach(a=>{r[a]=!0})};return yd(e)?s(e):s(String(e).split(t)),r},WL=()=>{},UL=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function HL(e){return!!(e&&Ps(e.append)&&e[N4]==="FormData"&&e[Zg])}const YL=e=>{const t=new Array(10),r=(s,i)=>{if(gp(s)){if(t.indexOf(s)>=0)return;if(hp(s))return s;if(!("toJSON"in s)){t[i]=s;const a=yd(s)?[]:{};return mp(s,(o,l)=>{const c=r(o,i+1);!ed(c)&&(a[l]=c)}),t[i]=void 0,a}}return s};return r(e,0)},KL=Mi("AsyncFunction"),VL=e=>e&&(gp(e)||Ps(e))&&Ps(e.then)&&Ps(e.catch),I4=((e,t)=>e?setImmediate:t?((r,s)=>(ml.addEventListener("message",({source:i,data:a})=>{i===ml&&a===r&&s.length&&s.shift()()},!1),i=>{s.push(i),ml.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ps(ml.postMessage)),qL=typeof queueMicrotask<"u"?queueMicrotask.bind(ml):typeof process<"u"&&process.nextTick||I4,GL=e=>e!=null&&Ps(e[Zg]),De={isArray:yd,isArrayBuffer:C4,isBuffer:hp,isFormData:jL,isArrayBufferView:pL,isString:fL,isNumber:_4,isBoolean:hL,isObject:gp,isPlainObject:eh,isEmptyObject:gL,isReadableStream:SL,isRequest:kL,isResponse:NL,isHeaders:CL,isUndefined:ed,isDate:mL,isFile:xL,isBlob:yL,isRegExp:ML,isFunction:Ps,isStream:bL,isURLSearchParams:wL,isTypedArray:OL,isFileList:vL,forEach:mp,merge:Yv,extend:AL,trim:_L,stripBOM:EL,inherits:PL,toFlatObject:IL,kindOf:em,kindOfTest:Mi,endsWith:TL,toArray:RL,forEachEntry:zL,matchAll:LL,isHTMLForm:$L,hasOwnProperty:b2,hasOwnProp:b2,reduceDescriptors:P4,freezeMethods:BL,toObjectSet:FL,toCamelCase:DL,noop:WL,toFiniteNumber:UL,findKey:A4,global:ml,isContextDefined:E4,isSpecCompliantForm:HL,toJSONObject:YL,isAsyncFn:KL,isThenable:VL,setImmediate:I4,asap:qL,isIterable:GL};function nr(e,t,r,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}De.inherits(nr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:De.toJSONObject(this.config),code:this.code,status:this.status}}});const T4=nr.prototype,R4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{R4[e]={value:e}});Object.defineProperties(nr,R4);Object.defineProperty(T4,"isAxiosError",{value:!0});nr.from=(e,t,r,s,i,a)=>{const o=Object.create(T4);De.toFlatObject(e,o,function(d){return d!==Error.prototype},u=>u!=="isAxiosError");const l=e&&e.message?e.message:"Error",c=t==null&&e?e.code:t;return nr.call(o,l,c,r,s,i),e&&o.cause==null&&Object.defineProperty(o,"cause",{value:e,configurable:!0}),o.name=e&&e.name||"Error",a&&Object.assign(o,a),o};const XL=null;function Kv(e){return De.isPlainObject(e)||De.isArray(e)}function O4(e){return De.endsWith(e,"[]")?e.slice(0,-2):e}function j2(e,t,r){return e?e.concat(t).map(function(i,a){return i=O4(i),!r&&a?"["+i+"]":i}).join(r?".":""):t}function QL(e){return De.isArray(e)&&!e.some(Kv)}const JL=De.toFlatObject(De,{},null,function(t){return/^is[A-Z]/.test(t)});function rm(e,t,r){if(!De.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=De.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,y){return!De.isUndefined(y[x])});const s=r.metaTokens,i=r.visitor||d,a=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&De.isSpecCompliantForm(t);if(!De.isFunction(i))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(De.isDate(g))return g.toISOString();if(De.isBoolean(g))return g.toString();if(!c&&De.isBlob(g))throw new nr("Blob is not supported. Use a Buffer instead.");return De.isArrayBuffer(g)||De.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function d(g,x,y){let v=g;if(g&&!y&&typeof g=="object"){if(De.endsWith(x,"{}"))x=s?x:x.slice(0,-2),g=JSON.stringify(g);else if(De.isArray(g)&&QL(g)||(De.isFileList(g)||De.endsWith(x,"[]"))&&(v=De.toArray(g)))return x=O4(x),v.forEach(function(k,j){!(De.isUndefined(k)||k===null)&&t.append(o===!0?j2([x],j,a):o===null?x:x+"[]",u(k))}),!1}return Kv(g)?!0:(t.append(j2(y,x,a),u(g)),!1)}const f=[],h=Object.assign(JL,{defaultVisitor:d,convertValue:u,isVisitable:Kv});function m(g,x){if(!De.isUndefined(g)){if(f.indexOf(g)!==-1)throw Error("Circular reference detected in "+x.join("."));f.push(g),De.forEach(g,function(v,S){(!(De.isUndefined(v)||v===null)&&i.call(t,v,De.isString(S)?S.trim():S,x,h))===!0&&m(v,x?x.concat(S):[S])}),f.pop()}}if(!De.isObject(e))throw new TypeError("data must be an object");return m(e),t}function w2(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function lb(e,t){this._pairs=[],e&&rm(e,this,t)}const z4=lb.prototype;z4.append=function(t,r){this._pairs.push([t,r])};z4.toString=function(t){const r=t?function(s){return t.call(this,s,w2)}:w2;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function ZL(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function L4(e,t,r){if(!t)return e;const s=r&&r.encode||ZL;De.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let a;if(i?a=i(t,r):a=De.isURLSearchParams(t)?t.toString():new lb(t,r).toString(s),a){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}class S2{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){De.forEach(this.handlers,function(s){s!==null&&t(s)})}}const $4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},e$=typeof URLSearchParams<"u"?URLSearchParams:lb,t$=typeof FormData<"u"?FormData:null,r$=typeof Blob<"u"?Blob:null,n$={isBrowser:!0,classes:{URLSearchParams:e$,FormData:t$,Blob:r$},protocols:["http","https","file","blob","url","data"]},cb=typeof window<"u"&&typeof document<"u",Vv=typeof navigator=="object"&&navigator||void 0,s$=cb&&(!Vv||["ReactNative","NativeScript","NS"].indexOf(Vv.product)<0),i$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",a$=cb&&window.location.href||"http://localhost",o$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:cb,hasStandardBrowserEnv:s$,hasStandardBrowserWebWorkerEnv:i$,navigator:Vv,origin:a$},Symbol.toStringTag,{value:"Module"})),ts={...o$,...n$};function l$(e,t){return rm(e,new ts.classes.URLSearchParams,{visitor:function(r,s,i,a){return ts.isNode&&De.isBuffer(r)?(this.append(s,r.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}function c$(e){return De.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function d$(e){const t={},r=Object.keys(e);let s;const i=r.length;let a;for(s=0;s<i;s++)a=r[s],t[a]=e[a];return t}function D4(e){function t(r,s,i,a){let o=r[a++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=a>=r.length;return o=!o&&De.isArray(i)?i.length:o,c?(De.hasOwnProp(i,o)?i[o]=[i[o],s]:i[o]=s,!l):((!i[o]||!De.isObject(i[o]))&&(i[o]=[]),t(r,s,i[o],a)&&De.isArray(i[o])&&(i[o]=d$(i[o])),!l)}if(De.isFormData(e)&&De.isFunction(e.entries)){const r={};return De.forEachEntry(e,(s,i)=>{t(c$(s),i,r,0)}),r}return null}function u$(e,t,r){if(De.isString(e))try{return(t||JSON.parse)(e),De.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(r||JSON.stringify)(e)}const xp={transitional:$4,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",i=s.indexOf("application/json")>-1,a=De.isObject(t);if(a&&De.isHTMLForm(t)&&(t=new FormData(t)),De.isFormData(t))return i?JSON.stringify(D4(t)):t;if(De.isArrayBuffer(t)||De.isBuffer(t)||De.isStream(t)||De.isFile(t)||De.isBlob(t)||De.isReadableStream(t))return t;if(De.isArrayBufferView(t))return t.buffer;if(De.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(a){if(s.indexOf("application/x-www-form-urlencoded")>-1)return l$(t,this.formSerializer).toString();if((l=De.isFileList(t))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return rm(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return a||i?(r.setContentType("application/json",!1),u$(t)):t}],transformResponse:[function(t){const r=this.transitional||xp.transitional,s=r&&r.forcedJSONParsing,i=this.responseType==="json";if(De.isResponse(t)||De.isReadableStream(t))return t;if(t&&De.isString(t)&&(s&&!this.responseType||i)){const o=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?nr.from(l,nr.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ts.classes.FormData,Blob:ts.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};De.forEach(["delete","get","head","post","put","patch"],e=>{xp.headers[e]={}});const p$=De.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),f$=e=>{const t={};let r,s,i;return e&&e.split(`
`).forEach(function(o){i=o.indexOf(":"),r=o.substring(0,i).trim().toLowerCase(),s=o.substring(i+1).trim(),!(!r||t[r]&&p$[r])&&(r==="set-cookie"?t[r]?t[r].push(s):t[r]=[s]:t[r]=t[r]?t[r]+", "+s:s)}),t},k2=Symbol("internals");function Hd(e){return e&&String(e).trim().toLowerCase()}function th(e){return e===!1||e==null?e:De.isArray(e)?e.map(th):String(e)}function h$(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=r.exec(e);)t[s[1]]=s[2];return t}const g$=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function qx(e,t,r,s,i){if(De.isFunction(s))return s.call(this,t,r);if(i&&(t=r),!!De.isString(t)){if(De.isString(s))return t.indexOf(s)!==-1;if(De.isRegExp(s))return s.test(t)}}function m$(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,s)=>r.toUpperCase()+s)}function x$(e,t){const r=De.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+r,{value:function(i,a,o){return this[s].call(this,t,i,a,o)},configurable:!0})})}let Is=class{constructor(t){t&&this.set(t)}set(t,r,s){const i=this;function a(l,c,u){const d=Hd(c);if(!d)throw new Error("header name must be a non-empty string");const f=De.findKey(i,d);(!f||i[f]===void 0||u===!0||u===void 0&&i[f]!==!1)&&(i[f||c]=th(l))}const o=(l,c)=>De.forEach(l,(u,d)=>a(u,d,c));if(De.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(De.isString(t)&&(t=t.trim())&&!g$(t))o(f$(t),r);else if(De.isObject(t)&&De.isIterable(t)){let l={},c,u;for(const d of t){if(!De.isArray(d))throw TypeError("Object iterator must return a key-value pair");l[u=d[0]]=(c=l[u])?De.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}o(l,r)}else t!=null&&a(r,t,s);return this}get(t,r){if(t=Hd(t),t){const s=De.findKey(this,t);if(s){const i=this[s];if(!r)return i;if(r===!0)return h$(i);if(De.isFunction(r))return r.call(this,i,s);if(De.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Hd(t),t){const s=De.findKey(this,t);return!!(s&&this[s]!==void 0&&(!r||qx(this,this[s],s,r)))}return!1}delete(t,r){const s=this;let i=!1;function a(o){if(o=Hd(o),o){const l=De.findKey(s,o);l&&(!r||qx(s,s[l],l,r))&&(delete s[l],i=!0)}}return De.isArray(t)?t.forEach(a):a(t),i}clear(t){const r=Object.keys(this);let s=r.length,i=!1;for(;s--;){const a=r[s];(!t||qx(this,this[a],a,t,!0))&&(delete this[a],i=!0)}return i}normalize(t){const r=this,s={};return De.forEach(this,(i,a)=>{const o=De.findKey(s,a);if(o){r[o]=th(i),delete r[a];return}const l=t?m$(a):String(a).trim();l!==a&&delete r[a],r[l]=th(i),s[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return De.forEach(this,(s,i)=>{s!=null&&s!==!1&&(r[i]=t&&De.isArray(s)?s.join(", "):s)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const s=new this(t);return r.forEach(i=>s.set(i)),s}static accessor(t){const s=(this[k2]=this[k2]={accessors:{}}).accessors,i=this.prototype;function a(o){const l=Hd(o);s[l]||(x$(i,o),s[l]=!0)}return De.isArray(t)?t.forEach(a):a(t),this}};Is.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);De.reduceDescriptors(Is.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[r]=s}}});De.freezeMethods(Is);function Gx(e,t){const r=this||xp,s=t||r,i=Is.from(s.headers);let a=s.data;return De.forEach(e,function(l){a=l.call(r,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function M4(e){return!!(e&&e.__CANCEL__)}function vd(e,t,r){nr.call(this,e??"canceled",nr.ERR_CANCELED,t,r),this.name="CanceledError"}De.inherits(vd,nr,{__CANCEL__:!0});function B4(e,t,r){const s=r.config.validateStatus;!r.status||!s||s(r.status)?e(r):t(new nr("Request failed with status code "+r.status,[nr.ERR_BAD_REQUEST,nr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function y$(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function v$(e,t){e=e||10;const r=new Array(e),s=new Array(e);let i=0,a=0,o;return t=t!==void 0?t:1e3,function(c){const u=Date.now(),d=s[a];o||(o=u),r[i]=c,s[i]=u;let f=a,h=0;for(;f!==i;)h+=r[f++],f=f%e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),u-o<t)return;const m=d&&u-d;return m?Math.round(h*1e3/m):void 0}}function b$(e,t){let r=0,s=1e3/t,i,a;const o=(u,d=Date.now())=>{r=d,i=null,a&&(clearTimeout(a),a=null),e(...u)};return[(...u)=>{const d=Date.now(),f=d-r;f>=s?o(u,d):(i=u,a||(a=setTimeout(()=>{a=null,o(i)},s-f)))},()=>i&&o(i)]}const Bh=(e,t,r=3)=>{let s=0;const i=v$(50,250);return b$(a=>{const o=a.loaded,l=a.lengthComputable?a.total:void 0,c=o-s,u=i(c),d=o<=l;s=o;const f={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:u||void 0,estimated:u&&l&&d?(l-o)/u:void 0,event:a,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(f)},r)},N2=(e,t)=>{const r=e!=null;return[s=>t[0]({lengthComputable:r,total:e,loaded:s}),t[1]]},C2=e=>(...t)=>De.asap(()=>e(...t)),j$=ts.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,ts.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(ts.origin),ts.navigator&&/(msie|trident)/i.test(ts.navigator.userAgent)):()=>!0,w$=ts.hasStandardBrowserEnv?{write(e,t,r,s,i,a,o){if(typeof document>"u")return;const l=[`${e}=${encodeURIComponent(t)}`];De.isNumber(r)&&l.push(`expires=${new Date(r).toUTCString()}`),De.isString(s)&&l.push(`path=${s}`),De.isString(i)&&l.push(`domain=${i}`),a===!0&&l.push("secure"),De.isString(o)&&l.push(`SameSite=${o}`),document.cookie=l.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function S$(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function k$(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function F4(e,t,r){let s=!S$(t);return e&&(s||r==!1)?k$(e,t):t}const _2=e=>e instanceof Is?{...e}:e;function Hl(e,t){t=t||{};const r={};function s(u,d,f,h){return De.isPlainObject(u)&&De.isPlainObject(d)?De.merge.call({caseless:h},u,d):De.isPlainObject(d)?De.merge({},d):De.isArray(d)?d.slice():d}function i(u,d,f,h){if(De.isUndefined(d)){if(!De.isUndefined(u))return s(void 0,u,f,h)}else return s(u,d,f,h)}function a(u,d){if(!De.isUndefined(d))return s(void 0,d)}function o(u,d){if(De.isUndefined(d)){if(!De.isUndefined(u))return s(void 0,u)}else return s(void 0,d)}function l(u,d,f){if(f in t)return s(u,d);if(f in e)return s(void 0,u)}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(u,d,f)=>i(_2(u),_2(d),f,!0)};return De.forEach(Object.keys({...e,...t}),function(d){const f=c[d]||i,h=f(e[d],t[d],d);De.isUndefined(h)&&f!==l||(r[d]=h)}),r}const W4=e=>{const t=Hl({},e);let{data:r,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:a,headers:o,auth:l}=t;if(t.headers=o=Is.from(o),t.url=L4(F4(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),De.isFormData(r)){if(ts.hasStandardBrowserEnv||ts.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(De.isFunction(r.getHeaders)){const c=r.getHeaders(),u=["content-type","content-length"];Object.entries(c).forEach(([d,f])=>{u.includes(d.toLowerCase())&&o.set(d,f)})}}if(ts.hasStandardBrowserEnv&&(s&&De.isFunction(s)&&(s=s(t)),s||s!==!1&&j$(t.url))){const c=i&&a&&w$.read(a);c&&o.set(i,c)}return t},N$=typeof XMLHttpRequest<"u",C$=N$&&function(e){return new Promise(function(r,s){const i=W4(e);let a=i.data;const o=Is.from(i.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:u}=i,d,f,h,m,g;function x(){m&&m(),g&&g(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let y=new XMLHttpRequest;y.open(i.method.toUpperCase(),i.url,!0),y.timeout=i.timeout;function v(){if(!y)return;const k=Is.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),_={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:k,config:e,request:y};B4(function(A){r(A),x()},function(A){s(A),x()},_),y=null}"onloadend"in y?y.onloadend=v:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(v)},y.onabort=function(){y&&(s(new nr("Request aborted",nr.ECONNABORTED,e,y)),y=null)},y.onerror=function(j){const _=j&&j.message?j.message:"Network Error",b=new nr(_,nr.ERR_NETWORK,e,y);b.event=j||null,s(b),y=null},y.ontimeout=function(){let j=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const _=i.transitional||$4;i.timeoutErrorMessage&&(j=i.timeoutErrorMessage),s(new nr(j,_.clarifyTimeoutError?nr.ETIMEDOUT:nr.ECONNABORTED,e,y)),y=null},a===void 0&&o.setContentType(null),"setRequestHeader"in y&&De.forEach(o.toJSON(),function(j,_){y.setRequestHeader(_,j)}),De.isUndefined(i.withCredentials)||(y.withCredentials=!!i.withCredentials),l&&l!=="json"&&(y.responseType=i.responseType),u&&([h,g]=Bh(u,!0),y.addEventListener("progress",h)),c&&y.upload&&([f,m]=Bh(c),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",m)),(i.cancelToken||i.signal)&&(d=k=>{y&&(s(!k||k.type?new vd(null,e,y):k),y.abort(),y=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const S=y$(i.url);if(S&&ts.protocols.indexOf(S)===-1){s(new nr("Unsupported protocol "+S+":",nr.ERR_BAD_REQUEST,e));return}y.send(a||null)})},_$=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let s=new AbortController,i;const a=function(u){if(!i){i=!0,l();const d=u instanceof Error?u:this.reason;s.abort(d instanceof nr?d:new vd(d instanceof Error?d.message:d))}};let o=t&&setTimeout(()=>{o=null,a(new nr(`timeout ${t} of ms exceeded`,nr.ETIMEDOUT))},t);const l=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),e=null)};e.forEach(u=>u.addEventListener("abort",a));const{signal:c}=s;return c.unsubscribe=()=>De.asap(l),c}},A$=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let s=0,i;for(;s<r;)i=s+t,yield e.slice(s,i),s=i},E$=async function*(e,t){for await(const r of P$(e))yield*A$(r,t)},P$=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:s}=await t.read();if(r)break;yield s}}finally{await t.cancel()}},A2=(e,t,r,s)=>{const i=E$(e,t);let a=0,o,l=c=>{o||(o=!0,s&&s(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await i.next();if(u){l(),c.close();return}let f=d.byteLength;if(r){let h=a+=f;r(h)}c.enqueue(new Uint8Array(d))}catch(u){throw l(u),u}},cancel(c){return l(c),i.return()}},{highWaterMark:2})},E2=64*1024,{isFunction:yf}=De,I$=(({Request:e,Response:t})=>({Request:e,Response:t}))(De.global),{ReadableStream:P2,TextEncoder:I2}=De.global,T2=(e,...t)=>{try{return!!e(...t)}catch{return!1}},T$=e=>{e=De.merge.call({skipUndefined:!0},I$,e);const{fetch:t,Request:r,Response:s}=e,i=t?yf(t):typeof fetch=="function",a=yf(r),o=yf(s);if(!i)return!1;const l=i&&yf(P2),c=i&&(typeof I2=="function"?(g=>x=>g.encode(x))(new I2):async g=>new Uint8Array(await new r(g).arrayBuffer())),u=a&&l&&T2(()=>{let g=!1;const x=new r(ts.origin,{body:new P2,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!x}),d=o&&l&&T2(()=>De.isReadableStream(new s("").body)),f={stream:d&&(g=>g.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!f[g]&&(f[g]=(x,y)=>{let v=x&&x[g];if(v)return v.call(x);throw new nr(`Response type '${g}' is not supported`,nr.ERR_NOT_SUPPORT,y)})});const h=async g=>{if(g==null)return 0;if(De.isBlob(g))return g.size;if(De.isSpecCompliantForm(g))return(await new r(ts.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(De.isArrayBufferView(g)||De.isArrayBuffer(g))return g.byteLength;if(De.isURLSearchParams(g)&&(g=g+""),De.isString(g))return(await c(g)).byteLength},m=async(g,x)=>{const y=De.toFiniteNumber(g.getContentLength());return y??h(x)};return async g=>{let{url:x,method:y,data:v,signal:S,cancelToken:k,timeout:j,onDownloadProgress:_,onUploadProgress:b,responseType:A,headers:z,withCredentials:D="same-origin",fetchOptions:w}=W4(g),N=t||fetch;A=A?(A+"").toLowerCase():"text";let $=_$([S,k&&k.toAbortSignal()],j),E=null;const q=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let L;try{if(b&&u&&y!=="get"&&y!=="head"&&(L=await m(z,v))!==0){let re=new r(x,{method:"POST",body:v,duplex:"half"}),ae;if(De.isFormData(v)&&(ae=re.headers.get("content-type"))&&z.setContentType(ae),re.body){const[Y,J]=N2(L,Bh(C2(b)));v=A2(re.body,E2,Y,J)}}De.isString(D)||(D=D?"include":"omit");const O=a&&"credentials"in r.prototype,B={...w,signal:$,method:y.toUpperCase(),headers:z.normalize().toJSON(),body:v,duplex:"half",credentials:O?D:void 0};E=a&&new r(x,B);let I=await(a?N(E,w):N(x,B));const T=d&&(A==="stream"||A==="response");if(d&&(_||T&&q)){const re={};["status","statusText","headers"].forEach(P=>{re[P]=I[P]});const ae=De.toFiniteNumber(I.headers.get("content-length")),[Y,J]=_&&N2(ae,Bh(C2(_),!0))||[];I=new s(A2(I.body,E2,Y,()=>{J&&J(),q&&q()}),re)}A=A||"text";let W=await f[De.findKey(f,A)||"text"](I,g);return!T&&q&&q(),await new Promise((re,ae)=>{B4(re,ae,{data:W,headers:Is.from(I.headers),status:I.status,statusText:I.statusText,config:g,request:E})})}catch(O){throw q&&q(),O&&O.name==="TypeError"&&/Load failed|fetch/i.test(O.message)?Object.assign(new nr("Network Error",nr.ERR_NETWORK,g,E),{cause:O.cause||O}):nr.from(O,O&&O.code,g,E)}}},R$=new Map,U4=e=>{let t=e&&e.env||{};const{fetch:r,Request:s,Response:i}=t,a=[s,i,r];let o=a.length,l=o,c,u,d=R$;for(;l--;)c=a[l],u=d.get(c),u===void 0&&d.set(c,u=l?new Map:T$(t)),d=u;return u};U4();const db={http:XL,xhr:C$,fetch:{get:U4}};De.forEach(db,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const R2=e=>`- ${e}`,O$=e=>De.isFunction(e)||e===null||e===!1;function z$(e,t){e=De.isArray(e)?e:[e];const{length:r}=e;let s,i;const a={};for(let o=0;o<r;o++){s=e[o];let l;if(i=s,!O$(s)&&(i=db[(l=String(s)).toLowerCase()],i===void 0))throw new nr(`Unknown adapter '${l}'`);if(i&&(De.isFunction(i)||(i=i.get(t))))break;a[l||"#"+o]=i}if(!i){const o=Object.entries(a).map(([c,u])=>`adapter ${c} `+(u===!1?"is not supported by the environment":"is not available in the build"));let l=r?o.length>1?`since :
`+o.map(R2).join(`
`):" "+R2(o[0]):"as no adapter specified";throw new nr("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return i}const H4={getAdapter:z$,adapters:db};function Xx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new vd(null,e)}function O2(e){return Xx(e),e.headers=Is.from(e.headers),e.data=Gx.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),H4.getAdapter(e.adapter||xp.adapter,e)(e).then(function(s){return Xx(e),s.data=Gx.call(e,e.transformResponse,s),s.headers=Is.from(s.headers),s},function(s){return M4(s)||(Xx(e),s&&s.response&&(s.response.data=Gx.call(e,e.transformResponse,s.response),s.response.headers=Is.from(s.response.headers))),Promise.reject(s)})}const Y4="1.13.2",nm={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{nm[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const z2={};nm.transitional=function(t,r,s){function i(a,o){return"[Axios v"+Y4+"] Transitional option '"+a+"'"+o+(s?". "+s:"")}return(a,o,l)=>{if(t===!1)throw new nr(i(o," has been removed"+(r?" in "+r:"")),nr.ERR_DEPRECATED);return r&&!z2[o]&&(z2[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(a,o,l):!0}};nm.spelling=function(t){return(r,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function L$(e,t,r){if(typeof e!="object")throw new nr("options must be an object",nr.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let i=s.length;for(;i-- >0;){const a=s[i],o=t[a];if(o){const l=e[a],c=l===void 0||o(l,a,e);if(c!==!0)throw new nr("option "+a+" must be "+c,nr.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new nr("Unknown option "+a,nr.ERR_BAD_OPTION)}}const rh={assertOptions:L$,validators:nm},Ui=rh.validators;let Il=class{constructor(t){this.defaults=t||{},this.interceptors={request:new S2,response:new S2}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const a=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?a&&!String(s.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+a):s.stack=a}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Hl(this.defaults,r);const{transitional:s,paramsSerializer:i,headers:a}=r;s!==void 0&&rh.assertOptions(s,{silentJSONParsing:Ui.transitional(Ui.boolean),forcedJSONParsing:Ui.transitional(Ui.boolean),clarifyTimeoutError:Ui.transitional(Ui.boolean)},!1),i!=null&&(De.isFunction(i)?r.paramsSerializer={serialize:i}:rh.assertOptions(i,{encode:Ui.function,serialize:Ui.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),rh.assertOptions(r,{baseUrl:Ui.spelling("baseURL"),withXsrfToken:Ui.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=a&&De.merge(a.common,a[r.method]);a&&De.forEach(["delete","get","head","post","put","patch","common"],g=>{delete a[g]}),r.headers=Is.concat(o,a);const l=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(c=c&&x.synchronous,l.unshift(x.fulfilled,x.rejected))});const u=[];this.interceptors.response.forEach(function(x){u.push(x.fulfilled,x.rejected)});let d,f=0,h;if(!c){const g=[O2.bind(this),void 0];for(g.unshift(...l),g.push(...u),h=g.length,d=Promise.resolve(r);f<h;)d=d.then(g[f++],g[f++]);return d}h=l.length;let m=r;for(;f<h;){const g=l[f++],x=l[f++];try{m=g(m)}catch(y){x.call(this,y);break}}try{d=O2.call(this,m)}catch(g){return Promise.reject(g)}for(f=0,h=u.length;f<h;)d=d.then(u[f++],u[f++]);return d}getUri(t){t=Hl(this.defaults,t);const r=F4(t.baseURL,t.url,t.allowAbsoluteUrls);return L4(r,t.params,t.paramsSerializer)}};De.forEach(["delete","get","head","options"],function(t){Il.prototype[t]=function(r,s){return this.request(Hl(s||{},{method:t,url:r,data:(s||{}).data}))}});De.forEach(["post","put","patch"],function(t){function r(s){return function(a,o,l){return this.request(Hl(l||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}Il.prototype[t]=r(),Il.prototype[t+"Form"]=r(!0)});let $$=class K4{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(a){r=a});const s=this;this.promise.then(i=>{if(!s._listeners)return;let a=s._listeners.length;for(;a-- >0;)s._listeners[a](i);s._listeners=null}),this.promise.then=i=>{let a;const o=new Promise(l=>{s.subscribe(l),a=l}).then(i);return o.cancel=function(){s.unsubscribe(a)},o},t(function(a,o,l){s.reason||(s.reason=new vd(a,o,l),r(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=s=>{t.abort(s)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new K4(function(i){t=i}),cancel:t}}};function D$(e){return function(r){return e.apply(null,r)}}function M$(e){return De.isObject(e)&&e.isAxiosError===!0}const qv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(qv).forEach(([e,t])=>{qv[t]=e});function V4(e){const t=new Il(e),r=k4(Il.prototype.request,t);return De.extend(r,Il.prototype,t,{allOwnKeys:!0}),De.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return V4(Hl(e,i))},r}const qr=V4(xp);qr.Axios=Il;qr.CanceledError=vd;qr.CancelToken=$$;qr.isCancel=M4;qr.VERSION=Y4;qr.toFormData=rm;qr.AxiosError=nr;qr.Cancel=qr.CanceledError;qr.all=function(t){return Promise.all(t)};qr.spread=D$;qr.isAxiosError=M$;qr.mergeConfig=Hl;qr.AxiosHeaders=Is;qr.formToJSON=e=>D4(De.isHTMLForm(e)?new FormData(e):e);qr.getAdapter=H4.getAdapter;qr.HttpStatusCode=qv;qr.default=qr;const{Axios:Yse,AxiosError:Kse,CanceledError:Vse,isCancel:qse,CancelToken:Gse,VERSION:Xse,all:Qse,Cancel:Jse,isAxiosError:Zse,spread:eie,toFormData:tie,AxiosHeaders:rie,HttpStatusCode:nie,formToJSON:sie,getAdapter:iie,mergeConfig:aie}=qr;var B_,F_;const B$=(F_=(B_=import.meta)==null?void 0:B_.env)==null?void 0:F_.VITE_API_URL,q4=B$||"/",K=qr.create({baseURL:q4}),F$=qr.create({baseURL:q4});K.interceptors.request.use(e=>{const t=sessionStorage.getItem("token")||localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e});K.interceptors.response.use(e=>e,e=>{var s,i,a,o,l;const t=(s=e==null?void 0:e.config)!=null&&s.url?String(e.config.url):"",r=String(((i=e==null?void 0:e.config)==null?void 0:i.method)||"GET").toUpperCase();if(t.includes("/error-logs"))return Promise.reject(e);try{const c=sessionStorage.getItem("token")||localStorage.getItem("token");if(c){const u=sessionStorage.getItem("role")||localStorage.getItem("role"),d={message:(e==null?void 0:e.message)||"unknown_error",status:(a=e==null?void 0:e.response)==null?void 0:a.status,url:t,method:r,stack:e==null?void 0:e.stack,source:"client",details:{role:u,path:typeof window<"u"?window.location.pathname:void 0,responseData:(o=e==null?void 0:e.response)==null?void 0:o.data,code:e==null?void 0:e.code}};F$.post("/error-logs",d,{headers:{Authorization:`Bearer ${c}`}}).catch(()=>null)}}catch{}if(e.config&&e.config.url&&e.config.url.includes("/microsoft/callback"))return Promise.reject(e);if(e.response&&e.response.status===403){const c=((l=e.config)==null?void 0:l.url)||"(unknown url)",u=e.response.data,d=u!=null&&u.error?String(u.error):"",f=u!=null&&u.message?String(u.message):"",h=(u==null?void 0:u.details)!==void 0?u.details:void 0;console.warn(`[api] 403 ${r} ${c}${d?` (${d})`:""}${f?`: ${f}`:""}`,h??u)}return e.response&&e.response.status===401&&(sessionStorage.getItem("token")?(sessionStorage.removeItem("token"),sessionStorage.removeItem("role"),sessionStorage.removeItem("displayName")):(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("displayName")),window.location.pathname!=="/login"&&(window.location.href="/login"+window.location.search)),Promise.reject(e)});const Fh={start:async e=>(await K.post("/impersonation/start",{targetUserId:e})).data,stop:async()=>(await K.post("/impersonation/stop")).data,getStatus:async()=>(await K.get("/impersonation/status")).data};function W$(){const[e,t]=p.useState(null),[r,s]=p.useState(!1),[i,a]=p.useState(!0),o=Sn(),l=p.useRef(!1);p.useEffect(()=>{if(K.get("/settings/public").then(j=>{j.data.login_enabled_microsoft!==void 0&&a(j.data.login_enabled_microsoft)}).catch(console.error),l.current)return;console.log("=== Microsoft OAuth Debug ==="),console.log("Full URL:",window.location.href),console.log("Search params:",window.location.search),console.log("Hash:",window.location.hash);const f=new URLSearchParams(window.location.search),h=f.get("code"),m=f.get("error"),g=f.get("error_description"),x=new URLSearchParams(window.location.hash.substring(1)),y=x.get("code"),v=x.get("error");console.log("Query code:",h),console.log("Query error:",m),console.log("Hash code:",y),console.log("Hash error:",v),console.log("=========================");const S=h||y,k=m||v;k?t(`Microsoft login error: ${k} - ${g||x.get("error_description")}`):S&&(l.current=!0,u(S))},[]);const c=()=>window.location.hostname==="livret.champville.com"||window.location.hostname==="192.168.17.10"||window.location.hostname==="192.168.1.74"?"https://livret.champville.com":window.location.origin,u=async f=>{var h,m,g,x;s(!0),t(null);try{console.log("Microsoft callback - exchanging code for token...");const y=c(),v=await K.post("/microsoft/callback",{code:f,redirect_uri:y});console.log("Microsoft login successful:",v.data),localStorage.setItem("token",v.data.token),localStorage.setItem("role",v.data.role),localStorage.setItem("displayName",v.data.displayName||""),window.history.replaceState({},document.title,window.location.pathname),setTimeout(()=>{v.data.role==="ADMIN"?o("/admin"):v.data.role==="SUBADMIN"?o("/subadmin/dashboard"):v.data.role==="TEACHER"?o("/teacher/classes"):o("/")},100)}catch(y){console.error("Microsoft authentication error:",y);const v=((m=(h=y.response)==null?void 0:h.data)==null?void 0:m.error)||"chec de l'authentification Microsoft",S=(x=(g=y.response)==null?void 0:g.data)==null?void 0:x.details,k=S?typeof S=="string"?S:JSON.stringify(S):null;v.includes("not authorized")||v.includes("Email not authorized")?t("Votre adresse email n'est pas autorise. Veuillez contacter l'administrateur."):t(k?`${v}: ${k}`:v),s(!1),window.history.replaceState({},document.title,window.location.pathname)}},d=async()=>{t(null),s(!0);try{const f=c(),h=await K.get(`/microsoft/auth-url?redirect_uri=${encodeURIComponent(f)}`);window.location.href=h.data.authUrl}catch{t("Impossible de se connecter avec Microsoft"),s(!1)}};return r?n.jsx("div",{className:"login-page",children:n.jsx("div",{className:"login-container",children:n.jsx("div",{className:"login-form-section",children:n.jsx("div",{className:"login-card",children:n.jsxs("div",{style:{textAlign:"center",padding:40},children:[n.jsx("div",{style:{fontSize:"3rem",marginBottom:20},children:""}),n.jsx("p",{children:"Connexion avec Microsoft en cours..."}),n.jsx("p",{style:{marginTop:12,fontSize:"0.9rem",color:"#6b7280"},children:"Veuillez ne pas fermer cette fentre. Vous allez tre redirig automatiquement."})]})})})})}):n.jsx("div",{className:"login-page",children:n.jsxs("div",{className:"login-container",children:[n.jsxs("div",{className:"login-welcome",children:[n.jsxs("div",{className:"login-brand",children:[n.jsx("img",{src:"/champville_logo.png",alt:"Champville Logo",className:"login-logo"}),n.jsx("h1",{className:"login-school-name",children:"Collge des Frres Maristes Champville"}),n.jsx("p",{className:"login-tagline",children:"Livret"})]}),n.jsxs("div",{className:"login-decoration",children:[n.jsx("div",{className:"floating-shape shape-1"}),n.jsx("div",{className:"floating-shape shape-2"}),n.jsx("div",{className:"floating-shape shape-3"})]})]}),n.jsx("div",{className:"login-form-section",children:n.jsxs("div",{className:"login-card",children:[n.jsxs("div",{className:"login-header",children:[n.jsx("h2",{className:"login-title",children:"Bienvenue"}),n.jsx("p",{className:"login-subtitle",children:"Connectez-vous  votre compte"}),n.jsx("p",{className:"login-helper-text",children:"Utilisez votre adresse Microsoft Champville pour accder  votre espace."})]}),e&&n.jsxs("div",{className:"login-error",style:{marginBottom:"20px"},role:"alert","aria-live":"polite",children:[n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:n.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z",fill:"currentColor"})}),n.jsx("span",{children:e})]}),i?n.jsxs("button",{type:"button",onClick:d,className:"login-microsoft-btn",children:[n.jsxs("svg",{width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),n.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),n.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),n.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),n.jsx("span",{children:"Se connecter avec Microsoft"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666"},children:"La connexion Microsoft est actuellement dsactive."}),n.jsx("div",{style:{textAlign:"center",fontSize:"0.9rem",color:"#6b7280",marginTop:-8},children:"En cas de problme, veuillez contacter l'administration ou le support informatique."})]}),n.jsx("div",{className:"login-footer",children:n.jsx("p",{children:"Systme de gestion acadmique"})})]})})]})})}function U$(){const[e,t]=p.useState(""),[r,s]=p.useState(""),[i,a]=p.useState(null),[o,l]=p.useState(null),[c,u]=p.useState(!1),[d,f]=p.useState(!0),h=Sn(),m=p.useRef(!1);p.useEffect(()=>{if(K.get("/settings/public").then(N=>{N.data.login_enabled_microsoft!==void 0&&f(N.data.login_enabled_microsoft)}).catch(console.error),m.current)return;console.log("=== Microsoft OAuth Debug ==="),console.log("Full URL:",window.location.href),console.log("Search params:",window.location.search),console.log("Hash:",window.location.hash);const S=new URLSearchParams(window.location.search),k=S.get("code"),j=S.get("error"),_=S.get("error_description"),b=new URLSearchParams(window.location.hash.substring(1)),A=b.get("code"),z=b.get("error");console.log("Query code:",k),console.log("Query error:",j),console.log("Hash code:",A),console.log("Hash error:",z),console.log("=========================");const D=k||A,w=j||z;w?a(`Microsoft login error: ${w} - ${_||b.get("error_description")}`):D&&(m.current=!0,x(D))},[]);const g=()=>window.location.hostname==="livret.champville.com"||window.location.hostname==="192.168.17.10"||window.location.hostname==="192.168.1.74"?"https://livret.champville.com":window.location.origin,x=async S=>{var k,j,_,b;u(!0),a(null);try{console.log("Microsoft callback - exchanging code for token...");const A=g(),z=await K.post("/microsoft/callback",{code:S,redirect_uri:A});console.log("Microsoft login successful:",z.data),localStorage.setItem("token",z.data.token),localStorage.setItem("role",z.data.role),localStorage.setItem("displayName",z.data.displayName||""),window.history.replaceState({},document.title,window.location.pathname),setTimeout(()=>{z.data.role==="ADMIN"?h("/admin"):z.data.role==="SUBADMIN"?h("/subadmin/dashboard"):z.data.role==="AEFE"?h("/aefe/dashboard"):z.data.role==="TEACHER"?h("/teacher/classes"):h("/")},100)}catch(A){console.error("Microsoft authentication error:",A);const z=((j=(k=A.response)==null?void 0:k.data)==null?void 0:j.error)||"chec de l'authentification Microsoft",D=(b=(_=A.response)==null?void 0:_.data)==null?void 0:b.details,w=D?typeof D=="string"?D:JSON.stringify(D):null;z.includes("not authorized")||z.includes("Email not authorized")?a("Votre adresse email n'est pas autorise. Veuillez contacter l'administrateur."):a(w?`${z}: ${w}`:z),u(!1),window.history.replaceState({},document.title,window.location.pathname)}},y=async()=>{a(null),u(!0);try{const S=g(),k=await K.get(`/microsoft/auth-url?redirect_uri=${encodeURIComponent(S)}`);window.location.href=k.data.authUrl}catch{a("Impossible de se connecter avec Microsoft"),u(!1)}},v=async S=>{S.preventDefault(),a(null);try{const k=await K.post("/auth/login",{email:e,password:r});localStorage.setItem("token",k.data.token),localStorage.setItem("role",k.data.role),localStorage.setItem("displayName",k.data.displayName||e),k.data.role==="ADMIN"?h("/admin"):k.data.role==="SUBADMIN"?h("/subadmin/dashboard"):k.data.role==="AEFE"?h("/aefe/dashboard"):k.data.role==="TEACHER"?h("/teacher/classes"):h("/")}catch{a("Identifiants invalides")}};return c?n.jsx("div",{className:"login-page",children:n.jsx("div",{className:"login-container",children:n.jsx("div",{className:"login-form-section",children:n.jsx("div",{className:"login-card",children:n.jsxs("div",{style:{textAlign:"center",padding:40},children:[n.jsx("div",{style:{fontSize:"3rem",marginBottom:20},children:""}),n.jsx("p",{children:"Connexion avec Microsoft en cours..."})]})})})})}):n.jsx("div",{className:"login-page",children:n.jsxs("div",{className:"login-container",children:[n.jsxs("div",{className:"login-welcome",children:[n.jsxs("div",{className:"login-brand",children:[n.jsx("img",{src:"/champville_logo.png",alt:"Champville Logo",className:"login-logo"}),n.jsx("h1",{className:"login-school-name",children:"Collge des Frres Maristes Champville"}),n.jsx("p",{className:"login-tagline",children:"Livret"})]}),n.jsxs("div",{className:"login-decoration",children:[n.jsx("div",{className:"floating-shape shape-1"}),n.jsx("div",{className:"floating-shape shape-2"}),n.jsx("div",{className:"floating-shape shape-3"})]})]}),n.jsx("div",{className:"login-form-section",children:n.jsxs("div",{className:"login-card",children:[n.jsxs("div",{className:"login-header",children:[n.jsx("h2",{className:"login-title",children:"Administration"}),n.jsx("p",{className:"login-subtitle",children:"Connectez-vous  votre compte administrateur"})]}),n.jsxs("form",{onSubmit:v,className:"login-form",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("input",{id:"email",type:"text",value:e,onChange:S=>t(S.target.value),onFocus:()=>l("email"),onBlur:()=>l(null),className:`form-input ${o==="email"||e?"has-value":""}`,required:!0}),n.jsx("label",{htmlFor:"email",className:"form-label",children:"Adresse email"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("input",{id:"password",type:"password",value:r,onChange:S=>s(S.target.value),onFocus:()=>l("password"),onBlur:()=>l(null),className:`form-input ${o==="password"||r?"has-value":""}`,required:!0}),n.jsx("label",{htmlFor:"password",className:"form-label",children:"Mot de passe"})]}),i&&n.jsxs("div",{className:"login-error",children:[n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:n.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z",fill:"currentColor"})}),n.jsx("span",{children:i})]}),n.jsxs("button",{type:"submit",className:"login-submit-btn",children:[n.jsx("span",{children:"Se connecter"}),n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:n.jsx("path",{d:"M10 0l10 10-10 10V0z",fill:"currentColor"})})]})]}),d&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0",gap:12},children:[n.jsx("div",{style:{flex:1,height:1,background:"#e0e0e0"}}),n.jsx("span",{style:{color:"#999",fontSize:"0.85rem"},children:"OU"}),n.jsx("div",{style:{flex:1,height:1,background:"#e0e0e0"}})]}),n.jsxs("button",{type:"button",onClick:y,style:{width:"100%",padding:"12px 24px",border:"1px solid #e0e0e0",borderRadius:8,background:"white",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:12,fontSize:"1rem",fontWeight:500,transition:"all 0.2s",color:"#333"},onMouseEnter:S=>{S.currentTarget.style.background="#f5f5f5",S.currentTarget.style.borderColor="#0078d4"},onMouseLeave:S=>{S.currentTarget.style.background="white",S.currentTarget.style.borderColor="#e0e0e0"},children:[n.jsxs("svg",{width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),n.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),n.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),n.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),n.jsx("span",{children:"Se connecter avec Microsoft"})]})]}),n.jsx("div",{className:"login-footer",children:n.jsx("p",{children:"Systme de gestion acadmique"})})]})})]})})}/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H$=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Y$=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,s)=>s?s.toUpperCase():r.toLowerCase()),L2=e=>{const t=Y$(e);return t.charAt(0).toUpperCase()+t.slice(1)},G4=(...e)=>e.filter((t,r,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===r).join(" ").trim(),K$=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var V$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q$=p.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:i="",children:a,iconNode:o,...l},c)=>p.createElement("svg",{ref:c,...V$,width:t,height:t,stroke:e,strokeWidth:s?Number(r)*24/Number(t):r,className:G4("lucide",i),...!a&&!K$(l)&&{"aria-hidden":"true"},...l},[...o.map(([u,d])=>p.createElement(u,d)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=(e,t)=>{const r=p.forwardRef(({className:s,...i},a)=>p.createElement(q$,{ref:a,iconNode:t,className:G4(`lucide-${H$(L2(e))}`,`lucide-${e}`,s),...i}));return r.displayName=L2(e),r};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G$=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],X4=Lt("activity",G$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X$=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Q$=Lt("archive",X$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J$=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Z$=Lt("arrow-down",J$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eD=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],tD=Lt("arrow-left",eD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rD=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Tc=Lt("arrow-right",rD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nD=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],sD=Lt("arrow-up",nD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iD=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Wh=Lt("book-open",iD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aD=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],oD=Lt("building",aD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lD=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Yl=Lt("calendar",lD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cD=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Gv=Lt("chart-column",cD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dD=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],$a=Lt("check",dD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uD=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ub=Lt("chevron-down",uD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pD=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],pb=Lt("chevron-right",pD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Lo=Lt("circle-alert",fD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hD=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Xv=Lt("circle-check-big",hD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],fb=Lt("circle-check",gD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],xD=Lt("circle-x",mD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yD=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],hb=Lt("clock",yD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vD=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],bD=Lt("cloud-upload",vD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jD=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],gb=Lt("copy",jD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wD=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],mb=Lt("download",wD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SD=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Q4=Lt("eye",SD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kD=[["path",{d:"M13.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v11.5",key:"4pqfef"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 12v-1",key:"1ej8lb"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M8 7V6",key:"1nbb54"}],["circle",{cx:"8",cy:"20",r:"2",key:"ckkr5m"}]],ND=Lt("file-archive",kD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CD=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],yp=Lt("file-text",CD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _D=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],AD=Lt("folder-open",_D);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ED=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],PD=Lt("funnel",ED);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ID=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],vp=Lt("globe",ID);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TD=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],Kl=Lt("graduation-cap",TD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RD=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],OD=Lt("hash",RD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zD=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],$2=Lt("image-off",zD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LD=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],$D=Lt("image",LD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],MD=Lt("info",DD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BD=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],J4=Lt("key",BD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FD=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],WD=Lt("layers",FD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UD=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],D2=Lt("layout-dashboard",UD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HD=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Z4=Lt("lightbulb",HD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YD=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],KD=Lt("link",YD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VD=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],io=Lt("loader-circle",VD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qD=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],eP=Lt("log-in",qD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GD=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],sm=Lt("mail",GD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XD=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],QD=Lt("menu",XD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JD=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],xb=Lt("pen-tool",JD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZD=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],M2=Lt("pen",ZD);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],tM=Lt("phone",eM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Fs=Lt("plus",rM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],sM=Lt("rotate-ccw",nM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],B2=Lt("save",iM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M18 5v16",key:"1ethyx"}],["path",{d:"m4 6 7.106-3.79a2 2 0 0 1 1.788 0L20 6",key:"zywc2d"}],["path",{d:"m6 11-3.52 2.147a1 1 0 0 0-.48.854V19a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a1 1 0 0 0-.48-.853L18 11",key:"1d4ql0"}],["path",{d:"M6 5v16",key:"1sn0nx"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]],Tl=Lt("school",aM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],lM=Lt("scroll-text",oM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],No=Lt("search",cM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],F2=Lt("send",dM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],bd=Lt("shield",uM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pM=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],tP=Lt("sparkles",pM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Pa=Lt("trash-2",fM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Uh=Lt("trending-up",hM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],yb=Lt("triangle-alert",gM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mM=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Rl=Lt("upload",mM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],W2=Lt("user-check",xM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],rP=Lt("user-plus",yM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],nh=Lt("user-x",vM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Bu=Lt("user",bM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ts=Lt("users",jM);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ai=Lt("x",wM);function An({title:e,description:t,icon:r,to:s,color:i,iconColor:a,children:o,className:l=""}){const c=n.jsxs("div",{className:`dashboard-card ${l}`,children:[n.jsxs("div",{className:"dashboard-card-header",children:[n.jsx("div",{className:"dashboard-card-icon",style:{background:i,color:a||"var(--text)"},children:n.jsx(r,{size:24})}),n.jsx("h3",{className:"dashboard-card-title",children:e})]}),n.jsx("p",{className:"dashboard-card-description",children:t}),n.jsx("div",{className:"dashboard-card-footer",children:o||(s?n.jsx("span",{className:"dashboard-card-link",children:"Accder "}):null)})]});return s&&!o?n.jsx(rr,{to:s,className:"dashboard-card-wrapper",children:c}):n.jsx("div",{className:"dashboard-card-wrapper",children:c})}function SM(){return n.jsxs("div",{className:"admin-dashboard",children:[n.jsxs("header",{className:"dashboard-header",children:[n.jsx("h1",{className:"dashboard-title",children:"Tableau de Bord"}),n.jsx("p",{className:"dashboard-subtitle",children:"Bienvenue dans l'espace d'administration. Grez les ressources scolaires, les utilisateurs et les carnets."})]}),n.jsxs("div",{className:"dashboard-content",children:[n.jsxs("section",{className:"dashboard-section",children:[n.jsx("h2",{className:"section-title",children:"Vue d'ensemble"}),n.jsxs("div",{className:"dashboard-grid",children:[n.jsx(An,{title:"Analytics",description:"Vue d'ensemble et statistiques.",icon:Gv,to:"/admin/analytics",color:"#e0e7ff",iconColor:"#4f46e5"}),n.jsx(An,{title:"Progression",description:"Suivi global de l'avancement.",icon:Uh,to:"/admin/progress",color:"#ecfeff",iconColor:"#0891b2"}),n.jsx(An,{title:"Comptences",description:"Stats par comptence.",icon:Gv,to:"/admin/skill-analytics",color:"#fef3c7",iconColor:"#d97706"}),n.jsx(An,{title:"En Ligne",description:"Utilisateurs actifs en temps rel.",icon:X4,to:"/admin/online-users",color:"#f0fdf4",iconColor:"#15803d"}),n.jsx(An,{title:"Logs",description:"Historique des actions.",icon:lM,to:"/admin/audit-logs",color:"#f5f5f5",iconColor:"#595959"})]})]}),n.jsxs("section",{className:"dashboard-section",children:[n.jsx("h2",{className:"section-title",children:"Gestion Scolaire"}),n.jsxs("div",{className:"dashboard-grid",children:[n.jsx(An,{title:"Structure",description:"Annes, classes et lves.",icon:Tl,to:"/admin/ressource",color:"#eef2ff",iconColor:"#4338ca"}),n.jsx(An,{title:"Utilisateurs",description:"Enseignants et admins.",icon:Ts,to:"/admin/users",color:"#fff0f6",iconColor:"#db2777"}),n.jsx(An,{title:"Assignations",description:"Affectations enseignants.",icon:KD,color:"#fff7e6",iconColor:"#d46b08",children:n.jsxs("div",{className:"dashboard-toolbar",children:[n.jsx(rr,{className:"dashboard-btn dashboard-btn-primary",to:"/admin/assignments",children:"Crer"}),n.jsx(rr,{className:"dashboard-btn dashboard-btn-secondary",to:"/admin/assignment-list",children:"Voir"})]})}),n.jsx(An,{title:"Passage lves",description:"Promotions annuelles.",icon:Kl,to:"/admin/student-promotions",color:"#ffedd5",iconColor:"#c2410c"}),n.jsx(An,{title:"Onboarding PSMS",description:"Prparation anne prcdente.",icon:rP,to:"/admin/ps-onboarding",color:"#dbeafe",iconColor:"#2563eb"})]})]}),n.jsxs("section",{className:"dashboard-section",children:[n.jsx("h2",{className:"section-title",children:"Contenu & Carnets"}),n.jsxs("div",{className:"dashboard-grid",children:[n.jsx(An,{title:"Templates",description:"diteur de modles.",icon:xb,to:"/admin/template-builder",color:"#f0f9ff",iconColor:"#0284c7"}),n.jsx(An,{title:"Carnets",description:"Carnets sauvegards.",icon:AD,to:"/admin/gradebooks",color:"#f6ffed",iconColor:"#52c41a"}),n.jsx(An,{title:"Supervision",description:"Accs global aux carnets.",icon:vp,to:"/admin/global-permissions",color:"#e0f2fe",iconColor:"#0369a1"}),n.jsx(An,{title:"Mdia",description:"Bibliothque de fichiers.",icon:$D,to:"/admin/media",color:"#fdf4ff",iconColor:"#c026d3"})]})]}),n.jsxs("section",{className:"dashboard-section",children:[n.jsx("h2",{className:"section-title",children:"Administration"}),n.jsxs("div",{className:"dashboard-grid",children:[n.jsx(An,{title:"Permissions",description:"Droits des sous-admins.",icon:J4,to:"/admin/permissions",color:"#fffbeb",iconColor:"#b45309"}),n.jsx(An,{title:"Menu",description:"Visibilit navigation.",icon:Q4,to:"/admin/navigation-visibility",color:"#f3e8ff",iconColor:"#7e22ce"}),n.jsx(An,{title:"Blocs",description:"Visibilit des blocs.",icon:WD,to:"/admin/block-visibility",color:"#e0f2fe",iconColor:"#0284c7"}),n.jsx(An,{title:"Suggestions",description:"Retours enseignants.",icon:Z4,to:"/admin/suggestions",color:"#fdf2f8",iconColor:"#be185d"})]})]})]})]})}function kM(){const e=Sn(),[t,r]=p.useState("current"),[s,i]=p.useState(!0),[a,o]=p.useState([]),[l,c]=p.useState([]),[u,d]=p.useState(""),[f,h]=p.useState(null),[m,g]=p.useState(new Set),[x,y]=p.useState([]),[v,S]=p.useState("");p.useEffect(()=>{k()},[]),p.useEffect(()=>{v&&j(v)},[v]);const k=async()=>{try{const N=(await K.get("/school-years")).data||[];y(N);const $=N.find(E=>E.active);$?S($._id):N.length>0&&S(N[0]._id)}catch(w){console.error("Failed to load years:",w)}},j=async w=>{i(!0),h(null);try{const N=w?{schoolYearId:w}:{},$=await K.get("/saved-gradebooks/admin/all-students",{params:N});o($.data.current||[]),c($.data.archived||[])}catch(N){console.error("Failed to load students:",N)}finally{i(!1)}},_=t==="current"?a:l,b=p.useMemo(()=>{if(!u.trim())return _;const w=u.toLowerCase();return _.filter(N=>`${N.firstName} ${N.lastName}`.toLowerCase().includes(w)||`${N.lastName} ${N.firstName}`.toLowerCase().includes(w))},[_,u]),A=w=>{e(`/admin/gradebooks/view/${w}`)},z=w=>{const N=new Set(m);N.has(w)?N.delete(w):N.add(w),g(N)},D=w=>w?new Date(w).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return n.jsxs("div",{className:"gradebooks-container",children:[n.jsxs("div",{className:"gradebooks-header",children:[n.jsx("h2",{className:"gradebooks-title",children:" Carnets Scolaires"}),n.jsxs("div",{className:"header-controls",children:[n.jsxs("div",{className:"year-selector",children:[n.jsx("label",{children:"Anne scolaire:"}),n.jsx("select",{value:v,onChange:w=>S(w.target.value),className:"year-select",children:x.map(w=>n.jsxs("option",{value:w._id,children:[w.name," ",w.active?"(active)":""]},w._id))})]}),n.jsxs("div",{className:"mode-switcher",children:[n.jsxs("button",{className:`mode-btn ${t==="current"?"active":""}`,onClick:()=>{r("current"),h(null)},children:[" En cours (",a.length,")"]}),n.jsxs("button",{className:`mode-btn ${t==="archived"?"active":""}`,onClick:()=>{r("archived"),h(null)},children:[" Archives (",l.length,")"]})]})]})]}),n.jsxs("div",{className:"gradebooks-layout",children:[n.jsxs("div",{className:"students-panel",children:[n.jsx("div",{className:"search-box",children:n.jsx("input",{type:"text",placeholder:" Rechercher un lve...",value:u,onChange:w=>d(w.target.value),className:"search-input"})}),s?n.jsx("div",{className:"panel-loading",children:"Chargement..."}):b.length===0?n.jsx("div",{className:"panel-empty",children:u?"Aucun lve trouv":"Aucun carnet sauvegard"}):n.jsx("div",{className:"students-list",children:b.map(w=>n.jsxs("div",{className:`student-item ${(f==null?void 0:f.studentId)===w.studentId?"selected":""}`,onClick:()=>{h(w),g(new Set)},children:[n.jsx("div",{className:"student-avatar",children:w.avatarUrl?n.jsx("img",{src:w.avatarUrl,alt:""}):n.jsxs("span",{children:[w.firstName[0],w.lastName[0]]})}),n.jsxs("div",{className:"student-info",children:[n.jsxs("div",{className:"student-name",children:[w.lastName," ",w.firstName]}),n.jsxs("div",{className:"student-meta",children:[t==="archived"?n.jsxs("span",{className:"badge badge-archived",children:["Sorti ",w.exitedFromLevel?`de ${w.exitedFromLevel}`:""]}):n.jsx("span",{className:"badge badge-level",children:w.currentLevel||"N/A"}),n.jsxs("span",{className:"years-count",children:[w.years.length," anne(s)"]})]})]})]},w.studentId))})]}),n.jsx("div",{className:"detail-panel",children:f?n.jsxs("div",{className:"student-detail",children:[n.jsxs("div",{className:"detail-header",children:[n.jsx("div",{className:"detail-avatar",children:f.avatarUrl?n.jsx("img",{src:f.avatarUrl,alt:""}):n.jsxs("span",{children:[f.firstName[0],f.lastName[0]]})}),n.jsxs("div",{className:"detail-title",children:[n.jsxs("h3",{children:[f.lastName," ",f.firstName]}),t==="archived"&&f.exitedAt&&n.jsxs("p",{className:"exit-info",children:["Sorti le ",D(f.exitedAt),f.exitedFromLevel&&` (${f.exitedFromLevel}  EB1)`]})]})]}),n.jsxs("div",{className:"years-timeline",children:[n.jsx("h4",{children:" Historique des carnets"}),f.years.length===0?n.jsx("div",{className:"no-years",children:"Aucun carnet enregistr"}):n.jsx("div",{className:"years-list",children:f.years.map(w=>n.jsxs("div",{className:"year-card",children:[n.jsxs("div",{className:"year-header",onClick:()=>z(w.yearId),children:[n.jsx("span",{className:"year-name",children:w.yearName}),n.jsx("span",{className:"year-level",children:w.level}),n.jsx("span",{className:"year-toggle",children:m.has(w.yearId)?"":""})]}),m.has(w.yearId)&&n.jsxs("div",{className:"year-content",children:[n.jsxs("div",{className:"semester-grid",children:[n.jsxs("div",{className:`semester-card ${w.s1?"available":"unavailable"}`,children:[n.jsx("div",{className:"semester-label",children:"S1"}),w.s1?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"semester-date",children:D(w.s1.createdAt)}),n.jsx("button",{className:"view-btn",onClick:()=>A(w.s1._id),children:" Voir"})]}):n.jsx("div",{className:"semester-na",children:"Non disponible"})]}),n.jsxs("div",{className:`semester-card ${w.s2?"available":"unavailable"}`,children:[n.jsx("div",{className:"semester-label",children:"S2"}),w.s2?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"semester-date",children:D(w.s2.createdAt)}),n.jsx("button",{className:"view-btn",onClick:()=>A(w.s2._id),children:" Voir"})]}):n.jsx("div",{className:"semester-na",children:"Non disponible"})]})]}),w.allSnapshots.length>2&&n.jsxs("details",{className:"more-snapshots",children:[n.jsxs("summary",{children:["+ ",w.allSnapshots.length-2," autre(s) version(s)"]}),n.jsx("div",{className:"snapshots-list",children:w.allSnapshots.filter(N=>{var $,E;return N._id!==(($=w.s1)==null?void 0:$._id)&&N._id!==((E=w.s2)==null?void 0:E._id)}).map(N=>n.jsxs("div",{className:"snapshot-item",children:[n.jsxs("span",{children:[N.snapshotReason," - ",D(N.createdAt)]}),n.jsx("button",{className:"view-btn-small",onClick:()=>A(N._id),children:"Voir"})]},N._id))})]})]})]},w.yearId))})]})]}):n.jsxs("div",{className:"detail-empty",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("div",{children:"Slectionnez un lve pour voir ses carnets"})]})})]})]})}const nP=p.createContext(void 0);function NM({children:e}){const[t,r]=p.useState([]),[s,i]=p.useState(!0),a=wn();p.useEffect(()=>{if(!localStorage.getItem("token")){r([]),i(!1);return}if(t.length>0)return;(async()=>{try{const u=await K.get("/levels");r(u.data)}catch(u){console.error("Failed to load levels",u),r([{_id:"1",name:"PS",order:1},{_id:"2",name:"MS",order:2},{_id:"3",name:"GS",order:3}])}finally{i(!1)}})()},[a.pathname,t.length]);const o=t.map(l=>l.name);return n.jsx(nP.Provider,{value:{levels:t,levelNames:o,isLoading:s},children:e})}function la(){const e=p.useContext(nP);if(e===void 0)throw new Error("useLevels must be used within a LevelProvider");return e}const sP=p.createContext(void 0);function CM({children:e}){const[t,r]=p.useState([]),[s,i]=p.useState(""),[a,o]=p.useState(!0),l=wn(),c=async(f=!1)=>{try{const m=(await K.get("/school-years")).data;if(r(m),f||!s){const g=m.find(x=>x.active);g?i(g._id):m.length>0&&!s&&i(m[0]._id)}}catch(h){console.error("Failed to load school years",h)}finally{o(!1)}},u=async()=>{await c(!0)};p.useEffect(()=>{if(!localStorage.getItem("token")){r([]),i(""),o(!1);return}t.length>0||c(!1)},[l.pathname,t.length]);const d=t.find(f=>f._id===s);return n.jsx(sP.Provider,{value:{years:t,activeYearId:s,setActiveYearId:i,activeYear:d,isLoading:a,refetchYears:u},children:e})}function Yn(){const e=p.useContext(sP);if(e===void 0)throw new Error("useSchoolYear must be used within a SchoolYearProvider");return e}function jd(){const e=()=>{window.scrollTo({top:0,behavior:"smooth"})};return n.jsx("button",{onClick:e,title:"Retour en haut",style:{position:"fixed",right:"20px",top:"50%",transform:"translateY(-50%)",zIndex:1e3,width:"40px",height:"40px",borderRadius:"50%",background:"white",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.color="#3b82f6",t.currentTarget.style.borderColor="#3b82f6",t.currentTarget.style.transform="translateY(-50%) scale(1.1)"},onMouseLeave:t=>{t.currentTarget.style.color="#64748b",t.currentTarget.style.borderColor="#e2e8f0",t.currentTarget.style.transform="translateY(-50%) scale(1)"},children:n.jsx(sD,{size:24})})}function im(){const e=()=>{window.scrollBy({top:window.innerHeight*5,behavior:"smooth"})};return n.jsxs("button",{onClick:e,title:"Descendre de 5 pages",style:{position:"fixed",right:"20px",top:"calc(50% + 50px)",transform:"translateY(-50%)",zIndex:1e3,width:"40px",height:"40px",borderRadius:"50%",background:"white",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s ease",flexDirection:"column",gap:0},onMouseEnter:t=>{t.currentTarget.style.color="#3b82f6",t.currentTarget.style.borderColor="#3b82f6",t.currentTarget.style.transform="translateY(-50%) scale(1.1)"},onMouseLeave:t=>{t.currentTarget.style.color="#64748b",t.currentTarget.style.borderColor="#e2e8f0",t.currentTarget.style.transform="translateY(-50%) scale(1)"},children:[n.jsx(Z$,{size:18}),n.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",width:"18px",height:"18px",borderRadius:"50%",background:"#3b82f6",color:"white",fontSize:"11px",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"},children:"5"})]})}const _M="/assets/pocket-BcFa7A1p.png",nc=({number:e,className:t="",draggable:r=!1,onDragStart:s,onDragEnd:i,onClick:a,width:o=120,fontSize:l})=>{const c={"--pocket-width":`${o}px`,...l?{"--number-font-size":`${l}px`}:{}};return n.jsxs("div",{className:`gradebook-pocket ${t}`,style:c,draggable:r,onDragStart:s,onDragEnd:i,onClick:a,role:a?"button":void 0,tabIndex:a?0:void 0,children:[n.jsx("div",{className:"pocket-body",children:n.jsx("img",{src:_M,alt:"Pocket",className:"pocket-image"})}),n.jsx("div",{className:"pocket-number",children:e})]})},Fo=({src:e,displayWidth:t,displayHeight:r,cropData:s,borderRadius:i=8,alt:a="",style:o={}})=>{const[l,c]=p.useState(null);if(p.useEffect(()=>{if(!s||s.naturalWidth&&s.naturalHeight)return;const y=new Image;y.onload=()=>c({width:y.naturalWidth,height:y.naturalHeight}),y.src=e},[e,s]),!s)return n.jsx("img",{src:e,alt:a,style:{width:t,height:r,borderRadius:i,objectFit:"cover",...o}});const u=s.naturalWidth||(l==null?void 0:l.width)||t,d=s.naturalHeight||(l==null?void 0:l.height)||r,f=t/s.width,h=u*f,m=d*f,g=-s.x*f,x=-s.y*f;return n.jsx("div",{style:{width:t,height:r,borderRadius:i,overflow:"hidden",position:"relative",...o},children:n.jsx("img",{src:e,alt:a,style:{position:"absolute",width:h,height:m,maxWidth:"none",left:g,top:x}})})};function AM(e){if(!e)return"";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return"";const r=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getFullYear());return`${r}/${s}/${i}`}const am=AM,U2=800,H2=1120;function EM({page:e,pageIndex:t,zoomLevel:r,context:s,showPageLabel:i=!1}){const{student:a,assignment:o,signature:l,finalSignature:c,levels:u,activeYearName:d,readOnly:f,templateId:h,visibleBlockKeys:m}=s,g={TPS:0,PS:1,MS:2,GS:3,EB1:4,KG1:1,KG2:2,KG3:3};u.forEach(N=>{g[N.name.toUpperCase()]=N.order});const x=N=>{if(N.props.level)return N.props.level;const $=(N.props.label||"").toUpperCase();return/\bPS\b/.test($)?"PS":/\bMS\b/.test($)?"MS":/\bGS\b/.test($)?"GS":/\bEB1\b/.test($)?"EB1":/\bKG1\b/.test($)?"KG1":/\bKG2\b/.test($)?"KG2":/\bKG3\b/.test($)?"KG3":null},y=N=>{if(!N||!(a!=null&&a.level))return!1;const $=g[a.level.toUpperCase()]??99;return(g[N.toUpperCase()]??99)>$},v=(N,$,E)=>{if($&&$.length>0&&E)return $.includes(E);if(!N||!E)return!0;const q=g[N.toUpperCase()]??99,L=g[E.toUpperCase()]??99;return q<=L},S=(N,$,E,q)=>q?`block:${q}`:`tpl:${N||""}:p:${$}:b:${E}`,k=(N,$)=>{var L;if(!m||m.length===0)return!0;const E=typeof((L=N==null?void 0:N.props)==null?void 0:L.blockId)=="string"&&N.props.blockId.trim()?N.props.blockId.trim():null,q=S(h,t,$,E);return m.includes(q)},j=N=>{if(!N)return null;if(u&&u.length>0){const E=u.find(q=>q.name===N);if(E){const q=u.find(L=>L.order===E.order+1);if(q)return q.name}}const $=(N||"").toUpperCase();return $==="TPS"?"PS":$==="PS"?"MS":$==="MS"?"GS":$==="GS"?"EB1":$==="KG1"?"KG2":$==="KG2"?"KG3":$==="KG3"?"EB1":null},_=N=>{var q,L,O;const $=((q=N.props)==null?void 0:q.semester)??((L=N.props)==null?void 0:L.semestre)??null;if($===1||$==="1")return 1;if($===2||$==="2")return 2;const E=String(((O=N.props)==null?void 0:O.period)||"");return E==="mid-year"?1:E==="end-year"?2:null},b=(N,$)=>{if(!(o!=null&&o.data))return;if($){const O=`${N}_${$}`;if(o.data[O]!==void 0)return o.data[O]}let E=null;const q=o.data.promotions||[];if(q.length>0&&(E=[...q].sort((B,I)=>{const T=new Date(B.date||0).getTime(),W=new Date(I.date||0).getTime();return T-W})[0].from),!E||$===E||!$)return o.data[N]},A=N=>{var ae,Y,J;const{level:$,semester:E}=N,q=[],L=(ae=o==null?void 0:o.data)==null?void 0:ae.signatures;Array.isArray(L)&&q.push(...L),l&&q.push(l),c&&q.push(c);const O=Array.isArray((Y=o==null?void 0:o.data)==null?void 0:Y.promotions)?(J=o==null?void 0:o.data)==null?void 0:J.promotions:[],B=P=>String(P||"").trim().toLowerCase(),I=B($),T=P=>{const ce=String((P==null?void 0:P.signaturePeriodId)||""),pe=String((P==null?void 0:P.type)||"standard");return E===1?ce.endsWith("_sem1")||pe==="standard":E===2?ce.endsWith("_sem2")||ce.endsWith("_end_of_year")||pe==="end_of_year":!0},W=P=>{if(!I)return!0;const ce=B(P==null?void 0:P.level);if(ce)return ce===I;if(P!=null&&P.schoolYearName){const ye=O.find(je=>String((je==null?void 0:je.year)||"")===String(P.schoolYearName)),se=B((ye==null?void 0:ye.from)||(ye==null?void 0:ye.fromLevel));if(se&&se===I)return!0}if(P!=null&&P.schoolYearId){const ye=O.find(je=>String((je==null?void 0:je.schoolYearId)||"")===String(P.schoolYearId)),se=B((ye==null?void 0:ye.from)||(ye==null?void 0:ye.fromLevel));if(se&&se===I)return!0}const pe=B(a==null?void 0:a.level);return!!pe&&pe===I};return q.filter(P=>P&&(P==null?void 0:P.signedAt)).filter(T).filter(W).sort((P,ce)=>new Date(ce.signedAt).getTime()-new Date(P.signedAt).getTime())[0]||null},z=N=>{if(!N)return"";const $=N.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!$)return"";const E=parseInt($[1],10),q=$[2],L=parseInt($[3],10);return Number.isNaN(E)||Number.isNaN(L)?"":`${E+1}${q}${L+1}`},D=(N,$)=>{var T;const E=String((N==null?void 0:N.year)||"");if(E){const W=z(E);if(W)return W}const q=z(d);if(q)return q;if(!E)return"";const L=((T=o==null?void 0:o.data)==null?void 0:T.signatures)||[],O=String((N==null?void 0:N.from)||$||""),B=Array.isArray(L)?L.filter(W=>(W==null?void 0:W.type)==="end_of_year"&&(W==null?void 0:W.schoolYearName)).find(W=>O?W!=null&&W.level?String(W.level)===O:!1:!0):null;return B!=null&&B.schoolYearName?String(B.schoolYearName):z(E)||E},w=(N,$,E)=>{var T;const q=((T=o==null?void 0:o.data)==null?void 0:T.signatures)||[],L=E==="end-year",O=E==="mid-year",I=q.filter(W=>{if(L){if(W.type!=="end_of_year")return!1}else if(O&&W.type&&W.type!=="standard")return!1;return!(W.level&&$&&W.level!==$)}).sort((W,re)=>{const ae=new Date(W.signedAt||0).getTime();return new Date(re.signedAt||0).getTime()-ae})[0];if(I){let W=String(I.schoolYearName||"").trim();if(!W&&I.signedAt){const re=new Date(I.signedAt),ae=re.getFullYear(),J=re.getMonth()>=8?ae:ae-1;W=`${J}/${J+1}`}if(W)return W}return String((N==null?void 0:N.year)||"")};return n.jsx("div",{style:{width:U2*r,height:H2*r,position:"relative",transition:"width 0.2s ease-out, height 0.2s ease-out"},children:n.jsxs("div",{id:`page-${t}`,className:"card page-canvas",style:{height:H2,width:U2,background:e.bgColor||"#fff",overflow:"hidden",position:"absolute",top:0,left:0,transform:`scale(${r})`,transformOrigin:"top left",transition:"transform 0.2s ease-out",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",border:"1px solid #e2e8f0"},children:[i&&n.jsxs("div",{style:{position:"absolute",top:-30,left:0,color:"#888",fontSize:14,fontWeight:600},children:["Page ",t+1]}),n.jsx("div",{className:"page-margins"}),e.blocks.map((N,$)=>{var L;if(!N||!N.props)return null;const E=x(N),q=y(E);if(E&&E!==(a==null?void 0:a.level)){const O=g[((L=a==null?void 0:a.level)==null?void 0:L.toUpperCase())||""]??99,B=g[E.toUpperCase()]??99;console.log(`[VISIBILITY] Page ${t} Block ${$}: blockLevel=${E} studentLevel=${a==null?void 0:a.level} blockOrder=${B} studentOrder=${O} isHigher=${q} WILL_HIDE=${q}`)}return q||!k(N,$)?null:n.jsxs("div",{style:{position:"absolute",left:N.props.x||0,top:N.props.y||0,zIndex:N.props.z??$,padding:6},children:[N.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:N.props.direction||"row",alignItems:"center",justifyContent:"center",gap:N.props.spacing||12,background:N.props.backgroundColor||"transparent",borderRadius:N.props.borderRadius||12,padding:N.props.padding||8,width:N.props.width,height:N.props.height,boxSizing:"border-box"},children:(N.props.items||[]).map((O,B)=>{if(!!(O.levels&&O.levels.length>0&&(a!=null&&a.level)&&!O.levels.includes(a.level))&&!O.active)return null;const T=40,ae=`https://emojicdn.elk.sh/${(Y=>{const J=Y.emoji;if(J&&J.length>=2)return J;const P=(Y.code||"").toLowerCase();return P==="lb"||P==="ar"?"":P==="fr"?"":P==="en"||P==="uk"||P==="gb"?"":""})(O)}?style=apple`;return n.jsx("div",{title:O.label,style:{width:T,height:T,minWidth:T,borderRadius:"50%",background:O.active?"#fff":"rgba(255, 255, 255, 0.5)",border:O.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:O.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",transform:O.active?"scale(1.1)":"scale(1)",opacity:O.active?1:.6},children:n.jsx("img",{src:ae,style:{width:T*.9,height:T*.9,objectFit:"contain"},alt:""})},B)})}),N.type==="text"&&n.jsx("div",{style:{color:N.props.color,fontSize:N.props.fontSize,fontWeight:N.props.bold?700:400,textDecoration:N.props.underline?"underline":"none",width:N.props.width,height:N.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(N.props.runs)&&N.props.runs.length?N.props.runs.map((O,B)=>n.jsx("span",{style:{color:(O==null?void 0:O.color)||N.props.color,fontWeight:O!=null&&O.bold||N.props.bold?700:400,textDecoration:O!=null&&O.underline||N.props.underline?"underline":"none"},children:(O==null?void 0:O.text)||""},B)):N.props.text}),N.type==="image"&&n.jsx(Fo,{src:N.props.url,displayWidth:N.props.width||120,displayHeight:N.props.height||120,cropData:N.props.cropData,borderRadius:8}),N.type==="student_photo"&&(a!=null&&a.avatarUrl?n.jsx("img",{src:a.avatarUrl,style:{width:N.props.width||100,height:N.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:N.props.width||100,height:N.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),N.type==="rect"&&n.jsx("div",{style:{width:N.props.width,height:N.props.height,background:N.props.color,borderRadius:N.props.radius||8,border:N.props.stroke?`${N.props.strokeWidth||1}px solid ${N.props.stroke}`:"none"}}),N.type==="circle"&&n.jsx("div",{style:{width:(N.props.radius||60)*2,height:(N.props.radius||60)*2,background:N.props.color,borderRadius:"50%",border:N.props.stroke?`${N.props.strokeWidth||1}px solid ${N.props.stroke}`:"none"}}),N.type==="gradebook_pocket"&&n.jsx(nc,{number:N.props.number||"1",width:N.props.width||120,fontSize:N.props.fontSize}),N.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:N.props.spacing||12},children:(N.props.items||[]).map((O,B)=>{if(!!(O.levels&&O.levels.length>0&&(a!=null&&a.level)&&!O.levels.includes(a.level))&&!O.active)return null;const W=(N.props.radius||40)*2;return n.jsx("div",{style:{width:W,height:W,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:O.active?"0 0 0 3px #6c5ce7":"0 0 0 1px #ddd",opacity:O.active?1:.6},children:O.logo?n.jsx("img",{src:O.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:O.active?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},B)})}),N.type==="line"&&n.jsx("div",{style:{width:N.props.x2||100,height:N.props.strokeWidth||2,background:N.props.stroke||"#b2bec3"}}),N.type==="arrow"&&n.jsx("div",{style:{width:N.props.x2||100,height:N.props.strokeWidth||2,background:N.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${N.props.stroke||"#6c5ce7"}`}})}),N.type==="dynamic_text"&&n.jsx("div",{style:{color:N.props.color,fontSize:N.props.fontSize,width:N.props.width,height:N.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let O=N.props.text||"";if(a){const B=String(a.fatherName||a.parentName||"").trim(),I=B?B.charAt(0).toUpperCase():"",T=I?`${I}.`:"",W=[a.firstName,T,a.lastName].filter(Boolean).join(" "),re=a.dateOfBirth?new Date(a.dateOfBirth):new Date(NaN),ae=isNaN(re.getTime())?"":`${String(re.getUTCDate()).padStart(2,"0")}/${String(re.getUTCMonth()+1).padStart(2,"0")}/${String(re.getUTCFullYear())}`;O=O.replace(/{student.firstName}/g,a.firstName).replace(/{student.lastName}/g,a.lastName).replace(/{student.dob}/g,a.dateOfBirth?new Date(a.dateOfBirth).toLocaleDateString():"").replace(/{student.fatherInitial}/g,T).replace(/{student.fullNameFatherInitial}/g,W).replace(/{student.dob_ddmmyyyy}/g,ae)}return o!=null&&o.data&&Object.entries(o.data).forEach(([B,I])=>{O=O.replace(new RegExp(`{${B}}`,"g"),String(I))}),O})()}),N.type==="dropdown"&&(()=>{const O=N.props.dropdownNumber?`dropdown_${N.props.dropdownNumber}`:N.props.variableName,B=x(N),I=b(O||"",B);return n.jsx("div",{style:{width:N.props.width||200,minHeight:N.props.height||32,fontSize:N.props.fontSize||12,color:N.props.color||"#333",padding:"4px 8px",borderRadius:4,border:f?"none":"1px solid #ccc",background:f?"transparent":"#f9f9f9",display:"flex",alignItems:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:I||(f?"":n.jsx("span",{style:{color:"#999"},children:"Non renseign"}))})})(),N.type==="dropdown_reference"&&(()=>{var T;const O=N.props.dropdownNumber||1,B=(T=o==null?void 0:o.data)==null?void 0:T[`dropdown_${O}`],I=typeof B=="string"?B.trim():B;return I?n.jsx("div",{style:{color:N.props.color||"#333",fontSize:N.props.fontSize||12,width:N.props.width||200,minHeight:N.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:String(I)}):null})(),N.type==="promotion_info"&&(()=>{var W,re;const O=((W=o==null?void 0:o.data)==null?void 0:W.promotions)||[],B=x(N),I=N.props.targetLevel;let T=null;if(I&&(T=O.find(ae=>ae.to===I)),!T&&B&&(T=O.find(ae=>ae.from===B)),!T&&!I&&!B&&O.length===1&&(T={...O[0]}),!T&&B){const ae=((re=o==null?void 0:o.data)==null?void 0:re.signatures)||[],Y=N.props.period==="mid-year",J=N.props.period==="end-year",ce=ae.filter(pe=>{if(J){if(pe.type!=="end_of_year")return!1}else if(Y&&pe.type&&pe.type!=="standard")return!1;return!(pe.level&&pe.level!==B)}).sort((pe,ye)=>{const se=new Date(pe.signedAt||0).getTime();return new Date(ye.signedAt||0).getTime()-se})[0];if(ce){let pe=ce.schoolYearName;if(!pe&&ce.signedAt){const je=new Date(ce.signedAt),ve=je.getFullYear(),oe=je.getMonth()>=8?ve:ve-1;pe=`${oe}/${oe+1}`}if(!pe){const ve=new Date().getFullYear();pe=`${ve}/${ve+1}`}const ye=B,se=I||j(ye||"")||"";T={year:pe,from:ye,to:se||"?",class:(a==null?void 0:a.className)||""}}}if(T)!T.class&&(a!=null&&a.className)&&(T.class=a.className),T.from||(B?T.from=B:a!=null&&a.level&&(T.from=a.level));else{const ae=!!B&&!!(a!=null&&a.level)&&B===a.level;if(N.props.period==="mid-year"?!!l&&(ae||!B&&O.length===0):!!c&&(ae||!B&&O.length===0)){let pe=0;if(d){const ye=d.match(/(\d{4})/);ye&&(pe=parseInt(ye[1],10))}if(pe){const ye=B||(a==null?void 0:a.level)||"",se=I||j(ye||"")||"";T={year:`${pe}/${pe+1}`,from:ye,to:se||"?",class:(a==null?void 0:a.className)||""}}}}if(!N.props.field)return T?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",T.to]}),n.jsxs("div",{children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}),n.jsxs("div",{style:{fontSize:(N.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Next Year ",D(T,B)]})]}):null;if(N.props.field==="level")return T?n.jsx("div",{style:{fontWeight:"bold"},children:T.to}):null;if(N.props.field==="student")return n.jsxs("div",{children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]});if(N.props.field==="studentFirstName")return n.jsx("div",{children:a==null?void 0:a.firstName});if(N.props.field==="studentLastName")return n.jsx("div",{children:a==null?void 0:a.lastName});if(N.props.field==="year")return T?n.jsx("div",{children:D(T,B)}):null;if(N.props.field==="currentYear"){const ae=w(T||{year:d},B,N.props.period)||d||"";return n.jsx("div",{children:String(ae)})}if(N.props.field==="class"){const ae=(T==null?void 0:T.class)||(a==null?void 0:a.className)||"",Y=ae.split(/\s*[-\s]\s*/),J=Y.length?Y[Y.length-1]:ae;return n.jsx("div",{children:J})}return N.props.field==="currentLevel"?n.jsx("div",{children:(T==null?void 0:T.from)||B||(a==null?void 0:a.level)||""}):null})(),N.type==="teacher_text"&&(()=>{const O=N.props.textNumber?`teacher_text_${N.props.textNumber}`:N.props.variableName,B=x(N),I=b(O||"",B);return n.jsx("div",{style:{width:N.props.width||200,minHeight:N.props.height||60,fontSize:N.props.fontSize||12,color:N.props.color||"#333",padding:"4px 8px",borderRadius:4,border:f?"none":"1px solid #ccc",background:f?"transparent":"#f9f9f9",wordWrap:"break-word",whiteSpace:"pre-wrap",overflow:"hidden"},children:I||""})})(),N.type==="table"&&(()=>{const O=le=>{const oe=typeof le=="number"?le:parseFloat(String(le||"0"));return isNaN(oe)?0:oe},B=(N.props.columnWidths||[]).map(O),I=(N.props.rowHeights||[]).map(O),T=N.props.cells||[],W=O(N.props.colGap),re=O(N.props.rowGap),ae=N.props.expandedRows||!1,Y=O(N.props.expandedRowHeight||34),J=O(N.props.expandedDividerWidth||.5),P=N.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",ce=4,pe=6,ye=N.props.expandedLanguages||[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}],se=N.props.expandedToggleStyle||"v2";let je=0;for(let le=0;le<B.length;le++)je+=B[le]||0,je+=W;B.length>0&&(je-=W);let ve=0;for(let le=0;le<I.length;le++)ve+=I[le]||0,ae&&(ve+=Y+ce),ve+=re;return I.length>0&&(ve-=re),n.jsx("div",{style:{position:"relative",width:je,height:ve,display:ae?"flex":"grid",flexDirection:"column",gap:`${re}px ${W}px`,gridTemplateColumns:ae?void 0:B.map(le=>`${Math.max(1,Math.round(le))}px`).join(" "),gridTemplateRows:ae?void 0:I.map(le=>`${Math.max(1,Math.round(le))}px`).join(" "),overflow:"visible",background:re>0||W>0?"transparent":N.props.backgroundColor||"transparent",borderRadius:re>0||W>0?0:N.props.borderRadius||0},children:ae?T.map((le,oe)=>{var G;const de=N.props.borderRadius||0,Pe=oe===0,Z=oe===I.length-1,ne=re>0,ee=((G=le[0])==null?void 0:G.fill)||N.props.backgroundColor||"#f8f9fa",te=I[oe]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",marginBottom:ae&&!Z?re:0},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:B.map(H=>`${Math.max(1,Math.round(H))}px`).join(" "),columnGap:W,height:te},children:le.map((H,ie)=>{var Ze,ge,Ae,Le;const me=(Ze=H==null?void 0:H.borders)==null?void 0:Ze.l,ke=(ge=H==null?void 0:H.borders)==null?void 0:ge.r,Be=(Ae=H==null?void 0:H.borders)==null?void 0:Ae.t;(Le=H==null?void 0:H.borders)==null||Le.b;const Te=ie===0,qe=ie===B.length-1,Qe={background:(H==null?void 0:H.fill)||(ne&&N.props.backgroundColor?N.props.backgroundColor:"transparent"),borderLeft:me!=null&&me.width?`${me.width}px solid ${me.color||"#000"}`:"none",borderRight:ke!=null&&ke.width?`${ke.width}px solid ${ke.color||"#000"}`:"none",borderTop:Be!=null&&Be.width?`${Be.width}px solid ${Be.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Te&&(ne||Pe)?de:0,borderTopRightRadius:qe&&(ne||Pe)?de:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:Qe,children:(H==null?void 0:H.text)&&n.jsx("div",{style:{fontSize:H.fontSize||12,color:H.color||"#000",whiteSpace:"pre-wrap"},children:H.text})},`cell-${oe}-${ie}`)})}),n.jsxs("div",{style:{background:ee,borderBottomLeftRadius:ne||Z?de:0,borderBottomRightRadius:ne||Z?de:0,height:Y,position:"relative",paddingBottom:ce},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:J,background:P,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:pe,gap:8},children:(()=>{var Ze,ge,Ae;const H=typeof((Ze=N==null?void 0:N.props)==null?void 0:Ze.blockId)=="string"&&N.props.blockId.trim()?N.props.blockId.trim():null,ie=Array.isArray((ge=N==null?void 0:N.props)==null?void 0:ge.rowIds)?N.props.rowIds:[],me=typeof(ie==null?void 0:ie[oe])=="string"&&ie[oe].trim()?ie[oe].trim():null,ke=H&&me?`table_${H}_row_${me}`:null,Be=`table_${t}_${$}_row_${oe}`,Te=((Ae=N.props.rowLanguages)==null?void 0:Ae[oe])||ye,qe=x(N);return((ke?b(ke,qe):null)||b(Be,qe)||Te).map((Le,Q)=>{if(!v(Le.level,Le.levels,a==null?void 0:a.level)&&!Le.active)return null;const we=Math.max(12,Math.min(Y-12,20)),Ne=Le.active;if(se==="v1"){const Fe=Le.logo||(()=>{const Ve=(Le.code||"").toLowerCase();return Ve==="en"||Ve==="uk"||Ve==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":Ve==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":Ve==="ar"||Ve==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:we,height:we,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:Ne?"0 0 0 2px #6c5ce7":"none",opacity:Ne?1:.5},children:Fe?n.jsx("img",{src:Fe,style:{width:"100%",height:"100%",objectFit:"cover",filter:Ne?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},Q)}const Oe=`https://emojicdn.elk.sh/${(Fe=>{const Ve=Fe.emoji;if(Ve&&Ve.length>=2)return Ve;const tt=(Fe.code||"").toLowerCase();return tt==="lb"||tt==="ar"?"":tt==="fr"?"":tt==="en"||tt==="uk"||tt==="gb"?"":""})(Le)}?style=apple`;return n.jsx("div",{title:Le.label,style:{width:we,height:we,minWidth:we,borderRadius:"50%",background:Ne?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:Ne?"scale(1.1)":"scale(1)",boxShadow:"none",opacity:Ne?1:.5},children:n.jsx("img",{src:Oe,style:{width:we*.9,height:we*.9,objectFit:"contain"},alt:""})},Q)})})()})]})]},`row-unit-${oe}`)}):T.flatMap((le,oe)=>le.map((de,Pe)=>{var qe,Qe,Ze,ge;const Z=(qe=de==null?void 0:de.borders)==null?void 0:qe.l,ne=(Qe=de==null?void 0:de.borders)==null?void 0:Qe.r,ee=(Ze=de==null?void 0:de.borders)==null?void 0:Ze.t,te=(ge=de==null?void 0:de.borders)==null?void 0:ge.b,G=N.props.borderRadius||0,H=Pe===0,ie=Pe===B.length-1,me=oe===0,ke=oe===I.length-1,Be=re>0,Te={background:(de==null?void 0:de.fill)||(Be&&N.props.backgroundColor?N.props.backgroundColor:"transparent"),borderLeft:Z!=null&&Z.width?`${Z.width}px solid ${Z.color||"#000"}`:"none",borderRight:ne!=null&&ne.width?`${ne.width}px solid ${ne.color||"#000"}`:"none",borderTop:ee!=null&&ee.width?`${ee.width}px solid ${ee.color||"#000"}`:"none",borderBottom:te!=null&&te.width?`${te.width}px solid ${te.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:H&&(Be||me)?G:0,borderBottomLeftRadius:H&&(Be||ke)?G:0,borderTopRightRadius:ie&&(Be||me)?G:0,borderBottomRightRadius:ie&&(Be||ke)?G:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:Te,children:(de==null?void 0:de.text)&&n.jsx("div",{style:{fontSize:de.fontSize||12,color:de.color||"#000",whiteSpace:"pre-wrap"},children:de.text})},`${oe}-${Pe}`)}))})})(),N.type==="qr"&&n.jsx("div",{style:{width:N.props.width||100,height:N.props.height||100,background:"#fff",border:"1px solid #ddd",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:"QR"}),N.type==="signature"&&n.jsx("div",{style:{fontSize:N.props.fontSize},children:(N.props.labels||[]).join(" / ")}),N.type==="signature_date"&&(()=>{var ce,pe;const O=String(((ce=N.props)==null?void 0:ce.level)||x(N)||"").trim()||null,B=_(N),I=A({level:O,semester:B});if(!I)return null;const T=am(I.signedAt),W=((pe=N.props)==null?void 0:pe.showMeta)!==!1,re="Sign le:",ae=B?`S${B}`:"",Y=O||"",J=`${Y}${Y&&ae?" ":""}${ae}`,P=W?`${re}${J?` ${J}`:""} ${T}`:`${re} ${T}`;return n.jsx("div",{style:{width:N.props.width||220,height:N.props.height||34,display:"flex",alignItems:"center",justifyContent:N.props.align||"flex-start",fontSize:N.props.fontSize||12,color:N.props.color||"#111",overflow:"hidden",whiteSpace:"nowrap"},children:P})})(),N.type==="final_signature_box"&&n.jsx("div",{style:{width:N.props.width||200,height:N.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(()=>{var T,W;if(c)return" Sign Fin Anne";const O=((T=o==null?void 0:o.data)==null?void 0:T.signatures)||[],B=((W=o==null?void 0:o.data)==null?void 0:W.promotions)||[],I=x(N);if(I){const re=O.find(ae=>{if(ae.type!=="end_of_year")return!1;if(ae.schoolYearName){const Y=B.find(J=>J.year===ae.schoolYearName);if(Y&&Y.from===I)return!0}return!1});if(re)return` Sign (${re.schoolYearName||"Ancien"})`}return null})()}),N.type==="final_signature_info"&&n.jsx("div",{style:{width:N.props.width||150,height:N.props.height||30,fontSize:N.props.fontSize||12,color:N.props.color||"#333",display:"flex",alignItems:"center",justifyContent:N.props.align||"flex-start"},children:(()=>{var Y,J;const B=(((Y=o==null?void 0:o.data)==null?void 0:Y.signatures)||[]).filter(P=>(P==null?void 0:P.type)==="end_of_year").sort((P,ce)=>{const pe=new Date(P.signedAt||0).getTime();return new Date(ce.signedAt||0).getTime()-pe})[0];if(!(!!B||!!c))return n.jsx("span",{style:{color:"#ccc"},children:N.props.placeholder||"..."});const T=B&&(B.schoolYearName||"")||new Date().getFullYear(),W=((J=o==null?void 0:o.data)==null?void 0:J.promotions)||[],re=B?W.find(P=>String(P.year)===String(B.schoolYearName)):null,ae=re?re.to:j((a==null?void 0:a.level)||"");return N.props.field==="year"?n.jsx("span",{children:String(T)}):N.props.field==="student"?n.jsxs("span",{children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}):N.props.field==="studentFirstName"?n.jsx("span",{children:a==null?void 0:a.firstName}):N.props.field==="studentLastName"?n.jsx("span",{children:a==null?void 0:a.lastName}):N.props.field==="nextLevel"?n.jsx("span",{children:ae||""}):null})()}),N.type==="signature_box"&&n.jsx("div",{style:{width:N.props.width||200,height:N.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(()=>{var re,ae;const O=x(N),B=l==null?void 0:l.level,I=c==null?void 0:c.level;if(O){if(N.props.period==="end-year"){if(c&&(I&&I===O||!I&&(a==null?void 0:a.level)===O)){const Y=c.signatureData||c.signatureUrl;return Y?n.jsx("img",{src:Y,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(l&&(B&&B===O||!B&&(a==null?void 0:a.level)===O)){const Y=l.signatureData||l.signatureUrl;return Y?n.jsx("img",{src:Y,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}}else if(N.props.period==="end-year"){if(c){const Y=c.signatureData||c.signatureUrl;return Y?n.jsx("img",{src:Y,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(l){const Y=l.signatureData||l.signatureUrl;return Y?n.jsx("img",{src:Y,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}const T=((re=o==null?void 0:o.data)==null?void 0:re.signatures)||[],W=((ae=o==null?void 0:o.data)==null?void 0:ae.promotions)||[];if(O){const Y=T.find(J=>{if(N.props.period==="end-year"&&J.type!=="end_of_year"||(!N.props.period||N.props.period==="mid-year")&&J.type==="end_of_year")return!1;if(J.level&&J.level===O)return!0;if(J.schoolYearName){const P=W.find(ce=>ce.year===J.schoolYearName);if(P&&P.from===O)return!0}return!1});if(Y){const J=Y.signatureData||Y.signatureUrl;return J?n.jsx("img",{src:J,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${Y.schoolYearName||"Ancien"})`}}return null})()})]},$)})]})})}function wd(e,t="Carnet",r="single",s=1){const i=new URL("/export-progress",window.location.origin);i.searchParams.set("url",e),i.searchParams.set("name",t),i.searchParams.set("type",r),s>1&&i.searchParams.set("count",s.toString()),window.open(i.toString(),"_blank")}function vb(e,t,r){return`${e.replace(/\/$/,"")}/pdf-v2/student/${t}?templateId=${r}`}function PM(e,t,r){const s=e.replace(/\/$/,""),i=window.location.origin;return`${s}/pdf-v2/preview/${t}/${r}?frontendOrigin=${encodeURIComponent(i)}`}function iP(e,t){return`${e.replace(/\/$/,"")}/pdf-v2/saved/${t}`}function IM(e,t,r,s){const i=`batch-${Date.now()}-${Math.random().toString(36).substring(7)}`,a={type:"batch",url:`${e.replace(/\/$/,"")}/pdf-v2/assignments/zip`,assignmentIds:t,groupLabel:r,displayName:s,count:t.length};sessionStorage.setItem(`pdf-export-${i}`,JSON.stringify(a));const o=new URL("/export-progress",window.location.origin);o.searchParams.set("exportId",i),o.searchParams.set("type","batch"),o.searchParams.set("name",s),o.searchParams.set("count",t.length.toString()),window.open(o.toString(),"_blank")}const TM=800;function RM(){var B;const{gradebookId:e}=oa(),t=Sn(),[r,s]=p.useState(null),[i,a]=p.useState(null),[o,l]=p.useState(null),[c,u]=p.useState(null),[d,f]=p.useState(null),[h,m]=p.useState(0),[g,x]=p.useState(!0),[y,v]=p.useState(!0),[S,k]=p.useState(""),[j,_]=p.useState(1),[b,A]=p.useState(!1),z=p.useRef(null),[D,w]=p.useState(null),{levels:N}=la(),{activeYear:$}=Yn(),E=()=>{const I=z.current?z.current.clientWidth:window.innerWidth;return Math.max(0,Math.min(window.innerWidth,I)-48)/TM};p.useEffect(()=>{e&&q()},[e]);const q=async()=>{var I,T,W,re,ae;v(!0),k("");try{const J=(await K.get(`/saved-gradebooks/${e}`)).data;w(J);const P=J.data||{},ce=((I=P.student)==null?void 0:I.level)||J.level;console.log("[AdminSavedGradebookView] Loaded data:",{studentLevel:ce,visibleBlockKeysCount:((T=P.visibleBlockKeys)==null?void 0:T.length)||0});const pe=P.student?{...P.student,level:ce}:null;a(pe),l(P.assignment||null);const ye=P.signatures||[];if(u(ye.find(se=>se.type==="standard")||P.signature||null),f(ye.find(se=>se.type==="end_of_year")||P.finalSignature||null),(W=J.data)!=null&&W.template)s(J.data.template);else if(J.templateId){let je=(await K.get(`/templates/${J.templateId}`)).data;const ve=((re=P.assignment)==null?void 0:re.templateVersion)??((ae=J.meta)==null?void 0:ae.templateVersion);if(ve&&je.versionHistory){const le=je.versionHistory.find(oe=>oe.version===ve);le&&(je={...je,pages:le.pages,variables:le.variables||{},watermark:le.watermark})}s(je)}}catch(Y){console.error("Failed to load saved gradebook:",Y),k(Y.message||"Erreur de chargement")}finally{v(!1)}},L=()=>{if(!D)return;const I=(K.defaults.baseURL||"").replace(/\/$/,""),T=iP(I,D._id),W=i?`${i.firstName} ${i.lastName}`:"lve";wd(T,W,"single",1)};if(y)return n.jsx("div",{style:{padding:24,textAlign:"center"},children:n.jsx("div",{style:{fontSize:18,color:"#64748b"},children:"Chargement du carnet..."})});if(S)return n.jsxs("div",{style:{padding:24,textAlign:"center"},children:[n.jsxs("div",{style:{fontSize:18,color:"#dc2626",marginBottom:16},children:[" ",S]}),n.jsx("button",{onClick:()=>t(-1),style:{padding:"10px 20px",borderRadius:8,border:"none",background:"#6366f1",color:"white",cursor:"pointer"},children:" Retour"})]});if(!r||!i)return n.jsxs("div",{style:{padding:24,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:18,color:"#64748b"},children:"Carnet introuvable"}),n.jsx("button",{onClick:()=>t(-1),style:{marginTop:16,padding:"10px 20px",borderRadius:8,border:"none",background:"#6366f1",color:"white",cursor:"pointer"},children:" Retour"})]});const O={student:i,assignment:o,signature:c,finalSignature:d,levels:N,activeYearName:$==null?void 0:$.name,readOnly:!0,templateId:r._id,visibleBlockKeys:((B=D==null?void 0:D.data)==null?void 0:B.visibleBlockKeys)||[]};return n.jsxs("div",{style:{padding:24},children:[n.jsx(jd,{}),n.jsx(im,{}),n.jsxs("div",{className:"card",children:[n.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:n.jsxs("div",{children:[n.jsxs("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:[" Carnet de ",i.firstName," ",i.lastName]}),n.jsx("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:n.jsx("button",{className:"btn secondary",onClick:()=>t("/admin/gradebooks"),style:{display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0",padding:"8px 12px"},children:" Retour aux carnets"})})]})}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:16,background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",borderRadius:12,marginBottom:20,border:"1px solid #e2e8f0"},children:[i.avatarUrl?n.jsx("img",{src:i.avatarUrl,style:{width:64,height:64,borderRadius:"50%",objectFit:"cover",border:"3px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},alt:""}):n.jsxs("div",{style:{width:64,height:64,borderRadius:"50%",background:"linear-gradient(135deg, #6366f1, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:24,fontWeight:600},children:[i.firstName[0],i.lastName[0]]}),n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:20,fontWeight:600,color:"#1e293b"},children:[i.firstName," ",i.lastName]}),n.jsxs("div",{style:{fontSize:14,color:"#64748b",marginTop:4},children:[i.level&&n.jsx("span",{style:{background:"#e0e7ff",color:"#4338ca",padding:"2px 8px",borderRadius:6,marginRight:8,fontWeight:500},children:i.level}),i.className&&n.jsx("span",{children:i.className})]})]}),n.jsx("div",{style:{marginLeft:"auto"},children:n.jsx("button",{onClick:L,style:{padding:"10px 20px",borderRadius:10,border:"none",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",color:"white",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 12px rgba(99, 102, 241, 0.3)"},children:" Imprimer / PDF"})})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"#f8fafc",borderRadius:12,marginBottom:20,border:"1px solid #e2e8f0",flexWrap:"wrap",gap:12},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{fontSize:14,color:"#64748b",fontWeight:500},children:"Dfilement:"}),n.jsx("button",{onClick:()=>x(!g),style:{padding:"6px 12px",borderRadius:8,border:"1px solid #e2e8f0",background:g?"#e0e7ff":"white",color:g?"#4338ca":"#475569",fontWeight:500,cursor:"pointer"},children:g?" Continu":" Par page"})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("button",{className:"btn secondary",onClick:()=>{A(!1),_(I=>Math.max(.5,I-.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom Out",children:""}),n.jsxs("span",{style:{minWidth:50,textAlign:"center",fontSize:14,fontWeight:500,color:"#475569"},children:[Math.round(j*100),"%"]}),n.jsx("button",{className:"btn secondary",onClick:()=>{A(!1),_(I=>Math.min(2,I+.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom In",children:"+"})]}),n.jsx("button",{className:"btn secondary",onClick:()=>{b?(A(!1),_(1)):(_(E()),A(!0))},style:{background:b?"#e0e7ff":"white",color:b?"#4338ca":"#475569",border:"1px solid #e2e8f0",padding:"8px 12px",fontWeight:500},children:b?" Ajust":" Ajuster"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>m(Math.max(0,h-1)),disabled:h===0||g,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:h===0||g?.5:1},children:" Prcdent"}),n.jsx("select",{value:h,onChange:I=>{const T=Number(I.target.value);m(T),g&&setTimeout(()=>{const W=document.getElementById(`page-${T}`);W&&W.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white"},children:r.pages.map((I,T)=>n.jsx("option",{value:T,children:I.title||`Page ${T+1}`},T))}),n.jsx("button",{className:"btn secondary",onClick:()=>m(Math.min(r.pages.length-1,h+1)),disabled:h===r.pages.length-1||g,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:h===r.pages.length-1||g?.5:1},children:"Suivant "})]})]}),n.jsx("div",{ref:z,style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center",overflowX:"hidden",width:"100%"},children:(g?r.pages:[r.pages[h]]).map((I,T)=>{const W=g?T:h;return n.jsx(EM,{page:I,pageIndex:W,zoomLevel:j,context:O,showPageLabel:g},W)})})]})]})}function aP(e){var t,r,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(r=aP(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}function vr(){for(var e,t,r=0,s="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=aP(e))&&(s&&(s+=" "),s+=t);return s}var OM=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function bb(e){if(typeof e!="string")return!1;var t=OM;return t.includes(e)}var zM=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],LM=new Set(zM);function oP(e){return typeof e!="string"?!1:LM.has(e)}function lP(e){return typeof e=="string"&&e.startsWith("data-")}function qs(e){if(typeof e!="object"||e===null)return{};var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(oP(r)||lP(r))&&(t[r]=e[r]);return t}function Vl(e){if(e==null)return null;if(p.isValidElement(e)&&typeof e.props=="object"&&e.props!==null){var t=e.props;return qs(t)}return typeof e=="object"&&!Array.isArray(e)?qs(e):null}function hs(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(oP(r)||lP(r)||bb(r))&&(t[r]=e[r]);return t}function $M(e){return e==null?null:p.isValidElement(e)?hs(e.props):typeof e=="object"&&!Array.isArray(e)?hs(e):null}var DM=["children","width","height","viewBox","className","style","title","desc"];function Qv(){return Qv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Qv.apply(null,arguments)}function MM(e,t){if(e==null)return{};var r,s,i=BM(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function BM(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var jb=p.forwardRef((e,t)=>{var{children:r,width:s,height:i,viewBox:a,className:o,style:l,title:c,desc:u}=e,d=MM(e,DM),f=a||{width:s,height:i,x:0,y:0},h=vr("recharts-surface",o);return p.createElement("svg",Qv({},hs(d),{className:h,width:s,height:i,style:l,viewBox:"".concat(f.x," ").concat(f.y," ").concat(f.width," ").concat(f.height),ref:t}),p.createElement("title",null,c),p.createElement("desc",null,u),r)}),FM=["children","className"];function Jv(){return Jv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Jv.apply(null,arguments)}function WM(e,t){if(e==null)return{};var r,s,i=UM(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function UM(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var Ln=p.forwardRef((e,t)=>{var{children:r,className:s}=e,i=WM(e,FM),a=vr("recharts-layer",s);return p.createElement("g",Jv({className:a},hs(i),{ref:t}),r)}),cP=p.createContext(null),HM=()=>p.useContext(cP);function Ir(e){return function(){return e}}const dP=Math.cos,Hh=Math.sin,Bi=Math.sqrt,Yh=Math.PI,om=2*Yh,Zv=Math.PI,e0=2*Zv,cl=1e-6,YM=e0-cl;function uP(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function KM(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return uP;const r=10**t;return function(s){this._+=s[0];for(let i=1,a=s.length;i<a;++i)this._+=Math.round(arguments[i]*r)/r+s[i]}}class VM{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?uP:KM(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,s,i){this._append`Q${+t},${+r},${this._x1=+s},${this._y1=+i}`}bezierCurveTo(t,r,s,i,a,o){this._append`C${+t},${+r},${+s},${+i},${this._x1=+a},${this._y1=+o}`}arcTo(t,r,s,i,a){if(t=+t,r=+r,s=+s,i=+i,a=+a,a<0)throw new Error(`negative radius: ${a}`);let o=this._x1,l=this._y1,c=s-t,u=i-r,d=o-t,f=l-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>cl)if(!(Math.abs(f*c-u*d)>cl)||!a)this._append`L${this._x1=t},${this._y1=r}`;else{let m=s-o,g=i-l,x=c*c+u*u,y=m*m+g*g,v=Math.sqrt(x),S=Math.sqrt(h),k=a*Math.tan((Zv-Math.acos((x+h-y)/(2*v*S)))/2),j=k/S,_=k/v;Math.abs(j-1)>cl&&this._append`L${t+j*d},${r+j*f}`,this._append`A${a},${a},0,0,${+(f*m>d*g)},${this._x1=t+_*c},${this._y1=r+_*u}`}}arc(t,r,s,i,a,o){if(t=+t,r=+r,s=+s,o=!!o,s<0)throw new Error(`negative radius: ${s}`);let l=s*Math.cos(i),c=s*Math.sin(i),u=t+l,d=r+c,f=1^o,h=o?i-a:a-i;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>cl||Math.abs(this._y1-d)>cl)&&this._append`L${u},${d}`,s&&(h<0&&(h=h%e0+e0),h>YM?this._append`A${s},${s},0,1,${f},${t-l},${r-c}A${s},${s},0,1,${f},${this._x1=u},${this._y1=d}`:h>cl&&this._append`A${s},${s},0,${+(h>=Zv)},${f},${this._x1=t+s*Math.cos(a)},${this._y1=r+s*Math.sin(a)}`)}rect(t,r,s,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${s=+s}v${+i}h${-s}Z`}toString(){return this._}}function wb(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const s=Math.floor(r);if(!(s>=0))throw new RangeError(`invalid digits: ${r}`);t=s}return e},()=>new VM(t)}function Sb(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function pP(e){this._context=e}pP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function lm(e){return new pP(e)}function fP(e){return e[0]}function hP(e){return e[1]}function gP(e,t){var r=Ir(!0),s=null,i=lm,a=null,o=wb(l);e=typeof e=="function"?e:e===void 0?fP:Ir(e),t=typeof t=="function"?t:t===void 0?hP:Ir(t);function l(c){var u,d=(c=Sb(c)).length,f,h=!1,m;for(s==null&&(a=i(m=o())),u=0;u<=d;++u)!(u<d&&r(f=c[u],u,c))===h&&((h=!h)?a.lineStart():a.lineEnd()),h&&a.point(+e(f,u,c),+t(f,u,c));if(m)return a=null,m+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:Ir(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:Ir(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Ir(!!c),l):r},l.curve=function(c){return arguments.length?(i=c,s!=null&&(a=i(s)),l):i},l.context=function(c){return arguments.length?(c==null?s=a=null:a=i(s=c),l):s},l}function vf(e,t,r){var s=null,i=Ir(!0),a=null,o=lm,l=null,c=wb(u);e=typeof e=="function"?e:e===void 0?fP:Ir(+e),t=typeof t=="function"?t:Ir(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?hP:Ir(+r);function u(f){var h,m,g,x=(f=Sb(f)).length,y,v=!1,S,k=new Array(x),j=new Array(x);for(a==null&&(l=o(S=c())),h=0;h<=x;++h){if(!(h<x&&i(y=f[h],h,f))===v)if(v=!v)m=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),g=h-1;g>=m;--g)l.point(k[g],j[g]);l.lineEnd(),l.areaEnd()}v&&(k[h]=+e(y,h,f),j[h]=+t(y,h,f),l.point(s?+s(y,h,f):k[h],r?+r(y,h,f):j[h]))}if(S)return l=null,S+""||null}function d(){return gP().defined(i).curve(o).context(a)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:Ir(+f),s=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Ir(+f),u):e},u.x1=function(f){return arguments.length?(s=f==null?null:typeof f=="function"?f:Ir(+f),u):s},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:Ir(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Ir(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Ir(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(s).y(t)},u.defined=function(f){return arguments.length?(i=typeof f=="function"?f:Ir(!!f),u):i},u.curve=function(f){return arguments.length?(o=f,a!=null&&(l=o(a)),u):o},u.context=function(f){return arguments.length?(f==null?a=l=null:l=o(a=f),u):a},u}class mP{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function qM(e){return new mP(e,!0)}function GM(e){return new mP(e,!1)}const kb={draw(e,t){const r=Bi(t/Yh);e.moveTo(r,0),e.arc(0,0,r,0,om)}},XM={draw(e,t){const r=Bi(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},xP=Bi(1/3),QM=xP*2,JM={draw(e,t){const r=Bi(t/QM),s=r*xP;e.moveTo(0,-r),e.lineTo(s,0),e.lineTo(0,r),e.lineTo(-s,0),e.closePath()}},ZM={draw(e,t){const r=Bi(t),s=-r/2;e.rect(s,s,r,r)}},eB=.8908130915292852,yP=Hh(Yh/10)/Hh(7*Yh/10),tB=Hh(om/10)*yP,rB=-dP(om/10)*yP,nB={draw(e,t){const r=Bi(t*eB),s=tB*r,i=rB*r;e.moveTo(0,-r),e.lineTo(s,i);for(let a=1;a<5;++a){const o=om*a/5,l=dP(o),c=Hh(o);e.lineTo(c*r,-l*r),e.lineTo(l*s-c*i,c*s+l*i)}e.closePath()}},Qx=Bi(3),sB={draw(e,t){const r=-Bi(t/(Qx*3));e.moveTo(0,r*2),e.lineTo(-Qx*r,-r),e.lineTo(Qx*r,-r),e.closePath()}},Js=-.5,Zs=Bi(3)/2,t0=1/Bi(12),iB=(t0/2+1)*3,aB={draw(e,t){const r=Bi(t/iB),s=r/2,i=r*t0,a=s,o=r*t0+r,l=-a,c=o;e.moveTo(s,i),e.lineTo(a,o),e.lineTo(l,c),e.lineTo(Js*s-Zs*i,Zs*s+Js*i),e.lineTo(Js*a-Zs*o,Zs*a+Js*o),e.lineTo(Js*l-Zs*c,Zs*l+Js*c),e.lineTo(Js*s+Zs*i,Js*i-Zs*s),e.lineTo(Js*a+Zs*o,Js*o-Zs*a),e.lineTo(Js*l+Zs*c,Js*c-Zs*l),e.closePath()}};function oB(e,t){let r=null,s=wb(i);e=typeof e=="function"?e:Ir(e||kb),t=typeof t=="function"?t:Ir(t===void 0?64:+t);function i(){let a;if(r||(r=a=s()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),a)return r=null,a+""||null}return i.type=function(a){return arguments.length?(e=typeof a=="function"?a:Ir(a),i):e},i.size=function(a){return arguments.length?(t=typeof a=="function"?a:Ir(+a),i):t},i.context=function(a){return arguments.length?(r=a??null,i):r},i}function Kh(){}function Vh(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function vP(e){this._context=e}vP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Vh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Vh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function lB(e){return new vP(e)}function bP(e){this._context=e}bP.prototype={areaStart:Kh,areaEnd:Kh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Vh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function cB(e){return new bP(e)}function jP(e){this._context=e}jP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,s):this._context.moveTo(r,s);break;case 3:this._point=4;default:Vh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function dB(e){return new jP(e)}function wP(e){this._context=e}wP.prototype={areaStart:Kh,areaEnd:Kh,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function uB(e){return new wP(e)}function Y2(e){return e<0?-1:1}function K2(e,t,r){var s=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(s||i<0&&-0),o=(r-e._y1)/(i||s<0&&-0),l=(a*i+o*s)/(s+i);return(Y2(a)+Y2(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(l))||0}function V2(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function Jx(e,t,r){var s=e._x0,i=e._y0,a=e._x1,o=e._y1,l=(a-s)/3;e._context.bezierCurveTo(s+l,i+l*t,a-l,o-l*r,a,o)}function qh(e){this._context=e}qh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Jx(this,this._t0,V2(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Jx(this,V2(this,r=K2(this,e,t)),r);break;default:Jx(this,this._t0,r=K2(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function SP(e){this._context=new kP(e)}(SP.prototype=Object.create(qh.prototype)).point=function(e,t){qh.prototype.point.call(this,t,e)};function kP(e){this._context=e}kP.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,s,i,a){this._context.bezierCurveTo(t,e,s,r,a,i)}};function pB(e){return new qh(e)}function fB(e){return new SP(e)}function NP(e){this._context=e}NP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var s=q2(e),i=q2(t),a=0,o=1;o<r;++a,++o)this._context.bezierCurveTo(s[0][a],i[0][a],s[1][a],i[1][a],e[o],t[o]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function q2(e){var t,r=e.length-1,s,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)s=i[t]/a[t-1],a[t]-=s,o[t]-=s*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function hB(e){return new NP(e)}function cm(e,t){this._context=e,this._t=t}cm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function gB(e){return new cm(e,.5)}function mB(e){return new cm(e,0)}function xB(e){return new cm(e,1)}function td(e,t){if((o=e.length)>1)for(var r=1,s,i,a=e[t[0]],o,l=a.length;r<o;++r)for(i=a,a=e[t[r]],s=0;s<l;++s)a[s][1]+=a[s][0]=isNaN(i[s][1])?i[s][0]:i[s][1]}function r0(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function yB(e,t){return e[t]}function vB(e){const t=[];return t.key=e,t}function bB(){var e=Ir([]),t=r0,r=td,s=yB;function i(a){var o=Array.from(e.apply(this,arguments),vB),l,c=o.length,u=-1,d;for(const f of a)for(l=0,++u;l<c;++l)(o[l][u]=[0,+s(f,o[l].key,u,a)]).data=f;for(l=0,d=Sb(t(o));l<c;++l)o[d[l]].index=l;return r(o,d),o}return i.keys=function(a){return arguments.length?(e=typeof a=="function"?a:Ir(Array.from(a)),i):e},i.value=function(a){return arguments.length?(s=typeof a=="function"?a:Ir(+a),i):s},i.order=function(a){return arguments.length?(t=a==null?r0:typeof a=="function"?a:Ir(Array.from(a)),i):t},i.offset=function(a){return arguments.length?(r=a??td,i):r},i}function jB(e,t){if((s=e.length)>0){for(var r,s,i=0,a=e[0].length,o;i<a;++i){for(o=r=0;r<s;++r)o+=e[r][i][1]||0;if(o)for(r=0;r<s;++r)e[r][i][1]/=o}td(e,t)}}function wB(e,t){if((i=e.length)>0){for(var r=0,s=e[t[0]],i,a=s.length;r<a;++r){for(var o=0,l=0;o<i;++o)l+=e[o][r][1]||0;s[r][1]+=s[r][0]=-l/2}td(e,t)}}function SB(e,t){if(!(!((o=e.length)>0)||!((a=(i=e[t[0]]).length)>0))){for(var r=0,s=1,i,a,o;s<a;++s){for(var l=0,c=0,u=0;l<o;++l){for(var d=e[t[l]],f=d[s][1]||0,h=d[s-1][1]||0,m=(f-h)/2,g=0;g<l;++g){var x=e[t[g]],y=x[s][1]||0,v=x[s-1][1]||0;m+=y-v}c+=f,u+=m*f}i[s-1][1]+=i[s-1][0]=r,c&&(r-=u/c)}i[s-1][1]+=i[s-1][0]=r,td(e,t)}}var dm={},CP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r==="__proto__"}e.isUnsafeProperty=t})(CP);var Nb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){switch(typeof r){case"number":case"symbol":return!1;case"string":return r.includes(".")||r.includes("[")||r.includes("]")}}e.isDeepKey=t})(Nb);var um={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){var s;return typeof r=="string"||typeof r=="symbol"?r:Object.is((s=r==null?void 0:r.valueOf)==null?void 0:s.call(r),-0)?"-0":String(r)}e.toKey=t})(um);var pm={},_P={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){if(r==null)return"";if(typeof r=="string")return r;if(Array.isArray(r))return r.map(t).join(",");const s=String(r);return s==="0"&&Object.is(Number(r),-0)?"-0":s}e.toString=t})(_P);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=_P,r=um;function s(i){if(Array.isArray(i))return i.map(r.toKey);if(typeof i=="symbol")return[i];i=t.toString(i);const a=[],o=i.length;if(o===0)return a;let l=0,c="",u="",d=!1;for(i.charCodeAt(0)===46&&(a.push(""),l++);l<o;){const f=i[l];u?f==="\\"&&l+1<o?(l++,c+=i[l]):f===u?u="":c+=f:d?f==='"'||f==="'"?u=f:f==="]"?(d=!1,a.push(c),c=""):c+=f:f==="["?(d=!0,c&&(a.push(c),c="")):f==="."?c&&(a.push(c),c=""):c+=f,l++}return c&&a.push(c),a}e.toPath=s})(pm);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=CP,r=Nb,s=um,i=pm;function a(l,c,u){if(l==null)return u;switch(typeof c){case"string":{if(t.isUnsafeProperty(c))return u;const d=l[c];return d===void 0?r.isDeepKey(c)?a(l,i.toPath(c),u):u:d}case"number":case"symbol":{typeof c=="number"&&(c=s.toKey(c));const d=l[c];return d===void 0?u:d}default:{if(Array.isArray(c))return o(l,c,u);if(Object.is(c==null?void 0:c.valueOf(),-0)?c="-0":c=String(c),t.isUnsafeProperty(c))return u;const d=l[c];return d===void 0?u:d}}}function o(l,c,u){if(c.length===0)return u;let d=l;for(let f=0;f<c.length;f++){if(d==null||t.isUnsafeProperty(c[f]))return u;d=d[c[f]]}return d===void 0?u:d}e.get=a})(dm);var kB=dm.get;const ql=Ya(kB);var On=e=>e===0?0:e>0?1:-1,$i=e=>typeof e=="number"&&e!=+e,Da=e=>typeof e=="string"&&e.indexOf("%")===e.length-1,zt=e=>(typeof e=="number"||e instanceof Number)&&!$i(e),na=e=>zt(e)||typeof e=="string",NB=0,Fu=e=>{var t=++NB;return"".concat(e||"").concat(t)},rs=function(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!zt(t)&&typeof t!="string")return s;var a;if(Da(t)){if(r==null)return s;var o=t.indexOf("%");a=r*parseFloat(t.slice(0,o))/100}else a=+t;return $i(a)&&(a=s),i&&r!=null&&a>r&&(a=r),a},AP=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,r={},s=0;s<t;s++)if(!r[e[s]])r[e[s]]=!0;else return!0;return!1};function Br(e,t,r){return zt(e)&&zt(t)?e+r*(t-e):t}function EP(e,t,r){if(!(!e||!e.length))return e.find(s=>s&&(typeof t=="function"?t(s):ql(s,t))===r)}var Ur=e=>e===null||typeof e>"u",bp=e=>Ur(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function CB(e){return e!=null}function jp(){}var _B=["type","size","sizeType"];function n0(){return n0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},n0.apply(null,arguments)}function G2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function X2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G2(Object(r),!0).forEach(function(s){AB(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G2(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function AB(e,t,r){return(t=EB(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EB(e){var t=PB(e,"string");return typeof t=="symbol"?t:t+""}function PB(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IB(e,t){if(e==null)return{};var r,s,i=TB(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function TB(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var PP={symbolCircle:kb,symbolCross:XM,symbolDiamond:JM,symbolSquare:ZM,symbolStar:nB,symbolTriangle:sB,symbolWye:aB},RB=Math.PI/180,OB=e=>{var t="symbol".concat(bp(e));return PP[t]||kb},zB=(e,t,r)=>{if(t==="area")return e;switch(r){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var s=18*RB;return 1.25*e*e*(Math.tan(s)-Math.tan(s*2)*Math.tan(s)**2)}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},LB=(e,t)=>{PP["symbol".concat(bp(e))]=t},Cb=e=>{var{type:t="circle",size:r=64,sizeType:s="area"}=e,i=IB(e,_B),a=X2(X2({},i),{},{type:t,size:r,sizeType:s}),o="circle";typeof t=="string"&&(o=t);var l=()=>{var h=OB(o),m=oB().type(h).size(zB(r,s,o)),g=m();if(g!==null)return g},{className:c,cx:u,cy:d}=a,f=hs(a);return zt(u)&&zt(d)&&zt(r)?p.createElement("path",n0({},f,{className:vr("recharts-symbols",c),transform:"translate(".concat(u,", ").concat(d,")"),d:l()})):null};Cb.registerSymbol=LB;var IP=e=>"radius"in e&&"startAngle"in e&&"endAngle"in e,_b=(e,t)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var r=e;if(p.isValidElement(e)&&(r=e.props),typeof r!="object"&&typeof r!="function")return null;var s={};return Object.keys(r).forEach(i=>{bb(i)&&(s[i]=a=>r[i](r,a))}),s},$B=(e,t,r)=>s=>(e(t,r,s),null),wp=(e,t,r)=>{if(e===null||typeof e!="object"&&typeof e!="function")return null;var s=null;return Object.keys(e).forEach(i=>{var a=e[i];bb(i)&&typeof a=="function"&&(s||(s={}),s[i]=$B(a,t,r))}),s};function Q2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function DB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q2(Object(r),!0).forEach(function(s){MB(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q2(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function MB(e,t,r){return(t=BB(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BB(e){var t=FB(e,"string");return typeof t=="symbol"?t:t+""}function FB(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hn(e,t){var r=DB({},e),s=t,i=Object.keys(t),a=i.reduce((o,l)=>(o[l]===void 0&&s[l]!==void 0&&(o[l]=s[l]),o),r);return a}function Gh(){return Gh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Gh.apply(null,arguments)}function J2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function WB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J2(Object(r),!0).forEach(function(s){UB(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J2(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function UB(e,t,r){return(t=HB(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HB(e){var t=YB(e,"string");return typeof t=="symbol"?t:t+""}function YB(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ti=32,KB={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function VB(e){var{data:t,iconType:r,inactiveColor:s}=e,i=ti/2,a=ti/6,o=ti/3,l=t.inactive?s:t.color,c=r??t.type;if(c==="none")return null;if(c==="plainline"){var u;return p.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:(u=t.payload)===null||u===void 0?void 0:u.strokeDasharray,x1:0,y1:i,x2:ti,y2:i,className:"recharts-legend-icon"})}if(c==="line")return p.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(i,"h").concat(o,`
            A`).concat(a,",").concat(a,",0,1,1,").concat(2*o,",").concat(i,`
            H`).concat(ti,"M").concat(2*o,",").concat(i,`
            A`).concat(a,",").concat(a,",0,1,1,").concat(o,",").concat(i),className:"recharts-legend-icon"});if(c==="rect")return p.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(ti/8,"h").concat(ti,"v").concat(ti*3/4,"h").concat(-ti,"z"),className:"recharts-legend-icon"});if(p.isValidElement(t.legendIcon)){var d=WB({},t);return delete d.legendIcon,p.cloneElement(t.legendIcon,d)}return p.createElement(Cb,{fill:l,cx:i,cy:i,size:ti,sizeType:"diameter",type:c})}function qB(e){var{payload:t,iconSize:r,layout:s,formatter:i,inactiveColor:a,iconType:o}=e,l={x:0,y:0,width:ti,height:ti},c={display:s==="horizontal"?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((d,f)=>{var h=d.formatter||i,m=vr({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:d.inactive});if(d.type==="none")return null;var g=d.inactive?a:d.color,x=h?h(d.value,d,f):d.value;return p.createElement("li",Gh({className:m,style:c,key:"legend-item-".concat(f)},wp(e,d,f)),p.createElement(jb,{width:r,height:r,viewBox:l,style:u,"aria-label":"".concat(x," legend icon")},p.createElement(VB,{data:d,iconType:o,inactiveColor:a})),p.createElement("span",{className:"recharts-legend-item-text",style:{color:g}},x))})}var GB=e=>{var t=hn(e,KB),{payload:r,layout:s,align:i}=t;if(!r||!r.length)return null;var a={padding:0,margin:0,textAlign:s==="horizontal"?i:"left"};return p.createElement("ul",{className:"recharts-default-legend",style:a},p.createElement(qB,Gh({},t,{payload:r})))},TP={},RP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r,s){const i=new Map;for(let a=0;a<r.length;a++){const o=r[a],l=s(o);i.has(l)||i.set(l,o)}return Array.from(i.values())}e.uniqBy=t})(RP);var Ab={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r}e.identity=t})(Ab);var OP={},fm={},zP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return Number.isSafeInteger(r)&&r>=0}e.isLength=t})(zP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=zP;function r(s){return s!=null&&typeof s!="function"&&t.isLength(s.length)}e.isArrayLike=r})(fm);var LP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return typeof r=="object"&&r!==null}e.isObjectLike=t})(LP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=fm,r=LP;function s(i){return r.isObjectLike(i)&&t.isArrayLike(i)}e.isArrayLikeObject=s})(OP);var $P={},DP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=dm;function r(s){return function(i){return t.get(i,s)}}e.property=r})(DP);var MP={},Eb={},BP={},Pb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r!==null&&(typeof r=="object"||typeof r=="function")}e.isObject=t})(Pb);var Ib={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r==null||typeof r!="object"&&typeof r!="function"}e.isPrimitive=t})(Ib);var Tb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r,s){return r===s||Number.isNaN(r)&&Number.isNaN(s)}e.eq=t})(Tb);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Pb,r=Ib,s=Tb;function i(d,f,h){return typeof h!="function"?i(d,f,()=>{}):a(d,f,function m(g,x,y,v,S,k){const j=h(g,x,y,v,S,k);return j!==void 0?!!j:a(g,x,m,k)},new Map)}function a(d,f,h,m){if(f===d)return!0;switch(typeof f){case"object":return o(d,f,h,m);case"function":return Object.keys(f).length>0?a(d,{...f},h,m):s.eq(d,f);default:return t.isObject(d)?typeof f=="string"?f==="":!0:s.eq(d,f)}}function o(d,f,h,m){if(f==null)return!0;if(Array.isArray(f))return c(d,f,h,m);if(f instanceof Map)return l(d,f,h,m);if(f instanceof Set)return u(d,f,h,m);const g=Object.keys(f);if(d==null)return g.length===0;if(g.length===0)return!0;if(m!=null&&m.has(f))return m.get(f)===d;m==null||m.set(f,d);try{for(let x=0;x<g.length;x++){const y=g[x];if(!r.isPrimitive(d)&&!(y in d)||f[y]===void 0&&d[y]!==void 0||f[y]===null&&d[y]!==null||!h(d[y],f[y],y,d,f,m))return!1}return!0}finally{m==null||m.delete(f)}}function l(d,f,h,m){if(f.size===0)return!0;if(!(d instanceof Map))return!1;for(const[g,x]of f.entries()){const y=d.get(g);if(h(y,x,g,d,f,m)===!1)return!1}return!0}function c(d,f,h,m){if(f.length===0)return!0;if(!Array.isArray(d))return!1;const g=new Set;for(let x=0;x<f.length;x++){const y=f[x];let v=!1;for(let S=0;S<d.length;S++){if(g.has(S))continue;const k=d[S];let j=!1;if(h(k,y,x,d,f,m)&&(j=!0),j){g.add(S),v=!0;break}}if(!v)return!1}return!0}function u(d,f,h,m){return f.size===0?!0:d instanceof Set?c([...d],[...f],h,m):!1}e.isMatchWith=i,e.isSetMatch=u})(BP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=BP;function r(s,i){return t.isMatchWith(s,i,()=>{})}e.isMatch=r})(Eb);var FP={},Rb={},WP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return Object.getOwnPropertySymbols(r).filter(s=>Object.prototype.propertyIsEnumerable.call(r,s))}e.getSymbols=t})(WP);var Ob={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}e.getTag=t})(Ob);var zb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t="[object RegExp]",r="[object String]",s="[object Number]",i="[object Boolean]",a="[object Arguments]",o="[object Symbol]",l="[object Date]",c="[object Map]",u="[object Set]",d="[object Array]",f="[object Function]",h="[object ArrayBuffer]",m="[object Object]",g="[object Error]",x="[object DataView]",y="[object Uint8Array]",v="[object Uint8ClampedArray]",S="[object Uint16Array]",k="[object Uint32Array]",j="[object BigUint64Array]",_="[object Int8Array]",b="[object Int16Array]",A="[object Int32Array]",z="[object BigInt64Array]",D="[object Float32Array]",w="[object Float64Array]";e.argumentsTag=a,e.arrayBufferTag=h,e.arrayTag=d,e.bigInt64ArrayTag=z,e.bigUint64ArrayTag=j,e.booleanTag=i,e.dataViewTag=x,e.dateTag=l,e.errorTag=g,e.float32ArrayTag=D,e.float64ArrayTag=w,e.functionTag=f,e.int16ArrayTag=b,e.int32ArrayTag=A,e.int8ArrayTag=_,e.mapTag=c,e.numberTag=s,e.objectTag=m,e.regexpTag=t,e.setTag=u,e.stringTag=r,e.symbolTag=o,e.uint16ArrayTag=S,e.uint32ArrayTag=k,e.uint8ArrayTag=y,e.uint8ClampedArrayTag=v})(zb);var UP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}e.isTypedArray=t})(UP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=WP,r=Ob,s=zb,i=Ib,a=UP;function o(d,f){return l(d,void 0,d,new Map,f)}function l(d,f,h,m=new Map,g=void 0){const x=g==null?void 0:g(d,f,h,m);if(x!==void 0)return x;if(i.isPrimitive(d))return d;if(m.has(d))return m.get(d);if(Array.isArray(d)){const y=new Array(d.length);m.set(d,y);for(let v=0;v<d.length;v++)y[v]=l(d[v],v,h,m,g);return Object.hasOwn(d,"index")&&(y.index=d.index),Object.hasOwn(d,"input")&&(y.input=d.input),y}if(d instanceof Date)return new Date(d.getTime());if(d instanceof RegExp){const y=new RegExp(d.source,d.flags);return y.lastIndex=d.lastIndex,y}if(d instanceof Map){const y=new Map;m.set(d,y);for(const[v,S]of d)y.set(v,l(S,v,h,m,g));return y}if(d instanceof Set){const y=new Set;m.set(d,y);for(const v of d)y.add(l(v,void 0,h,m,g));return y}if(typeof Buffer<"u"&&Buffer.isBuffer(d))return d.subarray();if(a.isTypedArray(d)){const y=new(Object.getPrototypeOf(d)).constructor(d.length);m.set(d,y);for(let v=0;v<d.length;v++)y[v]=l(d[v],v,h,m,g);return y}if(d instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&d instanceof SharedArrayBuffer)return d.slice(0);if(d instanceof DataView){const y=new DataView(d.buffer.slice(0),d.byteOffset,d.byteLength);return m.set(d,y),c(y,d,h,m,g),y}if(typeof File<"u"&&d instanceof File){const y=new File([d],d.name,{type:d.type});return m.set(d,y),c(y,d,h,m,g),y}if(typeof Blob<"u"&&d instanceof Blob){const y=new Blob([d],{type:d.type});return m.set(d,y),c(y,d,h,m,g),y}if(d instanceof Error){const y=new d.constructor;return m.set(d,y),y.message=d.message,y.name=d.name,y.stack=d.stack,y.cause=d.cause,c(y,d,h,m,g),y}if(d instanceof Boolean){const y=new Boolean(d.valueOf());return m.set(d,y),c(y,d,h,m,g),y}if(d instanceof Number){const y=new Number(d.valueOf());return m.set(d,y),c(y,d,h,m,g),y}if(d instanceof String){const y=new String(d.valueOf());return m.set(d,y),c(y,d,h,m,g),y}if(typeof d=="object"&&u(d)){const y=Object.create(Object.getPrototypeOf(d));return m.set(d,y),c(y,d,h,m,g),y}return d}function c(d,f,h=d,m,g){const x=[...Object.keys(f),...t.getSymbols(f)];for(let y=0;y<x.length;y++){const v=x[y],S=Object.getOwnPropertyDescriptor(d,v);(S==null||S.writable)&&(d[v]=l(f[v],v,h,m,g))}}function u(d){switch(r.getTag(d)){case s.argumentsTag:case s.arrayTag:case s.arrayBufferTag:case s.dataViewTag:case s.booleanTag:case s.dateTag:case s.float32ArrayTag:case s.float64ArrayTag:case s.int8ArrayTag:case s.int16ArrayTag:case s.int32ArrayTag:case s.mapTag:case s.numberTag:case s.objectTag:case s.regexpTag:case s.setTag:case s.stringTag:case s.symbolTag:case s.uint8ArrayTag:case s.uint8ClampedArrayTag:case s.uint16ArrayTag:case s.uint32ArrayTag:return!0;default:return!1}}e.cloneDeepWith=o,e.cloneDeepWithImpl=l,e.copyProperties=c})(Rb);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Rb;function r(s){return t.cloneDeepWithImpl(s,void 0,s,new Map,void 0)}e.cloneDeep=r})(FP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Eb,r=FP;function s(i){return i=r.cloneDeep(i),a=>t.isMatch(a,i)}e.matches=s})(MP);var HP={},YP={},KP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Rb,r=zb;function s(i,a){return t.cloneDeepWith(i,(o,l,c,u)=>{const d=a==null?void 0:a(o,l,c,u);if(d!==void 0)return d;if(typeof i=="object")switch(Object.prototype.toString.call(i)){case r.numberTag:case r.stringTag:case r.booleanTag:{const f=new i.constructor(i==null?void 0:i.valueOf());return t.copyProperties(f,i),f}case r.argumentsTag:{const f={};return t.copyProperties(f,i),f.length=i.length,f[Symbol.iterator]=i[Symbol.iterator],f}default:return}})}e.cloneDeepWith=s})(KP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=KP;function r(s){return t.cloneDeepWith(s)}e.cloneDeep=r})(YP);var VP={},Lb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=/^(?:0|[1-9]\d*)$/;function r(s,i=Number.MAX_SAFE_INTEGER){switch(typeof s){case"number":return Number.isInteger(s)&&s>=0&&s<i;case"symbol":return!1;case"string":return t.test(s)}}e.isIndex=r})(Lb);var qP={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Ob;function r(s){return s!==null&&typeof s=="object"&&t.getTag(s)==="[object Arguments]"}e.isArguments=r})(qP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Nb,r=Lb,s=qP,i=pm;function a(o,l){let c;if(Array.isArray(l)?c=l:typeof l=="string"&&t.isDeepKey(l)&&(o==null?void 0:o[l])==null?c=i.toPath(l):c=[l],c.length===0)return!1;let u=o;for(let d=0;d<c.length;d++){const f=c[d];if((u==null||!Object.hasOwn(u,f))&&!((Array.isArray(u)||s.isArguments(u))&&r.isIndex(f)&&f<u.length))return!1;u=u[f]}return!0}e.has=a})(VP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Eb,r=um,s=YP,i=dm,a=VP;function o(l,c){switch(typeof l){case"object":{Object.is(l==null?void 0:l.valueOf(),-0)&&(l="-0");break}case"number":{l=r.toKey(l);break}}return c=s.cloneDeep(c),function(u){const d=i.get(u,l);return d===void 0?a.has(u,l):c===void 0?d===void 0:t.isMatch(d,c)}}e.matchesProperty=o})(HP);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Ab,r=DP,s=MP,i=HP;function a(o){if(o==null)return t.identity;switch(typeof o){case"function":return o;case"object":return Array.isArray(o)&&o.length===2?i.matchesProperty(o[0],o[1]):s.matches(o);case"string":case"symbol":case"number":return r.property(o)}}e.iteratee=a})($P);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=RP,r=Ab,s=OP,i=$P;function a(o,l=r.identity){return s.isArrayLikeObject(o)?t.uniqBy(Array.from(o),i.iteratee(l)):[]}e.uniqBy=a})(TP);var XB=TP.uniqBy;const Z2=Ya(XB);function GP(e,t,r){return t===!0?Z2(e,r):typeof t=="function"?Z2(e,t):e}var XP={exports:{}},QP={},JP={exports:{}},ZP={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rd=p;function QB(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var JB=typeof Object.is=="function"?Object.is:QB,ZB=rd.useState,e9=rd.useEffect,t9=rd.useLayoutEffect,r9=rd.useDebugValue;function n9(e,t){var r=t(),s=ZB({inst:{value:r,getSnapshot:t}}),i=s[0].inst,a=s[1];return t9(function(){i.value=r,i.getSnapshot=t,Zx(i)&&a({inst:i})},[e,r,t]),e9(function(){return Zx(i)&&a({inst:i}),e(function(){Zx(i)&&a({inst:i})})},[e]),r9(r),r}function Zx(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!JB(e,r)}catch{return!0}}function s9(e,t){return t()}var i9=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?s9:n9;ZP.useSyncExternalStore=rd.useSyncExternalStore!==void 0?rd.useSyncExternalStore:i9;JP.exports=ZP;var a9=JP.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hm=p,o9=a9;function l9(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var c9=typeof Object.is=="function"?Object.is:l9,d9=o9.useSyncExternalStore,u9=hm.useRef,p9=hm.useEffect,f9=hm.useMemo,h9=hm.useDebugValue;QP.useSyncExternalStoreWithSelector=function(e,t,r,s,i){var a=u9(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=f9(function(){function c(m){if(!u){if(u=!0,d=m,m=s(m),i!==void 0&&o.hasValue){var g=o.value;if(i(g,m))return f=g}return f=m}if(g=f,c9(d,m))return g;var x=s(m);return i!==void 0&&i(g,x)?(d=m,g):(d=m,f=x)}var u=!1,d,f,h=r===void 0?null:r;return[function(){return c(t())},h===null?void 0:function(){return c(h())}]},[t,r,s,i]);var l=d9(e,a[0],a[1]);return p9(function(){o.hasValue=!0,o.value=l},[l]),h9(l),l};XP.exports=QP;var g9=XP.exports,$b=p.createContext(null),m9=e=>e,Rr=()=>{var e=p.useContext($b);return e?e.store.dispatch:m9},sh=()=>{},x9=()=>sh,y9=(e,t)=>e===t;function It(e){var t=p.useContext($b);return g9.useSyncExternalStoreWithSelector(t?t.subscription.addNestedSub:x9,t?t.store.getState:sh,t?t.store.getState:sh,t?e:sh,y9)}function v9(e,t=`expected a function, instead received ${typeof e}`){if(typeof e!="function")throw new TypeError(t)}function b9(e,t=`expected an object, instead received ${typeof e}`){if(typeof e!="object")throw new TypeError(t)}function j9(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(r=>typeof r=="function")){const r=e.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${t}[${r}]`)}}var ek=e=>Array.isArray(e)?e:[e];function w9(e){const t=Array.isArray(e[0])?e[0]:e;return j9(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function S9(e,t){const r=[],{length:s}=e;for(let i=0;i<s;i++)r.push(e[i].apply(null,t));return r}var k9=class{constructor(e){this.value=e}deref(){return this.value}},N9=typeof WeakRef<"u"?WeakRef:k9,C9=0,tk=1;function bf(){return{s:C9,v:void 0,o:null,p:null}}function eI(e,t={}){let r=bf();const{resultEqualityCheck:s}=t;let i,a=0;function o(){var f;let l=r;const{length:c}=arguments;for(let h=0,m=c;h<m;h++){const g=arguments[h];if(typeof g=="function"||typeof g=="object"&&g!==null){let x=l.o;x===null&&(l.o=x=new WeakMap);const y=x.get(g);y===void 0?(l=bf(),x.set(g,l)):l=y}else{let x=l.p;x===null&&(l.p=x=new Map);const y=x.get(g);y===void 0?(l=bf(),x.set(g,l)):l=y}}const u=l;let d;if(l.s===tk)d=l.v;else if(d=e.apply(null,arguments),a++,s){const h=((f=i==null?void 0:i.deref)==null?void 0:f.call(i))??i;h!=null&&s(h,d)&&(d=h,a!==0&&a--),i=typeof d=="object"&&d!==null||typeof d=="function"?new N9(d):d}return u.s=tk,u.v=d,d}return o.clearCache=()=>{r=bf(),o.resetResultsCount()},o.resultsCount=()=>a,o.resetResultsCount=()=>{a=0},o}function _9(e,...t){const r=typeof e=="function"?{memoize:e,memoizeOptions:t}:e,s=(...i)=>{let a=0,o=0,l,c={},u=i.pop();typeof u=="object"&&(c=u,u=i.pop()),v9(u,`createSelector expects an output function after the inputs, but received: [${typeof u}]`);const d={...r,...c},{memoize:f,memoizeOptions:h=[],argsMemoize:m=eI,argsMemoizeOptions:g=[]}=d,x=ek(h),y=ek(g),v=w9(i),S=f(function(){return a++,u.apply(null,arguments)},...x),k=m(function(){o++;const _=S9(v,arguments);return l=S.apply(null,_),l},...y);return Object.assign(k,{resultFunc:u,memoizedResultFunc:S,dependencies:v,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>l,recomputations:()=>a,resetRecomputations:()=>{a=0},memoize:f,argsMemoize:m})};return Object.assign(s,{withTypes:()=>s}),s}var ze=_9(eI),A9=Object.assign((e,t=ze)=>{b9(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);const r=Object.keys(e),s=r.map(a=>e[a]);return t(s,(...a)=>a.reduce((o,l,c)=>(o[r[c]]=l,o),{}))},{withTypes:()=>A9}),tI={},rI={},nI={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(s){return typeof s=="symbol"?1:s===null?2:s===void 0?3:s!==s?4:0}const r=(s,i,a)=>{if(s!==i){const o=t(s),l=t(i);if(o===l&&o===0){if(s<i)return a==="desc"?1:-1;if(s>i)return a==="desc"?-1:1}return a==="desc"?l-o:o-l}return 0};e.compareValues=r})(nI);var sI={},Db={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return typeof r=="symbol"||r instanceof Symbol}e.isSymbol=t})(Db);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Db,r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;function i(a,o){return Array.isArray(a)?!1:typeof a=="number"||typeof a=="boolean"||a==null||t.isSymbol(a)?!0:typeof a=="string"&&(s.test(a)||!r.test(a))||o!=null&&Object.hasOwn(o,a)}e.isKey=i})(sI);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=nI,r=sI,s=pm;function i(a,o,l,c){if(a==null)return[];l=c?void 0:l,Array.isArray(a)||(a=Object.values(a)),Array.isArray(o)||(o=o==null?[null]:[o]),o.length===0&&(o=[null]),Array.isArray(l)||(l=l==null?[]:[l]),l=l.map(m=>String(m));const u=(m,g)=>{let x=m;for(let y=0;y<g.length&&x!=null;++y)x=x[g[y]];return x},d=(m,g)=>g==null||m==null?g:typeof m=="object"&&"key"in m?Object.hasOwn(g,m.key)?g[m.key]:u(g,m.path):typeof m=="function"?m(g):Array.isArray(m)?u(g,m):typeof g=="object"?g[m]:g,f=o.map(m=>(Array.isArray(m)&&m.length===1&&(m=m[0]),m==null||typeof m=="function"||Array.isArray(m)||r.isKey(m)?m:{key:m,path:s.toPath(m)}));return a.map(m=>({original:m,criteria:f.map(g=>d(g,m))})).slice().sort((m,g)=>{for(let x=0;x<f.length;x++){const y=t.compareValues(m.criteria[x],g.criteria[x],l[x]);if(y!==0)return y}return 0}).map(m=>m.original)}e.orderBy=i})(rI);var iI={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r,s=1){const i=[],a=Math.floor(s),o=(l,c)=>{for(let u=0;u<l.length;u++){const d=l[u];Array.isArray(d)&&c<a?o(d,c+1):i.push(d)}};return o(r,0),i}e.flatten=t})(iI);var Mb={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Lb,r=fm,s=Pb,i=Tb;function a(o,l,c){return s.isObject(c)&&(typeof l=="number"&&r.isArrayLike(c)&&t.isIndex(l)&&l<c.length||typeof l=="string"&&l in c)?i.eq(c[l],o):!1}e.isIterateeCall=a})(Mb);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=rI,r=iI,s=Mb;function i(a,...o){const l=o.length;return l>1&&s.isIterateeCall(a,o[0],o[1])?o=[]:l>2&&s.isIterateeCall(o[0],o[1],o[2])&&(o=[o[0]]),t.orderBy(a,r.flatten(o),["asc"])}e.sortBy=i})(tI);var E9=tI.sortBy;const gm=Ya(E9);var aI=e=>e.legend.settings,P9=e=>e.legend.size,I9=e=>e.legend.payload,T9=ze([I9,aI],(e,t)=>{var{itemSorter:r}=t,s=e.flat(1);return r?gm(s,r):s});function R9(){return It(T9)}var jf=1;function oI(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[t,r]=p.useState({height:0,left:0,top:0,width:0}),s=p.useCallback(i=>{if(i!=null){var a=i.getBoundingClientRect(),o={height:a.height,left:a.left,top:a.top,width:a.width};(Math.abs(o.height-t.height)>jf||Math.abs(o.left-t.left)>jf||Math.abs(o.top-t.top)>jf||Math.abs(o.width-t.width)>jf)&&r({height:o.height,left:o.left,top:o.top,width:o.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,s]}function Bn(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var O9=typeof Symbol=="function"&&Symbol.observable||"@@observable",rk=O9,ey=()=>Math.random().toString(36).substring(7).split("").join("."),z9={INIT:`@@redux/INIT${ey()}`,REPLACE:`@@redux/REPLACE${ey()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${ey()}`},Xh=z9;function Bb(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function lI(e,t,r){if(typeof e!="function")throw new Error(Bn(2));if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Bn(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Bn(1));return r(lI)(e,t)}let s=e,i=t,a=new Map,o=a,l=0,c=!1;function u(){o===a&&(o=new Map,a.forEach((y,v)=>{o.set(v,y)}))}function d(){if(c)throw new Error(Bn(3));return i}function f(y){if(typeof y!="function")throw new Error(Bn(4));if(c)throw new Error(Bn(5));let v=!0;u();const S=l++;return o.set(S,y),function(){if(v){if(c)throw new Error(Bn(6));v=!1,u(),o.delete(S),a=null}}}function h(y){if(!Bb(y))throw new Error(Bn(7));if(typeof y.type>"u")throw new Error(Bn(8));if(typeof y.type!="string")throw new Error(Bn(17));if(c)throw new Error(Bn(9));try{c=!0,i=s(i,y)}finally{c=!1}return(a=o).forEach(S=>{S()}),y}function m(y){if(typeof y!="function")throw new Error(Bn(10));s=y,h({type:Xh.REPLACE})}function g(){const y=f;return{subscribe(v){if(typeof v!="object"||v===null)throw new Error(Bn(11));function S(){const j=v;j.next&&j.next(d())}return S(),{unsubscribe:y(S)}},[rk](){return this}}}return h({type:Xh.INIT}),{dispatch:h,subscribe:f,getState:d,replaceReducer:m,[rk]:g}}function L9(e){Object.keys(e).forEach(t=>{const r=e[t];if(typeof r(void 0,{type:Xh.INIT})>"u")throw new Error(Bn(12));if(typeof r(void 0,{type:Xh.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Bn(13))})}function cI(e){const t=Object.keys(e),r={};for(let a=0;a<t.length;a++){const o=t[a];typeof e[o]=="function"&&(r[o]=e[o])}const s=Object.keys(r);let i;try{L9(r)}catch(a){i=a}return function(o={},l){if(i)throw i;let c=!1;const u={};for(let d=0;d<s.length;d++){const f=s[d],h=r[f],m=o[f],g=h(m,l);if(typeof g>"u")throw l&&l.type,new Error(Bn(14));u[f]=g,c=c||g!==m}return c=c||s.length!==Object.keys(o).length,c?u:o}}function Qh(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,r)=>(...s)=>t(r(...s)))}function $9(...e){return t=>(r,s)=>{const i=t(r,s);let a=()=>{throw new Error(Bn(15))};const o={getState:i.getState,dispatch:(c,...u)=>a(c,...u)},l=e.map(c=>c(o));return a=Qh(...l)(i.dispatch),{...i,dispatch:a}}}function dI(e){return Bb(e)&&"type"in e&&typeof e.type=="string"}var uI=Symbol.for("immer-nothing"),nk=Symbol.for("immer-draftable"),gs=Symbol.for("immer-state");function Ei(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Hs=Object,nd=Hs.getPrototypeOf,Jh="constructor",mm="prototype",s0="configurable",Zh="enumerable",ih="writable",Wu="value",Ma=e=>!!e&&!!e[gs];function Di(e){var t;return e?pI(e)||xm(e)||!!e[nk]||!!((t=e[Jh])!=null&&t[nk])||ym(e)||vm(e):!1}var D9=Hs[mm][Jh].toString(),sk=new WeakMap;function pI(e){if(!e||!Fb(e))return!1;const t=nd(e);if(t===null||t===Hs[mm])return!0;const r=Hs.hasOwnProperty.call(t,Jh)&&t[Jh];if(r===Object)return!0;if(!uc(r))return!1;let s=sk.get(r);return s===void 0&&(s=Function.toString.call(r),sk.set(r,s)),s===D9}function Sp(e,t,r=!0){kp(e)===0?(r?Reflect.ownKeys(e):Hs.keys(e)).forEach(i=>{t(i,e[i],e)}):e.forEach((s,i)=>t(i,s,e))}function kp(e){const t=e[gs];return t?t.type_:xm(e)?1:ym(e)?2:vm(e)?3:0}var ik=(e,t,r=kp(e))=>r===2?e.has(t):Hs[mm].hasOwnProperty.call(e,t),i0=(e,t,r=kp(e))=>r===2?e.get(t):e[t],eg=(e,t,r,s=kp(e))=>{s===2?e.set(t,r):s===3?e.add(r):e[t]=r};function M9(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var xm=Array.isArray,ym=e=>e instanceof Map,vm=e=>e instanceof Set,Fb=e=>typeof e=="object",uc=e=>typeof e=="function",ty=e=>typeof e=="boolean",ba=e=>e.copy_||e.base_,Wb=e=>e.modified_?e.copy_:e.base_;function a0(e,t){if(ym(e))return new Map(e);if(vm(e))return new Set(e);if(xm(e))return Array[mm].slice.call(e);const r=pI(e);if(t===!0||t==="class_only"&&!r){const s=Hs.getOwnPropertyDescriptors(e);delete s[gs];let i=Reflect.ownKeys(s);for(let a=0;a<i.length;a++){const o=i[a],l=s[o];l[ih]===!1&&(l[ih]=!0,l[s0]=!0),(l.get||l.set)&&(s[o]={[s0]:!0,[ih]:!0,[Zh]:l[Zh],[Wu]:e[o]})}return Hs.create(nd(e),s)}else{const s=nd(e);if(s!==null&&r)return{...e};const i=Hs.create(s);return Hs.assign(i,e)}}function Ub(e,t=!1){return bm(e)||Ma(e)||!Di(e)||(kp(e)>1&&Hs.defineProperties(e,{set:wf,add:wf,clear:wf,delete:wf}),Hs.freeze(e),t&&Sp(e,(r,s)=>{Ub(s,!0)},!1)),e}function B9(){Ei(2)}var wf={[Wu]:B9};function bm(e){return e===null||!Fb(e)?!0:Hs.isFrozen(e)}var tg="MapSet",o0="Patches",fI={};function sd(e){const t=fI[e];return t||Ei(0,e),t}var F9=e=>!!fI[e],Uu,hI=()=>Uu,W9=(e,t)=>({drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:F9(tg)?sd(tg):void 0});function ak(e,t){t&&(e.patchPlugin_=sd(o0),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function l0(e){c0(e),e.drafts_.forEach(U9),e.drafts_=null}function c0(e){e===Uu&&(Uu=e.parent_)}var ok=e=>Uu=W9(Uu,e);function U9(e){const t=e[gs];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function lk(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];if(e!==void 0&&e!==r){r[gs].modified_&&(l0(t),Ei(4)),Di(e)&&(e=ck(t,e));const{patchPlugin_:i}=t;i&&i.generateReplacementPatches_(r[gs].base_,e,t)}else e=ck(t,r);return H9(t,e,!0),l0(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==uI?e:void 0}function ck(e,t){if(bm(t))return t;const r=t[gs];if(!r)return Hb(t,e.handledSet_,e);if(!jm(r,e))return t;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:s}=r;if(s)for(;s.length>0;)s.pop()(e);xI(r,e)}return r.copy_}function H9(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Ub(t,r)}function gI(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var jm=(e,t)=>e.scope_===t,Y9=[];function mI(e,t,r,s){const i=ba(e),a=e.type_;if(s!==void 0&&i0(i,s,a)===t){eg(i,s,r,a);return}if(!e.draftLocations_){const l=e.draftLocations_=new Map;Sp(i,(c,u)=>{if(Ma(u)){const d=l.get(u)||[];d.push(c),l.set(u,d)}})}const o=e.draftLocations_.get(t)??Y9;for(const l of o)eg(i,l,r,a)}function K9(e,t,r){e.callbacks_.push(function(i){var l;const a=t;if(!a||!jm(a,i))return;(l=i.mapSetPlugin_)==null||l.fixSetContents(a);const o=Wb(a);mI(e,a.draft_??a,o,r),xI(a,i)})}function xI(e,t){var s;if(e.modified_&&!e.finalized_&&(e.type_===3||(((s=e.assigned_)==null?void 0:s.size)??0)>0)){const{patchPlugin_:i}=t;if(i){const a=i.getPath(e);a&&i.generatePatches_(e,a,t)}gI(e)}}function V9(e,t,r){const{scope_:s}=e;if(Ma(r)){const i=r[gs];jm(i,s)&&i.callbacks_.push(function(){ah(e);const o=Wb(i);mI(e,r,o,t)})}else Di(r)&&e.callbacks_.push(function(){const a=ba(e);i0(a,t,e.type_)===r&&s.drafts_.length>1&&(e.assigned_.get(t)??!1)===!0&&e.copy_&&Hb(i0(e.copy_,t,e.type_),s.handledSet_,s)})}function Hb(e,t,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||Ma(e)||t.has(e)||!Di(e)||bm(e)||(t.add(e),Sp(e,(s,i)=>{if(Ma(i)){const a=i[gs];if(jm(a,r)){const o=Wb(a);eg(e,s,o,e.type_),gI(a)}}else Di(i)&&Hb(i,t,r)})),e}function q9(e,t){const r=xm(e),s={type_:r?1:0,scope_:t?t.scope_:hI(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let i=s,a=Yb;r&&(i=[s],a=Hu);const{revoke:o,proxy:l}=Proxy.revocable(i,a);return s.draft_=l,s.revoke_=o,[l,s]}var Yb={get(e,t){if(t===gs)return e;const r=ba(e);if(!ik(r,t,e.type_))return G9(e,r,t);const s=r[t];if(e.finalized_||!Di(s))return s;if(s===ry(e.base_,t)){ah(e);const i=e.type_===1?+t:t,a=u0(e.scope_,s,e,i);return e.copy_[i]=a}return s},has(e,t){return t in ba(e)},ownKeys(e){return Reflect.ownKeys(ba(e))},set(e,t,r){const s=yI(ba(e),t);if(s!=null&&s.set)return s.set.call(e.draft_,r),!0;if(!e.modified_){const i=ry(ba(e),t),a=i==null?void 0:i[gs];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_.set(t,!1),!0;if(M9(r,i)&&(r!==void 0||ik(e.base_,t,e.type_)))return!0;ah(e),d0(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_.set(t,!0),V9(e,t,r)),!0},deleteProperty(e,t){return ah(e),ry(e.base_,t)!==void 0||t in e.base_?(e.assigned_.set(t,!1),d0(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=ba(e),s=Reflect.getOwnPropertyDescriptor(r,t);return s&&{[ih]:!0,[s0]:e.type_!==1||t!=="length",[Zh]:s[Zh],[Wu]:r[t]}},defineProperty(){Ei(11)},getPrototypeOf(e){return nd(e.base_)},setPrototypeOf(){Ei(12)}},Hu={};Sp(Yb,(e,t)=>{Hu[e]=function(){const r=arguments;return r[0]=r[0][0],t.apply(this,r)}});Hu.deleteProperty=function(e,t){return Hu.set.call(this,e,t,void 0)};Hu.set=function(e,t,r){return Yb.set.call(this,e[0],t,r,e[0])};function ry(e,t){const r=e[gs];return(r?ba(r):e)[t]}function G9(e,t,r){var i;const s=yI(t,r);return s?Wu in s?s[Wu]:(i=s.get)==null?void 0:i.call(e.draft_):void 0}function yI(e,t){if(!(t in e))return;let r=nd(e);for(;r;){const s=Object.getOwnPropertyDescriptor(r,t);if(s)return s;r=nd(r)}}function d0(e){e.modified_||(e.modified_=!0,e.parent_&&d0(e.parent_))}function ah(e){e.copy_||(e.assigned_=new Map,e.copy_=a0(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var X9=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(r,s,i)=>{if(uc(r)&&!uc(s)){const o=s;s=r;const l=this;return function(u=o,...d){return l.produce(u,f=>s.call(this,f,...d))}}uc(s)||Ei(6),i!==void 0&&!uc(i)&&Ei(7);let a;if(Di(r)){const o=ok(this),l=u0(o,r,void 0);let c=!0;try{a=s(l),c=!1}finally{c?l0(o):c0(o)}return ak(o,i),lk(a,o)}else if(!r||!Fb(r)){if(a=s(r),a===void 0&&(a=r),a===uI&&(a=void 0),this.autoFreeze_&&Ub(a,!0),i){const o=[],l=[];sd(o0).generateReplacementPatches_(r,a,{patches_:o,inversePatches_:l}),i(o,l)}return a}else Ei(1,r)},this.produceWithPatches=(r,s)=>{if(uc(r))return(l,...c)=>this.produceWithPatches(l,u=>r(u,...c));let i,a;return[this.produce(r,s,(l,c)=>{i=l,a=c}),i,a]},ty(t==null?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze),ty(t==null?void 0:t.useStrictShallowCopy)&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),ty(t==null?void 0:t.useStrictIteration)&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){Di(t)||Ei(8),Ma(t)&&(t=Oi(t));const r=ok(this),s=u0(r,t,void 0);return s[gs].isManual_=!0,c0(r),s}finishDraft(t,r){const s=t&&t[gs];(!s||!s.isManual_)&&Ei(9);const{scope_:i}=s;return ak(i,r),lk(void 0,i)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,r){let s;for(s=r.length-1;s>=0;s--){const a=r[s];if(a.path.length===0&&a.op==="replace"){t=a.value;break}}s>-1&&(r=r.slice(s+1));const i=sd(o0).applyPatches_;return Ma(t)?i(t,r):this.produce(t,a=>i(a,r))}};function u0(e,t,r,s){const[i,a]=ym(t)?sd(tg).proxyMap_(t,r):vm(t)?sd(tg).proxySet_(t,r):q9(t,r);return((r==null?void 0:r.scope_)??hI()).drafts_.push(i),a.callbacks_=(r==null?void 0:r.callbacks_)??[],a.key_=s,r&&s!==void 0?K9(r,a,s):a.callbacks_.push(function(c){var d;(d=c.mapSetPlugin_)==null||d.fixSetContents(a);const{patchPlugin_:u}=c;a.modified_&&u&&u.generatePatches_(a,[],c)}),i}function Oi(e){return Ma(e)||Ei(10,e),vI(e)}function vI(e){if(!Di(e)||bm(e))return e;const t=e[gs];let r,s=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=a0(e,t.scope_.immer_.useStrictShallowCopy_),s=t.scope_.immer_.shouldUseStrictIteration()}else r=a0(e,!0);return Sp(r,(i,a)=>{eg(r,i,vI(a))},s),t&&(t.finalized_=!1),r}var Q9=new X9,bI=Q9.produce;function jI(e){return({dispatch:r,getState:s})=>i=>a=>typeof a=="function"?a(r,s,e):i(a)}var J9=jI(),Z9=jI,e7=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Qh:Qh.apply(null,arguments)};function pi(e,t){function r(...s){if(t){let i=t(...s);if(!i)throw new Error(Ks(0));return{type:e,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:e,payload:s[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=s=>dI(s)&&s.type===e,r}var wI=class au extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,au.prototype)}static get[Symbol.species](){return au}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new au(...t[0].concat(this)):new au(...t.concat(this))}};function dk(e){return Di(e)?bI(e,()=>{}):e}function Sf(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}function t7(e){return typeof e=="boolean"}var r7=()=>function(t){const{thunk:r=!0,immutableCheck:s=!0,serializableCheck:i=!0,actionCreatorCheck:a=!0}=t??{};let o=new wI;return r&&(t7(r)?o.push(J9):o.push(Z9(r.extraArgument))),o},SI="RTK_autoBatch",Mr=()=>e=>({payload:e,meta:{[SI]:!0}}),uk=e=>t=>{setTimeout(t,e)},kI=(e={type:"raf"})=>t=>(...r)=>{const s=t(...r);let i=!0,a=!1,o=!1;const l=new Set,c=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:uk(10):e.type==="callback"?e.queueNotification:uk(e.timeout),u=()=>{o=!1,a&&(a=!1,l.forEach(d=>d()))};return Object.assign({},s,{subscribe(d){const f=()=>i&&d(),h=s.subscribe(f);return l.add(d),()=>{h(),l.delete(d)}},dispatch(d){var f;try{return i=!((f=d==null?void 0:d.meta)!=null&&f[SI]),a=!i,a&&(o||(o=!0,c(u))),s.dispatch(d)}finally{i=!0}}})},n7=e=>function(r){const{autoBatch:s=!0}=r??{};let i=new wI(e);return s&&i.push(kI(typeof s=="object"?s:void 0)),i};function s7(e){const t=r7(),{reducer:r=void 0,middleware:s,devTools:i=!0,preloadedState:a=void 0,enhancers:o=void 0}=e||{};let l;if(typeof r=="function")l=r;else if(Bb(r))l=cI(r);else throw new Error(Ks(1));let c;typeof s=="function"?c=s(t):c=t();let u=Qh;i&&(u=e7({trace:!1,...typeof i=="object"&&i}));const d=$9(...c),f=n7(d);let h=typeof o=="function"?o(f):f();const m=u(...h);return lI(l,a,m)}function NI(e){const t={},r=[];let s;const i={addCase(a,o){const l=typeof a=="string"?a:a.type;if(!l)throw new Error(Ks(28));if(l in t)throw new Error(Ks(29));return t[l]=o,i},addAsyncThunk(a,o){return o.pending&&(t[a.pending.type]=o.pending),o.rejected&&(t[a.rejected.type]=o.rejected),o.fulfilled&&(t[a.fulfilled.type]=o.fulfilled),o.settled&&r.push({matcher:a.settled,reducer:o.settled}),i},addMatcher(a,o){return r.push({matcher:a,reducer:o}),i},addDefaultCase(a){return s=a,i}};return e(i),[t,r,s]}function i7(e){return typeof e=="function"}function a7(e,t){let[r,s,i]=NI(t),a;if(i7(e))a=()=>dk(e());else{const l=dk(e);a=()=>l}function o(l=a(),c){let u=[r[c.type],...s.filter(({matcher:d})=>d(c)).map(({reducer:d})=>d)];return u.filter(d=>!!d).length===0&&(u=[i]),u.reduce((d,f)=>{if(f)if(Ma(d)){const m=f(d,c);return m===void 0?d:m}else{if(Di(d))return bI(d,h=>f(h,c));{const h=f(d,c);if(h===void 0){if(d===null)return d;throw Error("A case reducer on a non-draftable value must not return undefined")}return h}}return d},l)}return o.getInitialState=a,o}var o7="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",l7=(e=21)=>{let t="",r=e;for(;r--;)t+=o7[Math.random()*64|0];return t},c7=Symbol.for("rtk-slice-createasyncthunk");function d7(e,t){return`${e}/${t}`}function u7({creators:e}={}){var r;const t=(r=e==null?void 0:e.asyncThunk)==null?void 0:r[c7];return function(i){const{name:a,reducerPath:o=a}=i;if(!a)throw new Error(Ks(11));const l=(typeof i.reducers=="function"?i.reducers(f7()):i.reducers)||{},c=Object.keys(l),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},d={addCase(j,_){const b=typeof j=="string"?j:j.type;if(!b)throw new Error(Ks(12));if(b in u.sliceCaseReducersByType)throw new Error(Ks(13));return u.sliceCaseReducersByType[b]=_,d},addMatcher(j,_){return u.sliceMatchers.push({matcher:j,reducer:_}),d},exposeAction(j,_){return u.actionCreators[j]=_,d},exposeCaseReducer(j,_){return u.sliceCaseReducersByName[j]=_,d}};c.forEach(j=>{const _=l[j],b={reducerName:j,type:d7(a,j),createNotation:typeof i.reducers=="function"};g7(_)?x7(b,_,d,t):h7(b,_,d)});function f(){const[j={},_=[],b=void 0]=typeof i.extraReducers=="function"?NI(i.extraReducers):[i.extraReducers],A={...j,...u.sliceCaseReducersByType};return a7(i.initialState,z=>{for(let D in A)z.addCase(D,A[D]);for(let D of u.sliceMatchers)z.addMatcher(D.matcher,D.reducer);for(let D of _)z.addMatcher(D.matcher,D.reducer);b&&z.addDefaultCase(b)})}const h=j=>j,m=new Map,g=new WeakMap;let x;function y(j,_){return x||(x=f()),x(j,_)}function v(){return x||(x=f()),x.getInitialState()}function S(j,_=!1){function b(z){let D=z[j];return typeof D>"u"&&_&&(D=Sf(g,b,v)),D}function A(z=h){const D=Sf(m,_,()=>new WeakMap);return Sf(D,z,()=>{const w={};for(const[N,$]of Object.entries(i.selectors??{}))w[N]=p7($,z,()=>Sf(g,z,v),_);return w})}return{reducerPath:j,getSelectors:A,get selectors(){return A(b)},selectSlice:b}}const k={name:a,reducer:y,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:v,...S(o),injectInto(j,{reducerPath:_,...b}={}){const A=_??o;return j.inject({reducerPath:A,reducer:y},b),{...k,...S(A,!0)}}};return k}}function p7(e,t,r,s){function i(a,...o){let l=t(a);return typeof l>"u"&&s&&(l=r()),e(l,...o)}return i.unwrapped=e,i}var Rs=u7();function f7(){function e(t,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...r}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...r){return t(...r)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:r}},asyncThunk:e}}function h7({type:e,reducerName:t,createNotation:r},s,i){let a,o;if("reducer"in s){if(r&&!m7(s))throw new Error(Ks(17));a=s.reducer,o=s.prepare}else a=s;i.addCase(e,a).exposeCaseReducer(t,a).exposeAction(t,o?pi(e,o):pi(e))}function g7(e){return e._reducerDefinitionType==="asyncThunk"}function m7(e){return e._reducerDefinitionType==="reducerWithPrepare"}function x7({type:e,reducerName:t},r,s,i){if(!i)throw new Error(Ks(18));const{payloadCreator:a,fulfilled:o,pending:l,rejected:c,settled:u,options:d}=r,f=i(e,a,d);s.exposeAction(t,f),o&&s.addCase(f.fulfilled,o),l&&s.addCase(f.pending,l),c&&s.addCase(f.rejected,c),u&&s.addMatcher(f.settled,u),s.exposeCaseReducer(t,{fulfilled:o||kf,pending:l||kf,rejected:c||kf,settled:u||kf})}function kf(){}var y7="task",CI="listener",_I="completed",Kb="cancelled",v7=`task-${Kb}`,b7=`task-${_I}`,p0=`${CI}-${Kb}`,j7=`${CI}-${_I}`,wm=class{constructor(e){vx(this,"name","TaskAbortError");vx(this,"message");this.code=e,this.message=`${y7} ${Kb} (reason: ${e})`}},Vb=(e,t)=>{if(typeof e!="function")throw new TypeError(Ks(32))},rg=()=>{},AI=(e,t=rg)=>(e.catch(t),e),EI=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),Ol=(e,t)=>{const r=e.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},zl=e=>{if(e.aborted){const{reason:t}=e;throw new wm(t)}};function PI(e,t){let r=rg;return new Promise((s,i)=>{const a=()=>i(new wm(e.reason));if(e.aborted){a();return}r=EI(e,a),t.finally(()=>r()).then(s,i)}).finally(()=>{r=rg})}var w7=async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(r){return{status:r instanceof wm?"cancelled":"rejected",error:r}}finally{t==null||t()}},ng=e=>t=>AI(PI(e,t).then(r=>(zl(e),r))),II=e=>{const t=ng(e);return r=>t(new Promise(s=>setTimeout(s,r)))},{assign:Rc}=Object,pk={},Sm="listenerMiddleware",S7=(e,t)=>{const r=s=>EI(e,()=>Ol(s,e.reason));return(s,i)=>{Vb(s);const a=new AbortController;r(a);const o=w7(async()=>{zl(e),zl(a.signal);const l=await s({pause:ng(a.signal),delay:II(a.signal),signal:a.signal});return zl(a.signal),l},()=>Ol(a,b7));return i!=null&&i.autoJoin&&t.push(o.catch(rg)),{result:ng(e)(o),cancel(){Ol(a,v7)}}}},k7=(e,t)=>{const r=async(s,i)=>{zl(t);let a=()=>{};const l=[new Promise((c,u)=>{let d=e({predicate:s,effect:(f,h)=>{h.unsubscribe(),c([f,h.getState(),h.getOriginalState()])}});a=()=>{d(),u()}})];i!=null&&l.push(new Promise(c=>setTimeout(c,i,null)));try{const c=await PI(t,Promise.race(l));return zl(t),c}finally{a()}};return(s,i)=>AI(r(s,i))},TI=e=>{let{type:t,actionCreator:r,matcher:s,predicate:i,effect:a}=e;if(t)i=pi(t).match;else if(r)t=r.type,i=r.match;else if(s)i=s;else if(!i)throw new Error(Ks(21));return Vb(a),{predicate:i,type:t,effect:a}},RI=Rc(e=>{const{type:t,predicate:r,effect:s}=TI(e);return{id:l7(),effect:s,type:t,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Ks(22))}}},{withTypes:()=>RI}),fk=(e,t)=>{const{type:r,effect:s,predicate:i}=TI(t);return Array.from(e.values()).find(a=>(typeof r=="string"?a.type===r:a.predicate===i)&&a.effect===s)},f0=e=>{e.pending.forEach(t=>{Ol(t,p0)})},N7=(e,t)=>()=>{for(const r of t.keys())f0(r);e.clear()},hk=(e,t,r)=>{try{e(t,r)}catch(s){setTimeout(()=>{throw s},0)}},OI=Rc(pi(`${Sm}/add`),{withTypes:()=>OI}),C7=pi(`${Sm}/removeAll`),zI=Rc(pi(`${Sm}/remove`),{withTypes:()=>zI}),_7=(...e)=>{console.error(`${Sm}/error`,...e)},Np=(e={})=>{const t=new Map,r=new Map,s=m=>{const g=r.get(m)??0;r.set(m,g+1)},i=m=>{const g=r.get(m)??1;g===1?r.delete(m):r.set(m,g-1)},{extra:a,onError:o=_7}=e;Vb(o);const l=m=>(m.unsubscribe=()=>t.delete(m.id),t.set(m.id,m),g=>{m.unsubscribe(),g!=null&&g.cancelActive&&f0(m)}),c=m=>{const g=fk(t,m)??RI(m);return l(g)};Rc(c,{withTypes:()=>c});const u=m=>{const g=fk(t,m);return g&&(g.unsubscribe(),m.cancelActive&&f0(g)),!!g};Rc(u,{withTypes:()=>u});const d=async(m,g,x,y)=>{const v=new AbortController,S=k7(c,v.signal),k=[];try{m.pending.add(v),s(m),await Promise.resolve(m.effect(g,Rc({},x,{getOriginalState:y,condition:(j,_)=>S(j,_).then(Boolean),take:S,delay:II(v.signal),pause:ng(v.signal),extra:a,signal:v.signal,fork:S7(v.signal,k),unsubscribe:m.unsubscribe,subscribe:()=>{t.set(m.id,m)},cancelActiveListeners:()=>{m.pending.forEach((j,_,b)=>{j!==v&&(Ol(j,p0),b.delete(j))})},cancel:()=>{Ol(v,p0),m.pending.delete(v)},throwIfCancelled:()=>{zl(v.signal)}})))}catch(j){j instanceof wm||hk(o,j,{raisedBy:"effect"})}finally{await Promise.all(k),Ol(v,j7),i(m),m.pending.delete(v)}},f=N7(t,r);return{middleware:m=>g=>x=>{if(!dI(x))return g(x);if(OI.match(x))return c(x.payload);if(C7.match(x)){f();return}if(zI.match(x))return u(x.payload);let y=m.getState();const v=()=>{if(y===pk)throw new Error(Ks(23));return y};let S;try{if(S=g(x),t.size>0){const k=m.getState(),j=Array.from(t.values());for(const _ of j){let b=!1;try{b=_.predicate(x,k,y)}catch(A){b=!1,hk(o,A,{raisedBy:"predicate"})}b&&d(_,x,m,v)}}}finally{y=pk}return S},startListening:c,stopListening:u,clearListeners:f}};function Ks(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var A7={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},LI=Rs({name:"chartLayout",initialState:A7,reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var r,s,i,a;e.margin.top=(r=t.payload.top)!==null&&r!==void 0?r:0,e.margin.right=(s=t.payload.right)!==null&&s!==void 0?s:0,e.margin.bottom=(i=t.payload.bottom)!==null&&i!==void 0?i:0,e.margin.left=(a=t.payload.left)!==null&&a!==void 0?a:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:E7,setLayout:P7,setChartSize:I7,setScale:T7}=LI.actions,R7=LI.reducer;function $I(e,t,r){return Array.isArray(e)&&e&&t+r!==0?e.slice(t,r+1):e}function gk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function kc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gk(Object(r),!0).forEach(function(s){O7(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function O7(e,t,r){return(t=z7(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z7(e){var t=L7(e,"string");return typeof t=="symbol"?t:t+""}function L7(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ar(e,t,r){return Ur(e)||Ur(t)?r:na(t)?ql(e,t,r):typeof t=="function"?t(e):r}var $7=(e,t,r)=>{if(t&&r){var{width:s,height:i}=r,{align:a,verticalAlign:o,layout:l}=t;if((l==="vertical"||l==="horizontal"&&o==="middle")&&a!=="center"&&zt(e[a]))return kc(kc({},e),{},{[a]:e[a]+(s||0)});if((l==="horizontal"||l==="vertical"&&a==="center")&&o!=="middle"&&zt(e[o]))return kc(kc({},e),{},{[o]:e[o]+(i||0)})}return e},Qo=(e,t)=>e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis",DI=(e,t,r,s)=>{if(s)return e.map(l=>l.coordinate);var i,a,o=e.map(l=>(l.coordinate===t&&(i=!0),l.coordinate===r&&(a=!0),l.coordinate));return i||o.push(t),a||o.push(r),o},MI=(e,t,r)=>{if(!e)return null;var{duplicateDomain:s,type:i,range:a,scale:o,realScaleType:l,isCategorical:c,categoricalDomain:u,tickCount:d,ticks:f,niceTicks:h,axisType:m}=e;if(!o)return null;var g=l==="scaleBand"&&o.bandwidth?o.bandwidth()/2:2,x=i==="category"&&o.bandwidth?o.bandwidth()/g:0;if(x=m==="angleAxis"&&a&&a.length>=2?On(a[0]-a[1])*2*x:x,f||h){var y=(f||h||[]).map((v,S)=>{var k=s?s.indexOf(v):v;return{coordinate:o(k)+x,value:v,offset:x,index:S}});return y.filter(v=>!$i(v.coordinate))}return c&&u?u.map((v,S)=>({coordinate:o(v)+x,value:v,index:S,offset:x})):o.ticks&&d!=null?o.ticks(d).map((v,S)=>({coordinate:o(v)+x,value:v,offset:x,index:S})):o.domain().map((v,S)=>({coordinate:o(v)+x,value:s?s[v]:v,index:S,offset:x}))},mk=1e-4,D7=e=>{var t=e.domain();if(!(!t||t.length<=2)){var r=t.length,s=e.range(),i=Math.min(s[0],s[1])-mk,a=Math.max(s[0],s[1])+mk,o=e(t[0]),l=e(t[r-1]);(o<i||o>a||l<i||l>a)&&e.domain([t[0],t[r-1]])}},M7=(e,t)=>{if(!t||t.length!==2||!zt(t[0])||!zt(t[1]))return e;var r=Math.min(t[0],t[1]),s=Math.max(t[0],t[1]),i=[e[0],e[1]];return(!zt(e[0])||e[0]<r)&&(i[0]=r),(!zt(e[1])||e[1]>s)&&(i[1]=s),i[0]>s&&(i[0]=s),i[1]<r&&(i[1]=r),i},B7=e=>{var t=e.length;if(!(t<=0))for(var r=0,s=e[0].length;r<s;++r)for(var i=0,a=0,o=0;o<t;++o){var l=$i(e[o][r][1])?e[o][r][0]:e[o][r][1];l>=0?(e[o][r][0]=i,e[o][r][1]=i+l,i=e[o][r][1]):(e[o][r][0]=a,e[o][r][1]=a+l,a=e[o][r][1])}},F7=e=>{var t=e.length;if(!(t<=0))for(var r=0,s=e[0].length;r<s;++r)for(var i=0,a=0;a<t;++a){var o=$i(e[a][r][1])?e[a][r][0]:e[a][r][1];o>=0?(e[a][r][0]=i,e[a][r][1]=i+o,i=e[a][r][1]):(e[a][r][0]=0,e[a][r][1]=0)}},W7={sign:B7,expand:jB,none:td,silhouette:wB,wiggle:SB,positive:F7},U7=(e,t,r)=>{var s=W7[r],i=bB().keys(t).value((a,o)=>Number(Ar(a,o,0))).order(r0).offset(s);return i(e)};function H7(e){return e==null?void 0:String(e)}function xk(e){var{axis:t,ticks:r,bandSize:s,entry:i,index:a,dataKey:o}=e;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Ur(i[t.dataKey])){var l=EP(r,"value",i[t.dataKey]);if(l)return l.coordinate+s/2}return r[a]?r[a].coordinate+s/2:null}var c=Ar(i,Ur(o)?t.dataKey:o);return Ur(c)?null:t.scale(c)}var yk=e=>{var{axis:t,ticks:r,offset:s,bandSize:i,entry:a,index:o}=e;if(t.type==="category")return r[o]?r[o].coordinate+s:null;var l=Ar(a,t.dataKey,t.scale.domain()[o]);return Ur(l)?null:t.scale(l)-i/2+s},Y7=e=>{var{numericAxis:t}=e,r=t.scale.domain();if(t.type==="number"){var s=Math.min(r[0],r[1]),i=Math.max(r[0],r[1]);return s<=0&&i>=0?0:i<0?i:s}return r[0]},K7=e=>{var t=e.flat(2).filter(zt);return[Math.min(...t),Math.max(...t)]},V7=e=>[e[0]===1/0?0:e[0],e[1]===-1/0?0:e[1]],q7=(e,t,r)=>{if(e!=null)return V7(Object.keys(e).reduce((s,i)=>{var a=e[i],{stackedData:o}=a,l=o.reduce((c,u)=>{var d=$I(u,t,r),f=K7(d);return[Math.min(c[0],f[0]),Math.max(c[1],f[1])]},[1/0,-1/0]);return[Math.min(l[0],s[0]),Math.max(l[1],s[1])]},[1/0,-1/0]))},vk=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,bk=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,id=(e,t,r)=>{if(e&&e.scale&&e.scale.bandwidth){var s=e.scale.bandwidth();if(!r||s>0)return s}if(e&&t&&t.length>=2){for(var i=gm(t,d=>d.coordinate),a=1/0,o=1,l=i.length;o<l;o++){var c=i[o],u=i[o-1];a=Math.min((c.coordinate||0)-(u.coordinate||0),a)}return a===1/0?0:a}return r?void 0:0};function jk(e){var{tooltipEntrySettings:t,dataKey:r,payload:s,value:i,name:a}=e;return kc(kc({},t),{},{dataKey:r,payload:s,value:i,name:a})}function Sd(e,t){if(e)return String(e);if(typeof t=="string")return t}var G7=(e,t)=>{if(t==="horizontal")return e.chartX;if(t==="vertical")return e.chartY},X7=(e,t)=>t==="centric"?e.angle:e.radius,qa=e=>e.layout.width,Ga=e=>e.layout.height,Q7=e=>e.layout.scale,BI=e=>e.layout.margin,km=ze(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),Nm=ze(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),FI="data-recharts-item-index",WI="data-recharts-item-data-key",Cp=60;function wk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Nf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wk(Object(r),!0).forEach(function(s){J7(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function J7(e,t,r){return(t=Z7(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z7(e){var t=eF(e,"string");return typeof t=="symbol"?t:t+""}function eF(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var tF=e=>e.brush.height;function rF(e){var t=Nm(e);return t.reduce((r,s)=>{if(s.orientation==="left"&&!s.mirror&&!s.hide){var i=typeof s.width=="number"?s.width:Cp;return r+i}return r},0)}function nF(e){var t=Nm(e);return t.reduce((r,s)=>{if(s.orientation==="right"&&!s.mirror&&!s.hide){var i=typeof s.width=="number"?s.width:Cp;return r+i}return r},0)}function sF(e){var t=km(e);return t.reduce((r,s)=>s.orientation==="top"&&!s.mirror&&!s.hide?r+s.height:r,0)}function iF(e){var t=km(e);return t.reduce((r,s)=>s.orientation==="bottom"&&!s.mirror&&!s.hide?r+s.height:r,0)}var kn=ze([qa,Ga,BI,tF,rF,nF,sF,iF,aI,P9],(e,t,r,s,i,a,o,l,c,u)=>{var d={left:(r.left||0)+i,right:(r.right||0)+a},f={top:(r.top||0)+o,bottom:(r.bottom||0)+l},h=Nf(Nf({},f),d),m=h.bottom;h.bottom+=s,h=$7(h,c,u);var g=e-h.left-h.right,x=t-h.top-h.bottom;return Nf(Nf({brushBottom:m},h),{},{width:Math.max(g,0),height:Math.max(x,0)})}),aF=ze(kn,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),qb=ze(qa,Ga,(e,t)=>({x:0,y:0,width:e,height:t})),oF=p.createContext(null),ss=()=>p.useContext(oF)!=null,Cm=e=>e.brush,_m=ze([Cm,kn,BI],(e,t,r)=>({height:e.height,x:zt(e.x)?e.x:t.left,y:zt(e.y)?e.y:t.top+t.height+t.brushBottom-((r==null?void 0:r.bottom)||0),width:zt(e.width)?e.width:t.width})),UI={},HI={},YI={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r,s,{signal:i,edges:a}={}){let o,l=null;const c=a!=null&&a.includes("leading"),u=a==null||a.includes("trailing"),d=()=>{l!==null&&(r.apply(o,l),o=void 0,l=null)},f=()=>{u&&d(),x()};let h=null;const m=()=>{h!=null&&clearTimeout(h),h=setTimeout(()=>{h=null,f()},s)},g=()=>{h!==null&&(clearTimeout(h),h=null)},x=()=>{g(),o=void 0,l=null},y=()=>{d()},v=function(...S){if(i!=null&&i.aborted)return;o=this,l=S;const k=h==null;m(),c&&k&&d()};return v.schedule=m,v.cancel=x,v.flush=y,i==null||i.addEventListener("abort",x,{once:!0}),v}e.debounce=t})(YI);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=YI;function r(s,i=0,a={}){typeof a!="object"&&(a={});const{leading:o=!1,trailing:l=!0,maxWait:c}=a,u=Array(2);o&&(u[0]="leading"),l&&(u[1]="trailing");let d,f=null;const h=t.debounce(function(...x){d=s.apply(this,x),f=null},i,{edges:u}),m=function(...x){return c!=null&&(f===null&&(f=Date.now()),Date.now()-f>=c)?(d=s.apply(this,x),f=Date.now(),h.cancel(),h.schedule(),d):(h.apply(this,x),d)},g=()=>(h.flush(),d);return m.cancel=h.cancel,m.flush=g,m}e.debounce=r})(HI);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=HI;function r(s,i=0,a={}){const{leading:o=!0,trailing:l=!0}=a;return t.debounce(s,i,{leading:o,maxWait:i,trailing:l})}e.throttle=r})(UI);var lF=UI.throttle;const cF=Ya(lF);var sg=function(t,r){for(var s=arguments.length,i=new Array(s>2?s-2:0),a=2;a<s;a++)i[a-2]=arguments[a];if(typeof console<"u"&&console.warn&&(r===void 0&&console.warn("LogUtils requires an error message argument"),!t))if(r===void 0)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var o=0;console.warn(r.replace(/%s/g,()=>i[o++]))}},KI=(e,t,r)=>{var{width:s="100%",height:i="100%",aspect:a,maxHeight:o}=r,l=Da(s)?e:Number(s),c=Da(i)?t:Number(i);return a&&a>0&&(l?c=l/a:c&&(l=c*a),o&&c!=null&&c>o&&(c=o)),{calculatedWidth:l,calculatedHeight:c}},dF={width:0,height:0,overflow:"visible"},uF={width:0,overflowX:"visible"},pF={height:0,overflowY:"visible"},fF={},hF=e=>{var{width:t,height:r}=e,s=Da(t),i=Da(r);return s&&i?dF:s?uF:i?pF:fF};function gF(e){var{width:t,height:r,aspect:s}=e,i=t,a=r;return i===void 0&&a===void 0?(i="100%",a="100%"):i===void 0?i=s&&s>0?void 0:"100%":a===void 0&&(a=s&&s>0?void 0:"100%"),{width:i,height:a}}function nn(e){return Number.isFinite(e)}function sa(e){return typeof e=="number"&&e>0&&Number.isFinite(e)}function h0(){return h0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},h0.apply(null,arguments)}function Sk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function kk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Sk(Object(r),!0).forEach(function(s){mF(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function mF(e,t,r){return(t=xF(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xF(e){var t=yF(e,"string");return typeof t=="symbol"?t:t+""}function yF(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var VI=p.createContext({width:-1,height:-1});function vF(e){return sa(e.width)&&sa(e.height)}function qI(e){var{children:t,width:r,height:s}=e,i=p.useMemo(()=>({width:r,height:s}),[r,s]);return vF(i)?p.createElement(VI.Provider,{value:i},t):null}var Gb=()=>p.useContext(VI),bF=p.forwardRef((e,t)=>{var{aspect:r,initialDimension:s={width:-1,height:-1},width:i,height:a,minWidth:o=0,minHeight:l,maxHeight:c,children:u,debounce:d=0,id:f,className:h,onResize:m,style:g={}}=e,x=p.useRef(null),y=p.useRef();y.current=m,p.useImperativeHandle(t,()=>x.current);var[v,S]=p.useState({containerWidth:s.width,containerHeight:s.height}),k=p.useCallback((z,D)=>{S(w=>{var N=Math.round(z),$=Math.round(D);return w.containerWidth===N&&w.containerHeight===$?w:{containerWidth:N,containerHeight:$}})},[]);p.useEffect(()=>{if(x.current==null||typeof ResizeObserver>"u")return jp;var z=$=>{var E,{width:q,height:L}=$[0].contentRect;k(q,L),(E=y.current)===null||E===void 0||E.call(y,q,L)};d>0&&(z=cF(z,d,{trailing:!0,leading:!1}));var D=new ResizeObserver(z),{width:w,height:N}=x.current.getBoundingClientRect();return k(w,N),D.observe(x.current),()=>{D.disconnect()}},[k,d]);var{containerWidth:j,containerHeight:_}=v;sg(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:b,calculatedHeight:A}=KI(j,_,{width:i,height:a,aspect:r,maxHeight:c});return sg(b!=null&&b>0||A!=null&&A>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,b,A,i,a,o,l,r),p.createElement("div",{id:f?"".concat(f):void 0,className:vr("recharts-responsive-container",h),style:kk(kk({},g),{},{width:i,height:a,minWidth:o,minHeight:l,maxHeight:c}),ref:x},p.createElement("div",{style:hF({width:i,height:a})},p.createElement(qI,{width:b,height:A},u)))}),Gl=p.forwardRef((e,t)=>{var r=Gb();if(sa(r.width)&&sa(r.height))return e.children;var{width:s,height:i}=gF({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:a,calculatedHeight:o}=KI(void 0,void 0,{width:s,height:i,aspect:e.aspect,maxHeight:e.maxHeight});return zt(a)&&zt(o)?p.createElement(qI,{width:a,height:o},e.children):p.createElement(bF,h0({},e,{width:s,height:i,ref:t}))});function GI(e){if(e)return{x:e.x,y:e.y,upperWidth:"upperWidth"in e?e.upperWidth:e.width,lowerWidth:"lowerWidth"in e?e.lowerWidth:e.width,width:e.width,height:e.height}}var Am=()=>{var e,t=ss(),r=It(aF),s=It(_m),i=(e=It(Cm))===null||e===void 0?void 0:e.padding;return!t||!s||!i?r:{width:s.width-i.left-i.right,height:s.height-i.top-i.bottom,x:i.left,y:i.top}},jF={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},XI=()=>{var e;return(e=It(kn))!==null&&e!==void 0?e:jF},Xb=()=>It(qa),Qb=()=>It(Ga),wF=()=>It(e=>e.layout.margin),gr=e=>e.layout.layoutType,_p=()=>It(gr),SF=()=>{var e=_p();return e!==void 0},Em=e=>{var t=Rr(),r=ss(),{width:s,height:i}=e,a=Gb(),o=s,l=i;return a&&(o=a.width>0?a.width:s,l=a.height>0?a.height:i),p.useEffect(()=>{!r&&sa(o)&&sa(l)&&t(I7({width:o,height:l}))},[t,r,o,l]),null},QI=Symbol.for("immer-nothing"),Nk=Symbol.for("immer-draftable"),Gs=Symbol.for("immer-state");function Pi(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Yu=Object.getPrototypeOf;function ad(e){return!!e&&!!e[Gs]}function Xl(e){var t;return e?JI(e)||Array.isArray(e)||!!e[Nk]||!!((t=e.constructor)!=null&&t[Nk])||Ap(e)||Im(e):!1}var kF=Object.prototype.constructor.toString(),Ck=new WeakMap;function JI(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);if(t===null||t===Object.prototype)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(r===Object)return!0;if(typeof r!="function")return!1;let s=Ck.get(r);return s===void 0&&(s=Function.toString.call(r),Ck.set(r,s)),s===kF}function ig(e,t,r=!0){Pm(e)===0?(r?Reflect.ownKeys(e):Object.keys(e)).forEach(i=>{t(i,e[i],e)}):e.forEach((s,i)=>t(i,s,e))}function Pm(e){const t=e[Gs];return t?t.type_:Array.isArray(e)?1:Ap(e)?2:Im(e)?3:0}function g0(e,t){return Pm(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ZI(e,t,r){const s=Pm(e);s===2?e.set(t,r):s===3?e.add(r):e[t]=r}function NF(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Ap(e){return e instanceof Map}function Im(e){return e instanceof Set}function dl(e){return e.copy_||e.base_}function m0(e,t){if(Ap(e))return new Map(e);if(Im(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=JI(e);if(t===!0||t==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(e);delete s[Gs];let i=Reflect.ownKeys(s);for(let a=0;a<i.length;a++){const o=i[a],l=s[o];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(s[o]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[o]})}return Object.create(Yu(e),s)}else{const s=Yu(e);if(s!==null&&r)return{...e};const i=Object.create(s);return Object.assign(i,e)}}function Jb(e,t=!1){return Tm(e)||ad(e)||!Xl(e)||(Pm(e)>1&&Object.defineProperties(e,{set:Cf,add:Cf,clear:Cf,delete:Cf}),Object.freeze(e),t&&Object.values(e).forEach(r=>Jb(r,!0))),e}function CF(){Pi(2)}var Cf={value:CF};function Tm(e){return e===null||typeof e!="object"?!0:Object.isFrozen(e)}var _F={};function Ql(e){const t=_F[e];return t||Pi(0,e),t}var Ku;function e6(){return Ku}function AF(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function _k(e,t){t&&(Ql("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function x0(e){y0(e),e.drafts_.forEach(EF),e.drafts_=null}function y0(e){e===Ku&&(Ku=e.parent_)}function Ak(e){return Ku=AF(Ku,e)}function EF(e){const t=e[Gs];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Ek(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[Gs].modified_&&(x0(t),Pi(4)),Xl(e)&&(e=ag(t,e),t.parent_||og(t,e)),t.patches_&&Ql("Patches").generateReplacementPatches_(r[Gs].base_,e,t.patches_,t.inversePatches_)):e=ag(t,r,[]),x0(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==QI?e:void 0}function ag(e,t,r){if(Tm(t))return t;const s=e.immer_.shouldUseStrictIteration(),i=t[Gs];if(!i)return ig(t,(a,o)=>Pk(e,i,t,a,o,r),s),t;if(i.scope_!==e)return t;if(!i.modified_)return og(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const a=i.copy_;let o=a,l=!1;i.type_===3&&(o=new Set(a),a.clear(),l=!0),ig(o,(c,u)=>Pk(e,i,a,c,u,r,l),s),og(e,a,!1),r&&e.patches_&&Ql("Patches").generatePatches_(i,r,e.patches_,e.inversePatches_)}return i.copy_}function Pk(e,t,r,s,i,a,o){if(i==null||typeof i!="object"&&!o)return;const l=Tm(i);if(!(l&&!o)){if(ad(i)){const c=a&&t&&t.type_!==3&&!g0(t.assigned_,s)?a.concat(s):void 0,u=ag(e,i,c);if(ZI(r,s,u),ad(u))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(Xl(i)&&!l){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[s]===i&&l)return;ag(e,i),(!t||!t.scope_.parent_)&&typeof s!="symbol"&&(Ap(r)?r.has(s):Object.prototype.propertyIsEnumerable.call(r,s))&&og(e,i)}}}function og(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Jb(t,r)}function PF(e,t){const r=Array.isArray(e),s={type_:r?1:0,scope_:t?t.scope_:e6(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=s,a=Zb;r&&(i=[s],a=Vu);const{revoke:o,proxy:l}=Proxy.revocable(i,a);return s.draft_=l,s.revoke_=o,l}var Zb={get(e,t){if(t===Gs)return e;const r=dl(e);if(!g0(r,t))return IF(e,r,t);const s=r[t];return e.finalized_||!Xl(s)?s:s===ny(e.base_,t)?(sy(e),e.copy_[t]=b0(s,e)):s},has(e,t){return t in dl(e)},ownKeys(e){return Reflect.ownKeys(dl(e))},set(e,t,r){const s=t6(dl(e),t);if(s!=null&&s.set)return s.set.call(e.draft_,r),!0;if(!e.modified_){const i=ny(dl(e),t),a=i==null?void 0:i[Gs];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(NF(r,i)&&(r!==void 0||g0(e.base_,t)))return!0;sy(e),v0(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ny(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,sy(e),v0(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=dl(e),s=Reflect.getOwnPropertyDescriptor(r,t);return s&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:s.enumerable,value:r[t]}},defineProperty(){Pi(11)},getPrototypeOf(e){return Yu(e.base_)},setPrototypeOf(){Pi(12)}},Vu={};ig(Zb,(e,t)=>{Vu[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Vu.deleteProperty=function(e,t){return Vu.set.call(this,e,t,void 0)};Vu.set=function(e,t,r){return Zb.set.call(this,e[0],t,r,e[0])};function ny(e,t){const r=e[Gs];return(r?dl(r):e)[t]}function IF(e,t,r){var i;const s=t6(t,r);return s?"value"in s?s.value:(i=s.get)==null?void 0:i.call(e.draft_):void 0}function t6(e,t){if(!(t in e))return;let r=Yu(e);for(;r;){const s=Object.getOwnPropertyDescriptor(r,t);if(s)return s;r=Yu(r)}}function v0(e){e.modified_||(e.modified_=!0,e.parent_&&v0(e.parent_))}function sy(e){e.copy_||(e.copy_=m0(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var TF=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(t,r,s)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const o=this;return function(c=a,...u){return o.produce(c,d=>r.call(this,d,...u))}}typeof r!="function"&&Pi(6),s!==void 0&&typeof s!="function"&&Pi(7);let i;if(Xl(t)){const a=Ak(this),o=b0(t,void 0);let l=!0;try{i=r(o),l=!1}finally{l?x0(a):y0(a)}return _k(a,s),Ek(i,a)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===QI&&(i=void 0),this.autoFreeze_&&Jb(i,!0),s){const a=[],o=[];Ql("Patches").generateReplacementPatches_(t,i,a,o),s(a,o)}return i}else Pi(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...l)=>this.produceWithPatches(o,c=>t(c,...l));let s,i;return[this.produce(t,r,(o,l)=>{s=o,i=l}),s,i]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),typeof(e==null?void 0:e.useStrictIteration)=="boolean"&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){Xl(e)||Pi(8),ad(e)&&(e=RF(e));const t=Ak(this),r=b0(e,void 0);return r[Gs].isManual_=!0,y0(t),r}finishDraft(e,t){const r=e&&e[Gs];(!r||!r.isManual_)&&Pi(9);const{scope_:s}=r;return _k(s,t),Ek(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));const s=Ql("Patches").applyPatches_;return ad(e)?s(e,t):this.produce(e,i=>s(i,t))}};function b0(e,t){const r=Ap(e)?Ql("MapSet").proxyMap_(e,t):Im(e)?Ql("MapSet").proxySet_(e,t):PF(e,t);return(t?t.scope_:e6()).drafts_.push(r),r}function RF(e){return ad(e)||Pi(10,e),r6(e)}function r6(e){if(!Xl(e)||Tm(e))return e;const t=e[Gs];let r,s=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=m0(e,t.scope_.immer_.useStrictShallowCopy_),s=t.scope_.immer_.shouldUseStrictIteration()}else r=m0(e,!0);return ig(r,(i,a)=>{ZI(r,i,r6(a))},s),t&&(t.finalized_=!1),r}var OF=new TF;OF.produce;var zF={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},n6=Rs({name:"legend",initialState:zF,reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:Mr()},replaceLegendPayload:{reducer(e,t){var{prev:r,next:s}=t.payload,i=Oi(e).payload.indexOf(r);i>-1&&(e.payload[i]=s)},prepare:Mr()},removeLegendPayload:{reducer(e,t){var r=Oi(e).payload.indexOf(t.payload);r>-1&&e.payload.splice(r,1)},prepare:Mr()}}}),{setLegendSize:Ik,setLegendSettings:LF,addLegendPayload:s6,replaceLegendPayload:i6,removeLegendPayload:a6}=n6.actions,$F=n6.reducer,DF=["contextPayload"];function j0(){return j0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},j0.apply(null,arguments)}function Tk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function od(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Tk(Object(r),!0).forEach(function(s){MF(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function MF(e,t,r){return(t=BF(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BF(e){var t=FF(e,"string");return typeof t=="symbol"?t:t+""}function FF(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function WF(e,t){if(e==null)return{};var r,s,i=UF(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function UF(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function HF(e){return e.value}function YF(e){var{contextPayload:t}=e,r=WF(e,DF),s=GP(t,e.payloadUniqBy,HF),i=od(od({},r),{},{payload:s});return p.isValidElement(e.content)?p.cloneElement(e.content,i):typeof e.content=="function"?p.createElement(e.content,i):p.createElement(GB,i)}function KF(e,t,r,s,i,a){var{layout:o,align:l,verticalAlign:c}=t,u,d;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(l==="center"&&o==="vertical"?u={left:((s||0)-a.width)/2}:u=l==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(c==="middle"?d={top:((i||0)-a.height)/2}:d=c==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),od(od({},u),d)}function VF(e){var t=Rr();return p.useEffect(()=>{t(LF(e))},[t,e]),null}function qF(e){var t=Rr();return p.useEffect(()=>(t(Ik(e)),()=>{t(Ik({width:0,height:0}))}),[t,e]),null}function GF(e,t,r,s){return e==="vertical"&&zt(t)?{height:t}:e==="horizontal"?{width:r||s}:null}var XF={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function o6(e){var t=hn(e,XF),r=R9(),s=HM(),i=wF(),{width:a,height:o,wrapperStyle:l,portal:c}=t,[u,d]=oI([r]),f=Xb(),h=Qb();if(f==null||h==null)return null;var m=f-((i==null?void 0:i.left)||0)-((i==null?void 0:i.right)||0),g=GF(t.layout,o,a,m),x=c?l:od(od({position:"absolute",width:(g==null?void 0:g.width)||a||"auto",height:(g==null?void 0:g.height)||o||"auto"},KF(l,t,i,f,h,u)),l),y=c??s;if(y==null||r==null)return null;var v=p.createElement("div",{className:"recharts-legend-wrapper",style:x,ref:d},p.createElement(VF,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!c&&p.createElement(qF,{width:u.width,height:u.height}),p.createElement(YF,j0({},t,g,{margin:i,chartWidth:f,chartHeight:h,contextPayload:r})));return Qi.createPortal(v,y)}o6.displayName="Legend";function w0(){return w0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},w0.apply(null,arguments)}function Rk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function iy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rk(Object(r),!0).forEach(function(s){QF(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function QF(e,t,r){return(t=JF(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JF(e){var t=ZF(e,"string");return typeof t=="symbol"?t:t+""}function ZF(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eW(e){return Array.isArray(e)&&na(e[0])&&na(e[1])?e.join(" ~ "):e}var tW=e=>{var{separator:t=" : ",contentStyle:r={},itemStyle:s={},labelStyle:i={},payload:a,formatter:o,itemSorter:l,wrapperClassName:c,labelClassName:u,label:d,labelFormatter:f,accessibilityLayer:h=!1}=e,m=()=>{if(a&&a.length){var _={padding:0,margin:0},b=(l?gm(a,l):a).map((A,z)=>{if(A.type==="none")return null;var D=A.formatter||o||eW,{value:w,name:N}=A,$=w,E=N;if(D){var q=D(w,N,A,z,a);if(Array.isArray(q))[$,E]=q;else if(q!=null)$=q;else return null}var L=iy({display:"block",paddingTop:4,paddingBottom:4,color:A.color||"#000"},s);return p.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(z),style:L},na(E)?p.createElement("span",{className:"recharts-tooltip-item-name"},E):null,na(E)?p.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,p.createElement("span",{className:"recharts-tooltip-item-value"},$),p.createElement("span",{className:"recharts-tooltip-item-unit"},A.unit||""))});return p.createElement("ul",{className:"recharts-tooltip-item-list",style:_},b)}return null},g=iy({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),x=iy({margin:0},i),y=!Ur(d),v=y?d:"",S=vr("recharts-default-tooltip",c),k=vr("recharts-tooltip-label",u);y&&f&&a!==void 0&&a!==null&&(v=f(d,a));var j=h?{role:"status","aria-live":"assertive"}:{};return p.createElement("div",w0({className:S,style:g},j),p.createElement("p",{className:k,style:x},p.isValidElement(v)?v:"".concat(v)),m())},Yd="recharts-tooltip-wrapper",rW={visibility:"hidden"};function nW(e){var{coordinate:t,translateX:r,translateY:s}=e;return vr(Yd,{["".concat(Yd,"-right")]:zt(r)&&t&&zt(t.x)&&r>=t.x,["".concat(Yd,"-left")]:zt(r)&&t&&zt(t.x)&&r<t.x,["".concat(Yd,"-bottom")]:zt(s)&&t&&zt(t.y)&&s>=t.y,["".concat(Yd,"-top")]:zt(s)&&t&&zt(t.y)&&s<t.y})}function Ok(e){var{allowEscapeViewBox:t,coordinate:r,key:s,offsetTopLeft:i,position:a,reverseDirection:o,tooltipDimension:l,viewBox:c,viewBoxDimension:u}=e;if(a&&zt(a[s]))return a[s];var d=r[s]-l-(i>0?i:0),f=r[s]+i;if(t[s])return o[s]?d:f;var h=c[s];if(h==null)return 0;if(o[s]){var m=d,g=h;return m<g?Math.max(f,h):Math.max(d,h)}if(u==null)return 0;var x=f+l,y=h+u;return x>y?Math.max(d,h):Math.max(f,h)}function sW(e){var{translateX:t,translateY:r,useTranslate3d:s}=e;return{transform:s?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function iW(e){var{allowEscapeViewBox:t,coordinate:r,offsetTopLeft:s,position:i,reverseDirection:a,tooltipBox:o,useTranslate3d:l,viewBox:c}=e,u,d,f;return o.height>0&&o.width>0&&r?(d=Ok({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:s,position:i,reverseDirection:a,tooltipDimension:o.width,viewBox:c,viewBoxDimension:c.width}),f=Ok({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:s,position:i,reverseDirection:a,tooltipDimension:o.height,viewBox:c,viewBoxDimension:c.height}),u=sW({translateX:d,translateY:f,useTranslate3d:l})):u=rW,{cssProperties:u,cssClasses:nW({translateX:d,translateY:f,coordinate:r})}}function zk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function _f(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zk(Object(r),!0).forEach(function(s){S0(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function S0(e,t,r){return(t=aW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aW(e){var t=oW(e,"string");return typeof t=="symbol"?t:t+""}function oW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class lW extends p.PureComponent{constructor(){super(...arguments),S0(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),S0(this,"handleKeyDown",t=>{if(t.key==="Escape"){var r,s,i,a;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(r=(s=this.props.coordinate)===null||s===void 0?void 0:s.x)!==null&&r!==void 0?r:0,y:(i=(a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==null&&i!==void 0?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var t,r;this.state.dismissed&&(((t=this.props.coordinate)===null||t===void 0?void 0:t.x)!==this.state.dismissedAtCoordinate.x||((r=this.props.coordinate)===null||r===void 0?void 0:r.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:t,allowEscapeViewBox:r,animationDuration:s,animationEasing:i,children:a,coordinate:o,hasPayload:l,isAnimationActive:c,offset:u,position:d,reverseDirection:f,useTranslate3d:h,viewBox:m,wrapperStyle:g,lastBoundingBox:x,innerRef:y,hasPortalFromProps:v}=this.props,{cssClasses:S,cssProperties:k}=iW({allowEscapeViewBox:r,coordinate:o,offsetTopLeft:u,position:d,reverseDirection:f,tooltipBox:{height:x.height,width:x.width},useTranslate3d:h,viewBox:m}),j=v?{}:_f(_f({transition:c&&t?"transform ".concat(s,"ms ").concat(i):void 0},k),{},{pointerEvents:"none",visibility:!this.state.dismissed&&t&&l?"visible":"hidden",position:"absolute",top:0,left:0}),_=_f(_f({},j),{},{visibility:!this.state.dismissed&&t&&l?"visible":"hidden"},g);return p.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:S,style:_,ref:y},a)}}var l6=()=>{var e;return(e=It(t=>t.rootProps.accessibilityLayer))!==null&&e!==void 0?e:!0};function k0(){return k0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},k0.apply(null,arguments)}function Lk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function $k(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lk(Object(r),!0).forEach(function(s){cW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function cW(e,t,r){return(t=dW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dW(e){var t=uW(e,"string");return typeof t=="symbol"?t:t+""}function uW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dk={curveBasisClosed:cB,curveBasisOpen:dB,curveBasis:lB,curveBumpX:qM,curveBumpY:GM,curveLinearClosed:uB,curveLinear:lm,curveMonotoneX:pB,curveMonotoneY:fB,curveNatural:hB,curveStep:gB,curveStepAfter:xB,curveStepBefore:mB},lg=e=>nn(e.x)&&nn(e.y),Mk=e=>e.base!=null&&lg(e.base)&&lg(e),Kd=e=>e.x,Vd=e=>e.y,pW=(e,t)=>{if(typeof e=="function")return e;var r="curve".concat(bp(e));return(r==="curveMonotone"||r==="curveBump")&&t?Dk["".concat(r).concat(t==="vertical"?"Y":"X")]:Dk[r]||lm},fW=e=>{var{type:t="linear",points:r=[],baseLine:s,layout:i,connectNulls:a=!1}=e,o=pW(t,i),l=a?r.filter(lg):r,c;if(Array.isArray(s)){var u=r.map((m,g)=>$k($k({},m),{},{base:s[g]}));i==="vertical"?c=vf().y(Vd).x1(Kd).x0(m=>m.base.x):c=vf().x(Kd).y1(Vd).y0(m=>m.base.y);var d=c.defined(Mk).curve(o),f=a?u.filter(Mk):u;return d(f)}i==="vertical"&&zt(s)?c=vf().y(Vd).x1(Kd).x0(s):zt(s)?c=vf().x(Kd).y1(Vd).y0(s):c=gP().x(Kd).y(Vd);var h=c.defined(lg).curve(o);return h(l)},ej=e=>{var{className:t,points:r,path:s,pathRef:i}=e;if((!r||!r.length)&&!s)return null;var a=r&&r.length?fW(e):s;return p.createElement("path",k0({},qs(e),_b(e),{className:vr("recharts-curve",t),d:a===null?void 0:a,ref:i}))},hW=["x","y","top","left","width","height","className"];function N0(){return N0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},N0.apply(null,arguments)}function Bk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function gW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Bk(Object(r),!0).forEach(function(s){mW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function mW(e,t,r){return(t=xW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xW(e){var t=yW(e,"string");return typeof t=="symbol"?t:t+""}function yW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vW(e,t){if(e==null)return{};var r,s,i=bW(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function bW(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var jW=(e,t,r,s,i,a)=>"M".concat(e,",").concat(i,"v").concat(s,"M").concat(a,",").concat(t,"h").concat(r),wW=e=>{var{x:t=0,y:r=0,top:s=0,left:i=0,width:a=0,height:o=0,className:l}=e,c=vW(e,hW),u=gW({x:t,y:r,top:s,left:i,width:a,height:o},c);return!zt(t)||!zt(r)||!zt(a)||!zt(o)||!zt(s)||!zt(i)?null:p.createElement("path",N0({},hs(u),{className:vr("recharts-cross",l),d:jW(t,r,a,o,s,i)}))};function SW(e,t,r,s){var i=s/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-i:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-i,width:e==="horizontal"?s:r.width-1,height:e==="horizontal"?r.height-1:s}}function Fk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Wk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fk(Object(r),!0).forEach(function(s){kW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function kW(e,t,r){return(t=NW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NW(e){var t=CW(e,"string");return typeof t=="symbol"?t:t+""}function CW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _W=e=>e.replace(/([A-Z])/g,t=>"-".concat(t.toLowerCase())),c6=(e,t,r)=>e.map(s=>"".concat(_W(s)," ").concat(t,"ms ").concat(r)).join(","),AW=(e,t)=>[Object.keys(e),Object.keys(t)].reduce((r,s)=>r.filter(i=>s.includes(i))),qu=(e,t)=>Object.keys(t).reduce((r,s)=>Wk(Wk({},r),{},{[s]:e(s,t[s])}),{});function Uk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function bn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Uk(Object(r),!0).forEach(function(s){EW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function EW(e,t,r){return(t=PW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PW(e){var t=IW(e,"string");return typeof t=="symbol"?t:t+""}function IW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var cg=(e,t,r)=>e+(t-e)*r,C0=e=>{var{from:t,to:r}=e;return t!==r},d6=(e,t,r)=>{var s=qu((i,a)=>{if(C0(a)){var[o,l]=e(a.from,a.to,a.velocity);return bn(bn({},a),{},{from:o,velocity:l})}return a},t);return r<1?qu((i,a)=>C0(a)?bn(bn({},a),{},{velocity:cg(a.velocity,s[i].velocity,r),from:cg(a.from,s[i].from,r)}):a,t):d6(e,s,r-1)};function TW(e,t,r,s,i,a){var o,l=s.reduce((h,m)=>bn(bn({},h),{},{[m]:{from:e[m],velocity:0,to:t[m]}}),{}),c=()=>qu((h,m)=>m.from,l),u=()=>!Object.values(l).filter(C0).length,d=null,f=h=>{o||(o=h);var m=h-o,g=m/r.dt;l=d6(r,l,g),i(bn(bn(bn({},e),t),c())),o=h,u()||(d=a.setTimeout(f))};return()=>(d=a.setTimeout(f),()=>{var h;(h=d)===null||h===void 0||h()})}function RW(e,t,r,s,i,a,o){var l=null,c=i.reduce((f,h)=>bn(bn({},f),{},{[h]:[e[h],t[h]]}),{}),u,d=f=>{u||(u=f);var h=(f-u)/s,m=qu((x,y)=>cg(...y,r(h)),c);if(a(bn(bn(bn({},e),t),m)),h<1)l=o.setTimeout(d);else{var g=qu((x,y)=>cg(...y,r(1)),c);a(bn(bn(bn({},e),t),g))}};return()=>(l=o.setTimeout(d),()=>{var f;(f=l)===null||f===void 0||f()})}const OW=(e,t,r,s,i,a)=>{var o=AW(e,t);return r==null?()=>(i(bn(bn({},e),t)),()=>{}):r.isStepper===!0?TW(e,t,r,o,i,a):RW(e,t,r,s,o,i,a)};var dg=1e-4,u6=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],p6=(e,t)=>e.map((r,s)=>r*t**s).reduce((r,s)=>r+s),Hk=(e,t)=>r=>{var s=u6(e,t);return p6(s,r)},zW=(e,t)=>r=>{var s=u6(e,t),i=[...s.map((a,o)=>a*o).slice(1),0];return p6(i,r)},LW=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(r.length===1)switch(r[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:{var i,a=r[0].split("(");if(a[0]==="cubic-bezier"&&((i=a[1])===null||i===void 0?void 0:i.split(")")[0].split(",").length)===4){var o=a[1].split(")")[0].split(",").map(l=>parseFloat(l));return[o[0],o[1],o[2],o[3]]}}}return r.length===4?r:[0,0,1,1]},$W=(e,t,r,s)=>{var i=Hk(e,r),a=Hk(t,s),o=zW(e,r),l=u=>u>1?1:u<0?0:u,c=u=>{for(var d=u>1?1:u,f=d,h=0;h<8;++h){var m=i(f)-d,g=o(f);if(Math.abs(m-d)<dg||g<dg)return a(f);f=l(f-m/g)}return a(f)};return c.isStepper=!1,c},Yk=function(){return $W(...LW(...arguments))},DW=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:r=100,damping:s=8,dt:i=17}=t,a=(o,l,c)=>{var u=-(o-l)*r,d=c*s,f=c+(u-d)*i/1e3,h=c*i/1e3+o;return Math.abs(h-l)<dg&&Math.abs(f)<dg?[l,0]:[h,f]};return a.isStepper=!0,a.dt=i,a},MW=e=>{if(typeof e=="string")switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return Yk(e);case"spring":return DW();default:if(e.split("(")[0]==="cubic-bezier")return Yk(e)}return typeof e=="function"?e:null};function BW(e){var t,r=()=>null,s=!1,i=null,a=o=>{if(!s){if(Array.isArray(o)){if(!o.length)return;var l=o,[c,...u]=l;if(typeof c=="number"){i=e.setTimeout(a.bind(null,u),c);return}a(c),i=e.setTimeout(a.bind(null,u));return}typeof o=="string"&&(t=o,r(t)),typeof o=="object"&&(t=o,r(t)),typeof o=="function"&&o()}};return{stop:()=>{s=!0},start:o=>{s=!1,i&&(i(),i=null),a(o)},subscribe:o=>(r=o,()=>{r=()=>null}),getTimeoutController:()=>e}}class FW{setTimeout(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=performance.now(),i=null,a=o=>{o-s>=r?t(o):typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(a))};return i=requestAnimationFrame(a),()=>{i!=null&&cancelAnimationFrame(i)}}}function WW(){return BW(new FW)}var UW=p.createContext(WW);function HW(e,t){var r=p.useContext(UW);return p.useMemo(()=>t??r(e),[e,t,r])}var YW=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),Ep={devToolsEnabled:!1,isSsr:YW()},KW={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},Kk={t:0},ay={t:1};function Pp(e){var t=hn(e,KW),{isActive:r,canBegin:s,duration:i,easing:a,begin:o,onAnimationEnd:l,onAnimationStart:c,children:u}=t,d=r==="auto"?!Ep.isSsr:r,f=HW(t.animationId,t.animationManager),[h,m]=p.useState(d?Kk:ay),g=p.useRef(null);return p.useEffect(()=>{d||m(ay)},[d]),p.useEffect(()=>{if(!d||!s)return jp;var x=OW(Kk,ay,MW(a),i,m,f.getTimeoutController()),y=()=>{g.current=x()};return f.start([c,o,y,i,l]),()=>{f.stop(),g.current&&g.current(),l()}},[d,s,i,a,o,c,l,f]),u(h.t)}function Ip(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",r=p.useRef(Fu(t)),s=p.useRef(e);return s.current!==e&&(r.current=Fu(t),s.current=e),r.current}var VW=["radius"],qW=["radius"];function Vk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function qk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Vk(Object(r),!0).forEach(function(s){GW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function GW(e,t,r){return(t=XW(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XW(e){var t=QW(e,"string");return typeof t=="symbol"?t:t+""}function QW(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ug(){return ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ug.apply(null,arguments)}function Gk(e,t){if(e==null)return{};var r,s,i=JW(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function JW(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var Xk=(e,t,r,s,i)=>{var a=Math.min(Math.abs(r)/2,Math.abs(s)/2),o=s>=0?1:-1,l=r>=0?1:-1,c=s>=0&&r>=0||s<0&&r<0?1:0,u;if(a>0&&i instanceof Array){for(var d=[0,0,0,0],f=0,h=4;f<h;f++)d[f]=i[f]>a?a:i[f];u="M".concat(e,",").concat(t+o*d[0]),d[0]>0&&(u+="A ".concat(d[0],",").concat(d[0],",0,0,").concat(c,",").concat(e+l*d[0],",").concat(t)),u+="L ".concat(e+r-l*d[1],",").concat(t),d[1]>0&&(u+="A ".concat(d[1],",").concat(d[1],",0,0,").concat(c,`,
        `).concat(e+r,",").concat(t+o*d[1])),u+="L ".concat(e+r,",").concat(t+s-o*d[2]),d[2]>0&&(u+="A ".concat(d[2],",").concat(d[2],",0,0,").concat(c,`,
        `).concat(e+r-l*d[2],",").concat(t+s)),u+="L ".concat(e+l*d[3],",").concat(t+s),d[3]>0&&(u+="A ".concat(d[3],",").concat(d[3],",0,0,").concat(c,`,
        `).concat(e,",").concat(t+s-o*d[3])),u+="Z"}else if(a>0&&i===+i&&i>0){var m=Math.min(a,i);u="M ".concat(e,",").concat(t+o*m,`
            A `).concat(m,",").concat(m,",0,0,").concat(c,",").concat(e+l*m,",").concat(t,`
            L `).concat(e+r-l*m,",").concat(t,`
            A `).concat(m,",").concat(m,",0,0,").concat(c,",").concat(e+r,",").concat(t+o*m,`
            L `).concat(e+r,",").concat(t+s-o*m,`
            A `).concat(m,",").concat(m,",0,0,").concat(c,",").concat(e+r-l*m,",").concat(t+s,`
            L `).concat(e+l*m,",").concat(t+s,`
            A `).concat(m,",").concat(m,",0,0,").concat(c,",").concat(e,",").concat(t+s-o*m," Z")}else u="M ".concat(e,",").concat(t," h ").concat(r," v ").concat(s," h ").concat(-r," Z");return u},Qk={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},f6=e=>{var t=hn(e,Qk),r=p.useRef(null),[s,i]=p.useState(-1);p.useEffect(()=>{if(r.current&&r.current.getTotalLength)try{var B=r.current.getTotalLength();B&&i(B)}catch{}},[]);var{x:a,y:o,width:l,height:c,radius:u,className:d}=t,{animationEasing:f,animationDuration:h,animationBegin:m,isAnimationActive:g,isUpdateAnimationActive:x}=t,y=p.useRef(l),v=p.useRef(c),S=p.useRef(a),k=p.useRef(o),j=p.useMemo(()=>({x:a,y:o,width:l,height:c,radius:u}),[a,o,l,c,u]),_=Ip(j,"rectangle-");if(a!==+a||o!==+o||l!==+l||c!==+c||l===0||c===0)return null;var b=vr("recharts-rectangle",d);if(!x){var A=hs(t),{radius:z}=A,D=Gk(A,VW);return p.createElement("path",ug({},D,{radius:typeof u=="number"?u:void 0,className:b,d:Xk(a,o,l,c,u)}))}var w=y.current,N=v.current,$=S.current,E=k.current,q="0px ".concat(s===-1?1:s,"px"),L="".concat(s,"px 0px"),O=c6(["strokeDasharray"],h,typeof f=="string"?f:Qk.animationEasing);return p.createElement(Pp,{animationId:_,key:_,canBegin:s>0,duration:h,easing:f,isActive:x,begin:m},B=>{var I=Br(w,l,B),T=Br(N,c,B),W=Br($,a,B),re=Br(E,o,B);r.current&&(y.current=I,v.current=T,S.current=W,k.current=re);var ae;g?B>0?ae={transition:O,strokeDasharray:L}:ae={strokeDasharray:q}:ae={strokeDasharray:L};var Y=hs(t),{radius:J}=Y,P=Gk(Y,qW);return p.createElement("path",ug({},P,{radius:typeof u=="number"?u:void 0,className:b,d:Xk(W,re,I,T,u),ref:r,style:qk(qk({},ae),t.style)}))})};function Jk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Zk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(r),!0).forEach(function(s){ZW(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jk(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function ZW(e,t,r){return(t=eU(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eU(e){var t=tU(e,"string");return typeof t=="symbol"?t:t+""}function tU(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pg=Math.PI/180,rU=e=>e*180/Math.PI,dn=(e,t,r,s)=>({x:e+Math.cos(-pg*s)*r,y:t+Math.sin(-pg*s)*r}),h6=function(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(s.left||0)-(s.right||0)),Math.abs(r-(s.top||0)-(s.bottom||0)))/2},nU=(e,t)=>{var{x:r,y:s}=e,{x:i,y:a}=t;return Math.sqrt((r-i)**2+(s-a)**2)},sU=(e,t)=>{var{x:r,y:s}=e,{cx:i,cy:a}=t,o=nU({x:r,y:s},{x:i,y:a});if(o<=0)return{radius:o,angle:0};var l=(r-i)/o,c=Math.acos(l);return s>a&&(c=2*Math.PI-c),{radius:o,angle:rU(c),angleInRadian:c}},iU=e=>{var{startAngle:t,endAngle:r}=e,s=Math.floor(t/360),i=Math.floor(r/360),a=Math.min(s,i);return{startAngle:t-a*360,endAngle:r-a*360}},aU=(e,t)=>{var{startAngle:r,endAngle:s}=t,i=Math.floor(r/360),a=Math.floor(s/360),o=Math.min(i,a);return e+o*360},oU=(e,t)=>{var{chartX:r,chartY:s}=e,{radius:i,angle:a}=sU({x:r,y:s},t),{innerRadius:o,outerRadius:l}=t;if(i<o||i>l||i===0)return null;var{startAngle:c,endAngle:u}=iU(t),d=a,f;if(c<=u){for(;d>u;)d-=360;for(;d<c;)d+=360;f=d>=c&&d<=u}else{for(;d>c;)d-=360;for(;d<u;)d+=360;f=d>=u&&d<=c}return f?Zk(Zk({},t),{},{radius:i,angle:aU(d,t)}):null};function g6(e){var{cx:t,cy:r,radius:s,startAngle:i,endAngle:a}=e,o=dn(t,r,s,i),l=dn(t,r,s,a);return{points:[o,l],cx:t,cy:r,radius:s,startAngle:i,endAngle:a}}function _0(){return _0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_0.apply(null,arguments)}var lU=(e,t)=>{var r=On(t-e),s=Math.min(Math.abs(t-e),359.999);return r*s},Af=e=>{var{cx:t,cy:r,radius:s,angle:i,sign:a,isExternal:o,cornerRadius:l,cornerIsExternal:c}=e,u=l*(o?1:-1)+s,d=Math.asin(l/u)/pg,f=c?i:i+a*d,h=dn(t,r,u,f),m=dn(t,r,s,f),g=c?i-a*d:i,x=dn(t,r,u*Math.cos(d*pg),g);return{center:h,circleTangency:m,lineTangency:x,theta:d}},m6=e=>{var{cx:t,cy:r,innerRadius:s,outerRadius:i,startAngle:a,endAngle:o}=e,l=lU(a,o),c=a+l,u=dn(t,r,i,a),d=dn(t,r,i,c),f="M ".concat(u.x,",").concat(u.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(l)>180),",").concat(+(a>c),`,
    `).concat(d.x,",").concat(d.y,`
  `);if(s>0){var h=dn(t,r,s,a),m=dn(t,r,s,c);f+="L ".concat(m.x,",").concat(m.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(l)>180),",").concat(+(a<=c),`,
            `).concat(h.x,",").concat(h.y," Z")}else f+="L ".concat(t,",").concat(r," Z");return f},cU=e=>{var{cx:t,cy:r,innerRadius:s,outerRadius:i,cornerRadius:a,forceCornerRadius:o,cornerIsExternal:l,startAngle:c,endAngle:u}=e,d=On(u-c),{circleTangency:f,lineTangency:h,theta:m}=Af({cx:t,cy:r,radius:i,angle:c,sign:d,cornerRadius:a,cornerIsExternal:l}),{circleTangency:g,lineTangency:x,theta:y}=Af({cx:t,cy:r,radius:i,angle:u,sign:-d,cornerRadius:a,cornerIsExternal:l}),v=l?Math.abs(c-u):Math.abs(c-u)-m-y;if(v<0)return o?"M ".concat(h.x,",").concat(h.y,`
        a`).concat(a,",").concat(a,",0,0,1,").concat(a*2,`,0
        a`).concat(a,",").concat(a,",0,0,1,").concat(-a*2,`,0
      `):m6({cx:t,cy:r,innerRadius:s,outerRadius:i,startAngle:c,endAngle:u});var S="M ".concat(h.x,",").concat(h.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(d<0),",").concat(f.x,",").concat(f.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(v>180),",").concat(+(d<0),",").concat(g.x,",").concat(g.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(d<0),",").concat(x.x,",").concat(x.y,`
  `);if(s>0){var{circleTangency:k,lineTangency:j,theta:_}=Af({cx:t,cy:r,radius:s,angle:c,sign:d,isExternal:!0,cornerRadius:a,cornerIsExternal:l}),{circleTangency:b,lineTangency:A,theta:z}=Af({cx:t,cy:r,radius:s,angle:u,sign:-d,isExternal:!0,cornerRadius:a,cornerIsExternal:l}),D=l?Math.abs(c-u):Math.abs(c-u)-_-z;if(D<0&&a===0)return"".concat(S,"L").concat(t,",").concat(r,"Z");S+="L".concat(A.x,",").concat(A.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(d<0),",").concat(b.x,",").concat(b.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(D>180),",").concat(+(d>0),",").concat(k.x,",").concat(k.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(d<0),",").concat(j.x,",").concat(j.y,"Z")}else S+="L".concat(t,",").concat(r,"Z");return S},dU={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},x6=e=>{var t=hn(e,dU),{cx:r,cy:s,innerRadius:i,outerRadius:a,cornerRadius:o,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d,className:f}=t;if(a<i||u===d)return null;var h=vr("recharts-sector",f),m=a-i,g=rs(o,m,0,!0),x;return g>0&&Math.abs(u-d)<360?x=cU({cx:r,cy:s,innerRadius:i,outerRadius:a,cornerRadius:Math.min(g,m/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d}):x=m6({cx:r,cy:s,innerRadius:i,outerRadius:a,startAngle:u,endAngle:d}),p.createElement("path",_0({},hs(t),{className:h,d:x}))};function uU(e,t,r){if(e==="horizontal")return[{x:t.x,y:r.top},{x:t.x,y:r.top+r.height}];if(e==="vertical")return[{x:r.left,y:t.y},{x:r.left+r.width,y:t.y}];if(IP(t)){if(e==="centric"){var{cx:s,cy:i,innerRadius:a,outerRadius:o,angle:l}=t,c=dn(s,i,a,l),u=dn(s,i,o,l);return[{x:c.x,y:c.y},{x:u.x,y:u.y}]}return g6(t)}}var y6={},v6={},b6={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Db;function r(s){return t.isSymbol(s)?NaN:Number(s)}e.toNumber=r})(b6);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=b6;function r(s){return s?(s=t.toNumber(s),s===1/0||s===-1/0?(s<0?-1:1)*Number.MAX_VALUE:s===s?s:0):s===0?s:0}e.toFinite=r})(v6);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Mb,r=v6;function s(i,a,o){o&&typeof o!="number"&&t.isIterateeCall(i,a,o)&&(a=o=void 0),i=r.toFinite(i),a===void 0?(a=i,i=0):a=r.toFinite(a),o=o===void 0?i<a?1:-1:r.toFinite(o);const l=Math.max(Math.ceil((a-i)/(o||1)),0),c=new Array(l);for(let u=0;u<l;u++)c[u]=i,i+=o;return c}e.range=s})(y6);var pU=y6.range;const j6=Ya(pU);function $o(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function fU(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function tj(e){let t,r,s;e.length!==2?(t=$o,r=(l,c)=>$o(e(l),c),s=(l,c)=>e(l)-c):(t=e===$o||e===fU?e:hU,r=e,s=e);function i(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}function a(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}function o(l,c,u=0,d=l.length){const f=i(l,c,u,d-1);return f>u&&s(l[f-1],c)>-s(l[f],c)?f-1:f}return{left:i,center:o,right:a}}function hU(){return 0}function w6(e){return e===null?NaN:+e}function*gU(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const mU=tj($o),Tp=mU.right;tj(w6).center;class eN extends Map{constructor(t,r=vU){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[s,i]of t)this.set(s,i)}get(t){return super.get(tN(this,t))}has(t){return super.has(tN(this,t))}set(t,r){return super.set(xU(this,t),r)}delete(t){return super.delete(yU(this,t))}}function tN({_intern:e,_key:t},r){const s=t(r);return e.has(s)?e.get(s):r}function xU({_intern:e,_key:t},r){const s=t(r);return e.has(s)?e.get(s):(e.set(s,r),r)}function yU({_intern:e,_key:t},r){const s=t(r);return e.has(s)&&(r=e.get(s),e.delete(s)),r}function vU(e){return e!==null&&typeof e=="object"?e.valueOf():e}function bU(e=$o){if(e===$o)return S6;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const s=e(t,r);return s||s===0?s:(e(r,r)===0)-(e(t,t)===0)}}function S6(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const jU=Math.sqrt(50),wU=Math.sqrt(10),SU=Math.sqrt(2);function fg(e,t,r){const s=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(s)),a=s/Math.pow(10,i),o=a>=jU?10:a>=wU?5:a>=SU?2:1;let l,c,u;return i<0?(u=Math.pow(10,-i)/o,l=Math.round(e*u),c=Math.round(t*u),l/u<e&&++l,c/u>t&&--c,u=-u):(u=Math.pow(10,i)*o,l=Math.round(e/u),c=Math.round(t/u),l*u<e&&++l,c*u>t&&--c),c<l&&.5<=r&&r<2?fg(e,t,r*2):[l,c,u]}function A0(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const s=t<e,[i,a,o]=s?fg(t,e,r):fg(e,t,r);if(!(a>=i))return[];const l=a-i+1,c=new Array(l);if(s)if(o<0)for(let u=0;u<l;++u)c[u]=(a-u)/-o;else for(let u=0;u<l;++u)c[u]=(a-u)*o;else if(o<0)for(let u=0;u<l;++u)c[u]=(i+u)/-o;else for(let u=0;u<l;++u)c[u]=(i+u)*o;return c}function E0(e,t,r){return t=+t,e=+e,r=+r,fg(e,t,r)[2]}function P0(e,t,r){t=+t,e=+e,r=+r;const s=t<e,i=s?E0(t,e,r):E0(e,t,r);return(s?-1:1)*(i<0?1/-i:i)}function rN(e,t){let r;for(const s of e)s!=null&&(r<s||r===void 0&&s>=s)&&(r=s);return r}function nN(e,t){let r;for(const s of e)s!=null&&(r>s||r===void 0&&s>=s)&&(r=s);return r}function k6(e,t,r=0,s=1/0,i){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),s=Math.floor(Math.min(e.length-1,s)),!(r<=t&&t<=s))return e;for(i=i===void 0?S6:bU(i);s>r;){if(s-r>600){const c=s-r+1,u=t-r+1,d=Math.log(c),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1),m=Math.max(r,Math.floor(t-u*f/c+h)),g=Math.min(s,Math.floor(t+(c-u)*f/c+h));k6(e,t,m,g,i)}const a=e[t];let o=r,l=s;for(qd(e,r,t),i(e[s],a)>0&&qd(e,r,s);o<l;){for(qd(e,o,l),++o,--l;i(e[o],a)<0;)++o;for(;i(e[l],a)>0;)--l}i(e[r],a)===0?qd(e,r,l):(++l,qd(e,l,s)),l<=t&&(r=l+1),t<=l&&(s=l-1)}return e}function qd(e,t,r){const s=e[t];e[t]=e[r],e[r]=s}function kU(e,t,r){if(e=Float64Array.from(gU(e)),!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return nN(e);if(t>=1)return rN(e);var s,i=(s-1)*t,a=Math.floor(i),o=rN(k6(e,a).subarray(0,a+1)),l=nN(e.subarray(a+1));return o+(l-o)*(i-a)}}function NU(e,t,r=w6){if(!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return+r(e[0],0,e);if(t>=1)return+r(e[s-1],s-1,e);var s,i=(s-1)*t,a=Math.floor(i),o=+r(e[a],a,e),l=+r(e[a+1],a+1,e);return o+(l-o)*(i-a)}}function CU(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var s=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,a=new Array(i);++s<i;)a[s]=e+s*r;return a}function hi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Xa(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const I0=Symbol("implicit");function rj(){var e=new eN,t=[],r=[],s=I0;function i(a){let o=e.get(a);if(o===void 0){if(s!==I0)return s;e.set(a,o=t.push(a)-1)}return r[o%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new eN;for(const o of a)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(a){return arguments.length?(r=Array.from(a),i):r.slice()},i.unknown=function(a){return arguments.length?(s=a,i):s},i.copy=function(){return rj(t,r).unknown(s)},hi.apply(i,arguments),i}function nj(){var e=rj().unknown(void 0),t=e.domain,r=e.range,s=0,i=1,a,o,l=!1,c=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,m=i<s,g=m?i:s,x=m?s:i;a=(x-g)/Math.max(1,h-c+u*2),l&&(a=Math.floor(a)),g+=(x-g-a*(h-c))*d,o=a*(1-c),l&&(g=Math.round(g),o=Math.round(o));var y=CU(h).map(function(v){return g+a*v});return r(m?y.reverse():y)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([s,i]=h,s=+s,i=+i,f()):[s,i]},e.rangeRound=function(h){return[s,i]=h,s=+s,i=+i,l=!0,f()},e.bandwidth=function(){return o},e.step=function(){return a},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,u=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return nj(t(),[s,i]).round(l).paddingInner(c).paddingOuter(u).align(d)},hi.apply(f(),arguments)}function N6(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return N6(t())},e}function _U(){return N6(nj.apply(null,arguments).paddingInner(1))}function sj(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function C6(e,t){var r=Object.create(e.prototype);for(var s in t)r[s]=t[s];return r}function Rp(){}var Gu=.7,hg=1/Gu,Oc="\\s*([+-]?\\d+)\\s*",Xu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ta="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",AU=/^#([0-9a-f]{3,8})$/,EU=new RegExp(`^rgb\\(${Oc},${Oc},${Oc}\\)$`),PU=new RegExp(`^rgb\\(${ta},${ta},${ta}\\)$`),IU=new RegExp(`^rgba\\(${Oc},${Oc},${Oc},${Xu}\\)$`),TU=new RegExp(`^rgba\\(${ta},${ta},${ta},${Xu}\\)$`),RU=new RegExp(`^hsl\\(${Xu},${ta},${ta}\\)$`),OU=new RegExp(`^hsla\\(${Xu},${ta},${ta},${Xu}\\)$`),sN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sj(Rp,Qu,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:iN,formatHex:iN,formatHex8:zU,formatHsl:LU,formatRgb:aN,toString:aN});function iN(){return this.rgb().formatHex()}function zU(){return this.rgb().formatHex8()}function LU(){return _6(this).formatHsl()}function aN(){return this.rgb().formatRgb()}function Qu(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=AU.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?oN(t):r===3?new Cs(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Ef(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Ef(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=EU.exec(e))?new Cs(t[1],t[2],t[3],1):(t=PU.exec(e))?new Cs(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=IU.exec(e))?Ef(t[1],t[2],t[3],t[4]):(t=TU.exec(e))?Ef(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=RU.exec(e))?dN(t[1],t[2]/100,t[3]/100,1):(t=OU.exec(e))?dN(t[1],t[2]/100,t[3]/100,t[4]):sN.hasOwnProperty(e)?oN(sN[e]):e==="transparent"?new Cs(NaN,NaN,NaN,0):null}function oN(e){return new Cs(e>>16&255,e>>8&255,e&255,1)}function Ef(e,t,r,s){return s<=0&&(e=t=r=NaN),new Cs(e,t,r,s)}function $U(e){return e instanceof Rp||(e=Qu(e)),e?(e=e.rgb(),new Cs(e.r,e.g,e.b,e.opacity)):new Cs}function T0(e,t,r,s){return arguments.length===1?$U(e):new Cs(e,t,r,s??1)}function Cs(e,t,r,s){this.r=+e,this.g=+t,this.b=+r,this.opacity=+s}sj(Cs,T0,C6(Rp,{brighter(e){return e=e==null?hg:Math.pow(hg,e),new Cs(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Gu:Math.pow(Gu,e),new Cs(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Cs(Ll(this.r),Ll(this.g),Ll(this.b),gg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:lN,formatHex:lN,formatHex8:DU,formatRgb:cN,toString:cN}));function lN(){return`#${xl(this.r)}${xl(this.g)}${xl(this.b)}`}function DU(){return`#${xl(this.r)}${xl(this.g)}${xl(this.b)}${xl((isNaN(this.opacity)?1:this.opacity)*255)}`}function cN(){const e=gg(this.opacity);return`${e===1?"rgb(":"rgba("}${Ll(this.r)}, ${Ll(this.g)}, ${Ll(this.b)}${e===1?")":`, ${e})`}`}function gg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ll(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function xl(e){return e=Ll(e),(e<16?"0":"")+e.toString(16)}function dN(e,t,r,s){return s<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ii(e,t,r,s)}function _6(e){if(e instanceof Ii)return new Ii(e.h,e.s,e.l,e.opacity);if(e instanceof Rp||(e=Qu(e)),!e)return new Ii;if(e instanceof Ii)return e;e=e.rgb();var t=e.r/255,r=e.g/255,s=e.b/255,i=Math.min(t,r,s),a=Math.max(t,r,s),o=NaN,l=a-i,c=(a+i)/2;return l?(t===a?o=(r-s)/l+(r<s)*6:r===a?o=(s-t)/l+2:o=(t-r)/l+4,l/=c<.5?a+i:2-a-i,o*=60):l=c>0&&c<1?0:o,new Ii(o,l,c,e.opacity)}function MU(e,t,r,s){return arguments.length===1?_6(e):new Ii(e,t,r,s??1)}function Ii(e,t,r,s){this.h=+e,this.s=+t,this.l=+r,this.opacity=+s}sj(Ii,MU,C6(Rp,{brighter(e){return e=e==null?hg:Math.pow(hg,e),new Ii(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Gu:Math.pow(Gu,e),new Ii(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,s=r+(r<.5?r:1-r)*t,i=2*r-s;return new Cs(oy(e>=240?e-240:e+120,i,s),oy(e,i,s),oy(e<120?e+240:e-120,i,s),this.opacity)},clamp(){return new Ii(uN(this.h),Pf(this.s),Pf(this.l),gg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=gg(this.opacity);return`${e===1?"hsl(":"hsla("}${uN(this.h)}, ${Pf(this.s)*100}%, ${Pf(this.l)*100}%${e===1?")":`, ${e})`}`}}));function uN(e){return e=(e||0)%360,e<0?e+360:e}function Pf(e){return Math.max(0,Math.min(1,e||0))}function oy(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const ij=e=>()=>e;function BU(e,t){return function(r){return e+r*t}}function FU(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(s){return Math.pow(e+s*t,r)}}function WU(e){return(e=+e)==1?A6:function(t,r){return r-t?FU(t,r,e):ij(isNaN(t)?r:t)}}function A6(e,t){var r=t-e;return r?BU(e,r):ij(isNaN(e)?t:e)}const pN=function e(t){var r=WU(t);function s(i,a){var o=r((i=T0(i)).r,(a=T0(a)).r),l=r(i.g,a.g),c=r(i.b,a.b),u=A6(i.opacity,a.opacity);return function(d){return i.r=o(d),i.g=l(d),i.b=c(d),i.opacity=u(d),i+""}}return s.gamma=e,s}(1);function UU(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,s=t.slice(),i;return function(a){for(i=0;i<r;++i)s[i]=e[i]*(1-a)+t[i]*a;return s}}function HU(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function YU(e,t){var r=t?t.length:0,s=e?Math.min(r,e.length):0,i=new Array(s),a=new Array(r),o;for(o=0;o<s;++o)i[o]=kd(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(l){for(o=0;o<s;++o)a[o]=i[o](l);return a}}function KU(e,t){var r=new Date;return e=+e,t=+t,function(s){return r.setTime(e*(1-s)+t*s),r}}function mg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function VU(e,t){var r={},s={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=kd(e[i],t[i]):s[i]=t[i];return function(a){for(i in r)s[i]=r[i](a);return s}}var R0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ly=new RegExp(R0.source,"g");function qU(e){return function(){return e}}function GU(e){return function(t){return e(t)+""}}function XU(e,t){var r=R0.lastIndex=ly.lastIndex=0,s,i,a,o=-1,l=[],c=[];for(e=e+"",t=t+"";(s=R0.exec(e))&&(i=ly.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),l[o]?l[o]+=a:l[++o]=a),(s=s[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,c.push({i:o,x:mg(s,i)})),r=ly.lastIndex;return r<t.length&&(a=t.slice(r),l[o]?l[o]+=a:l[++o]=a),l.length<2?c[0]?GU(c[0].x):qU(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function kd(e,t){var r=typeof t,s;return t==null||r==="boolean"?ij(t):(r==="number"?mg:r==="string"?(s=Qu(t))?(t=s,pN):XU:t instanceof Qu?pN:t instanceof Date?KU:HU(t)?UU:Array.isArray(t)?YU:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?VU:mg)(e,t)}function aj(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function QU(e,t){t===void 0&&(t=e,e=kd);for(var r=0,s=t.length-1,i=t[0],a=new Array(s<0?0:s);r<s;)a[r]=e(i,i=t[++r]);return function(o){var l=Math.max(0,Math.min(s-1,Math.floor(o*=s)));return a[l](o-l)}}function JU(e){return function(){return e}}function xg(e){return+e}var fN=[0,1];function ps(e){return e}function O0(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:JU(isNaN(t)?NaN:.5)}function ZU(e,t){var r;return e>t&&(r=e,e=t,t=r),function(s){return Math.max(e,Math.min(t,s))}}function eH(e,t,r){var s=e[0],i=e[1],a=t[0],o=t[1];return i<s?(s=O0(i,s),a=r(o,a)):(s=O0(s,i),a=r(a,o)),function(l){return a(s(l))}}function tH(e,t,r){var s=Math.min(e.length,t.length)-1,i=new Array(s),a=new Array(s),o=-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<s;)i[o]=O0(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(l){var c=Tp(e,l,1,s)-1;return a[c](i[c](l))}}function Op(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Rm(){var e=fN,t=fN,r=kd,s,i,a,o=ps,l,c,u;function d(){var h=Math.min(e.length,t.length);return o!==ps&&(o=ZU(e[0],e[h-1])),l=h>2?tH:eH,c=u=null,f}function f(h){return h==null||isNaN(h=+h)?a:(c||(c=l(e.map(s),t,r)))(s(o(h)))}return f.invert=function(h){return o(i((u||(u=l(t,e.map(s),mg)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,xg),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=aj,d()},f.clamp=function(h){return arguments.length?(o=h?!0:ps,d()):o!==ps},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,m){return s=h,i=m,d()}}function oj(){return Rm()(ps,ps)}function rH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function yg(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,s=e.slice(0,r);return[s.length>1?s[0]+s.slice(2):s,+e.slice(r+1)]}function ld(e){return e=yg(Math.abs(e)),e?e[1]:NaN}function nH(e,t){return function(r,s){for(var i=r.length,a=[],o=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>s&&(l=Math.max(1,s-c)),a.push(r.substring(i-=l,i+l)),!((c+=l+1)>s));)l=e[o=(o+1)%e.length];return a.reverse().join(t)}}function sH(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var iH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ju(e){if(!(t=iH.exec(e)))throw new Error("invalid format: "+e);var t;return new lj({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ju.prototype=lj.prototype;function lj(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}lj.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aH(e){e:for(var t=e.length,r=1,s=-1,i;r<t;++r)switch(e[r]){case".":s=i=r;break;case"0":s===0&&(s=r),i=r;break;default:if(!+e[r])break e;s>0&&(s=0);break}return s>0?e.slice(0,s)+e.slice(i+1):e}var E6;function oH(e,t){var r=yg(e,t);if(!r)return e+"";var s=r[0],i=r[1],a=i-(E6=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=s.length;return a===o?s:a>o?s+new Array(a-o+1).join("0"):a>0?s.slice(0,a)+"."+s.slice(a):"0."+new Array(1-a).join("0")+yg(e,Math.max(0,t+a-1))[0]}function hN(e,t){var r=yg(e,t);if(!r)return e+"";var s=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+s:s.length>i+1?s.slice(0,i+1)+"."+s.slice(i+1):s+new Array(i-s.length+2).join("0")}const gN={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:rH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>hN(e*100,t),r:hN,s:oH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function mN(e){return e}var xN=Array.prototype.map,yN=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function lH(e){var t=e.grouping===void 0||e.thousands===void 0?mN:nH(xN.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",s=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?mN:sH(xN.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function u(f){f=Ju(f);var h=f.fill,m=f.align,g=f.sign,x=f.symbol,y=f.zero,v=f.width,S=f.comma,k=f.precision,j=f.trim,_=f.type;_==="n"?(S=!0,_="g"):gN[_]||(k===void 0&&(k=12),j=!0,_="g"),(y||h==="0"&&m==="=")&&(y=!0,h="0",m="=");var b=x==="$"?r:x==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",A=x==="$"?s:/[%p]/.test(_)?o:"",z=gN[_],D=/[defgprs%]/.test(_);k=k===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k));function w(N){var $=b,E=A,q,L,O;if(_==="c")E=z(N)+E,N="";else{N=+N;var B=N<0||1/N<0;if(N=isNaN(N)?c:z(Math.abs(N),k),j&&(N=aH(N)),B&&+N==0&&g!=="+"&&(B=!1),$=(B?g==="("?g:l:g==="-"||g==="("?"":g)+$,E=(_==="s"?yN[8+E6/3]:"")+E+(B&&g==="("?")":""),D){for(q=-1,L=N.length;++q<L;)if(O=N.charCodeAt(q),48>O||O>57){E=(O===46?i+N.slice(q+1):N.slice(q))+E,N=N.slice(0,q);break}}}S&&!y&&(N=t(N,1/0));var I=$.length+N.length+E.length,T=I<v?new Array(v-I+1).join(h):"";switch(S&&y&&(N=t(T+N,T.length?v-E.length:1/0),T=""),m){case"<":N=$+N+E+T;break;case"=":N=$+T+N+E;break;case"^":N=T.slice(0,I=T.length>>1)+$+N+E+T.slice(I);break;default:N=T+$+N+E;break}return a(N)}return w.toString=function(){return f+""},w}function d(f,h){var m=u((f=Ju(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(ld(h)/3)))*3,x=Math.pow(10,-g),y=yN[8+g/3];return function(v){return m(x*v)+y}}return{format:u,formatPrefix:d}}var If,cj,P6;cH({thousands:",",grouping:[3],currency:["$",""]});function cH(e){return If=lH(e),cj=If.format,P6=If.formatPrefix,If}function dH(e){return Math.max(0,-ld(Math.abs(e)))}function uH(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ld(t)/3)))*3-ld(Math.abs(e)))}function pH(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ld(t)-ld(e))+1}function I6(e,t,r,s){var i=P0(e,t,r),a;switch(s=Ju(s??",f"),s.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return s.precision==null&&!isNaN(a=uH(i,o))&&(s.precision=a),P6(s,o)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(a=pH(i,Math.max(Math.abs(e),Math.abs(t))))&&(s.precision=a-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(a=dH(i))&&(s.precision=a-(s.type==="%")*2);break}}return cj(s)}function Jo(e){var t=e.domain;return e.ticks=function(r){var s=t();return A0(s[0],s[s.length-1],r??10)},e.tickFormat=function(r,s){var i=t();return I6(i[0],i[i.length-1],r??10,s)},e.nice=function(r){r==null&&(r=10);var s=t(),i=0,a=s.length-1,o=s[i],l=s[a],c,u,d=10;for(l<o&&(u=o,o=l,l=u,u=i,i=a,a=u);d-- >0;){if(u=E0(o,l,r),u===c)return s[i]=o,s[a]=l,t(s);if(u>0)o=Math.floor(o/u)*u,l=Math.ceil(l/u)*u;else if(u<0)o=Math.ceil(o*u)/u,l=Math.floor(l*u)/u;else break;c=u}return e},e}function T6(){var e=oj();return e.copy=function(){return Op(e,T6())},hi.apply(e,arguments),Jo(e)}function R6(e){var t;function r(s){return s==null||isNaN(s=+s)?t:s}return r.invert=r,r.domain=r.range=function(s){return arguments.length?(e=Array.from(s,xg),r):e.slice()},r.unknown=function(s){return arguments.length?(t=s,r):t},r.copy=function(){return R6(e).unknown(t)},e=arguments.length?Array.from(e,xg):[0,1],Jo(r)}function O6(e,t){e=e.slice();var r=0,s=e.length-1,i=e[r],a=e[s],o;return a<i&&(o=r,r=s,s=o,o=i,i=a,a=o),e[r]=t.floor(i),e[s]=t.ceil(a),e}function vN(e){return Math.log(e)}function bN(e){return Math.exp(e)}function fH(e){return-Math.log(-e)}function hH(e){return-Math.exp(-e)}function gH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function mH(e){return e===10?gH:e===Math.E?Math.exp:t=>Math.pow(e,t)}function xH(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function jN(e){return(t,r)=>-e(-t,r)}function dj(e){const t=e(vN,bN),r=t.domain;let s=10,i,a;function o(){return i=xH(s),a=mH(s),r()[0]<0?(i=jN(i),a=jN(a),e(fH,hH)):e(vN,bN),t}return t.base=function(l){return arguments.length?(s=+l,o()):s},t.domain=function(l){return arguments.length?(r(l),o()):r()},t.ticks=l=>{const c=r();let u=c[0],d=c[c.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=i(u),m=i(d),g,x;const y=l==null?10:+l;let v=[];if(!(s%1)&&m-h<y){if(h=Math.floor(h),m=Math.ceil(m),u>0){for(;h<=m;++h)for(g=1;g<s;++g)if(x=h<0?g/a(-h):g*a(h),!(x<u)){if(x>d)break;v.push(x)}}else for(;h<=m;++h)for(g=s-1;g>=1;--g)if(x=h>0?g/a(-h):g*a(h),!(x<u)){if(x>d)break;v.push(x)}v.length*2<y&&(v=A0(u,d,y))}else v=A0(h,m,Math.min(m-h,y)).map(a);return f?v.reverse():v},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=s===10?"s":","),typeof c!="function"&&(!(s%1)&&(c=Ju(c)).precision==null&&(c.trim=!0),c=cj(c)),l===1/0)return c;const u=Math.max(1,s*l/t.ticks().length);return d=>{let f=d/a(Math.round(i(d)));return f*s<s-.5&&(f*=s),f<=u?c(d):""}},t.nice=()=>r(O6(r(),{floor:l=>a(Math.floor(i(l))),ceil:l=>a(Math.ceil(i(l)))})),t}function z6(){const e=dj(Rm()).domain([1,10]);return e.copy=()=>Op(e,z6()).base(e.base()),hi.apply(e,arguments),e}function wN(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function SN(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function uj(e){var t=1,r=e(wN(t),SN(t));return r.constant=function(s){return arguments.length?e(wN(t=+s),SN(t)):t},Jo(r)}function L6(){var e=uj(Rm());return e.copy=function(){return Op(e,L6()).constant(e.constant())},hi.apply(e,arguments)}function kN(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function yH(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function vH(e){return e<0?-e*e:e*e}function pj(e){var t=e(ps,ps),r=1;function s(){return r===1?e(ps,ps):r===.5?e(yH,vH):e(kN(r),kN(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,s()):r},Jo(t)}function fj(){var e=pj(Rm());return e.copy=function(){return Op(e,fj()).exponent(e.exponent())},hi.apply(e,arguments),e}function bH(){return fj.apply(null,arguments).exponent(.5)}function NN(e){return Math.sign(e)*e*e}function jH(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function $6(){var e=oj(),t=[0,1],r=!1,s;function i(a){var o=jH(e(a));return isNaN(o)?s:r?Math.round(o):o}return i.invert=function(a){return e.invert(NN(a))},i.domain=function(a){return arguments.length?(e.domain(a),i):e.domain()},i.range=function(a){return arguments.length?(e.range((t=Array.from(a,xg)).map(NN)),i):t.slice()},i.rangeRound=function(a){return i.range(a).round(!0)},i.round=function(a){return arguments.length?(r=!!a,i):r},i.clamp=function(a){return arguments.length?(e.clamp(a),i):e.clamp()},i.unknown=function(a){return arguments.length?(s=a,i):s},i.copy=function(){return $6(e.domain(),t).round(r).clamp(e.clamp()).unknown(s)},hi.apply(i,arguments),Jo(i)}function D6(){var e=[],t=[],r=[],s;function i(){var o=0,l=Math.max(1,t.length);for(r=new Array(l-1);++o<l;)r[o-1]=NU(e,o/l);return a}function a(o){return o==null||isNaN(o=+o)?s:t[Tp(r,o)]}return a.invertExtent=function(o){var l=t.indexOf(o);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let l of o)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort($o),i()},a.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},a.unknown=function(o){return arguments.length?(s=o,a):s},a.quantiles=function(){return r.slice()},a.copy=function(){return D6().domain(e).range(t).unknown(s)},hi.apply(a,arguments)}function M6(){var e=0,t=1,r=1,s=[.5],i=[0,1],a;function o(c){return c!=null&&c<=c?i[Tp(s,c,0,r)]:a}function l(){var c=-1;for(s=new Array(r);++c<r;)s[c]=((c+1)*t-(c-r)*e)/(r+1);return o}return o.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},o.range=function(c){return arguments.length?(r=(i=Array.from(c)).length-1,l()):i.slice()},o.invertExtent=function(c){var u=i.indexOf(c);return u<0?[NaN,NaN]:u<1?[e,s[0]]:u>=r?[s[r-1],t]:[s[u-1],s[u]]},o.unknown=function(c){return arguments.length&&(a=c),o},o.thresholds=function(){return s.slice()},o.copy=function(){return M6().domain([e,t]).range(i).unknown(a)},hi.apply(Jo(o),arguments)}function B6(){var e=[.5],t=[0,1],r,s=1;function i(a){return a!=null&&a<=a?t[Tp(e,a,0,s)]:r}return i.domain=function(a){return arguments.length?(e=Array.from(a),s=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=Array.from(a),s=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return B6().domain(e).range(t).unknown(r)},hi.apply(i,arguments)}const cy=new Date,dy=new Date;function Nn(e,t,r,s){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=a=>(e(a=new Date(+a)),a),i.ceil=a=>(e(a=new Date(a-1)),t(a,1),e(a),a),i.round=a=>{const o=i(a),l=i.ceil(a);return a-o<l-a?o:l},i.offset=(a,o)=>(t(a=new Date(+a),o==null?1:Math.floor(o)),a),i.range=(a,o,l)=>{const c=[];if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<o)||!(l>0))return c;let u;do c.push(u=new Date(+a)),t(a,l),e(a);while(u<a&&a<o);return c},i.filter=a=>Nn(o=>{if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},(o,l)=>{if(o>=o)if(l<0)for(;++l<=0;)for(;t(o,-1),!a(o););else for(;--l>=0;)for(;t(o,1),!a(o););}),r&&(i.count=(a,o)=>(cy.setTime(+a),dy.setTime(+o),e(cy),e(dy),Math.floor(r(cy,dy))),i.every=a=>(a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(s?o=>s(o)%a===0:o=>i.count(0,o)%a===0):i)),i}const vg=Nn(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);vg.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Nn(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):vg);vg.range;const _a=1e3,li=_a*60,Aa=li*60,Ba=Aa*24,hj=Ba*7,CN=Ba*30,uy=Ba*365,yl=Nn(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*_a)},(e,t)=>(t-e)/_a,e=>e.getUTCSeconds());yl.range;const gj=Nn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_a)},(e,t)=>{e.setTime(+e+t*li)},(e,t)=>(t-e)/li,e=>e.getMinutes());gj.range;const mj=Nn(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*li)},(e,t)=>(t-e)/li,e=>e.getUTCMinutes());mj.range;const xj=Nn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_a-e.getMinutes()*li)},(e,t)=>{e.setTime(+e+t*Aa)},(e,t)=>(t-e)/Aa,e=>e.getHours());xj.range;const yj=Nn(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Aa)},(e,t)=>(t-e)/Aa,e=>e.getUTCHours());yj.range;const zp=Nn(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*li)/Ba,e=>e.getDate()-1);zp.range;const Om=Nn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ba,e=>e.getUTCDate()-1);Om.range;const F6=Nn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ba,e=>Math.floor(e/Ba));F6.range;function sc(e){return Nn(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*li)/hj)}const zm=sc(0),bg=sc(1),wH=sc(2),SH=sc(3),cd=sc(4),kH=sc(5),NH=sc(6);zm.range;bg.range;wH.range;SH.range;cd.range;kH.range;NH.range;function ic(e){return Nn(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/hj)}const Lm=ic(0),jg=ic(1),CH=ic(2),_H=ic(3),dd=ic(4),AH=ic(5),EH=ic(6);Lm.range;jg.range;CH.range;_H.range;dd.range;AH.range;EH.range;const vj=Nn(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());vj.range;const bj=Nn(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());bj.range;const Fa=Nn(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Fa.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Nn(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Fa.range;const Wa=Nn(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Wa.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Nn(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Wa.range;function W6(e,t,r,s,i,a){const o=[[yl,1,_a],[yl,5,5*_a],[yl,15,15*_a],[yl,30,30*_a],[a,1,li],[a,5,5*li],[a,15,15*li],[a,30,30*li],[i,1,Aa],[i,3,3*Aa],[i,6,6*Aa],[i,12,12*Aa],[s,1,Ba],[s,2,2*Ba],[r,1,hj],[t,1,CN],[t,3,3*CN],[e,1,uy]];function l(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const m=f&&typeof f.range=="function"?f:c(u,d,f),g=m?m.range(u,+d+1):[];return h?g.reverse():g}function c(u,d,f){const h=Math.abs(d-u)/f,m=tj(([,,y])=>y).right(o,h);if(m===o.length)return e.every(P0(u/uy,d/uy,f));if(m===0)return vg.every(Math.max(P0(u,d,f),1));const[g,x]=o[h/o[m-1][2]<o[m][2]/h?m-1:m];return g.every(x)}return[l,c]}const[PH,IH]=W6(Wa,bj,Lm,F6,yj,mj),[TH,RH]=W6(Fa,vj,zm,zp,xj,gj);function py(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function fy(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Gd(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function OH(e){var t=e.dateTime,r=e.date,s=e.time,i=e.periods,a=e.days,o=e.shortDays,l=e.months,c=e.shortMonths,u=Xd(i),d=Qd(i),f=Xd(a),h=Qd(a),m=Xd(o),g=Qd(o),x=Xd(l),y=Qd(l),v=Xd(c),S=Qd(c),k={a:B,A:I,b:T,B:W,c:null,d:TN,e:TN,f:nY,g:fY,G:gY,H:eY,I:tY,j:rY,L:U6,m:sY,M:iY,p:re,q:ae,Q:zN,s:LN,S:aY,u:oY,U:lY,V:cY,w:dY,W:uY,x:null,X:null,y:pY,Y:hY,Z:mY,"%":ON},j={a:Y,A:J,b:P,B:ce,c:null,d:RN,e:RN,f:bY,g:PY,G:TY,H:xY,I:yY,j:vY,L:Y6,m:jY,M:wY,p:pe,q:ye,Q:zN,s:LN,S:SY,u:kY,U:NY,V:CY,w:_Y,W:AY,x:null,X:null,y:EY,Y:IY,Z:RY,"%":ON},_={a:w,A:N,b:$,B:E,c:q,d:PN,e:PN,f:XH,g:EN,G:AN,H:IN,I:IN,j:KH,L:GH,m:YH,M:VH,p:D,q:HH,Q:JH,s:ZH,S:qH,u:MH,U:BH,V:FH,w:DH,W:WH,x:L,X:O,y:EN,Y:AN,Z:UH,"%":QH};k.x=b(r,k),k.X=b(s,k),k.c=b(t,k),j.x=b(r,j),j.X=b(s,j),j.c=b(t,j);function b(se,je){return function(ve){var le=[],oe=-1,de=0,Pe=se.length,Z,ne,ee;for(ve instanceof Date||(ve=new Date(+ve));++oe<Pe;)se.charCodeAt(oe)===37&&(le.push(se.slice(de,oe)),(ne=_N[Z=se.charAt(++oe)])!=null?Z=se.charAt(++oe):ne=Z==="e"?" ":"0",(ee=je[Z])&&(Z=ee(ve,ne)),le.push(Z),de=oe+1);return le.push(se.slice(de,oe)),le.join("")}}function A(se,je){return function(ve){var le=Gd(1900,void 0,1),oe=z(le,se,ve+="",0),de,Pe;if(oe!=ve.length)return null;if("Q"in le)return new Date(le.Q);if("s"in le)return new Date(le.s*1e3+("L"in le?le.L:0));if(je&&!("Z"in le)&&(le.Z=0),"p"in le&&(le.H=le.H%12+le.p*12),le.m===void 0&&(le.m="q"in le?le.q:0),"V"in le){if(le.V<1||le.V>53)return null;"w"in le||(le.w=1),"Z"in le?(de=fy(Gd(le.y,0,1)),Pe=de.getUTCDay(),de=Pe>4||Pe===0?jg.ceil(de):jg(de),de=Om.offset(de,(le.V-1)*7),le.y=de.getUTCFullYear(),le.m=de.getUTCMonth(),le.d=de.getUTCDate()+(le.w+6)%7):(de=py(Gd(le.y,0,1)),Pe=de.getDay(),de=Pe>4||Pe===0?bg.ceil(de):bg(de),de=zp.offset(de,(le.V-1)*7),le.y=de.getFullYear(),le.m=de.getMonth(),le.d=de.getDate()+(le.w+6)%7)}else("W"in le||"U"in le)&&("w"in le||(le.w="u"in le?le.u%7:"W"in le?1:0),Pe="Z"in le?fy(Gd(le.y,0,1)).getUTCDay():py(Gd(le.y,0,1)).getDay(),le.m=0,le.d="W"in le?(le.w+6)%7+le.W*7-(Pe+5)%7:le.w+le.U*7-(Pe+6)%7);return"Z"in le?(le.H+=le.Z/100|0,le.M+=le.Z%100,fy(le)):py(le)}}function z(se,je,ve,le){for(var oe=0,de=je.length,Pe=ve.length,Z,ne;oe<de;){if(le>=Pe)return-1;if(Z=je.charCodeAt(oe++),Z===37){if(Z=je.charAt(oe++),ne=_[Z in _N?je.charAt(oe++):Z],!ne||(le=ne(se,ve,le))<0)return-1}else if(Z!=ve.charCodeAt(le++))return-1}return le}function D(se,je,ve){var le=u.exec(je.slice(ve));return le?(se.p=d.get(le[0].toLowerCase()),ve+le[0].length):-1}function w(se,je,ve){var le=m.exec(je.slice(ve));return le?(se.w=g.get(le[0].toLowerCase()),ve+le[0].length):-1}function N(se,je,ve){var le=f.exec(je.slice(ve));return le?(se.w=h.get(le[0].toLowerCase()),ve+le[0].length):-1}function $(se,je,ve){var le=v.exec(je.slice(ve));return le?(se.m=S.get(le[0].toLowerCase()),ve+le[0].length):-1}function E(se,je,ve){var le=x.exec(je.slice(ve));return le?(se.m=y.get(le[0].toLowerCase()),ve+le[0].length):-1}function q(se,je,ve){return z(se,t,je,ve)}function L(se,je,ve){return z(se,r,je,ve)}function O(se,je,ve){return z(se,s,je,ve)}function B(se){return o[se.getDay()]}function I(se){return a[se.getDay()]}function T(se){return c[se.getMonth()]}function W(se){return l[se.getMonth()]}function re(se){return i[+(se.getHours()>=12)]}function ae(se){return 1+~~(se.getMonth()/3)}function Y(se){return o[se.getUTCDay()]}function J(se){return a[se.getUTCDay()]}function P(se){return c[se.getUTCMonth()]}function ce(se){return l[se.getUTCMonth()]}function pe(se){return i[+(se.getUTCHours()>=12)]}function ye(se){return 1+~~(se.getUTCMonth()/3)}return{format:function(se){var je=b(se+="",k);return je.toString=function(){return se},je},parse:function(se){var je=A(se+="",!1);return je.toString=function(){return se},je},utcFormat:function(se){var je=b(se+="",j);return je.toString=function(){return se},je},utcParse:function(se){var je=A(se+="",!0);return je.toString=function(){return se},je}}}var _N={"-":"",_:" ",0:"0"},$n=/^\s*\d+/,zH=/^%/,LH=/[\\^$*+?|[\]().{}]/g;function br(e,t,r){var s=e<0?"-":"",i=(s?-e:e)+"",a=i.length;return s+(a<r?new Array(r-a+1).join(t)+i:i)}function $H(e){return e.replace(LH,"\\$&")}function Xd(e){return new RegExp("^(?:"+e.map($H).join("|")+")","i")}function Qd(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function DH(e,t,r){var s=$n.exec(t.slice(r,r+1));return s?(e.w=+s[0],r+s[0].length):-1}function MH(e,t,r){var s=$n.exec(t.slice(r,r+1));return s?(e.u=+s[0],r+s[0].length):-1}function BH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.U=+s[0],r+s[0].length):-1}function FH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.V=+s[0],r+s[0].length):-1}function WH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.W=+s[0],r+s[0].length):-1}function AN(e,t,r){var s=$n.exec(t.slice(r,r+4));return s?(e.y=+s[0],r+s[0].length):-1}function EN(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.y=+s[0]+(+s[0]>68?1900:2e3),r+s[0].length):-1}function UH(e,t,r){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return s?(e.Z=s[1]?0:-(s[2]+(s[3]||"00")),r+s[0].length):-1}function HH(e,t,r){var s=$n.exec(t.slice(r,r+1));return s?(e.q=s[0]*3-3,r+s[0].length):-1}function YH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.m=s[0]-1,r+s[0].length):-1}function PN(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.d=+s[0],r+s[0].length):-1}function KH(e,t,r){var s=$n.exec(t.slice(r,r+3));return s?(e.m=0,e.d=+s[0],r+s[0].length):-1}function IN(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.H=+s[0],r+s[0].length):-1}function VH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.M=+s[0],r+s[0].length):-1}function qH(e,t,r){var s=$n.exec(t.slice(r,r+2));return s?(e.S=+s[0],r+s[0].length):-1}function GH(e,t,r){var s=$n.exec(t.slice(r,r+3));return s?(e.L=+s[0],r+s[0].length):-1}function XH(e,t,r){var s=$n.exec(t.slice(r,r+6));return s?(e.L=Math.floor(s[0]/1e3),r+s[0].length):-1}function QH(e,t,r){var s=zH.exec(t.slice(r,r+1));return s?r+s[0].length:-1}function JH(e,t,r){var s=$n.exec(t.slice(r));return s?(e.Q=+s[0],r+s[0].length):-1}function ZH(e,t,r){var s=$n.exec(t.slice(r));return s?(e.s=+s[0],r+s[0].length):-1}function TN(e,t){return br(e.getDate(),t,2)}function eY(e,t){return br(e.getHours(),t,2)}function tY(e,t){return br(e.getHours()%12||12,t,2)}function rY(e,t){return br(1+zp.count(Fa(e),e),t,3)}function U6(e,t){return br(e.getMilliseconds(),t,3)}function nY(e,t){return U6(e,t)+"000"}function sY(e,t){return br(e.getMonth()+1,t,2)}function iY(e,t){return br(e.getMinutes(),t,2)}function aY(e,t){return br(e.getSeconds(),t,2)}function oY(e){var t=e.getDay();return t===0?7:t}function lY(e,t){return br(zm.count(Fa(e)-1,e),t,2)}function H6(e){var t=e.getDay();return t>=4||t===0?cd(e):cd.ceil(e)}function cY(e,t){return e=H6(e),br(cd.count(Fa(e),e)+(Fa(e).getDay()===4),t,2)}function dY(e){return e.getDay()}function uY(e,t){return br(bg.count(Fa(e)-1,e),t,2)}function pY(e,t){return br(e.getFullYear()%100,t,2)}function fY(e,t){return e=H6(e),br(e.getFullYear()%100,t,2)}function hY(e,t){return br(e.getFullYear()%1e4,t,4)}function gY(e,t){var r=e.getDay();return e=r>=4||r===0?cd(e):cd.ceil(e),br(e.getFullYear()%1e4,t,4)}function mY(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+br(t/60|0,"0",2)+br(t%60,"0",2)}function RN(e,t){return br(e.getUTCDate(),t,2)}function xY(e,t){return br(e.getUTCHours(),t,2)}function yY(e,t){return br(e.getUTCHours()%12||12,t,2)}function vY(e,t){return br(1+Om.count(Wa(e),e),t,3)}function Y6(e,t){return br(e.getUTCMilliseconds(),t,3)}function bY(e,t){return Y6(e,t)+"000"}function jY(e,t){return br(e.getUTCMonth()+1,t,2)}function wY(e,t){return br(e.getUTCMinutes(),t,2)}function SY(e,t){return br(e.getUTCSeconds(),t,2)}function kY(e){var t=e.getUTCDay();return t===0?7:t}function NY(e,t){return br(Lm.count(Wa(e)-1,e),t,2)}function K6(e){var t=e.getUTCDay();return t>=4||t===0?dd(e):dd.ceil(e)}function CY(e,t){return e=K6(e),br(dd.count(Wa(e),e)+(Wa(e).getUTCDay()===4),t,2)}function _Y(e){return e.getUTCDay()}function AY(e,t){return br(jg.count(Wa(e)-1,e),t,2)}function EY(e,t){return br(e.getUTCFullYear()%100,t,2)}function PY(e,t){return e=K6(e),br(e.getUTCFullYear()%100,t,2)}function IY(e,t){return br(e.getUTCFullYear()%1e4,t,4)}function TY(e,t){var r=e.getUTCDay();return e=r>=4||r===0?dd(e):dd.ceil(e),br(e.getUTCFullYear()%1e4,t,4)}function RY(){return"+0000"}function ON(){return"%"}function zN(e){return+e}function LN(e){return Math.floor(+e/1e3)}var lc,V6,q6;OY({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function OY(e){return lc=OH(e),V6=lc.format,lc.parse,q6=lc.utcFormat,lc.utcParse,lc}function zY(e){return new Date(e)}function LY(e){return e instanceof Date?+e:+new Date(+e)}function jj(e,t,r,s,i,a,o,l,c,u){var d=oj(),f=d.invert,h=d.domain,m=u(".%L"),g=u(":%S"),x=u("%I:%M"),y=u("%I %p"),v=u("%a %d"),S=u("%b %d"),k=u("%B"),j=u("%Y");function _(b){return(c(b)<b?m:l(b)<b?g:o(b)<b?x:a(b)<b?y:s(b)<b?i(b)<b?v:S:r(b)<b?k:j)(b)}return d.invert=function(b){return new Date(f(b))},d.domain=function(b){return arguments.length?h(Array.from(b,LY)):h().map(zY)},d.ticks=function(b){var A=h();return e(A[0],A[A.length-1],b??10)},d.tickFormat=function(b,A){return A==null?_:u(A)},d.nice=function(b){var A=h();return(!b||typeof b.range!="function")&&(b=t(A[0],A[A.length-1],b??10)),b?h(O6(A,b)):d},d.copy=function(){return Op(d,jj(e,t,r,s,i,a,o,l,c,u))},d}function $Y(){return hi.apply(jj(TH,RH,Fa,vj,zm,zp,xj,gj,yl,V6).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DY(){return hi.apply(jj(PH,IH,Wa,bj,Lm,Om,yj,mj,yl,q6).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function $m(){var e=0,t=1,r,s,i,a,o=ps,l=!1,c;function u(f){return f==null||isNaN(f=+f)?c:o(i===0?.5:(f=(a(f)-r)*i,l?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=a(e=+e),s=a(t=+t),i=r===s?0:1/(s-r),u):[e,t]},u.clamp=function(f){return arguments.length?(l=!!f,u):l},u.interpolator=function(f){return arguments.length?(o=f,u):o};function d(f){return function(h){var m,g;return arguments.length?([m,g]=h,o=f(m,g),u):[o(0),o(1)]}}return u.range=d(kd),u.rangeRound=d(aj),u.unknown=function(f){return arguments.length?(c=f,u):c},function(f){return a=f,r=f(e),s=f(t),i=r===s?0:1/(s-r),u}}function Zo(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function G6(){var e=Jo($m()(ps));return e.copy=function(){return Zo(e,G6())},Xa.apply(e,arguments)}function X6(){var e=dj($m()).domain([1,10]);return e.copy=function(){return Zo(e,X6()).base(e.base())},Xa.apply(e,arguments)}function Q6(){var e=uj($m());return e.copy=function(){return Zo(e,Q6()).constant(e.constant())},Xa.apply(e,arguments)}function wj(){var e=pj($m());return e.copy=function(){return Zo(e,wj()).exponent(e.exponent())},Xa.apply(e,arguments)}function MY(){return wj.apply(null,arguments).exponent(.5)}function J6(){var e=[],t=ps;function r(s){if(s!=null&&!isNaN(s=+s))return t((Tp(e,s,1)-1)/(e.length-1))}return r.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let i of s)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort($o),r},r.interpolator=function(s){return arguments.length?(t=s,r):t},r.range=function(){return e.map((s,i)=>t(i/(e.length-1)))},r.quantiles=function(s){return Array.from({length:s+1},(i,a)=>kU(e,a/s))},r.copy=function(){return J6(t).domain(e)},Xa.apply(r,arguments)}function Dm(){var e=0,t=.5,r=1,s=1,i,a,o,l,c,u=ps,d,f=!1,h;function m(x){return isNaN(x=+x)?h:(x=.5+((x=+d(x))-a)*(s*x<s*a?l:c),u(f?Math.max(0,Math.min(1,x)):x))}m.domain=function(x){return arguments.length?([e,t,r]=x,i=d(e=+e),a=d(t=+t),o=d(r=+r),l=i===a?0:.5/(a-i),c=a===o?0:.5/(o-a),s=a<i?-1:1,m):[e,t,r]},m.clamp=function(x){return arguments.length?(f=!!x,m):f},m.interpolator=function(x){return arguments.length?(u=x,m):u};function g(x){return function(y){var v,S,k;return arguments.length?([v,S,k]=y,u=QU(x,[v,S,k]),m):[u(0),u(.5),u(1)]}}return m.range=g(kd),m.rangeRound=g(aj),m.unknown=function(x){return arguments.length?(h=x,m):h},function(x){return d=x,i=x(e),a=x(t),o=x(r),l=i===a?0:.5/(a-i),c=a===o?0:.5/(o-a),s=a<i?-1:1,m}}function Z6(){var e=Jo(Dm()(ps));return e.copy=function(){return Zo(e,Z6())},Xa.apply(e,arguments)}function eT(){var e=dj(Dm()).domain([.1,1,10]);return e.copy=function(){return Zo(e,eT()).base(e.base())},Xa.apply(e,arguments)}function tT(){var e=uj(Dm());return e.copy=function(){return Zo(e,tT()).constant(e.constant())},Xa.apply(e,arguments)}function Sj(){var e=pj(Dm());return e.copy=function(){return Zo(e,Sj()).exponent(e.exponent())},Xa.apply(e,arguments)}function BY(){return Sj.apply(null,arguments).exponent(.5)}const ou=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:nj,scaleDiverging:Z6,scaleDivergingLog:eT,scaleDivergingPow:Sj,scaleDivergingSqrt:BY,scaleDivergingSymlog:tT,scaleIdentity:R6,scaleImplicit:I0,scaleLinear:T6,scaleLog:z6,scaleOrdinal:rj,scalePoint:_U,scalePow:fj,scaleQuantile:D6,scaleQuantize:M6,scaleRadial:$6,scaleSequential:G6,scaleSequentialLog:X6,scaleSequentialPow:wj,scaleSequentialQuantile:J6,scaleSequentialSqrt:MY,scaleSequentialSymlog:Q6,scaleSqrt:bH,scaleSymlog:L6,scaleThreshold:B6,scaleTime:$Y,scaleUtc:DY,tickFormat:I6},Symbol.toStringTag,{value:"Module"}));var el=e=>e.chartData,kj=ze([el],e=>{var t=e.chartData!=null?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),Mm=(e,t,r,s)=>s?kj(e):el(e);function Wo(e){if(Array.isArray(e)&&e.length===2){var[t,r]=e;if(nn(t)&&nn(r))return!0}return!1}function $N(e,t,r){return r?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function rT(e,t){if(t&&typeof e!="function"&&Array.isArray(e)&&e.length===2){var[r,s]=e,i,a;if(nn(r))i=r;else if(typeof r=="function")return;if(nn(s))a=s;else if(typeof s=="function")return;var o=[i,a];if(Wo(o))return o}}function FY(e,t,r){if(!(!r&&t==null)){if(typeof e=="function"&&t!=null)try{var s=e(t,r);if(Wo(s))return $N(s,t,r)}catch{}if(Array.isArray(e)&&e.length===2){var[i,a]=e,o,l;if(i==="auto")t!=null&&(o=Math.min(...t));else if(zt(i))o=i;else if(typeof i=="function")try{t!=null&&(o=i(t==null?void 0:t[0]))}catch{}else if(typeof i=="string"&&vk.test(i)){var c=vk.exec(i);if(c==null||t==null)o=void 0;else{var u=+c[1];o=t[0]-u}}else o=t==null?void 0:t[0];if(a==="auto")t!=null&&(l=Math.max(...t));else if(zt(a))l=a;else if(typeof a=="function")try{t!=null&&(l=a(t==null?void 0:t[1]))}catch{}else if(typeof a=="string"&&bk.test(a)){var d=bk.exec(a);if(d==null||t==null)l=void 0;else{var f=+d[1];l=t[1]+f}}else l=t==null?void 0:t[1];var h=[o,l];if(Wo(h))return t==null?h:$N(h,t,r)}}}var Nd=1e9,WY={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Cj,Wr=!0,fi="[DecimalError] ",$l=fi+"Invalid argument: ",Nj=fi+"Exponent out of range: ",Cd=Math.floor,ul=Math.pow,UY=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ws,Tn=1e7,$r=7,nT=9007199254740991,wg=Cd(nT/$r),Tt={};Tt.absoluteValue=Tt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Tt.comparedTo=Tt.cmp=function(e){var t,r,s,i,a=this;if(e=new a.constructor(e),a.s!==e.s)return a.s||-e.s;if(a.e!==e.e)return a.e>e.e^a.s<0?1:-1;for(s=a.d.length,i=e.d.length,t=0,r=s<i?s:i;t<r;++t)if(a.d[t]!==e.d[t])return a.d[t]>e.d[t]^a.s<0?1:-1;return s===i?0:s>i^a.s<0?1:-1};Tt.decimalPlaces=Tt.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*$r;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Tt.dividedBy=Tt.div=function(e){return Ia(this,new this.constructor(e))};Tt.dividedToIntegerBy=Tt.idiv=function(e){var t=this,r=t.constructor;return Er(Ia(t,new r(e),0,1),r.precision)};Tt.equals=Tt.eq=function(e){return!this.cmp(e)};Tt.exponent=function(){return fn(this)};Tt.greaterThan=Tt.gt=function(e){return this.cmp(e)>0};Tt.greaterThanOrEqualTo=Tt.gte=function(e){return this.cmp(e)>=0};Tt.isInteger=Tt.isint=function(){return this.e>this.d.length-2};Tt.isNegative=Tt.isneg=function(){return this.s<0};Tt.isPositive=Tt.ispos=function(){return this.s>0};Tt.isZero=function(){return this.s===0};Tt.lessThan=Tt.lt=function(e){return this.cmp(e)<0};Tt.lessThanOrEqualTo=Tt.lte=function(e){return this.cmp(e)<1};Tt.logarithm=Tt.log=function(e){var t,r=this,s=r.constructor,i=s.precision,a=i+5;if(e===void 0)e=new s(10);else if(e=new s(e),e.s<1||e.eq(Ws))throw Error(fi+"NaN");if(r.s<1)throw Error(fi+(r.s?"NaN":"-Infinity"));return r.eq(Ws)?new s(0):(Wr=!1,t=Ia(Zu(r,a),Zu(e,a),a),Wr=!0,Er(t,i))};Tt.minus=Tt.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?aT(t,e):sT(t,(e.s=-e.s,e))};Tt.modulo=Tt.mod=function(e){var t,r=this,s=r.constructor,i=s.precision;if(e=new s(e),!e.s)throw Error(fi+"NaN");return r.s?(Wr=!1,t=Ia(r,e,0,1).times(e),Wr=!0,r.minus(t)):Er(new s(r),i)};Tt.naturalExponential=Tt.exp=function(){return iT(this)};Tt.naturalLogarithm=Tt.ln=function(){return Zu(this)};Tt.negated=Tt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Tt.plus=Tt.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?sT(t,e):aT(t,(e.s=-e.s,e))};Tt.precision=Tt.sd=function(e){var t,r,s,i=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error($l+e);if(t=fn(i)+1,s=i.d.length-1,r=s*$r+1,s=i.d[s],s){for(;s%10==0;s/=10)r--;for(s=i.d[0];s>=10;s/=10)r++}return e&&t>r?t:r};Tt.squareRoot=Tt.sqrt=function(){var e,t,r,s,i,a,o,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(fi+"NaN")}for(e=fn(l),Wr=!1,i=Math.sqrt(+l),i==0||i==1/0?(t=Ji(l.d),(t.length+e)%2==0&&(t+="0"),i=Math.sqrt(t),e=Cd((e+1)/2)-(e<0||e%2),i==1/0?t="5e"+e:(t=i.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),s=new c(t)):s=new c(i.toString()),r=c.precision,i=o=r+3;;)if(a=s,s=a.plus(Ia(l,a,o+2)).times(.5),Ji(a.d).slice(0,o)===(t=Ji(s.d)).slice(0,o)){if(t=t.slice(o-3,o+1),i==o&&t=="4999"){if(Er(a,r+1,0),a.times(a).eq(l)){s=a;break}}else if(t!="9999")break;o+=4}return Wr=!0,Er(s,r)};Tt.times=Tt.mul=function(e){var t,r,s,i,a,o,l,c,u,d=this,f=d.constructor,h=d.d,m=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,c=h.length,u=m.length,c<u&&(a=h,h=m,m=a,o=c,c=u,u=o),a=[],o=c+u,s=o;s--;)a.push(0);for(s=u;--s>=0;){for(t=0,i=c+s;i>s;)l=a[i]+m[s]*h[i-s-1]+t,a[i--]=l%Tn|0,t=l/Tn|0;a[i]=(a[i]+t)%Tn|0}for(;!a[--o];)a.pop();return t?++r:a.shift(),e.d=a,e.e=r,Wr?Er(e,f.precision):e};Tt.toDecimalPlaces=Tt.todp=function(e,t){var r=this,s=r.constructor;return r=new s(r),e===void 0?r:(ia(e,0,Nd),t===void 0?t=s.rounding:ia(t,0,8),Er(r,e+fn(r)+1,t))};Tt.toExponential=function(e,t){var r,s=this,i=s.constructor;return e===void 0?r=Jl(s,!0):(ia(e,0,Nd),t===void 0?t=i.rounding:ia(t,0,8),s=Er(new i(s),e+1,t),r=Jl(s,!0,e+1)),r};Tt.toFixed=function(e,t){var r,s,i=this,a=i.constructor;return e===void 0?Jl(i):(ia(e,0,Nd),t===void 0?t=a.rounding:ia(t,0,8),s=Er(new a(i),e+fn(i)+1,t),r=Jl(s.abs(),!1,e+fn(s)+1),i.isneg()&&!i.isZero()?"-"+r:r)};Tt.toInteger=Tt.toint=function(){var e=this,t=e.constructor;return Er(new t(e),fn(e)+1,t.rounding)};Tt.toNumber=function(){return+this};Tt.toPower=Tt.pow=function(e){var t,r,s,i,a,o,l=this,c=l.constructor,u=12,d=+(e=new c(e));if(!e.s)return new c(Ws);if(l=new c(l),!l.s){if(e.s<1)throw Error(fi+"Infinity");return l}if(l.eq(Ws))return l;if(s=c.precision,e.eq(Ws))return Er(l,s);if(t=e.e,r=e.d.length-1,o=t>=r,a=l.s,o){if((r=d<0?-d:d)<=nT){for(i=new c(Ws),t=Math.ceil(s/$r+4),Wr=!1;r%2&&(i=i.times(l),MN(i.d,t)),r=Cd(r/2),r!==0;)l=l.times(l),MN(l.d,t);return Wr=!0,e.s<0?new c(Ws).div(i):Er(i,s)}}else if(a<0)throw Error(fi+"NaN");return a=a<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Wr=!1,i=e.times(Zu(l,s+u)),Wr=!0,i=iT(i),i.s=a,i};Tt.toPrecision=function(e,t){var r,s,i=this,a=i.constructor;return e===void 0?(r=fn(i),s=Jl(i,r<=a.toExpNeg||r>=a.toExpPos)):(ia(e,1,Nd),t===void 0?t=a.rounding:ia(t,0,8),i=Er(new a(i),e,t),r=fn(i),s=Jl(i,e<=r||r<=a.toExpNeg,e)),s};Tt.toSignificantDigits=Tt.tosd=function(e,t){var r=this,s=r.constructor;return e===void 0?(e=s.precision,t=s.rounding):(ia(e,1,Nd),t===void 0?t=s.rounding:ia(t,0,8)),Er(new s(r),e,t)};Tt.toString=Tt.valueOf=Tt.val=Tt.toJSON=Tt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=fn(e),r=e.constructor;return Jl(e,t<=r.toExpNeg||t>=r.toExpPos)};function sT(e,t){var r,s,i,a,o,l,c,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),Wr?Er(t,f):t;if(c=e.d,u=t.d,o=e.e,i=t.e,c=c.slice(),a=o-i,a){for(a<0?(s=c,a=-a,l=u.length):(s=u,i=o,l=c.length),o=Math.ceil(f/$r),l=o>l?o+1:l+1,a>l&&(a=l,s.length=1),s.reverse();a--;)s.push(0);s.reverse()}for(l=c.length,a=u.length,l-a<0&&(a=l,s=u,u=c,c=s),r=0;a;)r=(c[--a]=c[a]+u[a]+r)/Tn|0,c[a]%=Tn;for(r&&(c.unshift(r),++i),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=i,Wr?Er(t,f):t}function ia(e,t,r){if(e!==~~e||e<t||e>r)throw Error($l+e)}function Ji(e){var t,r,s,i=e.length-1,a="",o=e[0];if(i>0){for(a+=o,t=1;t<i;t++)s=e[t]+"",r=$r-s.length,r&&(a+=lo(r)),a+=s;o=e[t],s=o+"",r=$r-s.length,r&&(a+=lo(r))}else if(o===0)return"0";for(;o%10===0;)o/=10;return a+o}var Ia=function(){function e(s,i){var a,o=0,l=s.length;for(s=s.slice();l--;)a=s[l]*i+o,s[l]=a%Tn|0,o=a/Tn|0;return o&&s.unshift(o),s}function t(s,i,a,o){var l,c;if(a!=o)c=a>o?1:-1;else for(l=c=0;l<a;l++)if(s[l]!=i[l]){c=s[l]>i[l]?1:-1;break}return c}function r(s,i,a){for(var o=0;a--;)s[a]-=o,o=s[a]<i[a]?1:0,s[a]=o*Tn+s[a]-i[a];for(;!s[0]&&s.length>1;)s.shift()}return function(s,i,a,o){var l,c,u,d,f,h,m,g,x,y,v,S,k,j,_,b,A,z,D=s.constructor,w=s.s==i.s?1:-1,N=s.d,$=i.d;if(!s.s)return new D(s);if(!i.s)throw Error(fi+"Division by zero");for(c=s.e-i.e,A=$.length,_=N.length,m=new D(w),g=m.d=[],u=0;$[u]==(N[u]||0);)++u;if($[u]>(N[u]||0)&&--c,a==null?S=a=D.precision:o?S=a+(fn(s)-fn(i))+1:S=a,S<0)return new D(0);if(S=S/$r+2|0,u=0,A==1)for(d=0,$=$[0],S++;(u<_||d)&&S--;u++)k=d*Tn+(N[u]||0),g[u]=k/$|0,d=k%$|0;else{for(d=Tn/($[0]+1)|0,d>1&&($=e($,d),N=e(N,d),A=$.length,_=N.length),j=A,x=N.slice(0,A),y=x.length;y<A;)x[y++]=0;z=$.slice(),z.unshift(0),b=$[0],$[1]>=Tn/2&&++b;do d=0,l=t($,x,A,y),l<0?(v=x[0],A!=y&&(v=v*Tn+(x[1]||0)),d=v/b|0,d>1?(d>=Tn&&(d=Tn-1),f=e($,d),h=f.length,y=x.length,l=t(f,x,h,y),l==1&&(d--,r(f,A<h?z:$,h))):(d==0&&(l=d=1),f=$.slice()),h=f.length,h<y&&f.unshift(0),r(x,f,y),l==-1&&(y=x.length,l=t($,x,A,y),l<1&&(d++,r(x,A<y?z:$,y))),y=x.length):l===0&&(d++,x=[0]),g[u++]=d,l&&x[0]?x[y++]=N[j]||0:(x=[N[j]],y=1);while((j++<_||x[0]!==void 0)&&S--)}return g[0]||g.shift(),m.e=c,Er(m,o?a+fn(m)+1:a)}}();function iT(e,t){var r,s,i,a,o,l,c=0,u=0,d=e.constructor,f=d.precision;if(fn(e)>16)throw Error(Nj+fn(e));if(!e.s)return new d(Ws);for(Wr=!1,l=f,o=new d(.03125);e.abs().gte(.1);)e=e.times(o),u+=5;for(s=Math.log(ul(2,u))/Math.LN10*2+5|0,l+=s,r=i=a=new d(Ws),d.precision=l;;){if(i=Er(i.times(e),l),r=r.times(++c),o=a.plus(Ia(i,r,l)),Ji(o.d).slice(0,l)===Ji(a.d).slice(0,l)){for(;u--;)a=Er(a.times(a),l);return d.precision=f,t==null?(Wr=!0,Er(a,f)):a}a=o}}function fn(e){for(var t=e.e*$r,r=e.d[0];r>=10;r/=10)t++;return t}function hy(e,t,r){if(t>e.LN10.sd())throw Wr=!0,r&&(e.precision=r),Error(fi+"LN10 precision limit exceeded");return Er(new e(e.LN10),t)}function lo(e){for(var t="";e--;)t+="0";return t}function Zu(e,t){var r,s,i,a,o,l,c,u,d,f=1,h=10,m=e,g=m.d,x=m.constructor,y=x.precision;if(m.s<1)throw Error(fi+(m.s?"NaN":"-Infinity"));if(m.eq(Ws))return new x(0);if(t==null?(Wr=!1,u=y):u=t,m.eq(10))return t==null&&(Wr=!0),hy(x,u);if(u+=h,x.precision=u,r=Ji(g),s=r.charAt(0),a=fn(m),Math.abs(a)<15e14){for(;s<7&&s!=1||s==1&&r.charAt(1)>3;)m=m.times(e),r=Ji(m.d),s=r.charAt(0),f++;a=fn(m),s>1?(m=new x("0."+r),a++):m=new x(s+"."+r.slice(1))}else return c=hy(x,u+2,y).times(a+""),m=Zu(new x(s+"."+r.slice(1)),u-h).plus(c),x.precision=y,t==null?(Wr=!0,Er(m,y)):m;for(l=o=m=Ia(m.minus(Ws),m.plus(Ws),u),d=Er(m.times(m),u),i=3;;){if(o=Er(o.times(d),u),c=l.plus(Ia(o,new x(i),u)),Ji(c.d).slice(0,u)===Ji(l.d).slice(0,u))return l=l.times(2),a!==0&&(l=l.plus(hy(x,u+2,y).times(a+""))),l=Ia(l,new x(f),u),x.precision=y,t==null?(Wr=!0,Er(l,y)):l;l=c,i+=2}}function DN(e,t){var r,s,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(r<0&&(r=s),r+=+t.slice(s+1),t=t.substring(0,s)):r<0&&(r=t.length),s=0;t.charCodeAt(s)===48;)++s;for(i=t.length;t.charCodeAt(i-1)===48;)--i;if(t=t.slice(s,i),t){if(i-=s,r=r-s-1,e.e=Cd(r/$r),e.d=[],s=(r+1)%$r,r<0&&(s+=$r),s<i){for(s&&e.d.push(+t.slice(0,s)),i-=$r;s<i;)e.d.push(+t.slice(s,s+=$r));t=t.slice(s),s=$r-t.length}else s-=i;for(;s--;)t+="0";if(e.d.push(+t),Wr&&(e.e>wg||e.e<-wg))throw Error(Nj+r)}else e.s=0,e.e=0,e.d=[0];return e}function Er(e,t,r){var s,i,a,o,l,c,u,d,f=e.d;for(o=1,a=f[0];a>=10;a/=10)o++;if(s=t-o,s<0)s+=$r,i=t,u=f[d=0];else{if(d=Math.ceil((s+1)/$r),a=f.length,d>=a)return e;for(u=a=f[d],o=1;a>=10;a/=10)o++;s%=$r,i=s-$r+o}if(r!==void 0&&(a=ul(10,o-i-1),l=u/a%10|0,c=t<0||f[d+1]!==void 0||u%a,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(s>0?i>0?u/ul(10,o-i):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(a=fn(e),f.length=1,t=t-a-1,f[0]=ul(10,($r-t%$r)%$r),e.e=Cd(-t/$r)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(s==0?(f.length=d,a=1,d--):(f.length=d+1,a=ul(10,$r-s),f[d]=i>0?(u/ul(10,o-i)%ul(10,i)|0)*a:0),c)for(;;)if(d==0){(f[0]+=a)==Tn&&(f[0]=1,++e.e);break}else{if(f[d]+=a,f[d]!=Tn)break;f[d--]=0,a=1}for(s=f.length;f[--s]===0;)f.pop();if(Wr&&(e.e>wg||e.e<-wg))throw Error(Nj+fn(e));return e}function aT(e,t){var r,s,i,a,o,l,c,u,d,f,h=e.constructor,m=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Wr?Er(t,m):t;if(c=e.d,f=t.d,s=t.e,u=e.e,c=c.slice(),o=u-s,o){for(d=o<0,d?(r=c,o=-o,l=f.length):(r=f,s=u,l=c.length),i=Math.max(Math.ceil(m/$r),l)+2,o>i&&(o=i,r.length=1),r.reverse(),i=o;i--;)r.push(0);r.reverse()}else{for(i=c.length,l=f.length,d=i<l,d&&(l=i),i=0;i<l;i++)if(c[i]!=f[i]){d=c[i]<f[i];break}o=0}for(d&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,i=f.length-l;i>0;--i)c[l++]=0;for(i=f.length;i>o;){if(c[--i]<f[i]){for(a=i;a&&c[--a]===0;)c[a]=Tn-1;--c[a],c[i]+=Tn}c[i]-=f[i]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--s;return c[0]?(t.d=c,t.e=s,Wr?Er(t,m):t):new h(0)}function Jl(e,t,r){var s,i=fn(e),a=Ji(e.d),o=a.length;return t?(r&&(s=r-o)>0?a=a.charAt(0)+"."+a.slice(1)+lo(s):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(i<0?"e":"e+")+i):i<0?(a="0."+lo(-i-1)+a,r&&(s=r-o)>0&&(a+=lo(s))):i>=o?(a+=lo(i+1-o),r&&(s=r-i-1)>0&&(a=a+"."+lo(s))):((s=i+1)<o&&(a=a.slice(0,s)+"."+a.slice(s)),r&&(s=r-o)>0&&(i+1===o&&(a+="."),a+=lo(s))),e.s<0?"-"+a:a}function MN(e,t){if(e.length>t)return e.length=t,!0}function oT(e){var t,r,s;function i(a){var o=this;if(!(o instanceof i))return new i(a);if(o.constructor=i,a instanceof i){o.s=a.s,o.e=a.e,o.d=(a=a.d)?a.slice():a;return}if(typeof a=="number"){if(a*0!==0)throw Error($l+a);if(a>0)o.s=1;else if(a<0)a=-a,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(a===~~a&&a<1e7){o.e=0,o.d=[a];return}return DN(o,a.toString())}else if(typeof a!="string")throw Error($l+a);if(a.charCodeAt(0)===45?(a=a.slice(1),o.s=-1):o.s=1,UY.test(a))DN(o,a);else throw Error($l+a)}if(i.prototype=Tt,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=oT,i.config=i.set=HY,e===void 0&&(e={}),e)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<s.length;)e.hasOwnProperty(r=s[t++])||(e[r]=this[r]);return i.config(e),i}function HY(e){if(!e||typeof e!="object")throw Error(fi+"Object expected");var t,r,s,i=["precision",1,Nd,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<i.length;t+=3)if((s=e[r=i[t]])!==void 0)if(Cd(s)===s&&s>=i[t+1]&&s<=i[t+2])this[r]=s;else throw Error($l+r+": "+s);if((s=e[r="LN10"])!==void 0)if(s==Math.LN10)this[r]=new this(s);else throw Error($l+r+": "+s);return this}var Cj=oT(WY);Ws=new Cj(1);const Nr=Cj;var YY=e=>e,lT={},cT=e=>e===lT,BN=e=>function t(){return arguments.length===0||arguments.length===1&&cT(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},dT=(e,t)=>e===1?t:BN(function(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];var a=s.filter(o=>o!==lT).length;return a>=e?t(...s):dT(e-a,BN(function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];var u=s.map(d=>cT(d)?l.shift():d);return t(...u,...l)}))}),KY=e=>dT(e.length,e),z0=(e,t)=>{for(var r=[],s=e;s<t;++s)r[s-e]=s;return r},VY=KY((e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(r=>t[r]).map(e)),qY=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(!r.length)return YY;var i=r.reverse(),a=i[0],o=i.slice(1);return function(){return o.reduce((l,c)=>c(l),a(...arguments))}},L0=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join("");function uT(e){var t;return e===0?t=1:t=Math.floor(new Nr(e).abs().log(10).toNumber())+1,t}function pT(e,t,r){for(var s=new Nr(e),i=0,a=[];s.lt(t)&&i<1e5;)a.push(s.toNumber()),s=s.add(r),i++;return a}var fT=e=>{var[t,r]=e,[s,i]=[t,r];return t>r&&([s,i]=[r,t]),[s,i]},hT=(e,t,r)=>{if(e.lte(0))return new Nr(0);var s=uT(e.toNumber()),i=new Nr(10).pow(s),a=e.div(i),o=s!==1?.05:.1,l=new Nr(Math.ceil(a.div(o).toNumber())).add(r).mul(o),c=l.mul(i);return t?new Nr(c.toNumber()):new Nr(Math.ceil(c.toNumber()))},GY=(e,t,r)=>{var s=new Nr(1),i=new Nr(e);if(!i.isint()&&r){var a=Math.abs(e);a<1?(s=new Nr(10).pow(uT(e)-1),i=new Nr(Math.floor(i.div(s).toNumber())).mul(s)):a>1&&(i=new Nr(Math.floor(e)))}else e===0?i=new Nr(Math.floor((t-1)/2)):r||(i=new Nr(Math.floor(e)));var o=Math.floor((t-1)/2),l=qY(VY(c=>i.add(new Nr(c-o).mul(s)).toNumber()),z0);return l(0,t)},gT=function(t,r,s,i){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((r-t)/(s-1)))return{step:new Nr(0),tickMin:new Nr(0),tickMax:new Nr(0)};var o=hT(new Nr(r).sub(t).div(s-1),i,a),l;t<=0&&r>=0?l=new Nr(0):(l=new Nr(t).add(r).div(2),l=l.sub(new Nr(l).mod(o)));var c=Math.ceil(l.sub(t).div(o).toNumber()),u=Math.ceil(new Nr(r).sub(l).div(o).toNumber()),d=c+u+1;return d>s?gT(t,r,s,i,a+1):(d<s&&(u=r>0?u+(s-d):u,c=r>0?c:c+(s-d)),{step:o,tickMin:l.sub(new Nr(c).mul(o)),tickMax:l.add(new Nr(u).mul(o))})},XY=function(t){var[r,s]=t,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=Math.max(i,2),[l,c]=fT([r,s]);if(l===-1/0||c===1/0){var u=c===1/0?[l,...z0(0,i-1).map(()=>1/0)]:[...z0(0,i-1).map(()=>-1/0),c];return r>s?L0(u):u}if(l===c)return GY(l,i,a);var{step:d,tickMin:f,tickMax:h}=gT(l,c,o,a,0),m=pT(f,h.add(new Nr(.1).mul(d)),d);return r>s?L0(m):m},QY=function(t,r){var[s,i]=t,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[o,l]=fT([s,i]);if(o===-1/0||l===1/0)return[s,i];if(o===l)return[o];var c=Math.max(r,2),u=hT(new Nr(l).sub(o).div(c-1),a,0),d=[...pT(new Nr(o),new Nr(l),u),l];return a===!1&&(d=d.map(f=>Math.round(f))),s>i?L0(d):d},mT=e=>e.rootProps.maxBarSize,JY=e=>e.rootProps.barGap,xT=e=>e.rootProps.barCategoryGap,ZY=e=>e.rootProps.barSize,Lp=e=>e.rootProps.stackOffset,yT=e=>e.rootProps.reverseStackOrder,_j=e=>e.options.chartName,Aj=e=>e.rootProps.syncId,vT=e=>e.rootProps.syncMethod,Ej=e=>e.options.eventEmitter,un={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},Sa={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},Bs={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},Bm=(e,t)=>{if(!(!e||!t))return e!=null&&e.reversed?[t[1],t[0]]:t},eK={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:Sa.angleAxisId,includeHidden:!1,name:void 0,reversed:Sa.reversed,scale:Sa.scale,tick:Sa.tick,tickCount:void 0,ticks:void 0,type:Sa.type,unit:void 0},tK={allowDataOverflow:Bs.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Bs.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Bs.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Bs.scale,tick:Bs.tick,tickCount:Bs.tickCount,ticks:void 0,type:Bs.type,unit:void 0},rK={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:Sa.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Sa.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Sa.scale,tick:Sa.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},nK={allowDataOverflow:Bs.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Bs.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Bs.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Bs.scale,tick:Bs.tick,tickCount:Bs.tickCount,ticks:void 0,type:"category",unit:void 0},Pj=(e,t)=>e.polarAxis.angleAxis[t]!=null?e.polarAxis.angleAxis[t]:e.layout.layoutType==="radial"?rK:eK,Ij=(e,t)=>e.polarAxis.radiusAxis[t]!=null?e.polarAxis.radiusAxis[t]:e.layout.layoutType==="radial"?nK:tK,Fm=e=>e.polarOptions,Tj=ze([qa,Ga,kn],h6),bT=ze([Fm,Tj],(e,t)=>{if(e!=null)return rs(e.innerRadius,t,0)}),jT=ze([Fm,Tj],(e,t)=>{if(e!=null)return rs(e.outerRadius,t,t*.8)}),sK=e=>{if(e==null)return[0,0];var{startAngle:t,endAngle:r}=e;return[t,r]},wT=ze([Fm],sK);ze([Pj,wT],Bm);var ST=ze([Tj,bT,jT],(e,t,r)=>{if(!(e==null||t==null||r==null))return[t,r]});ze([Ij,ST],Bm);var kT=ze([gr,Fm,bT,jT,qa,Ga],(e,t,r,s,i,a)=>{if(!(e!=="centric"&&e!=="radial"||t==null||r==null||s==null)){var{cx:o,cy:l,startAngle:c,endAngle:u}=t;return{cx:rs(o,i,i/2),cy:rs(l,a,a/2),innerRadius:r,outerRadius:s,startAngle:c,endAngle:u,clockWise:!1}}}),Hr=(e,t)=>t,$p=(e,t,r)=>r;function Rj(e){return e==null?void 0:e.id}function NT(e,t,r){var{chartData:s=[]}=t,{allowDuplicatedCategory:i,dataKey:a}=r,o=new Map;return e.forEach(l=>{var c,u=(c=l.data)!==null&&c!==void 0?c:s;if(!(u==null||u.length===0)){var d=Rj(l);u.forEach((f,h)=>{var m=a==null||i?h:String(Ar(f,a,null)),g=Ar(f,l.dataKey,0),x;o.has(m)?x=o.get(m):x={},Object.assign(x,{[d]:g}),o.set(m,x)})}}),Array.from(o.values())}function Wm(e){return e.stackId!=null&&e.dataKey!=null}var Um=(e,t)=>e===t?!0:e==null||t==null?!1:e[0]===t[0]&&e[1]===t[1];function Hm(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===0&&t.length===0?!0:e===t}function iK(e,t){if(e.length===t.length){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1}var Cn=e=>{var t=gr(e);return t==="horizontal"?"xAxis":t==="vertical"?"yAxis":t==="centric"?"angleAxis":"radiusAxis"},_d=e=>e.tooltip.settings.axisId;function FN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Sg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FN(Object(r),!0).forEach(function(s){aK(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function aK(e,t,r){return(t=oK(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oK(e){var t=lK(e,"string");return typeof t=="symbol"?t:t+""}function lK(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $0=[0,"auto"],En={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},CT=(e,t)=>e.cartesianAxis.xAxis[t],Qa=(e,t)=>{var r=CT(e,t);return r??En},Pn={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:$0,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Cp},_T=(e,t)=>e.cartesianAxis.yAxis[t],Ja=(e,t)=>{var r=_T(e,t);return r??Pn},cK={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},Oj=(e,t)=>{var r=e.cartesianAxis.zAxis[t];return r??cK},Gr=(e,t,r)=>{switch(t){case"xAxis":return Qa(e,r);case"yAxis":return Ja(e,r);case"zAxis":return Oj(e,r);case"angleAxis":return Pj(e,r);case"radiusAxis":return Ij(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},dK=(e,t,r)=>{switch(t){case"xAxis":return Qa(e,r);case"yAxis":return Ja(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},Dp=(e,t,r)=>{switch(t){case"xAxis":return Qa(e,r);case"yAxis":return Ja(e,r);case"angleAxis":return Pj(e,r);case"radiusAxis":return Ij(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},AT=e=>e.graphicalItems.cartesianItems.some(t=>t.type==="bar")||e.graphicalItems.polarItems.some(t=>t.type==="radialBar");function zj(e,t){return r=>{switch(e){case"xAxis":return"xAxisId"in r&&r.xAxisId===t;case"yAxis":return"yAxisId"in r&&r.yAxisId===t;case"zAxis":return"zAxisId"in r&&r.zAxisId===t;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===t;default:return!1}}}var Ym=e=>e.graphicalItems.cartesianItems,uK=ze([Hr,$p],zj),Lj=(e,t,r)=>e.filter(r).filter(s=>(t==null?void 0:t.includeHidden)===!0?!0:!s.hide),Mp=ze([Ym,Gr,uK],Lj,{memoizeOptions:{resultEqualityCheck:Hm}}),ET=ze([Mp],e=>e.filter(t=>t.type==="area"||t.type==="bar").filter(Wm)),PT=e=>e.filter(t=>!("stackId"in t)||t.stackId===void 0),pK=ze([Mp],PT),$j=e=>e.map(t=>t.data).filter(Boolean).flat(1),fK=ze([Mp],$j,{memoizeOptions:{resultEqualityCheck:Hm}}),Dj=(e,t)=>{var{chartData:r=[],dataStartIndex:s,dataEndIndex:i}=t;return e.length>0?e:r.slice(s,i+1)},Mj=ze([fK,Mm],Dj),Bj=(e,t,r)=>(t==null?void 0:t.dataKey)!=null?e.map(s=>({value:Ar(s,t.dataKey)})):r.length>0?r.map(s=>s.dataKey).flatMap(s=>e.map(i=>({value:Ar(i,s)}))):e.map(s=>({value:s})),Km=ze([Mj,Gr,Mp],Bj);function IT(e,t){switch(e){case"xAxis":return t.direction==="x";case"yAxis":return t.direction==="y";default:return!1}}function oh(e){if(na(e)||e instanceof Date){var t=Number(e);if(nn(t))return t}}function WN(e){if(Array.isArray(e)){var t=[oh(e[0]),oh(e[1])];return Wo(t)?t:void 0}var r=oh(e);if(r!=null)return[r,r]}function Ua(e){return e.map(oh).filter(CB)}function hK(e,t,r){return!r||typeof t!="number"||$i(t)?[]:r.length?Ua(r.flatMap(s=>{var i=Ar(e,s.dataKey),a,o;if(Array.isArray(i)?[a,o]=i:a=o=i,!(!nn(a)||!nn(o)))return[t-a,t+o]})):[]}var _n=e=>{var t=Cn(e),r=_d(e);return Dp(e,t,r)},Bp=ze([_n],e=>e==null?void 0:e.dataKey),gK=ze([ET,Mm,_n],NT),TT=(e,t,r,s)=>{var i={},a=t.reduce((o,l)=>(l.stackId==null||(o[l.stackId]==null&&(o[l.stackId]=[]),o[l.stackId].push(l)),o),i);return Object.fromEntries(Object.entries(a).map(o=>{var[l,c]=o,u=s?[...c].reverse():c,d=u.map(Rj);return[l,{stackedData:U7(e,d,r),graphicalItems:u}]}))},D0=ze([gK,ET,Lp,yT],TT),RT=(e,t,r,s)=>{var{dataStartIndex:i,dataEndIndex:a}=t;if(s==null&&r!=="zAxis"){var o=q7(e,i,a);if(!(o!=null&&o[0]===0&&o[1]===0))return o}},mK=ze([Gr],e=>e.allowDataOverflow),Fj=e=>{var t;if(e==null||!("domain"in e))return $0;if(e.domain!=null)return e.domain;if(e.ticks!=null){if(e.type==="number"){var r=Ua(e.ticks);return[Math.min(...r),Math.max(...r)]}if(e.type==="category")return e.ticks.map(String)}return(t=e==null?void 0:e.domain)!==null&&t!==void 0?t:$0},Wj=ze([Gr],Fj),Uj=ze([Wj,mK],rT),xK=ze([D0,el,Hr,Uj],RT,{memoizeOptions:{resultEqualityCheck:Um}}),Vm=e=>e.errorBars,yK=(e,t,r)=>e.flatMap(s=>t[s.id]).filter(Boolean).filter(s=>IT(r,s)),kg=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];var i=r.filter(Boolean);if(i.length!==0){var a=i.flat(),o=Math.min(...a),l=Math.max(...a);return[o,l]}},Hj=(e,t,r,s,i)=>{var a,o;if(r.length>0&&e.forEach(l=>{r.forEach(c=>{var u,d,f=(u=s[c.id])===null||u===void 0?void 0:u.filter(v=>IT(i,v)),h=Ar(l,(d=t.dataKey)!==null&&d!==void 0?d:c.dataKey),m=hK(l,h,f);if(m.length>=2){var g=Math.min(...m),x=Math.max(...m);(a==null||g<a)&&(a=g),(o==null||x>o)&&(o=x)}var y=WN(h);y!=null&&(a=a==null?y[0]:Math.min(a,y[0]),o=o==null?y[1]:Math.max(o,y[1]))})}),(t==null?void 0:t.dataKey)!=null&&e.forEach(l=>{var c=WN(Ar(l,t.dataKey));c!=null&&(a=a==null?c[0]:Math.min(a,c[0]),o=o==null?c[1]:Math.max(o,c[1]))}),nn(a)&&nn(o))return[a,o]},vK=ze([Mj,Gr,pK,Vm,Hr],Hj,{memoizeOptions:{resultEqualityCheck:Um}});function bK(e){var{value:t}=e;if(na(t)||t instanceof Date)return t}var jK=(e,t,r)=>{var s=e.map(bK).filter(i=>i!=null);return r&&(t.dataKey==null||t.allowDuplicatedCategory&&AP(s))?j6(0,e.length):t.allowDuplicatedCategory?s:Array.from(new Set(s))},OT=e=>e.referenceElements.dots,Ad=(e,t,r)=>e.filter(s=>s.ifOverflow==="extendDomain").filter(s=>t==="xAxis"?s.xAxisId===r:s.yAxisId===r),wK=ze([OT,Hr,$p],Ad),zT=e=>e.referenceElements.areas,SK=ze([zT,Hr,$p],Ad),LT=e=>e.referenceElements.lines,kK=ze([LT,Hr,$p],Ad),$T=(e,t)=>{var r=Ua(e.map(s=>t==="xAxis"?s.x:s.y));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},NK=ze(wK,Hr,$T),DT=(e,t)=>{var r=Ua(e.flatMap(s=>[t==="xAxis"?s.x1:s.y1,t==="xAxis"?s.x2:s.y2]));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},CK=ze([SK,Hr],DT);function _K(e){var t;if(e.x!=null)return Ua([e.x]);var r=(t=e.segment)===null||t===void 0?void 0:t.map(s=>s.x);return r==null||r.length===0?[]:Ua(r)}function AK(e){var t;if(e.y!=null)return Ua([e.y]);var r=(t=e.segment)===null||t===void 0?void 0:t.map(s=>s.y);return r==null||r.length===0?[]:Ua(r)}var MT=(e,t)=>{var r=e.flatMap(s=>t==="xAxis"?_K(s):AK(s));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},EK=ze([kK,Hr],MT),PK=ze(NK,EK,CK,(e,t,r)=>kg(e,r,t)),Yj=(e,t,r,s,i,a,o,l)=>{if(r!=null)return r;var c=o==="vertical"&&l==="xAxis"||o==="horizontal"&&l==="yAxis",u=c?kg(s,a,i):kg(a,i);return FY(t,u,e.allowDataOverflow)},IK=ze([Gr,Wj,Uj,xK,vK,PK,gr,Hr],Yj,{memoizeOptions:{resultEqualityCheck:Um}}),TK=[0,1],Kj=(e,t,r,s,i,a,o)=>{if(!((e==null||r==null||r.length===0)&&o===void 0)){var{dataKey:l,type:c}=e,u=Qo(t,a);if(u&&l==null){var d;return j6(0,(d=r==null?void 0:r.length)!==null&&d!==void 0?d:0)}return c==="category"?jK(s,e,u):i==="expand"?TK:o}},Vj=ze([Gr,gr,Mj,Km,Lp,Hr,IK],Kj),BT=(e,t,r,s,i)=>{if(e!=null){var{scale:a,type:o}=e;if(a==="auto")return t==="radial"&&i==="radiusAxis"?"band":t==="radial"&&i==="angleAxis"?"linear":o==="category"&&s&&(s.indexOf("LineChart")>=0||s.indexOf("AreaChart")>=0||s.indexOf("ComposedChart")>=0&&!r)?"point":o==="category"?"band":"linear";if(typeof a=="string"){var l="scale".concat(bp(a));return l in ou?l:"point"}}},Ed=ze([Gr,gr,AT,_j,Hr],BT);function RK(e){if(e!=null){if(e in ou)return ou[e]();var t="scale".concat(bp(e));if(t in ou)return ou[t]()}}function qj(e,t,r,s){if(!(r==null||s==null)){if(typeof e.scale=="function")return e.scale.copy().domain(r).range(s);var i=RK(t);if(i!=null){var a=i.domain(r).range(s);return D7(a),a}}}var Gj=(e,t,r)=>{var s=Fj(t);if(!(r!=="auto"&&r!=="linear")){if(t!=null&&t.tickCount&&Array.isArray(s)&&(s[0]==="auto"||s[1]==="auto")&&Wo(e))return XY(e,t.tickCount,t.allowDecimals);if(t!=null&&t.tickCount&&t.type==="number"&&Wo(e))return QY(e,t.tickCount,t.allowDecimals)}},Xj=ze([Vj,Dp,Ed],Gj),Qj=(e,t,r,s)=>{if(s!=="angleAxis"&&(e==null?void 0:e.type)==="number"&&Wo(t)&&Array.isArray(r)&&r.length>0){var i=t[0],a=r[0],o=t[1],l=r[r.length-1];return[Math.min(i,a),Math.max(o,l)]}return t},OK=ze([Gr,Vj,Xj,Hr],Qj),zK=ze(Km,Gr,(e,t)=>{if(!(!t||t.type!=="number")){var r=1/0,s=Array.from(Ua(e.map(l=>l.value))).sort((l,c)=>l-c);if(s.length<2)return 1/0;var i=s[s.length-1]-s[0];if(i===0)return 1/0;for(var a=0;a<s.length-1;a++){var o=s[a+1]-s[a];r=Math.min(r,o)}return r/i}}),FT=ze(zK,gr,xT,kn,(e,t,r,s)=>s,(e,t,r,s,i)=>{if(!nn(e))return 0;var a=t==="vertical"?s.height:s.width;if(i==="gap")return e*a/2;if(i==="no-gap"){var o=rs(r,e*a),l=e*a/2;return l-o-(l-o)/a*o}return 0}),LK=(e,t)=>{var r=Qa(e,t);return r==null||typeof r.padding!="string"?0:FT(e,"xAxis",t,r.padding)},$K=(e,t)=>{var r=Ja(e,t);return r==null||typeof r.padding!="string"?0:FT(e,"yAxis",t,r.padding)},DK=ze(Qa,LK,(e,t)=>{var r,s;if(e==null)return{left:0,right:0};var{padding:i}=e;return typeof i=="string"?{left:t,right:t}:{left:((r=i.left)!==null&&r!==void 0?r:0)+t,right:((s=i.right)!==null&&s!==void 0?s:0)+t}}),MK=ze(Ja,$K,(e,t)=>{var r,s;if(e==null)return{top:0,bottom:0};var{padding:i}=e;return typeof i=="string"?{top:t,bottom:t}:{top:((r=i.top)!==null&&r!==void 0?r:0)+t,bottom:((s=i.bottom)!==null&&s!==void 0?s:0)+t}}),BK=ze([kn,DK,_m,Cm,(e,t,r)=>r],(e,t,r,s,i)=>{var{padding:a}=s;return i?[a.left,r.width-a.right]:[e.left+t.left,e.left+e.width-t.right]}),FK=ze([kn,gr,MK,_m,Cm,(e,t,r)=>r],(e,t,r,s,i,a)=>{var{padding:o}=i;return a?[s.height-o.bottom,o.top]:t==="horizontal"?[e.top+e.height-r.bottom,e.top+r.top]:[e.top+r.top,e.top+e.height-r.bottom]}),Fp=(e,t,r,s)=>{var i;switch(t){case"xAxis":return BK(e,r,s);case"yAxis":return FK(e,r,s);case"zAxis":return(i=Oj(e,r))===null||i===void 0?void 0:i.range;case"angleAxis":return wT(e);case"radiusAxis":return ST(e,r);default:return}},WT=ze([Gr,Fp],Bm),Pd=ze([Gr,Ed,OK,WT],qj);ze([Mp,Vm,Hr],yK);function UT(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var qm=(e,t)=>t,Gm=(e,t,r)=>r,WK=ze(km,qm,Gm,(e,t,r)=>e.filter(s=>s.orientation===t).filter(s=>s.mirror===r).sort(UT)),UK=ze(Nm,qm,Gm,(e,t,r)=>e.filter(s=>s.orientation===t).filter(s=>s.mirror===r).sort(UT)),HT=(e,t)=>({width:e.width,height:t.height}),HK=(e,t)=>{var r=typeof t.width=="number"?t.width:Cp;return{width:r,height:e.height}},YT=ze(kn,Qa,HT),YK=(e,t,r)=>{switch(t){case"top":return e.top;case"bottom":return r-e.bottom;default:return 0}},KK=(e,t,r)=>{switch(t){case"left":return e.left;case"right":return r-e.right;default:return 0}},VK=ze(Ga,kn,WK,qm,Gm,(e,t,r,s,i)=>{var a={},o;return r.forEach(l=>{var c=HT(t,l);o==null&&(o=YK(t,s,e));var u=s==="top"&&!i||s==="bottom"&&i;a[l.id]=o-Number(u)*c.height,o+=(u?-1:1)*c.height}),a}),qK=ze(qa,kn,UK,qm,Gm,(e,t,r,s,i)=>{var a={},o;return r.forEach(l=>{var c=HK(t,l);o==null&&(o=KK(t,s,e));var u=s==="left"&&!i||s==="right"&&i;a[l.id]=o-Number(u)*c.width,o+=(u?-1:1)*c.width}),a}),GK=(e,t)=>{var r=Qa(e,t);if(r!=null)return VK(e,r.orientation,r.mirror)},XK=ze([kn,Qa,GK,(e,t)=>t],(e,t,r,s)=>{if(t!=null){var i=r==null?void 0:r[s];return i==null?{x:e.left,y:0}:{x:e.left,y:i}}}),QK=(e,t)=>{var r=Ja(e,t);if(r!=null)return qK(e,r.orientation,r.mirror)},JK=ze([kn,Ja,QK,(e,t)=>t],(e,t,r,s)=>{if(t!=null){var i=r==null?void 0:r[s];return i==null?{x:0,y:e.top}:{x:i,y:e.top}}}),KT=ze(kn,Ja,(e,t)=>{var r=typeof t.width=="number"?t.width:Cp;return{width:r,height:e.height}}),UN=(e,t,r)=>{switch(t){case"xAxis":return YT(e,r).width;case"yAxis":return KT(e,r).height;default:return}},VT=(e,t,r,s)=>{if(r!=null){var{allowDuplicatedCategory:i,type:a,dataKey:o}=r,l=Qo(e,s),c=t.map(u=>u.value);if(o&&l&&a==="category"&&i&&AP(c))return c}},Jj=ze([gr,Km,Gr,Hr],VT),qT=(e,t,r,s)=>{if(!(r==null||r.dataKey==null)){var{type:i,scale:a}=r,o=Qo(e,s);if(o&&(i==="number"||a!=="auto"))return t.map(l=>l.value)}},Zj=ze([gr,Km,Dp,Hr],qT),HN=ze([gr,dK,Ed,Pd,Jj,Zj,Fp,Xj,Hr],(e,t,r,s,i,a,o,l,c)=>{if(t!=null){var u=Qo(e,c);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:c,categoricalDomain:a,duplicateDomain:i,isCategorical:u,niceTicks:l,range:o,realScaleType:r,scale:s}}}),ZK=(e,t,r,s,i,a,o,l,c)=>{if(!(t==null||s==null)){var u=Qo(e,c),{type:d,ticks:f,tickCount:h}=t,m=r==="scaleBand"&&typeof s.bandwidth=="function"?s.bandwidth()/2:2,g=d==="category"&&s.bandwidth?s.bandwidth()/m:0;g=c==="angleAxis"&&a!=null&&a.length>=2?On(a[0]-a[1])*2*g:g;var x=f||i;if(x){var y=x.map((v,S)=>{var k=o?o.indexOf(v):v;return{index:S,coordinate:s(k)+g,value:v,offset:g}});return y.filter(v=>nn(v.coordinate))}return u&&l?l.map((v,S)=>({coordinate:s(v)+g,value:v,index:S,offset:g})).filter(v=>nn(v.coordinate)):s.ticks?s.ticks(h).map(v=>({coordinate:s(v)+g,value:v,offset:g})):s.domain().map((v,S)=>({coordinate:s(v)+g,value:o?o[v]:v,index:S,offset:g}))}},GT=ze([gr,Dp,Ed,Pd,Xj,Fp,Jj,Zj,Hr],ZK),eV=(e,t,r,s,i,a,o)=>{if(!(t==null||r==null||s==null||s[0]===s[1])){var l=Qo(e,o),{tickCount:c}=t,u=0;return u=o==="angleAxis"&&(s==null?void 0:s.length)>=2?On(s[0]-s[1])*2*u:u,l&&a?a.map((d,f)=>({coordinate:r(d)+u,value:d,index:f,offset:u})):r.ticks?r.ticks(c).map(d=>({coordinate:r(d)+u,value:d,offset:u})):r.domain().map((d,f)=>({coordinate:r(d)+u,value:i?i[d]:d,index:f,offset:u}))}},Uo=ze([gr,Dp,Pd,Fp,Jj,Zj,Hr],eV),Ho=ze(Gr,Pd,(e,t)=>{if(!(e==null||t==null))return Sg(Sg({},e),{},{scale:t})}),tV=ze([Gr,Ed,Vj,WT],qj);ze((e,t,r)=>Oj(e,r),tV,(e,t)=>{if(!(e==null||t==null))return Sg(Sg({},e),{},{scale:t})});var rV=ze([gr,km,Nm],(e,t,r)=>{switch(e){case"horizontal":return t.some(s=>s.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(s=>s.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),XT=e=>e.options.defaultTooltipEventType,QT=e=>e.options.validateTooltipEventTypes;function JT(e,t,r){if(e==null)return t;var s=e?"axis":"item";return r==null?t:r.includes(s)?s:t}function ew(e,t){var r=XT(e),s=QT(e);return JT(t,r,s)}function nV(e){return It(t=>ew(t,e))}var ZT=(e,t)=>{var r,s=Number(t);if(!($i(s)||t==null))return s>=0?e==null||(r=e[s])===null||r===void 0?void 0:r.value:void 0},sV=e=>e.tooltip.settings,fo={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},iV={itemInteraction:{click:fo,hover:fo},axisInteraction:{click:fo,hover:fo},keyboardInteraction:fo,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},e5=Rs({name:"tooltip",initialState:iV,reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:Mr()},replaceTooltipEntrySettings:{reducer(e,t){var{prev:r,next:s}=t.payload,i=Oi(e).tooltipItemPayloads.indexOf(r);i>-1&&(e.tooltipItemPayloads[i]=s)},prepare:Mr()},removeTooltipEntrySettings:{reducer(e,t){var r=Oi(e).tooltipItemPayloads.indexOf(t.payload);r>-1&&e.tooltipItemPayloads.splice(r,1)},prepare:Mr()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:aV,replaceTooltipEntrySettings:oV,removeTooltipEntrySettings:lV,setTooltipSettingsState:cV,setActiveMouseOverItemIndex:t5,mouseLeaveItem:dV,mouseLeaveChart:r5,setActiveClickItemIndex:uV,setMouseOverAxisIndex:n5,setMouseClickAxisIndex:pV,setSyncInteraction:M0,setKeyboardInteraction:B0}=e5.actions,fV=e5.reducer;function YN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Tf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YN(Object(r),!0).forEach(function(s){hV(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function hV(e,t,r){return(t=gV(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gV(e){var t=mV(e,"string");return typeof t=="symbol"?t:t+""}function mV(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xV(e,t,r){return t==="axis"?r==="click"?e.axisInteraction.click:e.axisInteraction.hover:r==="click"?e.itemInteraction.click:e.itemInteraction.hover}function yV(e){return e.index!=null}var s5=(e,t,r,s)=>{if(t==null)return fo;var i=xV(e,t,r);if(i==null)return fo;if(i.active)return i;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&e.syncInteraction.index!=null)return e.syncInteraction;var a=e.settings.active===!0;if(yV(i)){if(a)return Tf(Tf({},i),{},{active:!0})}else if(s!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:s,graphicalItemId:void 0};return Tf(Tf({},fo),{},{coordinate:i.coordinate})};function vV(e){if(typeof e=="number")return Number.isFinite(e)?e:void 0;if(e instanceof Date){var t=e.valueOf();return Number.isFinite(t)?t:void 0}var r=Number(e);return Number.isFinite(r)?r:void 0}function bV(e,t){var r=vV(e),s=t[0],i=t[1];if(r===void 0)return!1;var a=Math.min(s,i),o=Math.max(s,i);return r>=a&&r<=o}function jV(e,t,r){if(r==null||t==null)return!0;var s=Ar(e,t);return s==null||!Wo(r)?!0:bV(s,r)}var tw=(e,t,r,s)=>{var i=e==null?void 0:e.index;if(i==null)return null;var a=Number(i);if(!nn(a))return i;var o=0,l=1/0;t.length>0&&(l=t.length-1);var c=Math.max(o,Math.min(a,l)),u=t[c];return u==null||jV(u,r,s)?String(c):null},i5=(e,t,r,s,i,a,o,l)=>{if(!(a==null||l==null)){var c=o[0],u=c==null?void 0:l(c.positions,a);if(u!=null)return u;var d=i==null?void 0:i[Number(a)];if(d)switch(r){case"horizontal":return{x:d.coordinate,y:(s.top+t)/2};default:return{x:(s.left+e)/2,y:d.coordinate}}}},a5=(e,t,r,s)=>{if(t==="axis")return e.tooltipItemPayloads;if(e.tooltipItemPayloads.length===0)return[];var i;return r==="hover"?i=e.itemInteraction.hover.dataKey:i=e.itemInteraction.click.dataKey,i==null&&s!=null?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(a=>{var o;return((o=a.settings)===null||o===void 0?void 0:o.dataKey)===i})},Wp=e=>e.options.tooltipPayloadSearcher,Id=e=>e.tooltip;function KN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function VN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KN(Object(r),!0).forEach(function(s){wV(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function wV(e,t,r){return(t=SV(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SV(e){var t=kV(e,"string");return typeof t=="symbol"?t:t+""}function kV(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NV(e,t){return e??t}var o5=(e,t,r,s,i,a,o)=>{if(!(t==null||a==null)){var{chartData:l,computedData:c,dataStartIndex:u,dataEndIndex:d}=r,f=[];return e.reduce((h,m)=>{var g,{dataDefinedOnItem:x,settings:y}=m,v=NV(x,l),S=Array.isArray(v)?$I(v,u,d):v,k=(g=y==null?void 0:y.dataKey)!==null&&g!==void 0?g:s,j=y==null?void 0:y.nameKey,_;if(s&&Array.isArray(S)&&!Array.isArray(S[0])&&o==="axis"?_=EP(S,s,i):_=a(S,t,c,j),Array.isArray(_))_.forEach(A=>{var z=VN(VN({},y),{},{name:A.name,unit:A.unit,color:void 0,fill:void 0});h.push(jk({tooltipEntrySettings:z,dataKey:A.dataKey,payload:A.payload,value:Ar(A.payload,A.dataKey),name:A.name}))});else{var b;h.push(jk({tooltipEntrySettings:y,dataKey:k,payload:_,value:Ar(_,k),name:(b=Ar(_,j))!==null&&b!==void 0?b:y==null?void 0:y.name}))}return h},f)}},rw=ze([_n,gr,AT,_j,Cn],BT),CV=ze([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),_V=ze([Cn,_d],zj),Up=ze([CV,_n,_V],Lj,{memoizeOptions:{resultEqualityCheck:Hm}}),AV=ze([Up],e=>e.filter(Wm)),EV=ze([Up],$j,{memoizeOptions:{resultEqualityCheck:Hm}}),Td=ze([EV,el],Dj),PV=ze([AV,el,_n],NT),nw=ze([Td,_n,Up],Bj),l5=ze([_n],Fj),IV=ze([_n],e=>e.allowDataOverflow),c5=ze([l5,IV],rT),TV=ze([Up],e=>e.filter(Wm)),RV=ze([PV,TV,Lp,yT],TT),OV=ze([RV,el,Cn,c5],RT),zV=ze([Up],PT),LV=ze([Td,_n,zV,Vm,Cn],Hj,{memoizeOptions:{resultEqualityCheck:Um}}),$V=ze([OT,Cn,_d],Ad),DV=ze([$V,Cn],$T),MV=ze([zT,Cn,_d],Ad),BV=ze([MV,Cn],DT),FV=ze([LT,Cn,_d],Ad),WV=ze([FV,Cn],MT),UV=ze([DV,WV,BV],kg),HV=ze([_n,l5,c5,OV,LV,UV,gr,Cn],Yj),Hp=ze([_n,gr,Td,nw,Lp,Cn,HV],Kj),YV=ze([Hp,_n,rw],Gj),KV=ze([_n,Hp,YV,Cn],Qj),d5=e=>{var t=Cn(e),r=_d(e),s=!1;return Fp(e,t,r,s)},u5=ze([_n,d5],Bm),p5=ze([_n,rw,KV,u5],qj),VV=ze([gr,nw,_n,Cn],VT),qV=ze([gr,nw,_n,Cn],qT),GV=(e,t,r,s,i,a,o,l)=>{if(t){var{type:c}=t,u=Qo(e,l);if(s){var d=r==="scaleBand"&&s.bandwidth?s.bandwidth()/2:2,f=c==="category"&&s.bandwidth?s.bandwidth()/d:0;return f=l==="angleAxis"&&i!=null&&(i==null?void 0:i.length)>=2?On(i[0]-i[1])*2*f:f,u&&o?o.map((h,m)=>({coordinate:s(h)+f,value:h,index:m,offset:f})):s.domain().map((h,m)=>({coordinate:s(h)+f,value:a?a[h]:h,index:m,offset:f}))}}},Za=ze([gr,_n,rw,p5,d5,VV,qV,Cn],GV),sw=ze([XT,QT,sV],(e,t,r)=>JT(r.shared,e,t)),f5=e=>e.tooltip.settings.trigger,iw=e=>e.tooltip.settings.defaultIndex,Yp=ze([Id,sw,f5,iw],s5),Yo=ze([Yp,Td,Bp,Hp],tw),h5=ze([Za,Yo],ZT),aw=ze([Yp],e=>{if(e)return e.dataKey}),XV=ze([Yp],e=>{if(e)return e.graphicalItemId}),g5=ze([Id,sw,f5,iw],a5),QV=ze([qa,Ga,gr,kn,Za,iw,g5,Wp],i5),JV=ze([Yp,QV],(e,t)=>e!=null&&e.coordinate?e.coordinate:t),ZV=ze([Yp],e=>e.active),eq=ze([g5,Yo,el,Bp,h5,Wp,sw],o5),tq=ze([eq],e=>{if(e!=null){var t=e.map(r=>r.payload).filter(r=>r!=null);return Array.from(new Set(t))}});function qN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function GN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qN(Object(r),!0).forEach(function(s){rq(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function rq(e,t,r){return(t=nq(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nq(e){var t=sq(e,"string");return typeof t=="symbol"?t:t+""}function sq(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var iq=()=>It(_n),aq=()=>{var e=iq(),t=It(Za),r=It(p5);return id(!e||!r?void 0:GN(GN({},e),{},{scale:r}),t)};function XN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function cc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XN(Object(r),!0).forEach(function(s){oq(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function oq(e,t,r){return(t=lq(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lq(e){var t=cq(e,"string");return typeof t=="symbol"?t:t+""}function cq(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dq=(e,t,r,s)=>{var i=t.find(a=>a&&a.index===r);if(i){if(e==="horizontal")return{x:i.coordinate,y:s.chartY};if(e==="vertical")return{x:s.chartX,y:i.coordinate}}return{x:0,y:0}},uq=(e,t,r,s)=>{var i=t.find(u=>u&&u.index===r);if(i){if(e==="centric"){var a=i.coordinate,{radius:o}=s;return cc(cc(cc({},s),dn(s.cx,s.cy,o,a)),{},{angle:a,radius:o})}var l=i.coordinate,{angle:c}=s;return cc(cc(cc({},s),dn(s.cx,s.cy,l,c)),{},{angle:c,radius:l})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}};function pq(e,t){var{chartX:r,chartY:s}=e;return r>=t.left&&r<=t.left+t.width&&s>=t.top&&s<=t.top+t.height}var m5=(e,t,r,s,i)=>{var a,o=-1,l=(a=t==null?void 0:t.length)!==null&&a!==void 0?a:0;if(l<=1||e==null)return 0;if(s==="angleAxis"&&i!=null&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var c=0;c<l;c++){var u=c>0?r[c-1].coordinate:r[l-1].coordinate,d=r[c].coordinate,f=c>=l-1?r[0].coordinate:r[c+1].coordinate,h=void 0;if(On(d-u)!==On(f-d)){var m=[];if(On(f-d)===On(i[1]-i[0])){h=f;var g=d+i[1]-i[0];m[0]=Math.min(g,(g+u)/2),m[1]=Math.max(g,(g+u)/2)}else{h=u;var x=f+i[1]-i[0];m[0]=Math.min(d,(x+d)/2),m[1]=Math.max(d,(x+d)/2)}var y=[Math.min(d,(h+d)/2),Math.max(d,(h+d)/2)];if(e>y[0]&&e<=y[1]||e>=m[0]&&e<=m[1]){({index:o}=r[c]);break}}else{var v=Math.min(u,f),S=Math.max(u,f);if(e>(v+d)/2&&e<=(S+d)/2){({index:o}=r[c]);break}}}else if(t){for(var k=0;k<l;k++)if(k===0&&e<=(t[k].coordinate+t[k+1].coordinate)/2||k>0&&k<l-1&&e>(t[k].coordinate+t[k-1].coordinate)/2&&e<=(t[k].coordinate+t[k+1].coordinate)/2||k===l-1&&e>(t[k].coordinate+t[k-1].coordinate)/2){({index:o}=t[k]);break}}return o},fq=()=>It(_j),ow=(e,t)=>t,x5=(e,t,r)=>r,lw=(e,t,r,s)=>s,hq=ze(Za,e=>gm(e,t=>t.coordinate)),cw=ze([Id,ow,x5,lw],s5),dw=ze([cw,Td,Bp,Hp],tw),gq=(e,t,r)=>{if(t!=null){var s=Id(e);return t==="axis"?r==="hover"?s.axisInteraction.hover.dataKey:s.axisInteraction.click.dataKey:r==="hover"?s.itemInteraction.hover.dataKey:s.itemInteraction.click.dataKey}},y5=ze([Id,ow,x5,lw],a5),Ng=ze([qa,Ga,gr,kn,Za,lw,y5,Wp],i5),mq=ze([cw,Ng],(e,t)=>{var r;return(r=e.coordinate)!==null&&r!==void 0?r:t}),v5=ze([Za,dw],ZT),xq=ze([y5,dw,el,Bp,v5,Wp,ow],o5),yq=ze([cw,dw],(e,t)=>({isActive:e.active&&t!=null,activeIndex:t})),vq=(e,t,r,s,i,a,o)=>{if(!(!e||!r||!s||!i)&&pq(e,o)){var l=G7(e,t),c=m5(l,a,i,r,s),u=dq(t,i,c,e);return{activeIndex:String(c),activeCoordinate:u}}},bq=(e,t,r,s,i,a,o)=>{if(!(!e||!s||!i||!a||!r)){var l=oU(e,r);if(l){var c=X7(l,t),u=m5(c,o,a,s,i),d=uq(t,a,u,l);return{activeIndex:String(u),activeCoordinate:d}}}},jq=(e,t,r,s,i,a,o,l)=>{if(!(!e||!t||!s||!i||!a))return t==="horizontal"||t==="vertical"?vq(e,t,s,i,a,o,l):bq(e,t,r,s,i,a,o)},wq=ze(e=>e.zIndex.zIndexMap,(e,t)=>t,(e,t,r)=>r,(e,t,r)=>{if(t!=null){var s=e[t];if(s!=null)return r?s.panoramaElementId:s.elementId}}),Sq=ze(e=>e.zIndex.zIndexMap,e=>{var t=Object.keys(e).map(s=>parseInt(s,10)).concat(Object.values(un)),r=Array.from(new Set(t));return r.sort((s,i)=>s-i)},{memoizeOptions:{resultEqualityCheck:iK}});function QN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function JN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QN(Object(r),!0).forEach(function(s){kq(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function kq(e,t,r){return(t=Nq(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nq(e){var t=Cq(e,"string");return typeof t=="symbol"?t:t+""}function Cq(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _q={},Aq={zIndexMap:Object.values(un).reduce((e,t)=>JN(JN({},e),{},{[t]:{elementId:void 0,panoramaElementId:void 0,consumers:0}}),_q)},Eq=new Set(Object.values(un));function Pq(e){return Eq.has(e)}var b5=Rs({name:"zIndex",initialState:Aq,reducers:{registerZIndexPortal:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]?e.zIndexMap[r].consumers+=1:e.zIndexMap[r]={consumers:1,elementId:void 0,panoramaElementId:void 0}},prepare:Mr()},unregisterZIndexPortal:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]&&(e.zIndexMap[r].consumers-=1,e.zIndexMap[r].consumers<=0&&!Pq(r)&&delete e.zIndexMap[r])},prepare:Mr()},registerZIndexPortalId:{reducer:(e,t)=>{var{zIndex:r,elementId:s,isPanorama:i}=t.payload;e.zIndexMap[r]?i?e.zIndexMap[r].panoramaElementId=s:e.zIndexMap[r].elementId=s:e.zIndexMap[r]={consumers:0,elementId:i?void 0:s,panoramaElementId:i?s:void 0}},prepare:Mr()},unregisterZIndexPortalId:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]&&(t.payload.isPanorama?e.zIndexMap[r].panoramaElementId=void 0:e.zIndexMap[r].elementId=void 0)},prepare:Mr()}}}),{registerZIndexPortal:Iq,unregisterZIndexPortal:Tq,registerZIndexPortalId:Rq,unregisterZIndexPortalId:Oq}=b5.actions,zq=b5.reducer;function Os(e){var{zIndex:t,children:r}=e,s=SF(),i=s&&t!==void 0&&t!==0,a=ss(),o=Rr();p.useLayoutEffect(()=>i?(o(Iq({zIndex:t})),()=>{o(Tq({zIndex:t}))}):jp,[o,t,i]);var l=It(u=>wq(u,t,a));if(!i)return r;if(!l)return null;var c=document.getElementById(l);return c?Qi.createPortal(r,c):null}function F0(){return F0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},F0.apply(null,arguments)}function ZN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Rf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZN(Object(r),!0).forEach(function(s){Lq(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZN(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Lq(e,t,r){return(t=$q(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $q(e){var t=Dq(e,"string");return typeof t=="symbol"?t:t+""}function Dq(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Mq(e){var{cursor:t,cursorComp:r,cursorProps:s}=e;return p.isValidElement(t)?p.cloneElement(t,s):p.createElement(r,s)}function Bq(e){var t,{coordinate:r,payload:s,index:i,offset:a,tooltipAxisBandSize:o,layout:l,cursor:c,tooltipEventType:u,chartName:d}=e,f=r,h=s,m=i;if(!c||!f||d!=="ScatterChart"&&u!=="axis")return null;var g,x,y;if(d==="ScatterChart")g=f,x=wW,y=un.cursorLine;else if(d==="BarChart")g=SW(l,f,a,o),x=f6,y=un.cursorRectangle;else if(l==="radial"&&IP(f)){var{cx:v,cy:S,radius:k,startAngle:j,endAngle:_}=g6(f);g={cx:v,cy:S,startAngle:j,endAngle:_,innerRadius:k,outerRadius:k},x=x6,y=un.cursorLine}else g={points:uU(l,f,a)},x=ej,y=un.cursorLine;var b=typeof c=="object"&&"className"in c?c.className:void 0,A=Rf(Rf(Rf(Rf({stroke:"#ccc",pointerEvents:"none"},a),g),Vl(c)),{},{payload:h,payloadIndex:m,className:vr("recharts-tooltip-cursor",b)});return p.createElement(Os,{zIndex:(t=e.zIndex)!==null&&t!==void 0?t:y},p.createElement(Mq,{cursor:c,cursorComp:x,cursorProps:A}))}function Fq(e){var t=aq(),r=XI(),s=_p(),i=fq();return t==null||r==null||s==null||i==null?null:p.createElement(Bq,F0({},e,{offset:r,layout:s,tooltipAxisBandSize:t,chartName:i}))}var j5=p.createContext(null),Wq=()=>p.useContext(j5),w5={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function i(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function a(c,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var m=new i(d,f||c,h),g=r?r+u:u;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],m]:c._events[g].push(m):(c._events[g]=m,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new s:delete c._events[u]}function l(){this._events=new s,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,m=f.length,g=new Array(m);h<m;h++)g[h]=f[h].fn;return g},l.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,d,f,h,m,g){var x=r?r+u:u;if(!this._events[x])return!1;var y=this._events[x],v=arguments.length,S,k;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),v){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,f),!0;case 4:return y.fn.call(y.context,d,f,h),!0;case 5:return y.fn.call(y.context,d,f,h,m),!0;case 6:return y.fn.call(y.context,d,f,h,m,g),!0}for(k=1,S=new Array(v-1);k<v;k++)S[k-1]=arguments[k];y.fn.apply(y.context,S)}else{var j=y.length,_;for(k=0;k<j;k++)switch(y[k].once&&this.removeListener(u,y[k].fn,void 0,!0),v){case 1:y[k].fn.call(y[k].context);break;case 2:y[k].fn.call(y[k].context,d);break;case 3:y[k].fn.call(y[k].context,d,f);break;case 4:y[k].fn.call(y[k].context,d,f,h);break;default:if(!S)for(_=1,S=new Array(v-1);_<v;_++)S[_-1]=arguments[_];y[k].fn.apply(y[k].context,S)}}return!0},l.prototype.on=function(u,d,f){return a(this,u,d,f,!1)},l.prototype.once=function(u,d,f){return a(this,u,d,f,!0)},l.prototype.removeListener=function(u,d,f,h){var m=r?r+u:u;if(!this._events[m])return this;if(!d)return o(this,m),this;var g=this._events[m];if(g.fn)g.fn===d&&(!h||g.once)&&(!f||g.context===f)&&o(this,m);else{for(var x=0,y=[],v=g.length;x<v;x++)(g[x].fn!==d||h&&!g[x].once||f&&g[x].context!==f)&&y.push(g[x]);y.length?this._events[m]=y.length===1?y[0]:y:o(this,m)}return this},l.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&o(this,d)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l})(w5);var Uq=w5.exports;const Hq=Ya(Uq);var ep=new Hq,W0="recharts.syncEvent.tooltip",eC="recharts.syncEvent.brush";function uw(e,t){if(t){var r=Number.parseInt(t,10);if(!$i(r))return e==null?void 0:e[r]}}var Yq={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},S5=Rs({name:"options",initialState:Yq,reducers:{createEventEmitter:e=>{e.eventEmitter==null&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),Kq=S5.reducer,{createEventEmitter:Vq}=S5.actions;function qq(e){return e.tooltip.syncInteraction}var Gq={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},k5=Rs({name:"chartData",initialState:Gq,reducers:{setChartData(e,t){if(e.chartData=t.payload,t.payload==null){e.dataStartIndex=0,e.dataEndIndex=0;return}t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:r,endIndex:s}=t.payload;r!=null&&(e.dataStartIndex=r),s!=null&&(e.dataEndIndex=s)}}}),{setChartData:tC,setDataStartEndIndexes:Xq,setComputedData:lie}=k5.actions,Qq=k5.reducer,Jq=["x","y"];function rC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function dc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rC(Object(r),!0).forEach(function(s){Zq(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Zq(e,t,r){return(t=eG(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eG(e){var t=tG(e,"string");return typeof t=="symbol"?t:t+""}function tG(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rG(e,t){if(e==null)return{};var r,s,i=nG(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function nG(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function sG(){var e=It(Aj),t=It(Ej),r=Rr(),s=It(vT),i=It(Za),a=_p(),o=Am(),l=It(c=>c.rootProps.className);p.useEffect(()=>{if(e==null)return jp;var c=(u,d,f)=>{if(t!==f&&e===u){if(s==="index"){var h;if(o&&d!==null&&d!==void 0&&(h=d.payload)!==null&&h!==void 0&&h.coordinate&&d.payload.sourceViewBox){var m=d.payload.coordinate,{x:g,y:x}=m,y=rG(m,Jq),{x:v,y:S,width:k,height:j}=d.payload.sourceViewBox,_=dc(dc({},y),{},{x:o.x+(k?(g-v)/k:0)*o.width,y:o.y+(j?(x-S)/j:0)*o.height});r(dc(dc({},d),{},{payload:dc(dc({},d.payload),{},{coordinate:_})}))}else r(d);return}if(i!=null){var b;if(typeof s=="function"){var A={activeTooltipIndex:d.payload.index==null?void 0:Number(d.payload.index),isTooltipActive:d.payload.active,activeIndex:d.payload.index==null?void 0:Number(d.payload.index),activeLabel:d.payload.label,activeDataKey:d.payload.dataKey,activeCoordinate:d.payload.coordinate},z=s(i,A);b=i[z]}else s==="value"&&(b=i.find(O=>String(O.value)===d.payload.label));var{coordinate:D}=d.payload;if(b==null||d.payload.active===!1||D==null||o==null){r(M0({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}));return}var{x:w,y:N}=D,$=Math.min(w,o.x+o.width),E=Math.min(N,o.y+o.height),q={x:a==="horizontal"?b.coordinate:$,y:a==="horizontal"?E:b.coordinate},L=M0({active:d.payload.active,coordinate:q,dataKey:d.payload.dataKey,index:String(b.index),label:d.payload.label,sourceViewBox:d.payload.sourceViewBox,graphicalItemId:d.payload.graphicalItemId});r(L)}}};return ep.on(W0,c),()=>{ep.off(W0,c)}},[l,r,t,e,s,i,a,o])}function iG(){var e=It(Aj),t=It(Ej),r=Rr();p.useEffect(()=>{if(e==null)return jp;var s=(i,a,o)=>{t!==o&&e===i&&r(Xq(a))};return ep.on(eC,s),()=>{ep.off(eC,s)}},[r,t,e])}function aG(){var e=Rr();p.useEffect(()=>{e(Vq())},[e]),sG(),iG()}function oG(e,t,r,s,i,a){var o=It(m=>gq(m,e,t)),l=It(Ej),c=It(Aj),u=It(vT),d=It(qq),f=d==null?void 0:d.active,h=Am();p.useEffect(()=>{if(!f&&c!=null&&l!=null){var m=M0({active:a,coordinate:r,dataKey:o,index:i,label:typeof s=="number"?String(s):s,sourceViewBox:h,graphicalItemId:void 0});ep.emit(W0,c,m,l)}},[f,r,o,i,s,l,c,u,a,h])}function nC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function sC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nC(Object(r),!0).forEach(function(s){lG(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function lG(e,t,r){return(t=cG(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cG(e){var t=dG(e,"string");return typeof t=="symbol"?t:t+""}function dG(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uG(e){return e.dataKey}function pG(e,t){return p.isValidElement(e)?p.cloneElement(e,t):typeof e=="function"?p.createElement(e,t):p.createElement(tW,t)}var iC=[],fG={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function ud(e){var t,r,s=hn(e,fG),{active:i,allowEscapeViewBox:a,animationDuration:o,animationEasing:l,content:c,filterNull:u,isAnimationActive:d,offset:f,payloadUniqBy:h,position:m,reverseDirection:g,useTranslate3d:x,wrapperStyle:y,cursor:v,shared:S,trigger:k,defaultIndex:j,portal:_,axisId:b}=s,A=Rr(),z=typeof j=="number"?String(j):j;p.useEffect(()=>{A(cV({shared:S,trigger:k,axisId:b,active:i,defaultIndex:z}))},[A,S,k,b,i,z]);var D=Am(),w=l6(),N=nV(S),{activeIndex:$,isActive:E}=(t=It(pe=>yq(pe,N,k,z)))!==null&&t!==void 0?t:{},q=It(pe=>xq(pe,N,k,z)),L=It(pe=>v5(pe,N,k,z)),O=It(pe=>mq(pe,N,k,z)),B=q,I=Wq(),T=(r=i??E)!==null&&r!==void 0?r:!1,[W,re]=oI([B,T]),ae=N==="axis"?L:void 0;oG(N,k,O,ae,$,T);var Y=_??I;if(Y==null||D==null||N==null)return null;var J=B??iC;T||(J=iC),u&&J.length&&(J=GP(J.filter(pe=>pe.value!=null&&(pe.hide!==!0||s.includeHidden)),h,uG));var P=J.length>0,ce=p.createElement(lW,{allowEscapeViewBox:a,animationDuration:o,animationEasing:l,isAnimationActive:d,active:T,coordinate:O,hasPayload:P,offset:f,position:m,reverseDirection:g,useTranslate3d:x,viewBox:D,wrapperStyle:y,lastBoundingBox:W,innerRef:re,hasPortalFromProps:!!_},pG(c,sC(sC({},s),{},{payload:J,label:ae,active:T,activeIndex:$,coordinate:O,accessibilityLayer:w})));return p.createElement(p.Fragment,null,Qi.createPortal(ce,Y),T&&p.createElement(Fq,{cursor:v,tooltipEventType:N,coordinate:O,payload:J,index:$}))}var zi=e=>null;zi.displayName="Cell";function hG(e,t,r){return(t=gG(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gG(e){var t=mG(e,"string");return typeof t=="symbol"?t:t+""}function mG(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class xG{constructor(t){hG(this,"cache",new Map),this.maxSize=t}get(t){var r=this.cache.get(t);return r!==void 0&&(this.cache.delete(t),this.cache.set(t,r)),r}set(t,r){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxSize){var s=this.cache.keys().next().value;s!=null&&this.cache.delete(s)}this.cache.set(t,r)}clear(){this.cache.clear()}size(){return this.cache.size}}function aC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function yG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aC(Object(r),!0).forEach(function(s){vG(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function vG(e,t,r){return(t=bG(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bG(e){var t=jG(e,"string");return typeof t=="symbol"?t:t+""}function jG(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wG={cacheSize:2e3,enableCache:!0},N5=yG({},wG),oC=new xG(N5.cacheSize),SG={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},lC="recharts_measurement_span";function kG(e,t){var r=t.fontSize||"",s=t.fontFamily||"",i=t.fontWeight||"",a=t.fontStyle||"",o=t.letterSpacing||"",l=t.textTransform||"";return"".concat(e,"|").concat(r,"|").concat(s,"|").concat(i,"|").concat(a,"|").concat(o,"|").concat(l)}var cC=(e,t)=>{try{var r=document.getElementById(lC);r||(r=document.createElement("span"),r.setAttribute("id",lC),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,SG,t),r.textContent="".concat(e);var s=r.getBoundingClientRect();return{width:s.width,height:s.height}}catch{return{width:0,height:0}}},yu=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Ep.isSsr)return{width:0,height:0};if(!N5.enableCache)return cC(t,r);var s=kG(t,r),i=oC.get(s);if(i)return i;var a=cC(t,r);return oC.set(s,a),a},dC=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,uC=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,NG=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,CG=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,C5={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},_G=Object.keys(C5),Nc="NaN";function AG(e,t){return e*C5[t]}class ws{static parse(t){var r,[,s,i]=(r=CG.exec(t))!==null&&r!==void 0?r:[];return new ws(parseFloat(s),i??"")}constructor(t,r){this.num=t,this.unit=r,this.num=t,this.unit=r,$i(t)&&(this.unit=""),r!==""&&!NG.test(r)&&(this.num=NaN,this.unit=""),_G.includes(r)&&(this.num=AG(t,r),this.unit="px")}add(t){return this.unit!==t.unit?new ws(NaN,""):new ws(this.num+t.num,this.unit)}subtract(t){return this.unit!==t.unit?new ws(NaN,""):new ws(this.num-t.num,this.unit)}multiply(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new ws(NaN,""):new ws(this.num*t.num,this.unit||t.unit)}divide(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new ws(NaN,""):new ws(this.num/t.num,this.unit||t.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return $i(this.num)}}function _5(e){if(e.includes(Nc))return Nc;for(var t=e;t.includes("*")||t.includes("/");){var r,[,s,i,a]=(r=dC.exec(t))!==null&&r!==void 0?r:[],o=ws.parse(s??""),l=ws.parse(a??""),c=i==="*"?o.multiply(l):o.divide(l);if(c.isNaN())return Nc;t=t.replace(dC,c.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var u,[,d,f,h]=(u=uC.exec(t))!==null&&u!==void 0?u:[],m=ws.parse(d??""),g=ws.parse(h??""),x=f==="+"?m.add(g):m.subtract(g);if(x.isNaN())return Nc;t=t.replace(uC,x.toString())}return t}var pC=/\(([^()]*)\)/;function EG(e){for(var t=e,r;(r=pC.exec(t))!=null;){var[,s]=r;t=t.replace(pC,_5(s))}return t}function PG(e){var t=e.replace(/\s+/g,"");return t=EG(t),t=_5(t),t}function IG(e){try{return PG(e)}catch{return Nc}}function gy(e){var t=IG(e.slice(5,-1));return t===Nc?"":t}var TG=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],RG=["dx","dy","angle","className","breakAll"];function U0(){return U0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},U0.apply(null,arguments)}function fC(e,t){if(e==null)return{};var r,s,i=OG(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function OG(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var A5=/[ \f\n\r\t\v\u2028\u2029]+/,E5=e=>{var{children:t,breakAll:r,style:s}=e;try{var i=[];Ur(t)||(r?i=t.toString().split(""):i=t.toString().split(A5));var a=i.map(l=>({word:l,width:yu(l,s).width})),o=r?0:yu("",s).width;return{wordsWithComputedWidth:a,spaceWidth:o}}catch{return null}};function zG(e){return e==="start"||e==="middle"||e==="end"||e==="inherit"}var P5=(e,t,r,s)=>e.reduce((i,a)=>{var{word:o,width:l}=a,c=i[i.length-1];if(c&&l!=null&&(t==null||s||c.width+l+r<Number(t)))c.words.push(o),c.width+=l+r;else{var u={words:[o],width:l};i.push(u)}return i},[]),I5=e=>e.reduce((t,r)=>t.width>r.width?t:r),LG="",hC=(e,t,r,s,i,a,o,l)=>{var c=e.slice(0,t),u=E5({breakAll:r,style:s,children:c+LG});if(!u)return[!1,[]];var d=P5(u.wordsWithComputedWidth,a,o,l),f=d.length>i||I5(d).width>Number(a);return[f,d]},$G=(e,t,r,s,i)=>{var{maxLines:a,children:o,style:l,breakAll:c}=e,u=zt(a),d=String(o),f=P5(t,s,r,i);if(!u||i)return f;var h=f.length>a||I5(f).width>Number(s);if(!h)return f;for(var m=0,g=d.length-1,x=0,y;m<=g&&x<=d.length-1;){var v=Math.floor((m+g)/2),S=v-1,[k,j]=hC(d,S,c,l,a,s,r,i),[_]=hC(d,v,c,l,a,s,r,i);if(!k&&!_&&(m=v+1),k&&_&&(g=v-1),!k&&_){y=j;break}x++}return y||f},gC=e=>{var t=Ur(e)?[]:e.toString().split(A5);return[{words:t,width:void 0}]},DG=e=>{var{width:t,scaleToFit:r,children:s,style:i,breakAll:a,maxLines:o}=e;if((t||r)&&!Ep.isSsr){var l,c,u=E5({breakAll:a,children:s,style:i});if(u){var{wordsWithComputedWidth:d,spaceWidth:f}=u;l=d,c=f}else return gC(s);return $G({breakAll:a,children:s,maxLines:o,style:i},l,c,t,!!r)}return gC(s)},T5="#808080",MG={angle:0,breakAll:!1,capHeight:"0.71em",fill:T5,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},Xm=p.forwardRef((e,t)=>{var r=hn(e,MG),{x:s,y:i,lineHeight:a,capHeight:o,fill:l,scaleToFit:c,textAnchor:u,verticalAnchor:d}=r,f=fC(r,TG),h=p.useMemo(()=>DG({breakAll:f.breakAll,children:f.children,maxLines:f.maxLines,scaleToFit:c,style:f.style,width:f.width}),[f.breakAll,f.children,f.maxLines,c,f.style,f.width]),{dx:m,dy:g,angle:x,className:y,breakAll:v}=f,S=fC(f,RG);if(!na(s)||!na(i)||h.length===0)return null;var k=Number(s)+(zt(m)?m:0),j=Number(i)+(zt(g)?g:0);if(!nn(k)||!nn(j))return null;var _;switch(d){case"start":_=gy("calc(".concat(o,")"));break;case"middle":_=gy("calc(".concat((h.length-1)/2," * -").concat(a," + (").concat(o," / 2))"));break;default:_=gy("calc(".concat(h.length-1," * -").concat(a,")"));break}var b=[];if(c){var A=h[0].width,{width:z}=f;b.push("scale(".concat(zt(z)&&zt(A)?z/A:1,")"))}return x&&b.push("rotate(".concat(x,", ").concat(k,", ").concat(j,")")),b.length&&(S.transform=b.join(" ")),p.createElement("text",U0({},hs(S),{ref:t,x:k,y:j,className:vr("recharts-text",y),textAnchor:u,fill:l.includes("url")?T5:l}),h.map((D,w)=>{var N=D.words.join(v?"":" ");return p.createElement("tspan",{x:k,dy:w===0?_:a,key:"".concat(N,"-").concat(w)},N)}))});Xm.displayName="Text";var BG=["labelRef"];function FG(e,t){if(e==null)return{};var r,s,i=WG(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function WG(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function mC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function en(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mC(Object(r),!0).forEach(function(s){UG(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function UG(e,t,r){return(t=HG(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HG(e){var t=YG(e,"string");return typeof t=="symbol"?t:t+""}function YG(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ka(){return ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ka.apply(null,arguments)}var R5=p.createContext(null),KG=e=>{var{x:t,y:r,upperWidth:s,lowerWidth:i,width:a,height:o,children:l}=e,c=p.useMemo(()=>({x:t,y:r,upperWidth:s,lowerWidth:i,width:a,height:o}),[t,r,s,i,a,o]);return p.createElement(R5.Provider,{value:c},l)},O5=()=>{var e=p.useContext(R5),t=Am();return e||GI(t)},VG=p.createContext(null),qG=()=>{var e=p.useContext(VG),t=It(kT);return e||t},GG=e=>{var{value:t,formatter:r}=e,s=Ur(e.children)?t:e.children;return typeof r=="function"?r(s):s},pw=e=>e!=null&&typeof e=="function",XG=(e,t)=>{var r=On(t-e),s=Math.min(Math.abs(t-e),360);return r*s},QG=(e,t,r,s,i)=>{var{offset:a,className:o}=e,{cx:l,cy:c,innerRadius:u,outerRadius:d,startAngle:f,endAngle:h,clockWise:m}=i,g=(u+d)/2,x=XG(f,h),y=x>=0?1:-1,v,S;switch(t){case"insideStart":v=f+y*a,S=m;break;case"insideEnd":v=h-y*a,S=!m;break;case"end":v=h+y*a,S=m;break;default:throw new Error("Unsupported position ".concat(t))}S=x<=0?S:!S;var k=dn(l,c,g,v),j=dn(l,c,g,v+(S?1:-1)*359),_="M".concat(k.x,",").concat(k.y,`
    A`).concat(g,",").concat(g,",0,1,").concat(S?0:1,`,
    `).concat(j.x,",").concat(j.y),b=Ur(e.id)?Fu("recharts-radial-line-"):e.id;return p.createElement("text",ka({},s,{dominantBaseline:"central",className:vr("recharts-radial-bar-label",o)}),p.createElement("defs",null,p.createElement("path",{id:b,d:_})),p.createElement("textPath",{xlinkHref:"#".concat(b)},r))},JG=(e,t,r)=>{var{cx:s,cy:i,innerRadius:a,outerRadius:o,startAngle:l,endAngle:c}=e,u=(l+c)/2;if(r==="outside"){var{x:d,y:f}=dn(s,i,o+t,u);return{x:d,y:f,textAnchor:d>=s?"start":"end",verticalAnchor:"middle"}}if(r==="center")return{x:s,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(r==="centerTop")return{x:s,y:i,textAnchor:"middle",verticalAnchor:"start"};if(r==="centerBottom")return{x:s,y:i,textAnchor:"middle",verticalAnchor:"end"};var h=(a+o)/2,{x:m,y:g}=dn(s,i,h,u);return{x:m,y:g,textAnchor:"middle",verticalAnchor:"middle"}},H0=e=>"cx"in e&&zt(e.cx),ZG=(e,t)=>{var{parentViewBox:r,offset:s,position:i}=e,a;r!=null&&!H0(r)&&(a=r);var{x:o,y:l,upperWidth:c,lowerWidth:u,height:d}=t,f=o,h=o+(c-u)/2,m=(f+h)/2,g=(c+u)/2,x=f+c/2,y=d>=0?1:-1,v=y*s,S=y>0?"end":"start",k=y>0?"start":"end",j=c>=0?1:-1,_=j*s,b=j>0?"end":"start",A=j>0?"start":"end";if(i==="top"){var z={x:f+c/2,y:l-v,textAnchor:"middle",verticalAnchor:S};return en(en({},z),a?{height:Math.max(l-a.y,0),width:c}:{})}if(i==="bottom"){var D={x:h+u/2,y:l+d+v,textAnchor:"middle",verticalAnchor:k};return en(en({},D),a?{height:Math.max(a.y+a.height-(l+d),0),width:u}:{})}if(i==="left"){var w={x:m-_,y:l+d/2,textAnchor:b,verticalAnchor:"middle"};return en(en({},w),a?{width:Math.max(w.x-a.x,0),height:d}:{})}if(i==="right"){var N={x:m+g+_,y:l+d/2,textAnchor:A,verticalAnchor:"middle"};return en(en({},N),a?{width:Math.max(a.x+a.width-N.x,0),height:d}:{})}var $=a?{width:g,height:d}:{};return i==="insideLeft"?en({x:m+_,y:l+d/2,textAnchor:A,verticalAnchor:"middle"},$):i==="insideRight"?en({x:m+g-_,y:l+d/2,textAnchor:b,verticalAnchor:"middle"},$):i==="insideTop"?en({x:f+c/2,y:l+v,textAnchor:"middle",verticalAnchor:k},$):i==="insideBottom"?en({x:h+u/2,y:l+d-v,textAnchor:"middle",verticalAnchor:S},$):i==="insideTopLeft"?en({x:f+_,y:l+v,textAnchor:A,verticalAnchor:k},$):i==="insideTopRight"?en({x:f+c-_,y:l+v,textAnchor:b,verticalAnchor:k},$):i==="insideBottomLeft"?en({x:h+_,y:l+d-v,textAnchor:A,verticalAnchor:S},$):i==="insideBottomRight"?en({x:h+u-_,y:l+d-v,textAnchor:b,verticalAnchor:S},$):i&&typeof i=="object"&&(zt(i.x)||Da(i.x))&&(zt(i.y)||Da(i.y))?en({x:o+rs(i.x,g),y:l+rs(i.y,d),textAnchor:"end",verticalAnchor:"end"},$):en({x,y:l+d/2,textAnchor:"middle",verticalAnchor:"middle"},$)},eX={angle:0,offset:5,zIndex:un.label,position:"middle",textBreakAll:!1};function co(e){var t=hn(e,eX),{viewBox:r,position:s,value:i,children:a,content:o,className:l="",textBreakAll:c,labelRef:u}=t,d=qG(),f=O5(),h=s==="center"?f:d??f,m,g,x;if(r==null?m=h:H0(r)?m=r:m=GI(r),!m||Ur(i)&&Ur(a)&&!p.isValidElement(o)&&typeof o!="function")return null;var y=en(en({},t),{},{viewBox:m});if(p.isValidElement(o)){var{labelRef:v}=y,S=FG(y,BG);return p.cloneElement(o,S)}if(typeof o=="function"){if(g=p.createElement(o,y),p.isValidElement(g))return g}else g=GG(t);var k=hs(t);if(H0(m)){if(s==="insideStart"||s==="insideEnd"||s==="end")return QG(t,s,g,k,m);x=JG(m,t.offset,t.position)}else x=ZG(t,m);return p.createElement(Os,{zIndex:t.zIndex},p.createElement(Xm,ka({ref:u,className:vr("recharts-label",l)},k,x,{textAnchor:zG(k.textAnchor)?k.textAnchor:x.textAnchor,breakAll:c}),g))}co.displayName="Label";var tX=(e,t,r)=>{if(!e)return null;var s={viewBox:t,labelRef:r};return e===!0?p.createElement(co,ka({key:"label-implicit"},s)):na(e)?p.createElement(co,ka({key:"label-implicit",value:e},s)):p.isValidElement(e)?e.type===co?p.cloneElement(e,en({key:"label-implicit"},s)):p.createElement(co,ka({key:"label-implicit",content:e},s)):pw(e)?p.createElement(co,ka({key:"label-implicit",content:e},s)):e&&typeof e=="object"?p.createElement(co,ka({},e,{key:"label-implicit"},s)):null};function rX(e){var{label:t,labelRef:r}=e,s=O5();return tX(t,s,r)||null}var z5={},L5={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return r[r.length-1]}e.last=t})(L5);var $5={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){return Array.isArray(r)?r:Array.from(r)}e.toArray=t})($5);(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=L5,r=$5,s=fm;function i(a){if(s.isArrayLike(a))return t.last(r.toArray(a))}e.last=i})(z5);var nX=z5.last;const sX=Ya(nX);var iX=["valueAccessor"],aX=["dataKey","clockWise","id","textBreakAll","zIndex"];function Cg(){return Cg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Cg.apply(null,arguments)}function xC(e,t){if(e==null)return{};var r,s,i=oX(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function oX(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var lX=e=>Array.isArray(e.value)?sX(e.value):e.value,D5=p.createContext(void 0),M5=D5.Provider,B5=p.createContext(void 0),cX=B5.Provider;function dX(){return p.useContext(D5)}function uX(){return p.useContext(B5)}function lh(e){var{valueAccessor:t=lX}=e,r=xC(e,iX),{dataKey:s,clockWise:i,id:a,textBreakAll:o,zIndex:l}=r,c=xC(r,aX),u=dX(),d=uX(),f=u||d;return!f||!f.length?null:p.createElement(Os,{zIndex:l??un.label},p.createElement(Ln,{className:"recharts-label-list"},f.map((h,m)=>{var g,x=Ur(s)?t(h,m):Ar(h&&h.payload,s),y=Ur(a)?{}:{id:"".concat(a,"-").concat(m)};return p.createElement(co,Cg({key:"label-".concat(m)},hs(h),c,y,{fill:(g=r.fill)!==null&&g!==void 0?g:h.fill,parentViewBox:h.parentViewBox,value:x,textBreakAll:o,viewBox:h.viewBox,index:m,zIndex:0}))})))}lh.displayName="LabelList";function fw(e){var{label:t}=e;return t?t===!0?p.createElement(lh,{key:"labelList-implicit"}):p.isValidElement(t)||pw(t)?p.createElement(lh,{key:"labelList-implicit",content:t}):typeof t=="object"?p.createElement(lh,Cg({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}function Y0(){return Y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Y0.apply(null,arguments)}var F5=e=>{var{cx:t,cy:r,r:s,className:i}=e,a=vr("recharts-dot",i);return zt(t)&&zt(r)&&zt(s)?p.createElement("circle",Y0({},qs(e),_b(e),{className:a,cx:t,cy:r,r:s})):null},W5=e=>e.graphicalItems.polarItems,pX=ze([Hr,$p],zj),Qm=ze([W5,Gr,pX],Lj),fX=ze([Qm],$j),Jm=ze([fX,kj],Dj),hX=ze([Jm,Gr,Qm],Bj);ze([Jm,Gr,Qm],(e,t,r)=>r.length>0?e.flatMap(s=>r.flatMap(i=>{var a,o=Ar(s,(a=t.dataKey)!==null&&a!==void 0?a:i.dataKey);return{value:o,errorDomain:[]}})).filter(Boolean):(t==null?void 0:t.dataKey)!=null?e.map(s=>({value:Ar(s,t.dataKey),errorDomain:[]})):e.map(s=>({value:s,errorDomain:[]})));var yC=()=>{},gX=ze([Jm,Gr,Qm,Vm,Hr],Hj),mX=ze([Gr,Wj,Uj,yC,gX,yC,gr,Hr],Yj),U5=ze([Gr,gr,Jm,hX,Lp,Hr,mX],Kj),xX=ze([U5,Gr,Ed],Gj);ze([Gr,U5,xX,Hr],Qj);var yX={radiusAxis:{},angleAxis:{}},H5=Rs({name:"polarAxis",initialState:yX,reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:cie,removeRadiusAxis:die,addAngleAxis:uie,removeAngleAxis:pie}=H5.actions,vX=H5.reducer;function vC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function bC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vC(Object(r),!0).forEach(function(s){bX(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function bX(e,t,r){return(t=jX(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jX(e){var t=wX(e,"string");return typeof t=="symbol"?t:t+""}function wX(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SX=(e,t)=>t,hw=ze([W5,SX],(e,t)=>e.filter(r=>r.type==="pie").find(r=>r.id===t)),kX=[],gw=(e,t,r)=>(r==null?void 0:r.length)===0?kX:r,Y5=ze([kj,hw,gw],(e,t,r)=>{var{chartData:s}=e;if(t!=null){var i;if((t==null?void 0:t.data)!=null&&t.data.length>0?i=t.data:i=s,(!i||!i.length)&&r!=null&&(i=r.map(a=>bC(bC({},t.presentationProps),a.props))),i!=null)return i}}),NX=ze([Y5,hw,gw],(e,t,r)=>{if(!(e==null||t==null))return e.map((s,i)=>{var a,o=Ar(s,t.nameKey,t.name),l;return r!=null&&(a=r[i])!==null&&a!==void 0&&(a=a.props)!==null&&a!==void 0&&a.fill?l=r[i].props.fill:typeof s=="object"&&s!=null&&"fill"in s?l=s.fill:l=t.fill,{value:Sd(o,t.dataKey),color:l,payload:s,type:t.legendType}})}),CX=ze([Y5,hw,gw,kn],(e,t,r,s)=>{if(!(t==null||e==null))return NQ({offset:s,pieSettings:t,displayedData:e,cells:r})}),K5={exports:{}},Pr={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mw=Symbol.for("react.transitional.element"),xw=Symbol.for("react.portal"),Zm=Symbol.for("react.fragment"),ex=Symbol.for("react.strict_mode"),tx=Symbol.for("react.profiler"),rx=Symbol.for("react.consumer"),nx=Symbol.for("react.context"),sx=Symbol.for("react.forward_ref"),ix=Symbol.for("react.suspense"),ax=Symbol.for("react.suspense_list"),ox=Symbol.for("react.memo"),lx=Symbol.for("react.lazy"),_X=Symbol.for("react.view_transition"),AX=Symbol.for("react.client.reference");function gi(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case mw:switch(e=e.type,e){case Zm:case tx:case ex:case ix:case ax:case _X:return e;default:switch(e=e&&e.$$typeof,e){case nx:case sx:case lx:case ox:return e;case rx:return e;default:return t}}case xw:return t}}}Pr.ContextConsumer=rx;Pr.ContextProvider=nx;Pr.Element=mw;Pr.ForwardRef=sx;Pr.Fragment=Zm;Pr.Lazy=lx;Pr.Memo=ox;Pr.Portal=xw;Pr.Profiler=tx;Pr.StrictMode=ex;Pr.Suspense=ix;Pr.SuspenseList=ax;Pr.isContextConsumer=function(e){return gi(e)===rx};Pr.isContextProvider=function(e){return gi(e)===nx};Pr.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===mw};Pr.isForwardRef=function(e){return gi(e)===sx};Pr.isFragment=function(e){return gi(e)===Zm};Pr.isLazy=function(e){return gi(e)===lx};Pr.isMemo=function(e){return gi(e)===ox};Pr.isPortal=function(e){return gi(e)===xw};Pr.isProfiler=function(e){return gi(e)===tx};Pr.isStrictMode=function(e){return gi(e)===ex};Pr.isSuspense=function(e){return gi(e)===ix};Pr.isSuspenseList=function(e){return gi(e)===ax};Pr.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Zm||e===tx||e===ex||e===ix||e===ax||typeof e=="object"&&e!==null&&(e.$$typeof===lx||e.$$typeof===ox||e.$$typeof===nx||e.$$typeof===rx||e.$$typeof===sx||e.$$typeof===AX||e.getModuleId!==void 0)};Pr.typeOf=gi;K5.exports=Pr;var EX=K5.exports,jC=e=>typeof e=="string"?e:e?e.displayName||e.name||"Component":"",wC=null,my=null,V5=e=>{if(e===wC&&Array.isArray(my))return my;var t=[];return p.Children.forEach(e,r=>{Ur(r)||(EX.isFragment(r)?t=t.concat(V5(r.props.children)):t.push(r))}),my=t,wC=e,t};function yw(e,t){var r=[],s=[];return Array.isArray(t)?s=t.map(i=>jC(i)):s=[jC(t)],V5(e).forEach(i=>{var a=ql(i,"type.displayName")||ql(i,"type.name");a&&s.indexOf(a)!==-1&&r.push(i)}),r}var q5=e=>e&&typeof e=="object"&&"clipDot"in e?!!e.clipDot:!0,G5={};(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(r){var i;if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const a=r[Symbol.toStringTag];return a==null||!((i=Object.getOwnPropertyDescriptor(r,Symbol.toStringTag))!=null&&i.writable)?!1:r.toString()===`[object ${a}]`}let s=r;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(r)===s}e.isPlainObject=t})(G5);var PX=G5.isPlainObject;const IX=Ya(PX);function SC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function kC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SC(Object(r),!0).forEach(function(s){TX(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function TX(e,t,r){return(t=RX(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RX(e){var t=OX(e,"string");return typeof t=="symbol"?t:t+""}function OX(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _g(){return _g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_g.apply(null,arguments)}var NC=(e,t,r,s,i)=>{var a=r-s,o;return o="M ".concat(e,",").concat(t),o+="L ".concat(e+r,",").concat(t),o+="L ".concat(e+r-a/2,",").concat(t+i),o+="L ".concat(e+r-a/2-s,",").concat(t+i),o+="L ".concat(e,",").concat(t," Z"),o},zX={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},LX=e=>{var t=hn(e,zX),{x:r,y:s,upperWidth:i,lowerWidth:a,height:o,className:l}=t,{animationEasing:c,animationDuration:u,animationBegin:d,isUpdateAnimationActive:f}=t,h=p.useRef(null),[m,g]=p.useState(-1),x=p.useRef(i),y=p.useRef(a),v=p.useRef(o),S=p.useRef(r),k=p.useRef(s),j=Ip(e,"trapezoid-");if(p.useEffect(()=>{if(h.current&&h.current.getTotalLength)try{var q=h.current.getTotalLength();q&&g(q)}catch{}},[]),r!==+r||s!==+s||i!==+i||a!==+a||o!==+o||i===0&&a===0||o===0)return null;var _=vr("recharts-trapezoid",l);if(!f)return p.createElement("g",null,p.createElement("path",_g({},hs(t),{className:_,d:NC(r,s,i,a,o)})));var b=x.current,A=y.current,z=v.current,D=S.current,w=k.current,N="0px ".concat(m===-1?1:m,"px"),$="".concat(m,"px 0px"),E=c6(["strokeDasharray"],u,c);return p.createElement(Pp,{animationId:j,key:j,canBegin:m>0,duration:u,easing:c,isActive:f,begin:d},q=>{var L=Br(b,i,q),O=Br(A,a,q),B=Br(z,o,q),I=Br(D,r,q),T=Br(w,s,q);h.current&&(x.current=L,y.current=O,v.current=B,S.current=I,k.current=T);var W=q>0?{transition:E,strokeDasharray:$}:{strokeDasharray:N};return p.createElement("path",_g({},hs(t),{className:_,d:NC(I,T,L,O,B),ref:h,style:kC(kC({},W),t.style)}))})},$X=["option","shapeType","propTransformer","activeClassName"];function DX(e,t){if(e==null)return{};var r,s,i=MX(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function MX(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function CC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Ag(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CC(Object(r),!0).forEach(function(s){BX(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function BX(e,t,r){return(t=FX(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FX(e){var t=WX(e,"string");return typeof t=="symbol"?t:t+""}function WX(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UX(e,t){return Ag(Ag({},t),e)}function HX(e,t){return e==="symbols"}function _C(e){var{shapeType:t,elementProps:r}=e;switch(t){case"rectangle":return p.createElement(f6,r);case"trapezoid":return p.createElement(LX,r);case"sector":return p.createElement(x6,r);case"symbols":if(HX(t))return p.createElement(Cb,r);break;case"curve":return p.createElement(ej,r);default:return null}}function YX(e){return p.isValidElement(e)?e.props:e}function vw(e){var{option:t,shapeType:r,propTransformer:s=UX,activeClassName:i="recharts-active-shape"}=e,a=DX(e,$X),o;if(p.isValidElement(t))o=p.cloneElement(t,Ag(Ag({},a),YX(t)));else if(typeof t=="function")o=t(a,a.index);else if(IX(t)&&typeof t!="boolean"){var l=s(t,a);o=p.createElement(_C,{shapeType:r,elementProps:l})}else{var c=a;o=p.createElement(_C,{shapeType:r,elementProps:c})}return a.isActive?p.createElement(Ln,{className:i},o):o}var bw=(e,t,r)=>{var s=Rr();return(i,a)=>o=>{e==null||e(i,a,o),s(t5({activeIndex:String(a),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}},jw=e=>{var t=Rr();return(r,s)=>i=>{e==null||e(r,s,i),t(dV())}},ww=(e,t,r)=>{var s=Rr();return(i,a)=>o=>{e==null||e(i,a,o),s(uV({activeIndex:String(a),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}};function Sw(e){var{tooltipEntrySettings:t}=e,r=Rr(),s=ss(),i=p.useRef(null);return p.useLayoutEffect(()=>{s||(i.current===null?r(aV(t)):i.current!==t&&r(oV({prev:i.current,next:t})),i.current=t)},[t,r,s]),p.useLayoutEffect(()=>()=>{i.current&&(r(lV(i.current)),i.current=null)},[r]),null}function X5(e){var{legendPayload:t}=e,r=Rr(),s=ss(),i=p.useRef(null);return p.useLayoutEffect(()=>{s||(i.current===null?r(s6(t)):i.current!==t&&r(i6({prev:i.current,next:t})),i.current=t)},[r,s,t]),p.useLayoutEffect(()=>()=>{i.current&&(r(a6(i.current)),i.current=null)},[r]),null}function KX(e){var{legendPayload:t}=e,r=Rr(),s=It(gr),i=p.useRef(null);return p.useLayoutEffect(()=>{s!=="centric"&&s!=="radial"||(i.current===null?r(s6(t)):i.current!==t&&r(i6({prev:i.current,next:t})),i.current=t)},[r,s,t]),p.useLayoutEffect(()=>()=>{i.current&&(r(a6(i.current)),i.current=null)},[r]),null}var xy,VX=()=>{var[e]=p.useState(()=>Fu("uid-"));return e},qX=(xy=Z_.useId)!==null&&xy!==void 0?xy:VX;function Q5(e,t){var r=qX();return t||(e?"".concat(e,"-").concat(r):r)}var GX=p.createContext(void 0),kw=e=>{var{id:t,type:r,children:s}=e,i=Q5("recharts-".concat(r),t);return p.createElement(GX.Provider,{value:i},s(i))},XX={cartesianItems:[],polarItems:[]},J5=Rs({name:"graphicalItems",initialState:XX,reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:Mr()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:r,next:s}=t.payload,i=Oi(e).cartesianItems.indexOf(r);i>-1&&(e.cartesianItems[i]=s)},prepare:Mr()},removeCartesianGraphicalItem:{reducer(e,t){var r=Oi(e).cartesianItems.indexOf(t.payload);r>-1&&e.cartesianItems.splice(r,1)},prepare:Mr()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:Mr()},removePolarGraphicalItem:{reducer(e,t){var r=Oi(e).polarItems.indexOf(t.payload);r>-1&&e.polarItems.splice(r,1)},prepare:Mr()}}}),{addCartesianGraphicalItem:QX,replaceCartesianGraphicalItem:JX,removeCartesianGraphicalItem:ZX,addPolarGraphicalItem:eQ,removePolarGraphicalItem:tQ}=J5.actions,rQ=J5.reducer,nQ=e=>{var t=Rr(),r=p.useRef(null);return p.useLayoutEffect(()=>{r.current===null?t(QX(e)):r.current!==e&&t(JX({prev:r.current,next:e})),r.current=e},[t,e]),p.useLayoutEffect(()=>()=>{r.current&&(t(ZX(r.current)),r.current=null)},[t]),null},Z5=p.memo(nQ);function sQ(e){var t=Rr();return p.useLayoutEffect(()=>(t(eQ(e)),()=>{t(tQ(e))}),[t,e]),null}var iQ=["key"],aQ=["onMouseEnter","onClick","onMouseLeave"],oQ=["id"],lQ=["id"];function AC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Zr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AC(Object(r),!0).forEach(function(s){cQ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function cQ(e,t,r){return(t=dQ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dQ(e){var t=uQ(e,"string");return typeof t=="symbol"?t:t+""}function uQ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ko(){return Ko=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ko.apply(null,arguments)}function cx(e,t){if(e==null)return{};var r,s,i=pQ(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function pQ(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function fQ(e){var t=p.useMemo(()=>yw(e.children,zi),[e.children]),r=It(s=>NX(s,e.id,t));return r==null?null:p.createElement(KX,{legendPayload:r})}var hQ=p.memo(e=>{var{dataKey:t,nameKey:r,sectors:s,stroke:i,strokeWidth:a,fill:o,name:l,hide:c,tooltipType:u}=e,d={dataDefinedOnItem:s.map(f=>f.tooltipPayload),positions:s.map(f=>f.tooltipPosition),settings:{stroke:i,strokeWidth:a,fill:o,dataKey:t,nameKey:r,name:Sd(l,t),hide:c,type:u,color:o,unit:""}};return p.createElement(Sw,{tooltipEntrySettings:d})}),gQ=(e,t)=>e>t?"start":e<t?"end":"middle",mQ=(e,t,r)=>rs(typeof t=="function"?t(e):t,r,r*.8),xQ=(e,t,r)=>{var{top:s,left:i,width:a,height:o}=t,l=h6(a,o),c=i+rs(e.cx,a,a/2),u=s+rs(e.cy,o,o/2),d=rs(e.innerRadius,l,0),f=mQ(r,e.outerRadius,l),h=e.maxRadius||Math.sqrt(a*a+o*o)/2;return{cx:c,cy:u,innerRadius:d,outerRadius:f,maxRadius:h}},yQ=(e,t)=>{var r=On(t-e),s=Math.min(Math.abs(t-e),360);return r*s};function vQ(e){return e&&typeof e=="object"&&"className"in e&&typeof e.className=="string"?e.className:""}var bQ=(e,t)=>{if(p.isValidElement(e))return p.cloneElement(e,t);if(typeof e=="function")return e(t);var r=vr("recharts-pie-label-line",typeof e!="boolean"?e.className:""),{key:s}=t,i=cx(t,iQ);return p.createElement(ej,Ko({},i,{type:"linear",className:r}))},jQ=(e,t,r)=>{if(p.isValidElement(e))return p.cloneElement(e,t);var s=r;if(typeof e=="function"&&(s=e(t),p.isValidElement(s)))return s;var i=vr("recharts-pie-label-text",vQ(e));return p.createElement(Xm,Ko({},t,{alignmentBaseline:"middle",className:i}),s)};function wQ(e){var{sectors:t,props:r,showLabels:s}=e,{label:i,labelLine:a,dataKey:o}=r;if(!s||!i||!t)return null;var l=qs(r),c=Vl(i),u=Vl(a),d=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,f=t.map((h,m)=>{var g=(h.startAngle+h.endAngle)/2,x=dn(h.cx,h.cy,h.outerRadius+d,g),y=Zr(Zr(Zr(Zr({},l),h),{},{stroke:"none"},c),{},{index:m,textAnchor:gQ(x.x,h.cx)},x),v=Zr(Zr(Zr(Zr({},l),h),{},{fill:"none",stroke:h.fill},u),{},{index:m,points:[dn(h.cx,h.cy,h.outerRadius,g),x],key:"line"});return p.createElement(Os,{zIndex:un.label,key:"label-".concat(h.startAngle,"-").concat(h.endAngle,"-").concat(h.midAngle,"-").concat(m)},p.createElement(Ln,null,a&&bQ(a,v),jQ(i,y,Ar(h,o))))});return p.createElement(Ln,{className:"recharts-pie-labels"},f)}function SQ(e){var{sectors:t,props:r,showLabels:s}=e,{label:i}=r;return typeof i=="object"&&i!=null&&"position"in i?p.createElement(fw,{label:i}):p.createElement(wQ,{sectors:t,props:r,showLabels:s})}function kQ(e){var{sectors:t,activeShape:r,inactiveShape:s,allOtherPieProps:i,shape:a,id:o}=e,l=It(Yo),c=It(aw),u=It(XV),{onMouseEnter:d,onClick:f,onMouseLeave:h}=i,m=cx(i,aQ),g=bw(d,i.dataKey,o),x=jw(h),y=ww(f,i.dataKey,o);return t==null||t.length===0?null:p.createElement(p.Fragment,null,t.map((v,S)=>{if((v==null?void 0:v.startAngle)===0&&(v==null?void 0:v.endAngle)===0&&t.length!==1)return null;var k=u==null||u===o,j=String(S)===l&&(c==null||i.dataKey===c)&&k,_=l?s:null,b=r&&j?r:_,A=Zr(Zr({},v),{},{stroke:v.stroke,tabIndex:-1,[FI]:S,[WI]:i.dataKey});return p.createElement(Ln,Ko({key:"sector-".concat(v==null?void 0:v.startAngle,"-").concat(v==null?void 0:v.endAngle,"-").concat(v.midAngle,"-").concat(S),tabIndex:-1,className:"recharts-pie-sector"},wp(m,v,S),{onMouseEnter:g(v,S),onMouseLeave:x(v,S),onClick:y(v,S)}),p.createElement(vw,Ko({option:a??b,index:S,shapeType:"sector",isActive:j},A)))}))}function NQ(e){var t,{pieSettings:r,displayedData:s,cells:i,offset:a}=e,{cornerRadius:o,startAngle:l,endAngle:c,dataKey:u,nameKey:d,tooltipType:f}=r,h=Math.abs(r.minAngle),m=yQ(l,c),g=Math.abs(m),x=s.length<=1?0:(t=r.paddingAngle)!==null&&t!==void 0?t:0,y=s.filter(b=>Ar(b,u,0)!==0).length,v=(g>=360?y:y-1)*x,S=g-y*h-v,k=s.reduce((b,A)=>{var z=Ar(A,u,0);return b+(zt(z)?z:0)},0),j;if(k>0){var _;j=s.map((b,A)=>{var z=Ar(b,u,0),D=Ar(b,d,A),w=xQ(r,a,b),N=(zt(z)?z:0)/k,$,E=Zr(Zr({},b),i&&i[A]&&i[A].props);A?$=_.endAngle+On(m)*x*(z!==0?1:0):$=l;var q=$+On(m)*((z!==0?h:0)+N*S),L=($+q)/2,O=(w.innerRadius+w.outerRadius)/2,B=[{name:D,value:z,payload:E,dataKey:u,type:f}],I=dn(w.cx,w.cy,O,L);return _=Zr(Zr(Zr(Zr({},r.presentationProps),{},{percent:N,cornerRadius:typeof o=="string"?parseFloat(o):o,name:D,tooltipPayload:B,midAngle:L,middleRadius:O,tooltipPosition:I},E),w),{},{value:z,dataKey:u,startAngle:$,endAngle:q,payload:E,paddingAngle:On(m)*x}),_})}return j}function CQ(e){var{showLabels:t,sectors:r,children:s}=e,i=p.useMemo(()=>!t||!r?[]:r.map(a=>({value:a.value,payload:a.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:a.cx,cy:a.cy,innerRadius:a.innerRadius,outerRadius:a.outerRadius,startAngle:a.startAngle,endAngle:a.endAngle,clockWise:!1},fill:a.fill})),[r,t]);return p.createElement(cX,{value:t?i:void 0},s)}function _Q(e){var{props:t,previousSectorsRef:r,id:s}=e,{sectors:i,isAnimationActive:a,animationBegin:o,animationDuration:l,animationEasing:c,activeShape:u,inactiveShape:d,onAnimationStart:f,onAnimationEnd:h}=t,m=Ip(t,"recharts-pie-"),g=r.current,[x,y]=p.useState(!1),v=p.useCallback(()=>{typeof h=="function"&&h(),y(!1)},[h]),S=p.useCallback(()=>{typeof f=="function"&&f(),y(!0)},[f]);return p.createElement(CQ,{showLabels:!x,sectors:i},p.createElement(Pp,{animationId:m,begin:o,duration:l,isActive:a,easing:c,onAnimationStart:S,onAnimationEnd:v,key:m},k=>{var j=[],_=i&&i[0],b=_==null?void 0:_.startAngle;return i==null||i.forEach((A,z)=>{var D=g&&g[z],w=z>0?ql(A,"paddingAngle",0):0;if(D){var N=Br(D.endAngle-D.startAngle,A.endAngle-A.startAngle,k),$=Zr(Zr({},A),{},{startAngle:b+w,endAngle:b+N+w});j.push($),b=$.endAngle}else{var{endAngle:E,startAngle:q}=A,L=Br(0,E-q,k),O=Zr(Zr({},A),{},{startAngle:b+w,endAngle:b+L+w});j.push(O),b=O.endAngle}}),r.current=j,p.createElement(Ln,null,p.createElement(kQ,{sectors:j,activeShape:u,inactiveShape:d,allOtherPieProps:t,shape:t.shape,id:s}))}),p.createElement(SQ,{showLabels:!x,sectors:i,props:t}),t.children)}var AQ={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:un.area};function EQ(e){var{id:t}=e,r=cx(e,oQ),{hide:s,className:i,rootTabIndex:a}=e,o=p.useMemo(()=>yw(e.children,zi),[e.children]),l=It(d=>CX(d,t,o)),c=p.useRef(null),u=vr("recharts-pie",i);return s||l==null?(c.current=null,p.createElement(Ln,{tabIndex:a,className:u})):p.createElement(Os,{zIndex:e.zIndex},p.createElement(hQ,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:l,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType}),p.createElement(Ln,{tabIndex:a,className:u},p.createElement(_Q,{props:Zr(Zr({},r),{},{sectors:l}),previousSectorsRef:c,id:t})))}function dx(e){var t=hn(e,AQ),{id:r}=t,s=cx(t,lQ),i=qs(s);return p.createElement(kw,{id:r,type:"pie"},a=>p.createElement(p.Fragment,null,p.createElement(sQ,{type:"pie",id:a,data:s.data,dataKey:s.dataKey,hide:s.hide,angleAxisId:0,radiusAxisId:0,name:s.name,nameKey:s.nameKey,tooltipType:s.tooltipType,legendType:s.legendType,fill:s.fill,cx:s.cx,cy:s.cy,startAngle:s.startAngle,endAngle:s.endAngle,paddingAngle:s.paddingAngle,minAngle:s.minAngle,innerRadius:s.innerRadius,outerRadius:s.outerRadius,cornerRadius:s.cornerRadius,presentationProps:i,maxRadius:t.maxRadius}),p.createElement(fQ,Ko({},s,{id:a})),p.createElement(EQ,Ko({},s,{id:a}))))}dx.displayName="Pie";var PQ=["points"];function EC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function yy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EC(Object(r),!0).forEach(function(s){IQ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function IQ(e,t,r){return(t=TQ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TQ(e){var t=RQ(e,"string");return typeof t=="symbol"?t:t+""}function RQ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Eg(){return Eg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Eg.apply(null,arguments)}function OQ(e,t){if(e==null)return{};var r,s,i=zQ(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function zQ(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function LQ(e){var{option:t,dotProps:r,className:s}=e;if(p.isValidElement(t))return p.cloneElement(t,r);if(typeof t=="function")return t(r);var i=vr(s,typeof t!="boolean"?t.className:""),a=r??{},{points:o}=a,l=OQ(a,PQ);return p.createElement(F5,Eg({},l,{className:i}))}function $Q(e,t){return e==null?!1:t?!0:e.length===1}function DQ(e){var{points:t,dot:r,className:s,dotClassName:i,dataKey:a,baseProps:o,needClip:l,clipPathId:c,zIndex:u=un.scatter}=e;if(!$Q(t,r))return null;var d=q5(r),f=$M(r),h=t.map((g,x)=>{var y,v,S=yy(yy(yy({r:3},o),f),{},{index:x,cx:(y=g.x)!==null&&y!==void 0?y:void 0,cy:(v=g.y)!==null&&v!==void 0?v:void 0,dataKey:a,value:g.value,payload:g.payload,points:t});return p.createElement(LQ,{key:"dot-".concat(x),option:r,dotProps:S,className:i})}),m={};return l&&c!=null&&(m.clipPath="url(#clipPath-".concat(d?"":"dots-").concat(c,")")),p.createElement(Os,{zIndex:u},p.createElement(Ln,Eg({className:s},m),h))}function PC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function IC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PC(Object(r),!0).forEach(function(s){MQ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function MQ(e,t,r){return(t=BQ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BQ(e){var t=FQ(e,"string");return typeof t=="symbol"?t:t+""}function FQ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var WQ={xAxis:{},yAxis:{},zAxis:{}},e8=Rs({name:"cartesianAxis",initialState:WQ,reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:Mr()},replaceXAxis:{reducer(e,t){var{prev:r,next:s}=t.payload;e.xAxis[r.id]!==void 0&&(r.id!==s.id&&delete e.xAxis[r.id],e.xAxis[s.id]=s)},prepare:Mr()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:Mr()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:Mr()},replaceYAxis:{reducer(e,t){var{prev:r,next:s}=t.payload;e.yAxis[r.id]!==void 0&&(r.id!==s.id&&delete e.yAxis[r.id],e.yAxis[s.id]=s)},prepare:Mr()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:Mr()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:Mr()},replaceZAxis:{reducer(e,t){var{prev:r,next:s}=t.payload;e.zAxis[r.id]!==void 0&&(r.id!==s.id&&delete e.zAxis[r.id],e.zAxis[s.id]=s)},prepare:Mr()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:Mr()},updateYAxisWidth(e,t){var{id:r,width:s}=t.payload,i=e.yAxis[r];if(i){var a=i.widthHistory||[];if(a.length===3&&a[0]===a[2]&&s===a[1]&&s!==i.width&&Math.abs(s-a[0])<=1)return;var o=[...a,s].slice(-3);e.yAxis[r]=IC(IC({},e.yAxis[r]),{},{width:s,widthHistory:o})}}}}),{addXAxis:UQ,replaceXAxis:HQ,removeXAxis:YQ,addYAxis:KQ,replaceYAxis:VQ,removeYAxis:qQ,addZAxis:fie,replaceZAxis:hie,removeZAxis:gie,updateYAxisWidth:GQ}=e8.actions,XQ=e8.reducer,QQ=ze([kn],e=>({top:e.top,bottom:e.bottom,left:e.left,right:e.right})),JQ=ze([QQ,qa,Ga],(e,t,r)=>{if(!(!e||t==null||r==null))return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,r-e.top-e.bottom)}}),Nw=()=>It(JQ),ZQ=()=>It(tq);function TC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function vy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TC(Object(r),!0).forEach(function(s){eJ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function eJ(e,t,r){return(t=tJ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tJ(e){var t=rJ(e,"string");return typeof t=="symbol"?t:t+""}function rJ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nJ=e=>{var{point:t,childIndex:r,mainColor:s,activeDot:i,dataKey:a,clipPath:o}=e;if(i===!1||t.x==null||t.y==null)return null;var l={index:r,dataKey:a,cx:t.x,cy:t.y,r:4,fill:s??"none",strokeWidth:2,stroke:"#fff",payload:t.payload,value:t.value},c=vy(vy(vy({},l),Vl(i)),_b(i)),u;return p.isValidElement(i)?u=p.cloneElement(i,c):typeof i=="function"?u=i(c):u=p.createElement(F5,c),p.createElement(Ln,{className:"recharts-active-dot",clipPath:o},u)};function sJ(e){var{points:t,mainColor:r,activeDot:s,itemDataKey:i,clipPath:a,zIndex:o=un.activeDot}=e,l=It(Yo),c=ZQ();if(t==null||c==null)return null;var u=t.find(d=>c.includes(d.payload));return Ur(u)?null:p.createElement(Os,{zIndex:o},p.createElement(nJ,{point:u,childIndex:Number(l),mainColor:r,dataKey:i,activeDot:s,clipPath:a}))}var iJ="Invariant failed";function aJ(e,t){throw new Error(iJ)}var oJ=["x","y"];function K0(){return K0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},K0.apply(null,arguments)}function RC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Jd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RC(Object(r),!0).forEach(function(s){lJ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function lJ(e,t,r){return(t=cJ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cJ(e){var t=dJ(e,"string");return typeof t=="symbol"?t:t+""}function dJ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uJ(e,t){if(e==null)return{};var r,s,i=pJ(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function pJ(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function fJ(e,t){var{x:r,y:s}=e,i=uJ(e,oJ),a="".concat(r),o=parseInt(a,10),l="".concat(s),c=parseInt(l,10),u="".concat(t.height||i.height),d=parseInt(u,10),f="".concat(t.width||i.width),h=parseInt(f,10);return Jd(Jd(Jd(Jd(Jd({},t),i),o?{x:o}:{}),c?{y:c}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function Pg(e){return p.createElement(vw,K0({shapeType:"rectangle",propTransformer:fJ,activeClassName:"recharts-active-bar"},e))}var hJ=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s,i)=>{if(zt(t))return t;var a=zt(s)||Ur(s);return a?t(s,i):(a||aJ(),r)}},gJ={},t8=Rs({name:"errorBars",initialState:gJ,reducers:{addErrorBar:(e,t)=>{var{itemId:r,errorBar:s}=t.payload;e[r]||(e[r]=[]),e[r].push(s)},replaceErrorBar:(e,t)=>{var{itemId:r,prev:s,next:i}=t.payload;e[r]&&(e[r]=e[r].map(a=>a.dataKey===s.dataKey&&a.direction===s.direction?i:a))},removeErrorBar:(e,t)=>{var{itemId:r,errorBar:s}=t.payload;e[r]&&(e[r]=e[r].filter(i=>i.dataKey!==s.dataKey||i.direction!==s.direction))}}}),{addErrorBar:mie,replaceErrorBar:xie,removeErrorBar:yie}=t8.actions,mJ=t8.reducer,xJ=["children"];function yJ(e,t){if(e==null)return{};var r,s,i=vJ(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function vJ(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var bJ={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},jJ=p.createContext(bJ);function r8(e){var{children:t}=e,r=yJ(e,xJ);return p.createElement(jJ.Provider,{value:r},t)}function Cw(e,t){var r,s,i=It(u=>Qa(u,e)),a=It(u=>Ja(u,t)),o=(r=i==null?void 0:i.allowDataOverflow)!==null&&r!==void 0?r:En.allowDataOverflow,l=(s=a==null?void 0:a.allowDataOverflow)!==null&&s!==void 0?s:Pn.allowDataOverflow,c=o||l;return{needClip:c,needClipX:o,needClipY:l}}function n8(e){var{xAxisId:t,yAxisId:r,clipPathId:s}=e,i=Nw(),{needClipX:a,needClipY:o,needClip:l}=Cw(t,r);if(!l||!i)return null;var{x:c,y:u,width:d,height:f}=i;return p.createElement("clipPath",{id:"clipPath-".concat(s)},p.createElement("rect",{x:a?c:c-d/2,y:o?u:u-f/2,width:a?d:d*2,height:o?f:f*2}))}function wJ(e,t){return e&&typeof e=="object"&&"zIndex"in e&&typeof e.zIndex=="number"&&nn(e.zIndex)?e.zIndex:t}var SJ={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kp=p;function kJ(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var NJ=typeof Object.is=="function"?Object.is:kJ,CJ=Kp.useSyncExternalStore,_J=Kp.useRef,AJ=Kp.useEffect,EJ=Kp.useMemo,PJ=Kp.useDebugValue;SJ.useSyncExternalStoreWithSelector=function(e,t,r,s,i){var a=_J(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=EJ(function(){function c(m){if(!u){if(u=!0,d=m,m=s(m),i!==void 0&&o.hasValue){var g=o.value;if(i(g,m))return f=g}return f=m}if(g=f,NJ(d,m))return g;var x=s(m);return i!==void 0&&i(g,x)?(d=m,g):(d=m,f=x)}var u=!1,d,f,h=r===void 0?null:r;return[function(){return c(t())},h===null?void 0:function(){return c(h())}]},[t,r,s,i]);var l=CJ(e,a[0],a[1]);return AJ(function(){o.hasValue=!0,o.value=l},[l]),PJ(l),l};function IJ(e){e()}function TJ(){let e=null,t=null;return{clear(){e=null,t=null},notify(){IJ(()=>{let r=e;for(;r;)r.callback(),r=r.next})},get(){const r=[];let s=e;for(;s;)r.push(s),s=s.next;return r},subscribe(r){let s=!0;const i=t={callback:r,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){!s||e===null||(s=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}var OC={notify(){},get:()=>[]};function RJ(e,t){let r,s=OC,i=0,a=!1;function o(x){d();const y=s.subscribe(x);let v=!1;return()=>{v||(v=!0,y(),f())}}function l(){s.notify()}function c(){g.onStateChange&&g.onStateChange()}function u(){return a}function d(){i++,r||(r=e.subscribe(c),s=TJ())}function f(){i--,r&&i===0&&(r(),r=void 0,s.clear(),s=OC)}function h(){a||(a=!0,d())}function m(){a&&(a=!1,f())}const g={addNestedSub:o,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:u,trySubscribe:h,tryUnsubscribe:m,getListeners:()=>s};return g}var OJ=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zJ=OJ(),LJ=()=>typeof navigator<"u"&&navigator.product==="ReactNative",$J=LJ(),DJ=()=>zJ||$J?p.useLayoutEffect:p.useEffect,MJ=DJ();function zC(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function BJ(e,t){if(zC(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(let i=0;i<r.length;i++)if(!Object.prototype.hasOwnProperty.call(t,r[i])||!zC(e[r[i]],t[r[i]]))return!1;return!0}var by=Symbol.for("react-redux-context"),jy=typeof globalThis<"u"?globalThis:{};function FJ(){if(!p.createContext)return{};const e=jy[by]??(jy[by]=new Map);let t=e.get(p.createContext);return t||(t=p.createContext(null),e.set(p.createContext,t)),t}var WJ=FJ();function UJ(e){const{children:t,context:r,serverState:s,store:i}=e,a=p.useMemo(()=>{const c=RJ(i);return{store:i,subscription:c,getServerState:s?()=>s:void 0}},[i,s]),o=p.useMemo(()=>i.getState(),[i]);MJ(()=>{const{subscription:c}=a;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),o!==i.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[a,o]);const l=r||WJ;return p.createElement(l.Provider,{value:a},t)}var HJ=UJ,YJ=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle"]);function KJ(e,t){return e==null&&t==null?!0:typeof e=="number"&&typeof t=="number"?e===t||e!==e&&t!==t:e===t}function ux(e,t){var r=new Set([...Object.keys(e),...Object.keys(t)]);for(var s of r)if(YJ.has(s)){if(e[s]==null&&t[s]==null)continue;if(!BJ(e[s],t[s]))return!1}else if(!KJ(e[s],t[s]))return!1;return!0}var VJ=["onMouseEnter","onMouseLeave","onClick"],qJ=["value","background","tooltipPosition"],GJ=["id"],XJ=["onMouseEnter","onClick","onMouseLeave"];function Ha(){return Ha=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ha.apply(null,arguments)}function LC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function us(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LC(Object(r),!0).forEach(function(s){QJ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function QJ(e,t,r){return(t=JJ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JJ(e){var t=ZJ(e,"string");return typeof t=="symbol"?t:t+""}function ZJ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ig(e,t){if(e==null)return{};var r,s,i=eZ(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function eZ(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var tZ=e=>{var{dataKey:t,name:r,fill:s,legendType:i,hide:a}=e;return[{inactive:a,dataKey:t,type:i,color:s,value:Sd(r,t),payload:e}]},rZ=p.memo(e=>{var{dataKey:t,stroke:r,strokeWidth:s,fill:i,name:a,hide:o,unit:l,tooltipType:c}=e,u={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:r,strokeWidth:s,fill:i,dataKey:t,nameKey:void 0,name:Sd(a,t),hide:o,type:c,color:i,unit:l}};return p.createElement(Sw,{tooltipEntrySettings:u})});function nZ(e){var t=It(Yo),{data:r,dataKey:s,background:i,allOtherBarProps:a}=e,{onMouseEnter:o,onMouseLeave:l,onClick:c}=a,u=Ig(a,VJ),d=bw(o,s),f=jw(l),h=ww(c,s);if(!i||r==null)return null;var m=Vl(i);return p.createElement(Os,{zIndex:wJ(i,un.barBackground)},r.map((g,x)=>{var{value:y,background:v,tooltipPosition:S}=g,k=Ig(g,qJ);if(!v)return null;var j=d(g,x),_=f(g,x),b=h(g,x),A=us(us(us(us(us({option:i,isActive:String(x)===t},k),{},{fill:"#eee"},v),m),wp(u,g,x)),{},{onMouseEnter:j,onMouseLeave:_,onClick:b,dataKey:s,index:x,className:"recharts-bar-background-rectangle"});return p.createElement(Pg,Ha({key:"background-bar-".concat(x)},A))}))}function sZ(e){var{showLabels:t,children:r,rects:s}=e,i=s==null?void 0:s.map(a=>{var o={x:a.x,y:a.y,width:a.width,lowerWidth:a.width,upperWidth:a.width,height:a.height};return us(us({},o),{},{value:a.value,payload:a.payload,parentViewBox:a.parentViewBox,viewBox:o,fill:a.fill})});return p.createElement(M5,{value:t?i:void 0},r)}function iZ(e){var{shape:t,activeBar:r,baseProps:s,entry:i,index:a,dataKey:o}=e,l=It(Yo),c=It(aw),u=r&&String(a)===l&&(c==null||o===c),d=u?r:t;return u?p.createElement(Os,{zIndex:un.activeBar},p.createElement(Pg,Ha({},s,{name:String(s.name)},i,{isActive:u,option:d,index:a,dataKey:o}))):p.createElement(Pg,Ha({},s,{name:String(s.name)},i,{isActive:u,option:d,index:a,dataKey:o}))}function aZ(e){var{shape:t,baseProps:r,entry:s,index:i,dataKey:a}=e;return p.createElement(Pg,Ha({},r,{name:String(r.name)},s,{isActive:!1,option:t,index:i,dataKey:a}))}function oZ(e){var t,{data:r,props:s}=e,i=(t=qs(s))!==null&&t!==void 0?t:{},{id:a}=i,o=Ig(i,GJ),{shape:l,dataKey:c,activeBar:u}=s,{onMouseEnter:d,onClick:f,onMouseLeave:h}=s,m=Ig(s,XJ),g=bw(d,c),x=jw(h),y=ww(f,c);return r?p.createElement(p.Fragment,null,r.map((v,S)=>p.createElement(Ln,Ha({key:"rectangle-".concat(v==null?void 0:v.x,"-").concat(v==null?void 0:v.y,"-").concat(v==null?void 0:v.value,"-").concat(S),className:"recharts-bar-rectangle"},wp(m,v,S),{onMouseEnter:g(v,S),onMouseLeave:x(v,S),onClick:y(v,S)}),u?p.createElement(iZ,{shape:l,activeBar:u,baseProps:o,entry:v,index:S,dataKey:c}):p.createElement(aZ,{shape:l,baseProps:o,entry:v,index:S,dataKey:c})))):null}function lZ(e){var{props:t,previousRectanglesRef:r}=e,{data:s,layout:i,isAnimationActive:a,animationBegin:o,animationDuration:l,animationEasing:c,onAnimationEnd:u,onAnimationStart:d}=t,f=r.current,h=Ip(t,"recharts-bar-"),[m,g]=p.useState(!1),x=!m,y=p.useCallback(()=>{typeof u=="function"&&u(),g(!1)},[u]),v=p.useCallback(()=>{typeof d=="function"&&d(),g(!0)},[d]);return p.createElement(sZ,{showLabels:x,rects:s},p.createElement(Pp,{animationId:h,begin:o,duration:l,isActive:a,easing:c,onAnimationEnd:y,onAnimationStart:v,key:h},S=>{var k=S===1?s:s==null?void 0:s.map((j,_)=>{var b=f&&f[_];if(b)return us(us({},j),{},{x:Br(b.x,j.x,S),y:Br(b.y,j.y,S),width:Br(b.width,j.width,S),height:Br(b.height,j.height,S)});if(i==="horizontal"){var A=Br(0,j.height,S),z=Br(j.stackedBarStart,j.y,S);return us(us({},j),{},{y:z,height:A})}var D=Br(0,j.width,S),w=Br(j.stackedBarStart,j.x,S);return us(us({},j),{},{width:D,x:w})});return S>0&&(r.current=k??null),k==null?null:p.createElement(Ln,null,p.createElement(oZ,{props:t,data:k}))}),p.createElement(fw,{label:t.label}),t.children)}function cZ(e){var t=p.useRef(null);return p.createElement(lZ,{previousRectanglesRef:t,props:e})}var s8=0,dZ=(e,t)=>{var r=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:r,errorVal:Ar(e,t)}};class uZ extends p.PureComponent{render(){var{hide:t,data:r,dataKey:s,className:i,xAxisId:a,yAxisId:o,needClip:l,background:c,id:u}=this.props;if(t||r==null)return null;var d=vr("recharts-bar",i),f=u;return p.createElement(Ln,{className:d,id:u},l&&p.createElement("defs",null,p.createElement(n8,{clipPathId:f,xAxisId:a,yAxisId:o})),p.createElement(Ln,{className:"recharts-bar-rectangles",clipPath:l?"url(#clipPath-".concat(f,")"):void 0},p.createElement(nZ,{data:r,dataKey:s,background:c,allOtherBarProps:this.props}),p.createElement(cZ,this.props)))}}var pZ={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:s8,xAxisId:0,yAxisId:0,zIndex:un.bar};function fZ(e){var{xAxisId:t,yAxisId:r,hide:s,legendType:i,minPointSize:a,activeBar:o,animationBegin:l,animationDuration:c,animationEasing:u,isAnimationActive:d}=e,{needClip:f}=Cw(t,r),h=_p(),m=ss(),g=yw(e.children,zi),x=It(S=>FZ(S,t,r,m,e.id,g));if(h!=="vertical"&&h!=="horizontal")return null;var y,v=x==null?void 0:x[0];return v==null||v.height==null||v.width==null?y=0:y=h==="vertical"?v.height/2:v.width/2,p.createElement(r8,{xAxisId:t,yAxisId:r,data:x,dataPointFormatter:dZ,errorBarOffset:y},p.createElement(uZ,Ha({},e,{layout:h,needClip:f,data:x,xAxisId:t,yAxisId:r,hide:s,legendType:i,minPointSize:a,activeBar:o,animationBegin:l,animationDuration:c,animationEasing:u,isAnimationActive:d})))}function hZ(e){var{layout:t,barSettings:{dataKey:r,minPointSize:s},pos:i,bandSize:a,xAxis:o,yAxis:l,xAxisTicks:c,yAxisTicks:u,stackedData:d,displayedData:f,offset:h,cells:m,parentViewBox:g,dataStartIndex:x}=e,y=t==="horizontal"?l:o,v=d?y.scale.domain():null,S=Y7({numericAxis:y}),k=y.scale(S);return f.map((j,_)=>{var b,A,z,D,w,N;d?b=M7(d[_+x],v):(b=Ar(j,r),Array.isArray(b)||(b=[S,b]));var $=hJ(s,s8)(b[1],_);if(t==="horizontal"){var E,[q,L]=[l.scale(b[0]),l.scale(b[1])];A=yk({axis:o,ticks:c,bandSize:a,offset:i.offset,entry:j,index:_}),z=(E=L??q)!==null&&E!==void 0?E:void 0,D=i.size;var O=q-L;if(w=$i(O)?0:O,N={x:A,y:h.top,width:D,height:h.height},Math.abs($)>0&&Math.abs(w)<Math.abs($)){var B=On(w||$)*(Math.abs($)-Math.abs(w));z-=B,w+=B}}else{var[I,T]=[o.scale(b[0]),o.scale(b[1])];if(A=I,z=yk({axis:l,ticks:u,bandSize:a,offset:i.offset,entry:j,index:_}),D=T-I,w=i.size,N={x:h.left,y:z,width:h.width,height:w},Math.abs($)>0&&Math.abs(D)<Math.abs($)){var W=On(D||$)*(Math.abs($)-Math.abs(D));D+=W}}if(A==null||z==null||D==null||w==null)return null;var re=us(us({},j),{},{stackedBarStart:k,x:A,y:z,width:D,height:w,value:d?b:b[1],payload:j,background:N,tooltipPosition:{x:A+D/2,y:z+w/2},parentViewBox:g},m&&m[_]&&m[_].props);return re}).filter(Boolean)}function gZ(e){var t=hn(e,pZ),r=ss();return p.createElement(kw,{id:t.id,type:"bar"},s=>p.createElement(p.Fragment,null,p.createElement(X5,{legendPayload:tZ(t)}),p.createElement(rZ,{dataKey:t.dataKey,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType}),p.createElement(Z5,{type:"bar",id:s,data:void 0,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,stackId:H7(t.stackId),hide:t.hide,barSize:t.barSize,minPointSize:t.minPointSize,maxBarSize:t.maxBarSize,isPanorama:r}),p.createElement(Os,{zIndex:t.zIndex},p.createElement(fZ,Ha({},t,{id:s})))))}var tp=p.memo(gZ,ux);tp.displayName="Bar";function $C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Of(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$C(Object(r),!0).forEach(function(s){mZ(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$C(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function mZ(e,t,r){return(t=xZ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xZ(e){var t=yZ(e,"string");return typeof t=="symbol"?t:t+""}function yZ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vZ=(e,t)=>t,bZ=(e,t,r)=>r,jZ=(e,t,r,s)=>s,wZ=(e,t,r,s,i)=>i,Vp=ze([Ym,wZ],(e,t)=>e.filter(r=>r.type==="bar").find(r=>r.id===t)),SZ=ze([Vp],e=>e==null?void 0:e.maxBarSize),kZ=(e,t,r,s,i,a)=>a,DC=(e,t,r)=>{var s=r??e;if(!Ur(s))return rs(s,t,0)},NZ=ze([gr,Ym,vZ,bZ,jZ],(e,t,r,s,i)=>t.filter(a=>e==="horizontal"?a.xAxisId===r:a.yAxisId===s).filter(a=>a.isPanorama===i).filter(a=>a.hide===!1).filter(a=>a.type==="bar")),CZ=(e,t,r,s)=>{var i=gr(e);return i==="horizontal"?D0(e,"yAxis",r,s):D0(e,"xAxis",t,s)},_Z=(e,t,r)=>{var s=gr(e);return s==="horizontal"?UN(e,"xAxis",t):UN(e,"yAxis",r)},AZ=(e,t,r)=>{var s={},i=e.filter(Wm),a=e.filter(u=>u.stackId==null),o=i.reduce((u,d)=>(u[d.stackId]||(u[d.stackId]=[]),u[d.stackId].push(d),u),s),l=Object.entries(o).map(u=>{var[d,f]=u,h=f.map(g=>g.dataKey),m=DC(t,r,f[0].barSize);return{stackId:d,dataKeys:h,barSize:m}}),c=a.map(u=>{var d=[u.dataKey].filter(h=>h!=null),f=DC(t,r,u.barSize);return{stackId:void 0,dataKeys:d,barSize:f}});return[...l,...c]},EZ=ze([NZ,ZY,_Z],AZ),PZ=(e,t,r,s,i)=>{var a,o,l=Vp(e,t,r,s,i);if(l!=null){var c=gr(e),u=mT(e),{maxBarSize:d}=l,f=Ur(d)?u:d,h,m;return c==="horizontal"?(h=Ho(e,"xAxis",t,s),m=Uo(e,"xAxis",t,s)):(h=Ho(e,"yAxis",r,s),m=Uo(e,"yAxis",r,s)),(a=(o=id(h,m,!0))!==null&&o!==void 0?o:f)!==null&&a!==void 0?a:0}},i8=(e,t,r,s)=>{var i=gr(e),a,o;return i==="horizontal"?(a=Ho(e,"xAxis",t,s),o=Uo(e,"xAxis",t,s)):(a=Ho(e,"yAxis",r,s),o=Uo(e,"yAxis",r,s)),id(a,o)};function IZ(e,t,r,s,i){var a=s.length;if(!(a<1)){var o=rs(e,r,0,!0),l,c=[];if(nn(s[0].barSize)){var u=!1,d=r/a,f=s.reduce((v,S)=>v+(S.barSize||0),0);f+=(a-1)*o,f>=r&&(f-=(a-1)*o,o=0),f>=r&&d>0&&(u=!0,d*=.9,f=a*d);var h=(r-f)/2>>0,m={offset:h-o,size:0};l=s.reduce((v,S)=>{var k,j={stackId:S.stackId,dataKeys:S.dataKeys,position:{offset:m.offset+m.size+o,size:u?d:(k=S.barSize)!==null&&k!==void 0?k:0}},_=[...v,j];return m=_[_.length-1].position,_},c)}else{var g=rs(t,r,0,!0);r-2*g-(a-1)*o<=0&&(o=0);var x=(r-2*g-(a-1)*o)/a;x>1&&(x>>=0);var y=nn(i)?Math.min(x,i):x;l=s.reduce((v,S,k)=>[...v,{stackId:S.stackId,dataKeys:S.dataKeys,position:{offset:g+(x+o)*k+(x-y)/2,size:y}}],c)}return l}}var TZ=(e,t,r,s,i,a,o)=>{var l=Ur(o)?t:o,c=IZ(r,s,i!==a?i:a,e,l);return i!==a&&c!=null&&(c=c.map(u=>Of(Of({},u),{},{position:Of(Of({},u.position),{},{offset:u.position.offset-i/2})}))),c},RZ=ze([EZ,mT,JY,xT,PZ,i8,SZ],TZ),OZ=(e,t,r,s)=>Ho(e,"xAxis",t,s),zZ=(e,t,r,s)=>Ho(e,"yAxis",r,s),LZ=(e,t,r,s)=>Uo(e,"xAxis",t,s),$Z=(e,t,r,s)=>Uo(e,"yAxis",r,s),DZ=ze([RZ,Vp],(e,t)=>{if(!(e==null||t==null)){var r=e.find(s=>s.stackId===t.stackId&&t.dataKey!=null&&s.dataKeys.includes(t.dataKey));if(r!=null)return r.position}}),MZ=(e,t)=>{var r=Rj(t);if(!(!e||r==null||t==null)){var{stackId:s}=t;if(s!=null){var i=e[s];if(i){var{stackedData:a}=i;if(a)return a.find(o=>o.key===r)}}}},BZ=ze([CZ,Vp],MZ),FZ=ze([kn,qb,OZ,zZ,LZ,$Z,DZ,gr,Mm,i8,BZ,Vp,kZ],(e,t,r,s,i,a,o,l,c,u,d,f,h)=>{var{chartData:m,dataStartIndex:g,dataEndIndex:x}=c;if(!(f==null||o==null||t==null||l!=="horizontal"&&l!=="vertical"||r==null||s==null||i==null||a==null||u==null)){var{data:y}=f,v;if(y!=null&&y.length>0?v=y:v=m==null?void 0:m.slice(g,x+1),v!=null)return hZ({layout:l,barSettings:f,pos:o,parentViewBox:t,bandSize:u,xAxis:r,yAxis:s,xAxisTicks:i,yAxisTicks:a,stackedData:d,displayedData:v,offset:e,cells:h,dataStartIndex:g})}}),a8=e=>{var{chartData:t}=e,r=Rr(),s=ss();return p.useEffect(()=>s?()=>{}:(r(tC(t)),()=>{r(tC(void 0))}),[t,r,s]),null},MC={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},o8=Rs({name:"brush",initialState:MC,reducers:{setBrushSettings(e,t){return t.payload==null?MC:t.payload}}}),{setBrushSettings:vie}=o8.actions,WZ=o8.reducer;function UZ(e,t,r){return(t=HZ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HZ(e){var t=YZ(e,"string");return typeof t=="symbol"?t:t+""}function YZ(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class _w{static create(t){return new _w(t)}constructor(t){this.scale=t}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(t){var{bandAware:r,position:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t!==void 0){if(s)switch(s){case"start":return this.scale(t);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+i}case"end":{var a=this.bandwidth?this.bandwidth():0;return this.scale(t)+a}default:return this.scale(t)}if(r){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+o}return this.scale(t)}}isInRange(t){var r=this.range(),s=r[0],i=r[r.length-1];return s<=i?t>=s&&t<=i:t>=i&&t<=s}}UZ(_w,"EPS",1e-4);function KZ(e){return(e%180+180)%180}var VZ=function(t){var{width:r,height:s}=t,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=KZ(i),o=a*Math.PI/180,l=Math.atan(s/r),c=o>l&&o<Math.PI-l?s/Math.sin(o):r/Math.cos(o);return Math.abs(c)},qZ={dots:[],areas:[],lines:[]},l8=Rs({name:"referenceElements",initialState:qZ,reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var r=Oi(e).dots.findIndex(s=>s===t.payload);r!==-1&&e.dots.splice(r,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var r=Oi(e).areas.findIndex(s=>s===t.payload);r!==-1&&e.areas.splice(r,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var r=Oi(e).lines.findIndex(s=>s===t.payload);r!==-1&&e.lines.splice(r,1)}}}),{addDot:bie,removeDot:jie,addArea:wie,removeArea:Sie,addLine:kie,removeLine:Nie}=l8.actions,GZ=l8.reducer,XZ=p.createContext(void 0),QZ=e=>{var{children:t}=e,[r]=p.useState("".concat(Fu("recharts"),"-clip")),s=Nw();if(s==null)return null;var{x:i,y:a,width:o,height:l}=s;return p.createElement(XZ.Provider,{value:r},p.createElement("defs",null,p.createElement("clipPath",{id:r},p.createElement("rect",{x:i,y:a,height:l,width:o}))),t)};function c8(e,t){if(t<1)return[];if(t===1)return e;for(var r=[],s=0;s<e.length;s+=t)r.push(e[s]);return r}function JZ(e,t,r){var s={width:e.width+t.width,height:e.height+t.height};return VZ(s,r)}function ZZ(e,t,r){var s=r==="width",{x:i,y:a,width:o,height:l}=e;return t===1?{start:s?i:a,end:s?i+o:a+l}:{start:s?i+o:a+l,end:s?i:a}}function Tg(e,t,r,s,i){if(e*t<e*s||e*t>e*i)return!1;var a=r();return e*(t-e*a/2-s)>=0&&e*(t+e*a/2-i)<=0}function eee(e,t){return c8(e,t+1)}function tee(e,t,r,s,i){for(var a=(s||[]).slice(),{start:o,end:l}=t,c=0,u=1,d=o,f=function(){var g=s==null?void 0:s[c];if(g===void 0)return{v:c8(s,u)};var x=c,y,v=()=>(y===void 0&&(y=r(g,x)),y),S=g.coordinate,k=c===0||Tg(e,S,v,d,l);k||(c=0,d=o,u+=1),k&&(d=S+e*(v()/2+i),c+=u)},h;u<=a.length;)if(h=f(),h)return h.v;return[]}function BC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Jn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BC(Object(r),!0).forEach(function(s){ree(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function ree(e,t,r){return(t=nee(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nee(e){var t=see(e,"string");return typeof t=="symbol"?t:t+""}function see(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iee(e,t,r,s,i){for(var a=(s||[]).slice(),o=a.length,{start:l}=t,{end:c}=t,u=function(h){var m=a[h],g,x=()=>(g===void 0&&(g=r(m,h)),g);if(h===o-1){var y=e*(m.coordinate+e*x()/2-c);a[h]=m=Jn(Jn({},m),{},{tickCoord:y>0?m.coordinate-y*e:m.coordinate})}else a[h]=m=Jn(Jn({},m),{},{tickCoord:m.coordinate});if(m.tickCoord!=null){var v=Tg(e,m.tickCoord,x,l,c);v&&(c=m.tickCoord-e*(x()/2+i),a[h]=Jn(Jn({},m),{},{isShow:!0}))}},d=o-1;d>=0;d--)u(d);return a}function aee(e,t,r,s,i,a){var o=(s||[]).slice(),l=o.length,{start:c,end:u}=t;if(a){var d=s[l-1],f=r(d,l-1),h=e*(d.coordinate+e*f/2-u);if(o[l-1]=d=Jn(Jn({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate}),d.tickCoord!=null){var m=Tg(e,d.tickCoord,()=>f,c,u);m&&(u=d.tickCoord-e*(f/2+i),o[l-1]=Jn(Jn({},d),{},{isShow:!0}))}}for(var g=a?l-1:l,x=function(S){var k=o[S],j,_=()=>(j===void 0&&(j=r(k,S)),j);if(S===0){var b=e*(k.coordinate-e*_()/2-c);o[S]=k=Jn(Jn({},k),{},{tickCoord:b<0?k.coordinate-b*e:k.coordinate})}else o[S]=k=Jn(Jn({},k),{},{tickCoord:k.coordinate});if(k.tickCoord!=null){var A=Tg(e,k.tickCoord,_,c,u);A&&(c=k.tickCoord+e*(_()/2+i),o[S]=Jn(Jn({},k),{},{isShow:!0}))}},y=0;y<g;y++)x(y);return o}function Aw(e,t,r){var{tick:s,ticks:i,viewBox:a,minTickGap:o,orientation:l,interval:c,tickFormatter:u,unit:d,angle:f}=e;if(!i||!i.length||!s)return[];if(zt(c)||Ep.isSsr){var h;return(h=eee(i,zt(c)?c:0))!==null&&h!==void 0?h:[]}var m=[],g=l==="top"||l==="bottom"?"width":"height",x=d&&g==="width"?yu(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},y=(k,j)=>{var _=typeof u=="function"?u(k.value,j):k.value;return g==="width"?JZ(yu(_,{fontSize:t,letterSpacing:r}),x,f):yu(_,{fontSize:t,letterSpacing:r})[g]},v=i.length>=2?On(i[1].coordinate-i[0].coordinate):1,S=ZZ(a,v,g);return c==="equidistantPreserveStart"?tee(v,S,y,i,o):(c==="preserveStart"||c==="preserveStartEnd"?m=aee(v,S,y,i,o,c==="preserveStartEnd"):m=iee(v,S,y,i,o),m.filter(k=>k.isShow))}var oee=e=>{var{ticks:t,label:r,labelGapWithTick:s=5,tickSize:i=0,tickMargin:a=0}=e,o=0;if(t){Array.from(t).forEach(d=>{if(d){var f=d.getBoundingClientRect();f.width>o&&(o=f.width)}});var l=r?r.getBoundingClientRect().width:0,c=i+a,u=o+c+l+(r?s:0);return Math.round(u)}return 0},lee=["axisLine","width","height","className","hide","ticks","axisType"];function cee(e,t){if(e==null)return{};var r,s,i=dee(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function dee(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function Zl(){return Zl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Zl.apply(null,arguments)}function FC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function ln(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FC(Object(r),!0).forEach(function(s){uee(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function uee(e,t,r){return(t=pee(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pee(e){var t=fee(e,"string");return typeof t=="symbol"?t:t+""}function fee(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ta={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:un.axis};function hee(e){var{x:t,y:r,width:s,height:i,orientation:a,mirror:o,axisLine:l,otherSvgProps:c}=e;if(!l)return null;var u=ln(ln(ln({},c),qs(l)),{},{fill:"none"});if(a==="top"||a==="bottom"){var d=+(a==="top"&&!o||a==="bottom"&&o);u=ln(ln({},u),{},{x1:t,y1:r+d*i,x2:t+s,y2:r+d*i})}else{var f=+(a==="left"&&!o||a==="right"&&o);u=ln(ln({},u),{},{x1:t+f*s,y1:r,x2:t+f*s,y2:r+i})}return p.createElement("line",Zl({},u,{className:vr("recharts-cartesian-axis-line",ql(l,"className"))}))}function gee(e,t,r,s,i,a,o,l,c){var u,d,f,h,m,g,x=l?-1:1,y=e.tickSize||o,v=zt(e.tickCoord)?e.tickCoord:e.coordinate;switch(a){case"top":u=d=e.coordinate,h=r+ +!l*i,f=h-x*y,g=f-x*c,m=v;break;case"left":f=h=e.coordinate,d=t+ +!l*s,u=d-x*y,m=u-x*c,g=v;break;case"right":f=h=e.coordinate,d=t+ +l*s,u=d+x*y,m=u+x*c,g=v;break;default:u=d=e.coordinate,h=r+ +l*i,f=h+x*y,g=f+x*c,m=v;break}return{line:{x1:u,y1:f,x2:d,y2:h},tick:{x:m,y:g}}}function mee(e,t){switch(e){case"left":return t?"start":"end";case"right":return t?"end":"start";default:return"middle"}}function xee(e,t){switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}function yee(e){var{option:t,tickProps:r,value:s}=e,i,a=vr(r.className,"recharts-cartesian-axis-tick-value");if(p.isValidElement(t))i=p.cloneElement(t,ln(ln({},r),{},{className:a}));else if(typeof t=="function")i=t(ln(ln({},r),{},{className:a}));else{var o="recharts-cartesian-axis-tick-value";typeof t!="boolean"&&(o=vr(o,t==null?void 0:t.className)),i=p.createElement(Xm,Zl({},r,{className:o}),s)}return i}var vee=p.forwardRef((e,t)=>{var{ticks:r=[],tick:s,tickLine:i,stroke:a,tickFormatter:o,unit:l,padding:c,tickTextProps:u,orientation:d,mirror:f,x:h,y:m,width:g,height:x,tickSize:y,tickMargin:v,fontSize:S,letterSpacing:k,getTicksConfig:j,events:_,axisType:b}=e,A=Aw(ln(ln({},j),{},{ticks:r}),S,k),z=mee(d,f),D=xee(d,f),w=qs(j),N=Vl(s),$={};typeof i=="object"&&($=i);var E=ln(ln({},w),{},{fill:"none"},$),q=A.map(B=>ln({entry:B},gee(B,h,m,g,x,d,y,f,v))),L=q.map(B=>{var{entry:I,line:T}=B;return p.createElement(Ln,{className:"recharts-cartesian-axis-tick",key:"tick-".concat(I.value,"-").concat(I.coordinate,"-").concat(I.tickCoord)},i&&p.createElement("line",Zl({},E,T,{className:vr("recharts-cartesian-axis-tick-line",ql(i,"className"))})))}),O=q.map((B,I)=>{var{entry:T,tick:W}=B,re=ln(ln(ln(ln({textAnchor:z,verticalAnchor:D},w),{},{stroke:"none",fill:a},N),W),{},{index:I,payload:T,visibleTicksCount:A.length,tickFormatter:o,padding:c},u);return p.createElement(Ln,Zl({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(T.value,"-").concat(T.coordinate,"-").concat(T.tickCoord)},wp(_,T,I)),s&&p.createElement(yee,{option:s,tickProps:re,value:"".concat(typeof o=="function"?o(T.value,I):T.value).concat(l||"")}))});return p.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(b,"-ticks")},O.length>0&&p.createElement(Os,{zIndex:un.label},p.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(b,"-tick-labels"),ref:t},O)),L.length>0&&p.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(b,"-tick-lines")},L))}),bee=p.forwardRef((e,t)=>{var{axisLine:r,width:s,height:i,className:a,hide:o,ticks:l,axisType:c}=e,u=cee(e,lee),[d,f]=p.useState(""),[h,m]=p.useState(""),g=p.useRef(null);p.useImperativeHandle(t,()=>({getCalculatedWidth:()=>{var y;return oee({ticks:g.current,label:(y=e.labelRef)===null||y===void 0?void 0:y.current,labelGapWithTick:5,tickSize:e.tickSize,tickMargin:e.tickMargin})}}));var x=p.useCallback(y=>{if(y){var v=y.getElementsByClassName("recharts-cartesian-axis-tick-value");g.current=v;var S=v[0];if(S){var k=window.getComputedStyle(S),j=k.fontSize,_=k.letterSpacing;(j!==d||_!==h)&&(f(j),m(_))}}},[d,h]);return o||s!=null&&s<=0||i!=null&&i<=0?null:p.createElement(Os,{zIndex:e.zIndex},p.createElement(Ln,{className:vr("recharts-cartesian-axis",a)},p.createElement(hee,{x:e.x,y:e.y,width:s,height:i,orientation:e.orientation,mirror:e.mirror,axisLine:r,otherSvgProps:qs(e)}),p.createElement(vee,{ref:x,axisType:c,events:u,fontSize:d,getTicksConfig:e,height:e.height,letterSpacing:h,mirror:e.mirror,orientation:e.orientation,padding:e.padding,stroke:e.stroke,tick:e.tick,tickFormatter:e.tickFormatter,tickLine:e.tickLine,tickMargin:e.tickMargin,tickSize:e.tickSize,tickTextProps:e.tickTextProps,ticks:l,unit:e.unit,width:e.width,x:e.x,y:e.y}),p.createElement(KG,{x:e.x,y:e.y,width:e.width,height:e.height,lowerWidth:e.width,upperWidth:e.width},p.createElement(rX,{label:e.label,labelRef:e.labelRef}),e.children)))}),Ew=p.forwardRef((e,t)=>{var r=hn(e,Ta);return p.createElement(bee,Zl({},r,{ref:t}))});Ew.displayName="CartesianAxis";var jee=["x1","y1","x2","y2","key"],wee=["offset"],See=["xAxisId","yAxisId"],kee=["xAxisId","yAxisId"];function WC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function es(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WC(Object(r),!0).forEach(function(s){Nee(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Nee(e,t,r){return(t=Cee(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cee(e){var t=_ee(e,"string");return typeof t=="symbol"?t:t+""}function _ee(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vl(){return vl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},vl.apply(null,arguments)}function Rg(e,t){if(e==null)return{};var r,s,i=Aee(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Aee(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var Eee=e=>{var{fill:t}=e;if(!t||t==="none")return null;var{fillOpacity:r,x:s,y:i,width:a,height:o,ry:l}=e;return p.createElement("rect",{x:s,y:i,ry:l,width:a,height:o,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function d8(e){var{option:t,lineItemProps:r}=e,s;if(p.isValidElement(t))s=p.cloneElement(t,r);else if(typeof t=="function")s=t(r);else{var i,{x1:a,y1:o,x2:l,y2:c,key:u}=r,d=Rg(r,jee),f=(i=qs(d))!==null&&i!==void 0?i:{},{offset:h}=f,m=Rg(f,wee);s=p.createElement("line",vl({},m,{x1:a,y1:o,x2:l,y2:c,fill:"none",key:u}))}return s}function Pee(e){var{x:t,width:r,horizontal:s=!0,horizontalPoints:i}=e;if(!s||!i||!i.length)return null;var{xAxisId:a,yAxisId:o}=e,l=Rg(e,See),c=i.map((u,d)=>{var f=es(es({},l),{},{x1:t,y1:u,x2:t+r,y2:u,key:"line-".concat(d),index:d});return p.createElement(d8,{key:"line-".concat(d),option:s,lineItemProps:f})});return p.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function Iee(e){var{y:t,height:r,vertical:s=!0,verticalPoints:i}=e;if(!s||!i||!i.length)return null;var{xAxisId:a,yAxisId:o}=e,l=Rg(e,kee),c=i.map((u,d)=>{var f=es(es({},l),{},{x1:u,y1:t,x2:u,y2:t+r,key:"line-".concat(d),index:d});return p.createElement(d8,{option:s,lineItemProps:f,key:"line-".concat(d)})});return p.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function Tee(e){var{horizontalFill:t,fillOpacity:r,x:s,y:i,width:a,height:o,horizontalPoints:l,horizontal:c=!0}=e;if(!c||!t||!t.length||l==null)return null;var u=l.map(f=>Math.round(f+i-i)).sort((f,h)=>f-h);i!==u[0]&&u.unshift(0);var d=u.map((f,h)=>{var m=!u[h+1],g=m?i+o-f:u[h+1]-f;if(g<=0)return null;var x=h%t.length;return p.createElement("rect",{key:"react-".concat(h),y:f,x:s,height:g,width:a,stroke:"none",fill:t[x],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return p.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},d)}function Ree(e){var{vertical:t=!0,verticalFill:r,fillOpacity:s,x:i,y:a,width:o,height:l,verticalPoints:c}=e;if(!t||!r||!r.length)return null;var u=c.map(f=>Math.round(f+i-i)).sort((f,h)=>f-h);i!==u[0]&&u.unshift(0);var d=u.map((f,h)=>{var m=!u[h+1],g=m?i+o-f:u[h+1]-f;if(g<=0)return null;var x=h%r.length;return p.createElement("rect",{key:"react-".concat(h),x:f,y:a,width:g,height:l,stroke:"none",fill:r[x],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return p.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},d)}var Oee=(e,t)=>{var{xAxis:r,width:s,height:i,offset:a}=e;return DI(Aw(es(es(es({},Ta),r),{},{ticks:MI(r),viewBox:{x:0,y:0,width:s,height:i}})),a.left,a.left+a.width,t)},zee=(e,t)=>{var{yAxis:r,width:s,height:i,offset:a}=e;return DI(Aw(es(es(es({},Ta),r),{},{ticks:MI(r),viewBox:{x:0,y:0,width:s,height:i}})),a.top,a.top+a.height,t)},Lee={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0,syncWithTicks:!1,zIndex:un.grid};function qp(e){var t=Xb(),r=Qb(),s=XI(),i=es(es({},hn(e,Lee)),{},{x:zt(e.x)?e.x:s.left,y:zt(e.y)?e.y:s.top,width:zt(e.width)?e.width:s.width,height:zt(e.height)?e.height:s.height}),{xAxisId:a,yAxisId:o,x:l,y:c,width:u,height:d,syncWithTicks:f,horizontalValues:h,verticalValues:m}=i,g=ss(),x=It(D=>HN(D,"xAxis",a,g)),y=It(D=>HN(D,"yAxis",o,g));if(!sa(u)||!sa(d)||!zt(l)||!zt(c))return null;var v=i.verticalCoordinatesGenerator||Oee,S=i.horizontalCoordinatesGenerator||zee,{horizontalPoints:k,verticalPoints:j}=i;if((!k||!k.length)&&typeof S=="function"){var _=h&&h.length,b=S({yAxis:y?es(es({},y),{},{ticks:_?h:y.ticks}):void 0,width:t??u,height:r??d,offset:s},_?!0:f);sg(Array.isArray(b),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof b,"]")),Array.isArray(b)&&(k=b)}if((!j||!j.length)&&typeof v=="function"){var A=m&&m.length,z=v({xAxis:x?es(es({},x),{},{ticks:A?m:x.ticks}):void 0,width:t??u,height:r??d,offset:s},A?!0:f);sg(Array.isArray(z),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof z,"]")),Array.isArray(z)&&(j=z)}return p.createElement(Os,{zIndex:i.zIndex},p.createElement("g",{className:"recharts-cartesian-grid"},p.createElement(Eee,{fill:i.fill,fillOpacity:i.fillOpacity,x:i.x,y:i.y,width:i.width,height:i.height,ry:i.ry}),p.createElement(Tee,vl({},i,{horizontalPoints:k})),p.createElement(Ree,vl({},i,{verticalPoints:j})),p.createElement(Pee,vl({},i,{offset:s,horizontalPoints:k,xAxis:x,yAxis:y})),p.createElement(Iee,vl({},i,{offset:s,verticalPoints:j,xAxis:x,yAxis:y}))))}qp.displayName="CartesianGrid";var u8=(e,t,r,s)=>Ho(e,"xAxis",t,s),p8=(e,t,r,s)=>Uo(e,"xAxis",t,s),f8=(e,t,r,s)=>Ho(e,"yAxis",r,s),h8=(e,t,r,s)=>Uo(e,"yAxis",r,s),$ee=ze([gr,u8,f8,p8,h8],(e,t,r,s,i)=>Qo(e,"xAxis")?id(t,s,!1):id(r,i,!1)),Dee=(e,t,r,s,i)=>i;function Mee(e){return e.type==="line"}var Bee=ze([Ym,Dee],(e,t)=>e.filter(Mee).find(r=>r.id===t)),Fee=ze([gr,u8,f8,p8,h8,Bee,$ee,Mm],(e,t,r,s,i,a,o,l)=>{var{chartData:c,dataStartIndex:u,dataEndIndex:d}=l;if(!(a==null||t==null||r==null||s==null||i==null||s.length===0||i.length===0||o==null||e!=="horizontal"&&e!=="vertical")){var{dataKey:f,data:h}=a,m;if(h!=null&&h.length>0?m=h:m=c==null?void 0:c.slice(u,d+1),m!=null)return lte({layout:e,xAxis:t,yAxis:r,xAxisTicks:s,yAxisTicks:i,dataKey:f,bandSize:o,displayedData:m})}});function Wee(e){var t=Vl(e),r=3,s=2;if(t!=null){var{r:i,strokeWidth:a}=t,o=Number(i),l=Number(a);return(Number.isNaN(o)||o<0)&&(o=r),(Number.isNaN(l)||l<0)&&(l=s),{r:o,strokeWidth:l}}return{r,strokeWidth:s}}var Uee=["id"],Hee=["type","layout","connectNulls","needClip","shape"],Yee=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function rp(){return rp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},rp.apply(null,arguments)}function UC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Gi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?UC(Object(r),!0).forEach(function(s){Kee(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Kee(e,t,r){return(t=Vee(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vee(e){var t=qee(e,"string");return typeof t=="symbol"?t:t+""}function qee(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Pw(e,t){if(e==null)return{};var r,s,i=Gee(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Gee(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var Xee=e=>{var{dataKey:t,name:r,stroke:s,legendType:i,hide:a}=e;return[{inactive:a,dataKey:t,type:i,color:s,value:Sd(r,t),payload:e}]},Qee=p.memo(e=>{var{dataKey:t,data:r,stroke:s,strokeWidth:i,fill:a,name:o,hide:l,unit:c,tooltipType:u}=e,d={dataDefinedOnItem:r,positions:void 0,settings:{stroke:s,strokeWidth:i,fill:a,dataKey:t,nameKey:void 0,name:Sd(o,t),hide:l,type:u,color:s,unit:c}};return p.createElement(Sw,{tooltipEntrySettings:d})}),g8=(e,t)=>"".concat(t,"px ").concat(e-t,"px");function Jee(e,t){for(var r=e.length%2!==0?[...e,0]:e,s=[],i=0;i<t;++i)s=[...s,...r];return s}var Zee=(e,t,r)=>{var s=r.reduce((f,h)=>f+h);if(!s)return g8(t,e);for(var i=Math.floor(e/s),a=e%s,o=t-e,l=[],c=0,u=0;c<r.length;u+=r[c],++c)if(u+r[c]>a){l=[...r.slice(0,c),a-u];break}var d=l.length%2===0?[0,o]:[o];return[...Jee(r,i),...l,...d].map(f=>"".concat(f,"px")).join(", ")};function ete(e){var{clipPathId:t,points:r,props:s}=e,{dot:i,dataKey:a,needClip:o}=s,{id:l}=s,c=Pw(s,Uee),u=qs(c);return p.createElement(DQ,{points:r,dot:i,className:"recharts-line-dots",dotClassName:"recharts-line-dot",dataKey:a,baseProps:u,needClip:o,clipPathId:t})}function tte(e){var{showLabels:t,children:r,points:s}=e,i=p.useMemo(()=>s==null?void 0:s.map(a=>{var o,l,c={x:(o=a.x)!==null&&o!==void 0?o:0,y:(l=a.y)!==null&&l!==void 0?l:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Gi(Gi({},c),{},{value:a.value,payload:a.payload,viewBox:c,parentViewBox:void 0,fill:void 0})}),[s]);return p.createElement(M5,{value:t?i:void 0},r)}function HC(e){var{clipPathId:t,pathRef:r,points:s,strokeDasharray:i,props:a}=e,{type:o,layout:l,connectNulls:c,needClip:u,shape:d}=a,f=Pw(a,Hee),h=Gi(Gi({},hs(f)),{},{fill:"none",className:"recharts-line-curve",clipPath:u?"url(#clipPath-".concat(t,")"):void 0,points:s,type:o,layout:l,connectNulls:c,strokeDasharray:i??a.strokeDasharray});return p.createElement(p.Fragment,null,(s==null?void 0:s.length)>1&&p.createElement(vw,rp({shapeType:"curve",option:d},h,{pathRef:r})),p.createElement(ete,{points:s,clipPathId:t,props:a}))}function rte(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch{return 0}}function nte(e){var{clipPathId:t,props:r,pathRef:s,previousPointsRef:i,longestAnimatedLengthRef:a}=e,{points:o,strokeDasharray:l,isAnimationActive:c,animationBegin:u,animationDuration:d,animationEasing:f,animateNewValues:h,width:m,height:g,onAnimationEnd:x,onAnimationStart:y}=r,v=i.current,S=Ip(o,"recharts-line-"),k=p.useRef(S),[j,_]=p.useState(!1),b=!j,A=p.useCallback(()=>{typeof x=="function"&&x(),_(!1)},[x]),z=p.useCallback(()=>{typeof y=="function"&&y(),_(!0)},[y]),D=rte(s.current),w=p.useRef(0);k.current!==S&&(w.current=a.current,k.current=S);var N=w.current;return p.createElement(tte,{points:o,showLabels:b},r.children,p.createElement(Pp,{animationId:S,begin:u,duration:d,isActive:c,easing:f,onAnimationEnd:A,onAnimationStart:z,key:S},$=>{var E=Br(N,D+N,$),q=Math.min(E,D),L;if(c)if(l){var O="".concat(l).split(/[,\s]+/gim).map(T=>parseFloat(T));L=Zee(q,D,O)}else L=g8(D,q);else L=l==null?void 0:String(l);if($>0&&D>0&&(i.current=o,a.current=Math.max(a.current,q)),v){var B=v.length/o.length,I=$===1?o:o.map((T,W)=>{var re=Math.floor(W*B);if(v[re]){var ae=v[re];return Gi(Gi({},T),{},{x:Br(ae.x,T.x,$),y:Br(ae.y,T.y,$)})}return h?Gi(Gi({},T),{},{x:Br(m*2,T.x,$),y:Br(g/2,T.y,$)}):Gi(Gi({},T),{},{x:T.x,y:T.y})});return i.current=I,p.createElement(HC,{props:r,points:I,clipPathId:t,pathRef:s,strokeDasharray:L})}return p.createElement(HC,{props:r,points:o,clipPathId:t,pathRef:s,strokeDasharray:L})}),p.createElement(fw,{label:r.label}))}function ste(e){var{clipPathId:t,props:r}=e,s=p.useRef(null),i=p.useRef(0),a=p.useRef(null);return p.createElement(nte,{props:r,clipPathId:t,previousPointsRef:s,longestAnimatedLengthRef:i,pathRef:a})}var ite=(e,t)=>{var r,s;return{x:(r=e.x)!==null&&r!==void 0?r:void 0,y:(s=e.y)!==null&&s!==void 0?s:void 0,value:e.value,errorVal:Ar(e.payload,t)}};class ate extends p.Component{render(){var{hide:t,dot:r,points:s,className:i,xAxisId:a,yAxisId:o,top:l,left:c,width:u,height:d,id:f,needClip:h,zIndex:m}=this.props;if(t)return null;var g=vr("recharts-line",i),x=f,{r:y,strokeWidth:v}=Wee(r),S=q5(r),k=y*2+v,j=h?"url(#clipPath-".concat(S?"":"dots-").concat(x,")"):void 0;return p.createElement(Os,{zIndex:m},p.createElement(Ln,{className:g},h&&p.createElement("defs",null,p.createElement(n8,{clipPathId:x,xAxisId:a,yAxisId:o}),!S&&p.createElement("clipPath",{id:"clipPath-dots-".concat(x)},p.createElement("rect",{x:c-k/2,y:l-k/2,width:u+k,height:d+k}))),p.createElement(r8,{xAxisId:a,yAxisId:o,data:s,dataPointFormatter:ite,errorBarOffset:0},p.createElement(ste,{props:this.props,clipPathId:x}))),p.createElement(sJ,{activeDot:this.props.activeDot,points:s,mainColor:this.props.stroke,itemDataKey:this.props.dataKey,clipPath:j}))}}var m8={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:"auto",label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0,zIndex:un.line,type:"linear"};function ote(e){var t=hn(e,m8),{activeDot:r,animateNewValues:s,animationBegin:i,animationDuration:a,animationEasing:o,connectNulls:l,dot:c,hide:u,isAnimationActive:d,label:f,legendType:h,xAxisId:m,yAxisId:g,id:x}=t,y=Pw(t,Yee),{needClip:v}=Cw(m,g),S=Nw(),k=_p(),j=ss(),_=It(w=>Fee(w,m,g,j,x));if(k!=="horizontal"&&k!=="vertical"||_==null||S==null)return null;var{height:b,width:A,x:z,y:D}=S;return p.createElement(ate,rp({},y,{id:x,connectNulls:l,dot:c,activeDot:r,animateNewValues:s,animationBegin:i,animationDuration:a,animationEasing:o,isAnimationActive:d,hide:u,label:f,legendType:h,xAxisId:m,yAxisId:g,points:_,layout:k,height:b,width:A,left:z,top:D,needClip:v}))}function lte(e){var{layout:t,xAxis:r,yAxis:s,xAxisTicks:i,yAxisTicks:a,dataKey:o,bandSize:l,displayedData:c}=e;return c.map((u,d)=>{var f=Ar(u,o);if(t==="horizontal"){var h=xk({axis:r,ticks:i,bandSize:l,entry:u,index:d}),m=Ur(f)?null:s.scale(f);return{x:h,y:m,value:f,payload:u}}var g=Ur(f)?null:r.scale(f),x=xk({axis:s,ticks:a,bandSize:l,entry:u,index:d});return g==null||x==null?null:{x:g,y:x,value:f,payload:u}}).filter(Boolean)}function cte(e){var t=hn(e,m8),r=ss();return p.createElement(kw,{id:t.id,type:"line"},s=>p.createElement(p.Fragment,null,p.createElement(X5,{legendPayload:Xee(t)}),p.createElement(Qee,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType}),p.createElement(Z5,{type:"line",id:s,data:t.data,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,hide:t.hide,isPanorama:r}),p.createElement(ote,rp({},t,{id:s}))))}var x8=p.memo(cte,ux);x8.displayName="Line";var dte=["domain","range"],ute=["domain","range"];function YC(e,t){if(e==null)return{};var r,s,i=pte(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function pte(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function KC(e,t){return e===t?!0:Array.isArray(e)&&e.length===2&&Array.isArray(t)&&t.length===2?e[0]===t[0]&&e[1]===t[1]:!1}function y8(e,t){if(e===t)return!0;var{domain:r,range:s}=e,i=YC(e,dte),{domain:a,range:o}=t,l=YC(t,ute);return!KC(r,a)||!KC(s,o)?!1:ux(i,l)}var fte=["dangerouslySetInnerHTML","ticks"],hte=["id"];function V0(){return V0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},V0.apply(null,arguments)}function VC(e,t){if(e==null)return{};var r,s,i=gte(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function gte(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function mte(e){var t=Rr(),r=p.useRef(null);return p.useLayoutEffect(()=>{r.current===null?t(UQ(e)):r.current!==e&&t(HQ({prev:r.current,next:e})),r.current=e},[e,t]),p.useLayoutEffect(()=>()=>{r.current&&(t(YQ(r.current)),r.current=null)},[t]),null}var xte=e=>{var{xAxisId:t,className:r}=e,s=It(qb),i=ss(),a="xAxis",o=It(y=>Pd(y,a,t,i)),l=It(y=>GT(y,a,t,i)),c=It(y=>YT(y,t)),u=It(y=>XK(y,t)),d=It(y=>CT(y,t));if(c==null||u==null||d==null)return null;var{dangerouslySetInnerHTML:f,ticks:h}=e,m=VC(e,fte),{id:g}=d,x=VC(d,hte);return p.createElement(Ew,V0({},m,x,{scale:o,x:u.x,y:u.y,width:c.width,height:c.height,className:vr("recharts-".concat(a," ").concat(a),r),viewBox:s,ticks:l,axisType:a}))},yte={allowDataOverflow:En.allowDataOverflow,allowDecimals:En.allowDecimals,allowDuplicatedCategory:En.allowDuplicatedCategory,angle:En.angle,axisLine:Ta.axisLine,height:En.height,hide:!1,includeHidden:En.includeHidden,interval:En.interval,minTickGap:En.minTickGap,mirror:En.mirror,orientation:En.orientation,padding:En.padding,reversed:En.reversed,scale:En.scale,tick:En.tick,tickCount:En.tickCount,tickLine:Ta.tickLine,tickSize:Ta.tickSize,type:En.type,xAxisId:0},vte=e=>{var t=hn(e,yte);return p.createElement(p.Fragment,null,p.createElement(mte,{allowDataOverflow:t.allowDataOverflow,allowDecimals:t.allowDecimals,allowDuplicatedCategory:t.allowDuplicatedCategory,angle:t.angle,dataKey:t.dataKey,domain:t.domain,height:t.height,hide:t.hide,id:t.xAxisId,includeHidden:t.includeHidden,interval:t.interval,minTickGap:t.minTickGap,mirror:t.mirror,name:t.name,orientation:t.orientation,padding:t.padding,reversed:t.reversed,scale:t.scale,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit}),p.createElement(xte,t))},Gp=p.memo(vte,y8);Gp.displayName="XAxis";var bte=["dangerouslySetInnerHTML","ticks"],jte=["id"];function q0(){return q0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},q0.apply(null,arguments)}function qC(e,t){if(e==null)return{};var r,s,i=wte(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function wte(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function Ste(e){var t=Rr(),r=p.useRef(null);return p.useLayoutEffect(()=>{r.current===null?t(KQ(e)):r.current!==e&&t(VQ({prev:r.current,next:e})),r.current=e},[e,t]),p.useLayoutEffect(()=>()=>{r.current&&(t(qQ(r.current)),r.current=null)},[t]),null}var kte=e=>{var{yAxisId:t,className:r,width:s,label:i}=e,a=p.useRef(null),o=p.useRef(null),l=It(qb),c=ss(),u=Rr(),d="yAxis",f=It(_=>Pd(_,d,t,c)),h=It(_=>KT(_,t)),m=It(_=>JK(_,t)),g=It(_=>GT(_,d,t,c)),x=It(_=>_T(_,t));if(p.useLayoutEffect(()=>{if(!(s!=="auto"||!h||pw(i)||p.isValidElement(i)||x==null)){var _=a.current;if(_){var b=_.getCalculatedWidth();Math.round(h.width)!==Math.round(b)&&u(GQ({id:t,width:b}))}}},[g,h,u,i,t,s,x]),h==null||m==null||x==null)return null;var{dangerouslySetInnerHTML:y,ticks:v}=e,S=qC(e,bte),{id:k}=x,j=qC(x,jte);return p.createElement(Ew,q0({},S,j,{ref:a,labelRef:o,scale:f,x:m.x,y:m.y,tickTextProps:s==="auto"?{width:void 0}:{width:s},width:h.width,height:h.height,className:vr("recharts-".concat(d," ").concat(d),r),viewBox:l,ticks:g,axisType:d}))},Nte={allowDataOverflow:Pn.allowDataOverflow,allowDecimals:Pn.allowDecimals,allowDuplicatedCategory:Pn.allowDuplicatedCategory,angle:Pn.angle,axisLine:Ta.axisLine,hide:!1,includeHidden:Pn.includeHidden,interval:Pn.interval,minTickGap:Pn.minTickGap,mirror:Pn.mirror,orientation:Pn.orientation,padding:Pn.padding,reversed:Pn.reversed,scale:Pn.scale,tick:Pn.tick,tickCount:Pn.tickCount,tickLine:Ta.tickLine,tickSize:Ta.tickSize,type:Pn.type,width:Pn.width,yAxisId:0},Cte=e=>{var t=hn(e,Nte);return p.createElement(p.Fragment,null,p.createElement(Ste,{interval:t.interval,id:t.yAxisId,scale:t.scale,type:t.type,domain:t.domain,allowDataOverflow:t.allowDataOverflow,dataKey:t.dataKey,allowDuplicatedCategory:t.allowDuplicatedCategory,allowDecimals:t.allowDecimals,tickCount:t.tickCount,padding:t.padding,includeHidden:t.includeHidden,reversed:t.reversed,ticks:t.ticks,width:t.width,orientation:t.orientation,mirror:t.mirror,hide:t.hide,unit:t.unit,name:t.name,angle:t.angle,minTickGap:t.minTickGap,tick:t.tick,tickFormatter:t.tickFormatter}),p.createElement(kte,t))},Xp=p.memo(Cte,y8);Xp.displayName="YAxis";var _te=(e,t)=>t,Iw=ze([_te,gr,kT,Cn,u5,Za,hq,kn],jq),Tw=e=>{var t=e.currentTarget.getBoundingClientRect(),r=t.width/e.currentTarget.offsetWidth,s=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/r),chartY:Math.round((e.clientY-t.top)/s)}},v8=pi("mouseClick"),b8=Np();b8.startListening({actionCreator:v8,effect:(e,t)=>{var r=e.payload,s=Iw(t.getState(),Tw(r));(s==null?void 0:s.activeIndex)!=null&&t.dispatch(pV({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate}))}});var G0=pi("mouseMove"),j8=Np(),zf=null;j8.startListening({actionCreator:G0,effect:(e,t)=>{var r=e.payload;zf!==null&&cancelAnimationFrame(zf);var s=Tw(r);zf=requestAnimationFrame(()=>{var i=t.getState(),a=ew(i,i.tooltip.settings.shared);if(a==="axis"){var o=Iw(i,s);(o==null?void 0:o.activeIndex)!=null?t.dispatch(n5({activeIndex:o.activeIndex,activeDataKey:void 0,activeCoordinate:o.activeCoordinate})):t.dispatch(r5())}zf=null})}});var GC={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},w8=Rs({name:"rootProps",initialState:GC,reducers:{updateOptions:(e,t)=>{var r;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=(r=t.payload.barGap)!==null&&r!==void 0?r:GC.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className,e.baseValue=t.payload.baseValue,e.reverseStackOrder=t.payload.reverseStackOrder}}}),Ate=w8.reducer,{updateOptions:Ete}=w8.actions,S8=Rs({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:Pte}=S8.actions,Ite=S8.reducer,k8=pi("keyDown"),N8=pi("focus"),Rw=Np();Rw.startListening({actionCreator:k8,effect:(e,t)=>{var r=t.getState(),s=r.rootProps.accessibilityLayer!==!1;if(s){var{keyboardInteraction:i}=r.tooltip,a=e.payload;if(!(a!=="ArrowRight"&&a!=="ArrowLeft"&&a!=="Enter")){var o=tw(i,Td(r),Bp(r),Hp(r)),l=o==null?-1:Number(o);if(!(!Number.isFinite(l)||l<0)){var c=Za(r);if(a==="Enter"){var u=Ng(r,"axis","hover",String(i.index));t.dispatch(B0({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:u}));return}var d=rV(r),f=d==="left-to-right"?1:-1,h=a==="ArrowRight"?1:-1,m=l+h*f;if(!(c==null||m>=c.length||m<0)){var g=Ng(r,"axis","hover",String(m));t.dispatch(B0({active:!0,activeIndex:m.toString(),activeDataKey:void 0,activeCoordinate:g}))}}}}}});Rw.startListening({actionCreator:N8,effect:(e,t)=>{var r=t.getState(),s=r.rootProps.accessibilityLayer!==!1;if(s){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&i.index==null){var a="0",o=Ng(r,"axis","hover",String(a));t.dispatch(B0({activeDataKey:void 0,active:!0,activeIndex:a,activeCoordinate:o}))}}}});var ei=pi("externalEvent"),C8=Np(),wy=new Map;C8.startListening({actionCreator:ei,effect:(e,t)=>{var{handler:r,reactEvent:s}=e.payload;if(r!=null){s.persist();var i=s.type,a=wy.get(i);a!==void 0&&cancelAnimationFrame(a);var o=requestAnimationFrame(()=>{try{var l=t.getState(),c={activeCoordinate:JV(l),activeDataKey:aw(l),activeIndex:Yo(l),activeLabel:h5(l),activeTooltipIndex:Yo(l),isTooltipActive:ZV(l)};r(c,s)}finally{wy.delete(i)}});wy.set(i,o)}}});var Tte=ze([Id],e=>e.tooltipItemPayloads),Rte=ze([Tte,Wp,(e,t,r)=>t,(e,t,r)=>r],(e,t,r,s)=>{var i=e.find(l=>l.settings.dataKey===s);if(i!=null){var{positions:a}=i;if(a!=null){var o=t(a,r);return o}}}),_8=pi("touchMove"),A8=Np();A8.startListening({actionCreator:_8,effect:(e,t)=>{var r=e.payload;if(!(r.touches==null||r.touches.length===0)){var s=t.getState(),i=ew(s,s.tooltip.settings.shared);if(i==="axis"){var a=Iw(s,Tw({clientX:r.touches[0].clientX,clientY:r.touches[0].clientY,currentTarget:r.currentTarget}));(a==null?void 0:a.activeIndex)!=null&&t.dispatch(n5({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}else if(i==="item"){var o,l=r.touches[0];if(document.elementFromPoint==null)return;var c=document.elementFromPoint(l.clientX,l.clientY);if(!c||!c.getAttribute)return;var u=c.getAttribute(FI),d=(o=c.getAttribute(WI))!==null&&o!==void 0?o:void 0,f=Rte(t.getState(),u,d);t.dispatch(t5({activeDataKey:d,activeIndex:u,activeCoordinate:f}))}}}});var Ote=cI({brush:WZ,cartesianAxis:XQ,chartData:Qq,errorBars:mJ,graphicalItems:rQ,layout:R7,legend:$F,options:Kq,polarAxis:vX,polarOptions:Ite,referenceElements:GZ,rootProps:Ate,tooltip:fV,zIndex:zq}),zte=function(t){return s7({reducer:Ote,preloadedState:t,middleware:r=>{var s;return r({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes((s="es6")!==null&&s!==void 0?s:"")}).concat([b8.middleware,j8.middleware,Rw.middleware,C8.middleware,A8.middleware])},enhancers:r=>{var s=r;return typeof r=="function"&&(s=r()),s.concat(kI({type:"raf"}))},devTools:Ep.devToolsEnabled})};function E8(e){var{preloadedState:t,children:r,reduxStoreName:s}=e,i=ss(),a=p.useRef(null);if(i)return r;a.current==null&&(a.current=zte(t));var o=$b;return p.createElement(HJ,{context:o,store:a.current},r)}function Lte(e){var{layout:t,margin:r}=e,s=Rr(),i=ss();return p.useEffect(()=>{i||(s(P7(t)),s(E7(r)))},[s,i,t,r]),null}var P8=p.memo(Lte,ux);function I8(e){var t=Rr();return p.useEffect(()=>{t(Ete(e))},[t,e]),null}function XC(e){var{zIndex:t,isPanorama:r}=e,s=r?"recharts-zindex-panorama-":"recharts-zindex-",i=Q5("".concat(s).concat(t)),a=Rr();return p.useLayoutEffect(()=>(a(Rq({zIndex:t,elementId:i,isPanorama:r})),()=>{a(Oq({zIndex:t,isPanorama:r}))}),[a,t,i,r]),p.createElement("g",{tabIndex:-1,id:i})}function QC(e){var{children:t,isPanorama:r}=e,s=It(Sq);if(!s||s.length===0)return t;var i=s.filter(o=>o<0),a=s.filter(o=>o>0);return p.createElement(p.Fragment,null,i.map(o=>p.createElement(XC,{key:o,zIndex:o,isPanorama:r})),t,a.map(o=>p.createElement(XC,{key:o,zIndex:o,isPanorama:r})))}var $te=["children"];function Dte(e,t){if(e==null)return{};var r,s,i=Mte(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Mte(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function Og(){return Og=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Og.apply(null,arguments)}var Bte={width:"100%",height:"100%",display:"block"},Fte=p.forwardRef((e,t)=>{var r=Xb(),s=Qb(),i=l6();if(!sa(r)||!sa(s))return null;var{children:a,otherAttributes:o,title:l,desc:c}=e,u,d;return o!=null&&(typeof o.tabIndex=="number"?u=o.tabIndex:u=i?0:void 0,typeof o.role=="string"?d=o.role:d=i?"application":void 0),p.createElement(jb,Og({},o,{title:l,desc:c,role:d,tabIndex:u,width:r,height:s,style:Bte,ref:t}),a)}),Wte=e=>{var{children:t}=e,r=It(_m);if(!r)return null;var{width:s,height:i,y:a,x:o}=r;return p.createElement(jb,{width:s,height:i,x:o,y:a},t)},JC=p.forwardRef((e,t)=>{var{children:r}=e,s=Dte(e,$te),i=ss();return i?p.createElement(Wte,null,p.createElement(QC,{isPanorama:!0},r)):p.createElement(Fte,Og({ref:t},s),p.createElement(QC,{isPanorama:!1},r))});function Ute(){var e=Rr(),[t,r]=p.useState(null),s=It(Q7);return p.useEffect(()=>{if(t!=null){var i=t.getBoundingClientRect(),a=i.width/t.offsetWidth;nn(a)&&a!==s&&e(T7(a))}},[t,e,s]),r}function ZC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Hte(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZC(Object(r),!0).forEach(function(s){Yte(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZC(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Yte(e,t,r){return(t=Kte(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kte(e){var t=Vte(e,"string");return typeof t=="symbol"?t:t+""}function Vte(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ec(){return ec=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ec.apply(null,arguments)}var qte=()=>(aG(),null);function zg(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var Gte=p.forwardRef((e,t)=>{var r,s,i=p.useRef(null),[a,o]=p.useState({containerWidth:zg((r=e.style)===null||r===void 0?void 0:r.width),containerHeight:zg((s=e.style)===null||s===void 0?void 0:s.height)}),l=p.useCallback((u,d)=>{o(f=>{var h=Math.round(u),m=Math.round(d);return f.containerWidth===h&&f.containerHeight===m?f:{containerWidth:h,containerHeight:m}})},[]),c=p.useCallback(u=>{if(typeof t=="function"&&t(u),u!=null&&typeof ResizeObserver<"u"){var{width:d,height:f}=u.getBoundingClientRect();l(d,f);var h=g=>{var{width:x,height:y}=g[0].contentRect;l(x,y)},m=new ResizeObserver(h);m.observe(u),i.current=m}},[t,l]);return p.useEffect(()=>()=>{var u=i.current;u!=null&&u.disconnect()},[l]),p.createElement(p.Fragment,null,p.createElement(Em,{width:a.containerWidth,height:a.containerHeight}),p.createElement("div",ec({ref:c},e)))}),Xte=p.forwardRef((e,t)=>{var{width:r,height:s}=e,[i,a]=p.useState({containerWidth:zg(r),containerHeight:zg(s)}),o=p.useCallback((c,u)=>{a(d=>{var f=Math.round(c),h=Math.round(u);return d.containerWidth===f&&d.containerHeight===h?d:{containerWidth:f,containerHeight:h}})},[]),l=p.useCallback(c=>{if(typeof t=="function"&&t(c),c!=null){var{width:u,height:d}=c.getBoundingClientRect();o(u,d)}},[t,o]);return p.createElement(p.Fragment,null,p.createElement(Em,{width:i.containerWidth,height:i.containerHeight}),p.createElement("div",ec({ref:l},e)))}),Qte=p.forwardRef((e,t)=>{var{width:r,height:s}=e;return p.createElement(p.Fragment,null,p.createElement(Em,{width:r,height:s}),p.createElement("div",ec({ref:t},e)))}),Jte=p.forwardRef((e,t)=>{var{width:r,height:s}=e;return Da(r)||Da(s)?p.createElement(Xte,ec({},e,{ref:t})):p.createElement(Qte,ec({},e,{ref:t}))});function Zte(e){return e===!0?Gte:Jte}var ere=p.forwardRef((e,t)=>{var{children:r,className:s,height:i,onClick:a,onContextMenu:o,onDoubleClick:l,onMouseDown:c,onMouseEnter:u,onMouseLeave:d,onMouseMove:f,onMouseUp:h,onTouchEnd:m,onTouchMove:g,onTouchStart:x,style:y,width:v,responsive:S,dispatchTouchEvents:k=!0}=e,j=p.useRef(null),_=Rr(),[b,A]=p.useState(null),[z,D]=p.useState(null),w=Ute(),N=Gb(),$=(N==null?void 0:N.width)>0?N.width:v,E=(N==null?void 0:N.height)>0?N.height:i,q=p.useCallback(se=>{w(se),typeof t=="function"&&t(se),A(se),D(se),se!=null&&(j.current=se)},[w,t,A,D]),L=p.useCallback(se=>{_(v8(se)),_(ei({handler:a,reactEvent:se}))},[_,a]),O=p.useCallback(se=>{_(G0(se)),_(ei({handler:u,reactEvent:se}))},[_,u]),B=p.useCallback(se=>{_(r5()),_(ei({handler:d,reactEvent:se}))},[_,d]),I=p.useCallback(se=>{_(G0(se)),_(ei({handler:f,reactEvent:se}))},[_,f]),T=p.useCallback(()=>{_(N8())},[_]),W=p.useCallback(se=>{_(k8(se.key))},[_]),re=p.useCallback(se=>{_(ei({handler:o,reactEvent:se}))},[_,o]),ae=p.useCallback(se=>{_(ei({handler:l,reactEvent:se}))},[_,l]),Y=p.useCallback(se=>{_(ei({handler:c,reactEvent:se}))},[_,c]),J=p.useCallback(se=>{_(ei({handler:h,reactEvent:se}))},[_,h]),P=p.useCallback(se=>{_(ei({handler:x,reactEvent:se}))},[_,x]),ce=p.useCallback(se=>{k&&_(_8(se)),_(ei({handler:g,reactEvent:se}))},[_,k,g]),pe=p.useCallback(se=>{_(ei({handler:m,reactEvent:se}))},[_,m]),ye=Zte(S);return p.createElement(j5.Provider,{value:b},p.createElement(cP.Provider,{value:z},p.createElement(ye,{width:$??(y==null?void 0:y.width),height:E??(y==null?void 0:y.height),className:vr("recharts-wrapper",s),style:Hte({position:"relative",cursor:"default",width:$,height:E},y),onClick:L,onContextMenu:re,onDoubleClick:ae,onFocus:T,onKeyDown:W,onMouseDown:Y,onMouseEnter:O,onMouseLeave:B,onMouseMove:I,onMouseUp:J,onTouchEnd:pe,onTouchMove:ce,onTouchStart:P,ref:q},p.createElement(qte,null),r)))}),tre=["width","height","responsive","children","className","style","compact","title","desc"];function rre(e,t){if(e==null)return{};var r,s,i=nre(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function nre(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var T8=p.forwardRef((e,t)=>{var{width:r,height:s,responsive:i,children:a,className:o,style:l,compact:c,title:u,desc:d}=e,f=rre(e,tre),h=qs(f);return c?p.createElement(p.Fragment,null,p.createElement(Em,{width:r,height:s}),p.createElement(JC,{otherAttributes:h,title:u,desc:d},a)):p.createElement(ere,{className:o,style:l,width:r,height:s,responsive:i??!1,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},p.createElement(JC,{otherAttributes:h,title:u,desc:d,ref:t},p.createElement(QZ,null,a)))});function X0(){return X0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},X0.apply(null,arguments)}var sre={top:5,right:5,bottom:5,left:5},ire={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,layout:"horizontal",margin:sre,responsive:!1,reverseStackOrder:!1,stackOffset:"none",syncMethod:"index"},R8=p.forwardRef(function(t,r){var s,i=hn(t.categoricalChartProps,ire),{chartName:a,defaultTooltipEventType:o,validateTooltipEventTypes:l,tooltipPayloadSearcher:c,categoricalChartProps:u}=t,d={chartName:a,defaultTooltipEventType:o,validateTooltipEventTypes:l,tooltipPayloadSearcher:c,eventEmitter:void 0};return p.createElement(E8,{preloadedState:{options:d},reduxStoreName:(s=u.id)!==null&&s!==void 0?s:a},p.createElement(a8,{chartData:u.data}),p.createElement(P8,{layout:i.layout,margin:i.margin}),p.createElement(I8,{baseValue:i.baseValue,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),p.createElement(T8,X0({},i,{ref:r})))}),are=["axis"],ore=p.forwardRef((e,t)=>p.createElement(R8,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:are,tooltipPayloadSearcher:uw,categoricalChartProps:e,ref:t})),lre=["axis","item"],Ow=p.forwardRef((e,t)=>p.createElement(R8,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:lre,tooltipPayloadSearcher:uw,categoricalChartProps:e,ref:t}));function cre(e){var t=Rr();return p.useEffect(()=>{t(Pte(e))},[t,e]),null}var dre=["layout"];function Q0(){return Q0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Q0.apply(null,arguments)}function ure(e,t){if(e==null)return{};var r,s,i=pre(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function pre(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var fre={top:5,right:5,bottom:5,left:5},O8={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:fre,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},hre=p.forwardRef(function(t,r){var s,i=hn(t.categoricalChartProps,O8),{layout:a}=i,o=ure(i,dre),{chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:u,tooltipPayloadSearcher:d}=t,f={chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:u,tooltipPayloadSearcher:d,eventEmitter:void 0};return p.createElement(E8,{preloadedState:{options:f},reduxStoreName:(s=i.id)!==null&&s!==void 0?s:l},p.createElement(a8,{chartData:i.data}),p.createElement(P8,{layout:a,margin:i.margin}),p.createElement(I8,{baseValue:void 0,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),p.createElement(cre,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),p.createElement(T8,Q0({},o,{ref:r})))});function e_(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function t_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e_(Object(r),!0).forEach(function(s){gre(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e_(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function gre(e,t,r){return(t=mre(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mre(e){var t=xre(e,"string");return typeof t=="symbol"?t:t+""}function xre(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yre=["item"],vre=t_(t_({},O8),{},{layout:"centric",startAngle:0,endAngle:360}),zw=p.forwardRef((e,t)=>{var r=hn(e,vre);return p.createElement(hre,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:yre,tooltipPayloadSearcher:uw,categoricalChartProps:r,ref:t})});const Hi=[{start:"#6366f1",end:"#8b5cf6"},{start:"#06b6d4",end:"#0891b2"},{start:"#10b981",end:"#059669"},{start:"#f59e0b",end:"#d97706"},{start:"#f43f5e",end:"#e11d48"},{start:"#8b5cf6",end:"#7c3aed"},{start:"#3b82f6",end:"#2563eb"},{start:"#ec4899",end:"#db2777"}],z8=({title:e,total:t,completed:r,perLevelBreakdown:s,perClassBreakdown:i,promuBreakdown:a=[],showPromu:o=!0})=>{const[l,c]=p.useState(0),[u,d]=p.useState("level"),f=t>0?Math.round(r/t*100):0,h=t-r;p.useEffect(()=>{const A=Date.now(),z=()=>{const D=Date.now()-A,w=Math.min(D/1200,1),N=1-Math.pow(1-w,3),$=Math.round(N*f);c($),w<1&&requestAnimationFrame(z)};requestAnimationFrame(z)},[f]);const m=[{name:"Complt",value:r},{name:"Restant",value:h||.001}],y=(()=>{switch(u){case"level":return s;case"class":return i;case"promu":return a;default:return s}})().map((b,A)=>({name:b.label,Complt:b.completed,Restant:b.total-b.completed,Total:b.total,percentage:b.total>0?Math.round(b.completed/b.total*100):0,colorIndex:A%Hi.length})),v=b=>b>=100?{bg:"#ecfdf5",border:"#10b981",text:"#059669"}:b>=75?{bg:"#f0fdf4",border:"#22c55e",text:"#16a34a"}:b>=50?{bg:"#fefce8",border:"#eab308",text:"#ca8a04"}:b>=25?{bg:"#fff7ed",border:"#f97316",text:"#ea580c"}:{bg:"#fef2f2",border:"#ef4444",text:"#dc2626"},S=v(f),k=[{id:"level",label:"Par Niveau",icon:"",count:s.length},{id:"class",label:"Par Classe",icon:"",count:i.length},...o?[{id:"promu",label:"Promus",icon:"",count:a.length}]:[]],j=()=>n.jsxs("defs",{children:[n.jsx("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:f>=100?n.jsxs(n.Fragment,{children:[n.jsx("stop",{offset:"0%",stopColor:"#10b981"}),n.jsx("stop",{offset:"100%",stopColor:"#059669"})]}):n.jsxs(n.Fragment,{children:[n.jsx("stop",{offset:"0%",stopColor:"#6366f1"}),n.jsx("stop",{offset:"100%",stopColor:"#8b5cf6"})]})}),n.jsxs("linearGradient",{id:"remainingGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",stopColor:"#f1f5f9"}),n.jsx("stop",{offset:"100%",stopColor:"#e2e8f0"})]}),Hi.map((b,A)=>n.jsxs("linearGradient",{id:`barGradient${A}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",stopColor:b.start}),n.jsx("stop",{offset:"100%",stopColor:b.end})]},A))]}),_=()=>{const b=y.length;return b<=3?180:b<=6?240:b<=10?Math.max(280,b*40):Math.min(500,b*36)};return n.jsxs("div",{className:"progression-chart-container",children:[n.jsxs("div",{className:"progression-chart-header",children:[n.jsxs("div",{className:"progression-chart-title-section",children:[n.jsx("h3",{className:"progression-chart-title",children:e}),n.jsx("span",{className:"progression-chart-badge",style:{background:S.bg,borderColor:S.border,color:S.text},children:f>=100?" Termin":f>=75?" En bonne voie":f>=50?" En cours":"  complter"})]}),n.jsxs("div",{className:"progression-chart-summary",children:[n.jsxs("span",{className:"progression-chart-stat",children:[n.jsx("span",{className:"stat-number",children:r}),n.jsx("span",{className:"stat-label",children:"termins"})]}),n.jsx("span",{className:"progression-chart-divider",children:"/"}),n.jsxs("span",{className:"progression-chart-stat",children:[n.jsx("span",{className:"stat-number",children:t}),n.jsx("span",{className:"stat-label",children:"total"})]})]})]}),n.jsxs("div",{className:"progression-chart-content unified-mode",children:[n.jsxs("div",{className:"progression-chart-radial",children:[n.jsxs("div",{className:"radial-container compact",children:[n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(zw,{children:[j(),n.jsxs(dx,{data:m,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,fill:"#8884d8",paddingAngle:3,dataKey:"value",startAngle:90,endAngle:-270,animationBegin:0,animationDuration:1200,children:[n.jsx(zi,{fill:"url(#progressGradient)"}),n.jsx(zi,{fill:"url(#remainingGradient)"})]})]})}),n.jsxs("div",{className:"radial-center",children:[n.jsxs("div",{className:"radial-percentage compact",children:[l,"%"]}),n.jsx("div",{className:"radial-label",children:"Progression"})]})]}),n.jsxs("div",{className:"radial-legend compact",children:[n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-dot completed"}),n.jsx("span",{className:"legend-text",children:r})]}),n.jsxs("div",{className:"legend-item",children:[n.jsx("span",{className:"legend-dot remaining"}),n.jsx("span",{className:"legend-text",children:h})]})]})]}),n.jsxs("div",{className:"progression-chart-breakdown",children:[n.jsx("div",{className:"breakdown-tabs",children:k.map(b=>n.jsxs("button",{className:`breakdown-tab ${u===b.id?"active":""}`,onClick:()=>d(b.id),children:[n.jsx("span",{className:"tab-icon",children:b.icon}),n.jsx("span",{className:"tab-label",children:b.label}),n.jsx("span",{className:"tab-count",children:b.count})]},b.id))}),n.jsx("div",{className:"breakdown-content",children:y.length===0?n.jsxs("div",{className:"breakdown-empty",children:[n.jsx("span",{className:"empty-icon",children:""}),n.jsx("span",{className:"empty-text",children:"Aucune donne disponible"})]}):y.length<=4?n.jsx("div",{className:"breakdown-cards compact",children:y.map((b,A)=>{const z=v(b.percentage);return n.jsxs("div",{className:"breakdown-card compact",style:{"--card-gradient-start":Hi[A%Hi.length].start,"--card-gradient-end":Hi[A%Hi.length].end},children:[n.jsxs("div",{className:"breakdown-card-header",children:[n.jsx("span",{className:"breakdown-card-name",children:b.name}),n.jsxs("span",{className:"breakdown-card-percentage",style:{color:z.text},children:[b.percentage,"%"]})]}),n.jsx("div",{className:"breakdown-card-progress",children:n.jsx("div",{className:"breakdown-card-progress-fill",style:{width:`${b.percentage}%`,background:`linear-gradient(90deg, ${Hi[A%Hi.length].start}, ${Hi[A%Hi.length].end})`}})}),n.jsxs("div",{className:"breakdown-card-stats",children:[n.jsxs("span",{className:"card-stat",children:[" ",b.Complt]}),n.jsxs("span",{className:"card-stat remaining",children:[" ",b.Restant]})]})]},b.name)})}):n.jsx("div",{className:"breakdown-chart",children:n.jsx(Gl,{width:"100%",height:_(),children:n.jsxs(Ow,{data:y,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[j(),n.jsx(qp,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),n.jsx(Gp,{type:"number",tick:{fill:"#64748b",fontSize:11},axisLine:{stroke:"#e2e8f0"}}),n.jsx(Xp,{dataKey:"name",type:"category",width:100,tick:{fill:"#334155",fontSize:12,fontWeight:500},axisLine:{stroke:"#e2e8f0"},tickFormatter:b=>b.length>14?b.substring(0,14)+"":b}),n.jsx(ud,{cursor:{fill:"rgba(99, 102, 241, 0.05)"},content:({active:b,payload:A,label:z})=>{if(b&&A&&A.length){const D=A[0].payload,w=v(D.percentage);return n.jsxs("div",{className:"custom-tooltip",children:[n.jsx("div",{className:"tooltip-header",children:z}),n.jsxs("div",{className:"tooltip-percentage",style:{color:w.text},children:[D.percentage,"% complt"]}),n.jsxs("div",{className:"tooltip-stats",children:[n.jsxs("div",{className:"tooltip-stat completed",children:[n.jsx("span",{className:"tooltip-dot"}),"Complt: ",D.Complt]}),n.jsxs("div",{className:"tooltip-stat remaining",children:[n.jsx("span",{className:"tooltip-dot"}),"Restant: ",D.Restant]})]}),n.jsxs("div",{className:"tooltip-total",children:["Total: ",D.Total," lves"]})]})}return null}}),n.jsx(tp,{dataKey:"Complt",stackId:"a",radius:[0,0,0,0],animationDuration:1e3,children:y.map((b,A)=>n.jsx(zi,{fill:`url(#barGradient${b.colorIndex})`},`cell-${A}`))}),n.jsx(tp,{dataKey:"Restant",stackId:"a",fill:"#e2e8f0",radius:[0,4,4,0],animationDuration:1e3})]})})})})]})]})]})};function r_(){const{activeYearId:e,activeYear:t,isLoading:r}=Yn(),[s,i]=p.useState([]),[a,o]=p.useState(new Map),[l,c]=p.useState(!0),[u,d]=p.useState(""),f=(t==null?void 0:t.activeSemester)||1;p.useEffect(()=>{if(r)return;let x=!0;return(async()=>{try{c(!0);const v=await K.get(`/teacher/classes?schoolYearId=${e}`);if(!x)return;i(v.data);const S=f,k=v.data.map(b=>K.get(`/teacher/classes/${b._id}/completion-stats?semester=${S}`).then(A=>{const z=A.data;return{classId:b._id,stats:z}}).catch(()=>({classId:b._id,stats:null}))),j=await Promise.all(k);if(!x)return;const _=new Map;j.forEach(({classId:b,stats:A})=>{A&&_.set(b,A)}),o(_)}catch(v){x&&(d("Impossible de charger les classes"),console.error(v))}finally{x&&c(!1)}})(),()=>{x=!1}},[e,t==null?void 0:t.activeSemester,r]);const h=Array.from(a.values()).reduce((x,y)=>(x.total+=y.totalAssignments,x.completed+=y.completedAssignments,x),{total:0,completed:0}),m=s.map(x=>{const y=a.get(x._id);return{label:x.name,total:(y==null?void 0:y.totalAssignments)||0,completed:(y==null?void 0:y.completedAssignments)||0}}).sort((x,y)=>x.label.localeCompare(y.label)),g=Object.entries(s.reduce((x,y)=>{const v=y.level||"Sans niveau";x[v]||(x[v]={total:0,completed:0});const S=a.get(y._id);return x[v].total+=(S==null?void 0:S.totalAssignments)||0,x[v].completed+=(S==null?void 0:S.completedAssignments)||0,x},{})).map(([x,y])=>({label:x,total:y.total,completed:y.completed})).sort((x,y)=>x.label.localeCompare(y.label));return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:28,flexWrap:"wrap",gap:16},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{fontSize:26,margin:0,color:"#0f172a",fontWeight:700,letterSpacing:"-0.02em"},children:"Mes Classes"}),n.jsx("p",{style:{margin:"6px 0 0 0",fontSize:14,color:"#64748b",fontWeight:400},children:s.length>0?`${s.length} classe${s.length>1?"s":""} assigne${s.length>1?"s":""}`:"Aucune classe"})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",fontSize:13,fontWeight:600,borderRadius:8,background:"#f1f5f9",color:"#475569",border:"1px solid #e2e8f0"},children:["S",f]}),(t==null?void 0:t.name)&&n.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",fontSize:13,fontWeight:600,borderRadius:8,background:"#eef2ff",color:"#4f46e5",border:"1px solid #c7d2fe"},children:t.name})]})]}),l&&n.jsxs("div",{style:{textAlign:"center",padding:40,color:"#64748b",fontSize:14},children:[n.jsx("div",{style:{width:32,height:32,border:"3px solid #e2e8f0",borderTopColor:"#6366f1",borderRadius:"50%",margin:"0 auto 12px",animation:"spin 1s linear infinite"}}),"Chargement..."]}),u&&n.jsx("div",{style:{color:"#dc2626",background:"#fef2f2",padding:"12px 16px",borderRadius:10,border:"1px solid #fecaca",fontSize:14,fontWeight:500},children:u}),!l&&s.length>0&&n.jsx(z8,{title:" Progression Globale",total:h.total,completed:h.completed,perLevelBreakdown:g,perClassBreakdown:m,showPromu:!1}),n.jsxs("div",{style:{marginTop:20},children:[Object.entries(s.reduce((x,y)=>{const v=y.level||"Sans niveau";return x[v]||(x[v]=[]),x[v].push(y),x},{})).sort(([x],[y])=>x.localeCompare(y)).map(([x,y])=>n.jsxs("div",{style:{marginBottom:24},children:[n.jsx("h3",{style:{fontSize:18,margin:"0 0 12px 0",color:"#475569",fontWeight:600,display:"flex",alignItems:"center",gap:8},children:n.jsx("span",{style:{background:"#f1f5f9",padding:"4px 10px",borderRadius:6,fontSize:14},children:x})}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:12},children:y.map(v=>{const S=a.get(v._id);return n.jsx(rr,{to:`/teacher/classes/${v._id}`,style:{textDecoration:"none"},children:n.jsxs("div",{style:{cursor:"pointer",transition:"all 0.2s ease",position:"relative",border:"1px solid #e2e8f0",background:"#fff",borderRadius:12,padding:"14px 16px",display:"flex",flexDirection:"column",gap:10},onMouseEnter:k=>{k.currentTarget.style.transform="translateY(-2px)",k.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.1)",k.currentTarget.style.borderColor="#c7d2fe"},onMouseLeave:k=>{k.currentTarget.style.transform="translateY(0)",k.currentTarget.style.boxShadow="none",k.currentTarget.style.borderColor="#e2e8f0"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsx("span",{style:{fontSize:17,fontWeight:600,color:"#1e293b"},children:v.name}),S&&S.completionPercentage===100&&n.jsx("span",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",borderRadius:999,width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:"bold",flexShrink:0},children:""})]}),n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[v.level&&n.jsxs("span",{style:{fontSize:11,padding:"3px 8px",borderRadius:6,background:"#f1f5f9",color:"#475569",fontWeight:500},children:[" ",v.level]}),n.jsx("span",{style:{fontSize:11,padding:"3px 8px",borderRadius:6,background:"#eef2ff",color:"#6366f1",fontWeight:500},children:(()=>{if(v.isProfPolyvalent)return" Polyvalent";if(!v.languages||v.languages.length===0)return" Toutes";const k={ar:"",en:"EN",fr:"FR"};return v.languages.map(j=>k[j.toLowerCase()]||j.toUpperCase()).join("  ")})()})]}),S&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[n.jsx("div",{style:{flex:1,height:6,background:"#e2e8f0",borderRadius:999,overflow:"hidden"},children:n.jsx("div",{style:{width:`${S.completionPercentage}%`,height:"100%",background:S.completionPercentage===100?"linear-gradient(90deg, #10b981, #059669)":"linear-gradient(90deg, #6366f1, #8b5cf6)",transition:"width 0.4s ease"}})}),n.jsxs("span",{style:{fontSize:12,fontWeight:600,color:S.completionPercentage===100?"#059669":"#6366f1",minWidth:42,textAlign:"right"},children:[S.completedAssignments,"/",S.totalAssignments]})]})]})},v._id)})})]},x)),!l&&s.length===0&&n.jsx("div",{className:"note",children:"Aucune classe assigne. Contactez l'administrateur."})]})]})})}function Sy({label:e,on:t,onToggle:r,variant:s}){return n.jsx("div",{className:`pill ${t?"on":""} ${s??""}`,onClick:r,"aria-pressed":t,children:e})}function bre(){var h,m,g,x;const{id:e}=oa(),[t,r]=p.useState(null),[s,i]=p.useState([]),[a,o]=p.useState({}),[l,c]=p.useState(!1),[u,d]=p.useState([]);p.useEffect(()=>{(async()=>{const v=await K.get(`/students/${e}`),S=await K.get("/categories"),k=await K.get(`/students/${e}/competencies`),j=await K.get(`/template-assignments/student/${e}`);r(v.data),i(S.data);const _={};for(const b of k.data)_[b.competencyId]=b;o(_),d(j.data||[])})()},[e]);const f=async(y,v)=>{const S=a[y],k={...S,competencyId:y,[v]:!(S!=null&&S[v])};o({...a,[y]:k}),c(!0);try{await K.patch(`/students/${e}/competencies/${y}`,k)}finally{c(!1)}};return n.jsxs("div",{className:"container",children:[t&&n.jsx("div",{className:"card",children:n.jsxs("div",{className:"header",children:[n.jsx("img",{className:"avatar",src:`https://api.dicebear.com/9.x/thumbs/svg?seed=${t.firstName}-${t.lastName}`}),n.jsxs("div",{className:"header-info",children:[n.jsxs("div",{className:"title",children:[t.firstName," ",t.lastName]}),n.jsxs("div",{className:"note",children:["Classe: ",((m=(h=t.enrollments)==null?void 0:h[0])==null?void 0:m.classId)||"","  ",l?"Sauvegarde":"Enregistr"]}),n.jsx("div",{className:"toolbar",children:u.length>0?n.jsxs("button",{className:"btn",onClick:()=>{const y=u[0],v=(K.defaults.baseURL||"").replace(/\/$/,""),S=vb(v,e,y.templateId);wd(S,`${t.firstName} ${t.lastName}`,"single",1)},children:[" Exporter le Carnet (",((x=(g=u[0])==null?void 0:g.template)==null?void 0:x.name)||"Template assign",")"]}):n.jsx("div",{style:{padding:"8px 12px",background:"#fef3c7",color:"#92400e",borderRadius:8,fontSize:13},children:" Aucun carnet assign  cet lve. Veuillez d'abord assigner un template  sa classe."})})]})]})}),n.jsxs("div",{className:"card",style:{marginTop:16},children:[n.jsx("h3",{className:"title",children:"Signatures"}),n.jsx(jre,{studentId:e})]}),n.jsx("div",{className:"row",children:n.jsx("div",{style:{flex:1},children:s.map(y=>n.jsxs("div",{className:"category",children:[n.jsx("div",{className:"title pastel",children:y.name}),y.competencies.map(v=>{const S=a[v._id]||{competencyId:v._id,en:!1,fr:!1,ar:!1};return n.jsxs("div",{className:"competency",children:[n.jsx("div",{children:v.label}),n.jsxs("div",{className:"indicators",children:[n.jsx(Sy,{label:"EN",variant:"en",on:!!S.en,onToggle:()=>f(v._id,"en")}),n.jsx(Sy,{label:"FR",variant:"fr",on:!!S.fr,onToggle:()=>f(v._id,"fr")}),n.jsx(Sy,{label:"AR",variant:"ar",on:!!S.ar,onToggle:()=>f(v._id,"ar")})]})]},v._id)})]},y._id))})})]})}function jre({studentId:e}){const{data:t,refetch:r}=v2({queryKey:["signatures",e],queryFn:async()=>(await K.get(`/signatures/${e}`)).data}),{data:s}=v2({queryKey:["gallery"],queryFn:async()=>(await K.get("/media/list")).data}),[i,a]=p.useState([]);p.useEffect(()=>{t!=null&&t.items&&a(t.items)},[t]);const o=()=>a([...i,{label:"Signature"}]),l=async()=>{await K.post(`/signatures/${e}`,{items:i}),await r()};return n.jsxs("div",{children:[i.map((c,u)=>n.jsxs("div",{className:"competency",children:[n.jsx("input",{placeholder:"Label",value:c.label,onChange:d=>{const f=[...i];f[u]={...c,label:d.target.value},a(f)},style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Data URL image",value:c.dataUrl||"",onChange:d=>{const f=[...i];f[u]={...c,dataUrl:d.target.value},a(f)},style:{padding:8,borderRadius:8,border:"1px solid #ddd",flex:1}}),n.jsx("input",{type:"file",accept:"image/*",onChange:async d=>{var x;const f=(x=d.target.files)==null?void 0:x[0];if(!f)return;const h=new FormData;h.append("file",f);const g=await(await fetch("/media/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:h})).json();if(g!=null&&g.url){const y=[...i];y[u]={...c,dataUrl:(g.url.startsWith("http"),g.url)},a(y)}}}),n.jsx("button",{className:"btn",onClick:async()=>{const d=await K.get("/media/list");Array.isArray(d.data)},children:"Rafrachir la galerie"}),Array.isArray(s)&&n.jsxs("select",{value:c.dataUrl||"",onChange:d=>{const f=[...i];f[u]={...c,dataUrl:`/uploads${d.target.value}`},a(f)},style:{padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"",children:"Choisir depuis la galerie"}),s.filter(d=>d.type==="file").map(d=>n.jsx("option",{value:d.path,children:d.name},d.path))]})]},u)),n.jsxs("div",{className:"toolbar",style:{marginTop:8},children:[n.jsx("button",{className:"btn",onClick:o,children:"Ajouter une signature"}),n.jsx("button",{className:"btn secondary",onClick:l,children:"Enregistrer"})]}),n.jsx("div",{className:"note",children:"Le PDF affichera une ligne si limage nest pas fournie."})]})}function pd({isOpen:e,onClose:t,title:r,children:s,footer:i,width:a=500}){return p.useEffect(()=>{const o=l=>{l.key==="Escape"&&t()};return e&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow="unset"}},[e,t]),e?Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"fadeIn 0.2s ease-out"},onClick:t,children:[n.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",width:a,maxWidth:"90%",maxHeight:"90vh",display:"flex",flexDirection:"column",animation:"slideUp 0.3s ease-out"},onClick:o=>o.stopPropagation(),children:[n.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("h3",{style:{margin:0,fontSize:"1.25rem",fontWeight:600,color:"#1e293b"},children:r}),n.jsx("button",{onClick:t,style:{background:"transparent",border:"none",fontSize:"1.5rem",color:"#94a3b8",cursor:"pointer",padding:"4px",lineHeight:1,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),n.jsx("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:s}),i&&n.jsx("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px",display:"flex",justifyContent:"flex-end",gap:"12px"},children:i})]}),n.jsx("style",{children:`
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}),document.body):null}function ca({message:e,type:t="info",onClose:r,duration:s=3e3,actionLabel:i,onAction:a,actionDisabled:o}){p.useEffect(()=>{const u=setTimeout(()=>{r()},s);return()=>clearTimeout(u)},[s,r,e]);const l={success:"#10b981",error:"#ef4444",info:"#3b82f6"},c={success:"",error:"",info:""};return Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:"24px",right:"24px",backgroundColor:l[t],color:"white",padding:"20px 32px",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"16px",zIndex:2e3,animation:"slideInFromTop 0.4s ease-out",fontWeight:500,maxWidth:"520px",fontSize:"16px",border:"2px solid rgba(255, 255, 255, 0.3)"},children:[n.jsx("div",{style:{backgroundColor:"rgba(255,255,255,0.25)",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",flexShrink:0},children:c[t]}),n.jsx("div",{style:{fontSize:"16px",lineHeight:1.4},children:e}),i&&a&&n.jsx("button",{onClick:a,disabled:!!o,style:{background:"rgba(255,255,255,0.25)",border:"2px solid rgba(255,255,255,0.5)",color:"white",cursor:o?"not-allowed":"pointer",borderRadius:8,padding:"10px 16px",fontWeight:700,fontSize:"15px",opacity:o?.7:1,whiteSpace:"nowrap",transition:"all 0.2s ease"},children:i}),n.jsx("button",{onClick:r,style:{background:"transparent",border:"none",color:"rgba(255,255,255,0.9)",cursor:"pointer",marginLeft:"8px",fontSize:"24px",padding:0,fontWeight:"bold"},children:""}),n.jsx("style",{children:`
                @keyframes slideInFromTop {
                    from { opacity: 0; transform: translateY(-100%); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}),document.body)}const Lw=e=>e.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase(),wre=({user:e,roleStyle:t,onUpdateName:r,onDelete:s,onResetPassword:i,onImpersonate:a,impersonatingId:o})=>{const[l,c]=p.useState(e.displayName||""),[u,d]=p.useState(""),[f,h]=p.useState(!1),[m,g]=p.useState(!1);p.useEffect(()=>{c(e.displayName||"")},[e.displayName]);const x=()=>{g(!1),l!==(e.displayName||"")&&r(e._id,l)},y=k=>{k.key==="Enter"&&k.currentTarget.blur(),k.key==="Escape"&&(c(e.displayName||""),k.currentTarget.blur())},v=()=>{u&&(i(e._id,u),d(""))},S=()=>{navigator.clipboard.writeText(e.email),h(!0),setTimeout(()=>h(!1),2e3)};return n.jsxs("div",{className:"user-card",children:[n.jsxs("div",{className:"user-card-top",style:{background:`linear-gradient(135deg, ${t.bg}, #ffffff)`},children:[n.jsx("div",{className:"user-avatar",style:{backgroundColor:t.color},children:Lw(l||e.email)}),n.jsx("div",{className:"user-role-badge",style:{color:t.color,borderColor:t.border},children:e.role})]}),n.jsxs("div",{className:"user-card-content",children:[n.jsxs("div",{className:"user-identity",children:[n.jsx("input",{className:"user-name-input",value:l,onChange:k=>c(k.target.value),onFocus:()=>g(!0),onBlur:x,onKeyDown:y,placeholder:"Cliquez pour ajouter un nom",title:"Cliquez pour modifier le nom","aria-label":"Nom d'affichage",style:m?{borderBottomColor:"#8b5cf6"}:void 0}),n.jsxs("div",{className:"user-email-row",onClick:S,title:"Cliquer pour copier l'email",role:"button",tabIndex:0,children:[n.jsx(sm,{size:14}),n.jsx("span",{className:"user-email-text",children:e.email}),f?n.jsx($a,{size:14,color:"#10B981"}):n.jsx(gb,{size:14,className:"copy-icon"})]})]}),n.jsxs("div",{className:"user-actions-area",children:[n.jsxs("div",{className:"password-reset-group",children:[n.jsx(J4,{size:16,className:"input-icon"}),n.jsx("input",{className:"reset-input",placeholder:"Nouveau mot de passe",type:"password",value:u,onChange:k=>d(k.target.value),onKeyDown:k=>k.key==="Enter"&&v(),"aria-label":"Nouveau mot de passe"}),u&&n.jsx("button",{className:"btn-icon-action primary",onClick:v,title:"Valider le nouveau mot de passe","aria-label":"Confirmer le changement de mot de passe",children:n.jsx($a,{size:14})})]}),n.jsxs("div",{className:"card-buttons",children:[e.role!=="ADMIN"&&n.jsx("button",{className:`btn-action ${o===e._id?"active":""}`,onClick:()=>a(e),disabled:o===e._id,title:"Se connecter en tant que cet utilisateur","aria-label":"Imiter cet utilisateur",children:n.jsx(eP,{size:16})}),n.jsx("button",{className:"btn-action danger",onClick:()=>s(e._id),title:"Dsactiver cet utilisateur","aria-label":"Dsactiver l'utilisateur",children:n.jsx(Pa,{size:16})})]})]})]})]})},Sre=({user:e,roleStyle:t,onUpdateName:r,onDelete:s,onUpdateRole:i,onImpersonate:a,impersonatingId:o})=>{const[l,c]=p.useState(e.displayName||""),[u,d]=p.useState(!1),[f,h]=p.useState(!1);p.useEffect(()=>{c(e.displayName||"")},[e.displayName]);const m=()=>{h(!1),l!==(e.displayName||"")&&r(e._id,l)},g=()=>{navigator.clipboard.writeText(e.email),d(!0),setTimeout(()=>d(!1),2e3)};return n.jsxs("div",{className:"user-card outlook-card",children:[n.jsxs("div",{className:"user-card-top",children:[n.jsx("div",{className:"user-avatar",style:{backgroundColor:"#0078d4"},children:Lw(l||e.email)}),n.jsx("div",{className:"microsoft-badge",children:n.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",alt:"",style:{width:18,height:18}})})]}),n.jsxs("div",{className:"user-card-content",children:[n.jsxs("div",{className:"user-identity",children:[n.jsx("input",{className:"user-name-input",value:l,onChange:x=>c(x.target.value),onFocus:()=>h(!0),onBlur:m,onKeyDown:x=>{x.key==="Enter"&&x.currentTarget.blur(),x.key==="Escape"&&(c(e.displayName||""),x.currentTarget.blur())},placeholder:"Cliquez pour ajouter un nom","aria-label":"Nom d'affichage",style:f?{borderBottomColor:"#0078d4"}:void 0}),n.jsxs("div",{className:"user-email-row",onClick:g,title:"Cliquer pour copier l'email",role:"button",tabIndex:0,children:[n.jsx(sm,{size:14}),n.jsx("span",{className:"user-email-text",children:e.email}),u?n.jsx($a,{size:14,color:"#10B981"}):n.jsx(gb,{size:14,className:"copy-icon"})]}),e.lastLogin&&n.jsxs("div",{className:"last-login",children:[n.jsx(Yl,{size:14}),"Dernire connexion: ",new Date(e.lastLogin).toLocaleDateString("fr-FR")]})]}),n.jsxs("div",{className:"user-actions-area",children:[n.jsxs("select",{className:"role-select",value:e.role,onChange:x=>i(e._id,x.target.value),style:{color:t.color,borderColor:t.border},"aria-label":"Changer le rle",children:[n.jsx("option",{value:"TEACHER",children:" Enseignant"}),n.jsx("option",{value:"SUBADMIN",children:" Prfet"}),n.jsx("option",{value:"AEFE",children:" RPP et Direction"}),n.jsx("option",{value:"ADMIN",children:" Admin"})]}),n.jsxs("div",{className:"card-buttons",children:[e.role!=="ADMIN"&&n.jsx("button",{className:`btn-action ${o===e._id?"active":""}`,onClick:()=>a(e),disabled:o===e._id,title:"Se connecter en tant que cet utilisateur","aria-label":"Imiter cet utilisateur",children:n.jsx(eP,{size:16})}),n.jsx("button",{className:"btn-action danger",onClick:()=>s(e._id),title:"Supprimer cet utilisateur","aria-label":"Supprimer l'utilisateur",children:n.jsx(Pa,{size:16})})]})]})]})]})};function kre(){const[e,t]=p.useState([]),[r,s]=p.useState([]),[i,a]=p.useState(""),[o,l]=p.useState(""),[c,u]=p.useState("TEACHER"),[d,f]=p.useState(""),[h,m]=p.useState(null),[g,x]=p.useState([]),[y,v]=p.useState(""),[S,k]=p.useState("TEACHER"),[j,_]=p.useState(""),[b,A]=p.useState("local"),[z,D]=p.useState(""),[w,N]=p.useState(null),[$,E]=p.useState(null),q=Z=>{for(let ne=1;ne<=3;ne++)if(!confirm(`${Z}

Confirmation ${ne}/3`))return!1;return!0},L=(Z,ne="info")=>{N({message:Z,type:ne})},O=Z=>{switch(Z){case"ADMIN":return{bg:"#fff0f6",color:"#c41d7f",border:"#ffadd2"};case"SUBADMIN":return{bg:"#e6f7ff",color:"#096dd9",border:"#91d5ff"};case"AEFE":return{bg:"#fff7e6",color:"#d46b08",border:"#ffd591"};case"TEACHER":return{bg:"#f6ffed",color:"#389e0d",border:"#b7eb8f"};default:return{bg:"#f5f5f5",color:"#595959",border:"#d9d9d9"}}},B=Z=>{switch(Z){case"ADMIN":return"Administrateur";case"SUBADMIN":return"Prfet";case"AEFE":return"RPP ET DIRECTION";case"TEACHER":return"Enseignant";default:return Z}},I=(Z,ne,ee)=>{const te=z.trim().toLowerCase(),G=ne.filter(me=>me.role===Z),H=te?G.filter(me=>(me.displayName||me.displayName||"").toLowerCase().includes(te)||me.email.toLowerCase().includes(te)):G;if(H.length===0)return null;const ie=O(Z);return n.jsxs("div",{className:"role-section",children:[n.jsxs("h4",{className:"role-header",style:{borderBottomColor:ie.border},children:[n.jsxs("span",{style:{color:ie.color},className:"role-title",children:[B(Z),"s"]}),n.jsx("span",{className:"role-count",style:{background:ie.bg,color:ie.color},children:H.length})]}),n.jsx("div",{className:"users-grid",children:H.map(me=>ee?n.jsx(Sre,{user:me,roleStyle:ie,onUpdateName:oe,onDelete:je,onUpdateRole:ve,onImpersonate:Pe,impersonatingId:h},me._id):n.jsx(wre,{user:me,roleStyle:ie,onUpdateName:le,onDelete:pe,onResetPassword:ce,onImpersonate:de,impersonatingId:h},me._id))})]},Z)},T=async()=>{const Z=await K.get("/users");t(Z.data.filter(ne=>ne.status!=="deleted").filter(ne=>!ne.isOutlook).filter(ne=>(ne.authProvider||"local")!=="microsoft"))},W=async()=>{try{const Z=await K.get("/users/deleted");s(Z.data)}catch(Z){console.error("Failed to load deleted users:",Z)}},re=async()=>{try{const Z=await K.get("/outlook-users");x(Z.data)}catch(Z){console.error("Failed to load Outlook users:",Z)}};p.useEffect(()=>{T(),re(),W()},[]);const ae=e.length,Y=g.length,J=r.length,P=async()=>{if(!i||!o){L("Email et mot de passe requis","error");return}try{await K.post("/users",{email:i,password:o,role:c,displayName:d}),a(""),l(""),f(""),u("TEACHER"),await T(),L("Utilisateur cr avec succs","success")}catch{L("Erreur lors de la cration","error")}},ce=async(Z,ne)=>{if(ne)try{await K.patch(`/users/${Z}/password`,{password:ne}),L("Mot de passe rinitialis","success")}catch{L("Erreur lors de la rinitialisation","error")}},pe=Z=>{E({isOpen:!0,title:"Dsactiver l'utilisateur",content:"L'utilisateur sera dsactiv et ne pourra plus se connecter. Vous pourrez le ractiver plus tard si ncessaire.",onConfirm:async()=>{if(!q("Confirmer la dsactivation de cet utilisateur")){E(null);return}await K.delete(`/users/${Z}`),await T(),await W(),E(null),L(`Utilisateur dsactiv. Vous pouvez le ractiver dans l'onglet "Supprims"`,"success")}})},ye=async Z=>{var ne,ee;try{await K.post(`/users/${Z}/reactivate`),await T(),await W(),L("Utilisateur ractiv avec succs","success")}catch(te){L(((ee=(ne=te.response)==null?void 0:ne.data)==null?void 0:ee.message)||"Erreur lors de la ractivation","error")}},se=async()=>{var Z,ne;if(y.trim())try{await K.post("/outlook-users",{email:y.trim().toLowerCase(),role:S,displayName:j.trim()||void 0}),v(""),_(""),k("TEACHER"),await re(),L("Utilisateur Outlook ajout","success")}catch(ee){L(((ne=(Z=ee.response)==null?void 0:Z.data)==null?void 0:ne.error)||"Erreur lors de l'ajout","error")}},je=Z=>{E({isOpen:!0,title:"Supprimer utilisateur Outlook",content:"Supprimer cet utilisateur Outlook ?",onConfirm:async()=>{if(!q("Confirmer la suppression de cet utilisateur Outlook")){E(null);return}try{await K.delete(`/outlook-users/${Z}`),await re(),E(null),L("Utilisateur supprim","success")}catch{L("Erreur lors de la suppression","error")}}})},ve=async(Z,ne)=>{try{await K.patch(`/outlook-users/${Z}`,{role:ne}),await re(),L("Rle mis  jour","success")}catch{L("Erreur lors de la mise  jour","error")}},le=async(Z,ne)=>{try{await K.patch(`/users/${Z}`,{displayName:ne}),await T(),L("Nom mis  jour","success")}catch{L("Erreur lors de la mise  jour du nom","error")}},oe=async(Z,ne)=>{try{await K.patch(`/outlook-users/${Z}`,{displayName:ne}),await re(),L("Nom mis  jour","success")}catch{L("Erreur lors de la mise  jour du nom","error")}},de=async Z=>{if(Z.role==="ADMIN"){L("Impossible d'imiter un autre administrateur","error");return}try{m(Z._id);const ne=await Fh.start(Z._id);let ee="/";Z.role==="TEACHER"?ee="/teacher/classes":Z.role==="SUBADMIN"?ee="/subadmin/dashboard":Z.role==="AEFE"&&(ee="/aefe/dashboard");const te=window.open("about:blank","_blank");te&&(te.sessionStorage.setItem("token",ne.token),te.sessionStorage.setItem("role",Z.role),te.sessionStorage.setItem("displayName",Z.displayName),te.location.href=window.location.origin+ee),m(null)}catch(ne){console.error("Failed to impersonate:",ne),L("chec de l'imitation","error"),m(null)}},Pe=async Z=>{if(Z.role==="ADMIN"){L("Impossible d'imiter un autre administrateur","error");return}try{m(Z._id);const ne=await Fh.start(Z._id);let ee="/";Z.role==="TEACHER"?ee="/teacher/classes":Z.role==="SUBADMIN"?ee="/subadmin/dashboard":Z.role==="AEFE"&&(ee="/aefe/dashboard");const te=window.open("about:blank","_blank");te&&(te.sessionStorage.setItem("token",ne.token),te.sessionStorage.setItem("role",Z.role),te.sessionStorage.setItem("displayName",Z.displayName||Z.email),te.location.href=window.location.origin+ee),m(null)}catch(ne){console.error("Failed to impersonate Outlook user:",ne),L("chec de l'imitation","error"),m(null)}};return n.jsxs("div",{className:"users-page",children:[w&&n.jsx(ca,{message:w.message,type:w.type,onClose:()=>N(null)}),n.jsx(pd,{isOpen:!!$,onClose:()=>E(null),title:($==null?void 0:$.title)||"",footer:n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[n.jsx("button",{className:"btn secondary",onClick:()=>E(null),children:"Annuler"}),n.jsx("button",{className:"btn",onClick:$==null?void 0:$.onConfirm,children:"Confirmer"})]}),children:$==null?void 0:$.content}),n.jsxs("div",{className:"users-header",children:[n.jsxs("h2",{className:"users-title",children:[n.jsx(tP,{size:28,style:{display:"inline",marginRight:12,verticalAlign:"middle"}}),"Gestion des utilisateurs"]}),n.jsx("p",{className:"users-description",children:"Grez les accs, les rles et les permissions de tous les utilisateurs de la plateforme en toute simplicit."})]}),n.jsxs("div",{className:"users-toolbar",children:[n.jsx("div",{className:"search-group",children:n.jsx("input",{className:"search-input",type:"text",placeholder:"Rechercher un utilisateur...",value:z,onChange:Z=>D(Z.target.value),"aria-label":"Rechercher par nom ou email"})}),n.jsxs("div",{className:"users-stats",children:[n.jsxs("span",{className:"users-stat-chip",title:"Comptes avec mot de passe local",children:[n.jsx(Ts,{size:16}),ae," locaux"]}),n.jsxs("span",{className:"users-stat-chip",title:"Comptes Microsoft/Outlook",children:[n.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",alt:"",style:{width:16,height:16}}),Y," Microsoft"]}),J>0&&n.jsxs("span",{className:"users-stat-chip",style:{background:"#fef2f2",borderColor:"#fecaca",color:"#dc2626"},title:"Comptes dsactivs",children:[n.jsx(nh,{size:16}),J," supprims"]})]})]}),n.jsxs("div",{className:"tabs-container",children:[n.jsxs("button",{className:`tab-button ${b==="local"?"active":""}`,onClick:()=>A("local"),children:[n.jsx(Ts,{size:18}),"Comptes Locaux",n.jsx("span",{className:"tab-count",children:ae})]}),n.jsxs("button",{className:`tab-button ${b==="microsoft"?"active microsoft":""}`,onClick:()=>A("microsoft"),children:[n.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",alt:"Microsoft",style:{width:18,height:18}}),"Comptes Microsoft",n.jsx("span",{className:"tab-count",children:Y})]}),n.jsxs("button",{className:`tab-button ${b==="deleted"?"active deleted":""}`,onClick:()=>A("deleted"),style:{marginLeft:"auto"},children:[n.jsx(nh,{size:18}),"Supprims",J>0&&n.jsx("span",{className:"tab-count",style:{backgroundColor:"#fee2e2",color:"#dc2626"},children:J})]})]}),b==="local"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("div",{className:"add-user-card",children:[n.jsxs("div",{className:"add-user-header",children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #e0e7ff, #c7d2fe)",padding:12,borderRadius:14,color:"#4f46e5"},children:n.jsx(rP,{size:24})}),n.jsxs("div",{children:[n.jsx("h3",{className:"add-user-title",children:"Nouvel utilisateur local"}),n.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Crez un compte avec email et mot de passe"})]})]}),n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Email"}),n.jsx("input",{className:"form-input",placeholder:"utilisateur@ecole.com",value:i,onChange:Z=>a(Z.target.value),type:"email",autoComplete:"email"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Mot de passe"}),n.jsx("input",{className:"form-input",placeholder:"",type:"password",value:o,onChange:Z=>l(Z.target.value),autoComplete:"new-password"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Nom affich"}),n.jsx("input",{className:"form-input",placeholder:"Jean Dupont",value:d,onChange:Z=>f(Z.target.value),autoComplete:"name"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Rle"}),n.jsxs("select",{className:"form-select",value:c,onChange:Z=>u(Z.target.value),children:[n.jsx("option",{value:"TEACHER",children:" Enseignant"}),n.jsx("option",{value:"SUBADMIN",children:" Prfet"}),n.jsx("option",{value:"AEFE",children:" RPP et Direction"}),n.jsx("option",{value:"ADMIN",children:" Administrateur"})]})]}),n.jsxs("button",{className:"btn-add",onClick:P,children:[n.jsx(Fs,{size:18}),"Crer le compte"]})]})]}),I("ADMIN",e,!1),I("SUBADMIN",e,!1),I("AEFE",e,!1),I("TEACHER",e,!1)]}),b==="microsoft"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("div",{className:"add-user-card",style:{background:"linear-gradient(135deg, #f0f9ff, #ffffff)",borderColor:"#bae6fd"},children:[n.jsxs("div",{className:"add-user-header",children:[n.jsx("div",{style:{background:"white",padding:12,borderRadius:14,boxShadow:"0 2px 8px rgba(0,120,212,0.15)"},children:n.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",alt:"",style:{width:24,height:24}})}),n.jsxs("div",{children:[n.jsx("h3",{className:"add-user-title",children:"Autoriser un compte Microsoft"}),n.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:"L'utilisateur se connectera avec son compte Outlook/Microsoft"})]})]}),n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Email Microsoft"}),n.jsx("input",{className:"form-input",placeholder:"utilisateur@outlook.com",value:y,onChange:Z=>v(Z.target.value),type:"email"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Nom (optionnel)"}),n.jsx("input",{className:"form-input",placeholder:"Jean Dupont",value:j,onChange:Z=>_(Z.target.value)})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{className:"form-label",children:"Rle"}),n.jsxs("select",{className:"form-select",value:S,onChange:Z=>k(Z.target.value),children:[n.jsx("option",{value:"TEACHER",children:" Enseignant"}),n.jsx("option",{value:"SUBADMIN",children:" Prfet"}),n.jsx("option",{value:"AEFE",children:" RPP et Direction"}),n.jsx("option",{value:"ADMIN",children:" Administrateur"})]})]}),n.jsxs("button",{className:"btn-add",onClick:se,style:{background:"linear-gradient(135deg, #0078d4, #00a4ef)"},children:[n.jsx(Fs,{size:18}),"Autoriser"]})]})]}),I("ADMIN",g,!0),I("SUBADMIN",g,!0),I("AEFE",g,!0),I("TEACHER",g,!0)]}),b==="deleted"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("div",{className:"deleted-users-header",children:[n.jsx("div",{style:{background:"#fee2e2",padding:14,borderRadius:14,color:"#dc2626"},children:n.jsx(Q$,{size:26})}),n.jsxs("div",{children:[n.jsx("h3",{children:"Utilisateurs dsactivs"}),n.jsx("p",{children:"Ces comptes ont t dsactivs et ne peuvent plus se connecter. Vous pouvez les ractiver  tout moment."})]})]}),r.length===0?n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-state-icon",children:n.jsx(nh,{size:32})}),n.jsx("p",{className:"empty-state-text",children:"Aucun utilisateur dsactiv"})]}):n.jsx("div",{className:"users-grid",children:r.map(Z=>(O(Z.role),n.jsxs("div",{className:"user-card",style:{opacity:.85,borderColor:"#fecaca"},children:[n.jsxs("div",{className:"user-card-top",style:{background:"linear-gradient(135deg, #fef2f2, #ffffff)"},children:[n.jsx("div",{className:"user-avatar",style:{backgroundColor:"#9ca3af"},children:Lw(Z.displayName||Z.email)}),n.jsx("div",{className:"user-role-badge",style:{color:"#6b7280",borderColor:"#d1d5db"},children:Z.role})]}),n.jsxs("div",{className:"user-card-content",children:[n.jsxs("div",{className:"user-identity",children:[n.jsx("div",{style:{fontWeight:700,color:"#374151",fontSize:"1.1rem",marginBottom:4},children:Z.displayName||Z.email}),n.jsxs("div",{className:"user-email-row",style:{cursor:"default"},children:[n.jsx(sm,{size:14}),n.jsx("span",{className:"user-email-text",children:Z.email})]}),Z.deletedAt&&n.jsxs("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:12,display:"flex",alignItems:"center",gap:6,padding:"6px 10px",background:"#fef2f2",borderRadius:8,width:"fit-content"},children:[n.jsx(Yl,{size:14}),"Dsactiv le ",new Date(Z.deletedAt).toLocaleDateString("fr-FR")]})]}),n.jsx("div",{className:"user-actions-area",style:{marginTop:16},children:n.jsxs("button",{className:"btn-action",onClick:()=>ye(Z._id),style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",border:"none",display:"flex",alignItems:"center",gap:8,padding:"10px 20px",borderRadius:10,cursor:"pointer",width:"100%",justifyContent:"center",fontWeight:600,fontSize:"0.9rem",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.25)"},title:"Ractiver l'utilisateur",children:[n.jsx(sM,{size:16}),"Ractiver le compte"]})})]})]},Z._id)))})]})]})}function Nre(){return{name:"Carnet color",pages:[{title:"Page de garde",layout:"single",blocks:[{type:"image",props:{url:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Eo_circle_pink_blank.svg/480px-Eo_circle_pink_blank.svg.png"}},{type:"student_info",props:{fields:["name","class","dob"]}},{type:"text",props:{text:"Bienvenue au carnet scolaire",size:16}}]},{title:"Comptences",layout:"single",blocks:[{type:"competency_list",props:{}}]}]}}function Cre(){const[e,t]=p.useState([]),[r,s]=p.useState(Nre()),[i,a]=p.useState(""),[o,l]=p.useState(""),[c,u]=p.useState(""),[d,f]=p.useState([]),[h,m]=p.useState([]),[g,x]=p.useState([]),y=async()=>{const A=await K.get("/templates");t(A.data)},v=async()=>{const A=await K.get("/school-years");f(A.data)},S=async A=>{const z=await K.get("/classes",{params:{schoolYearId:A}});m(z.data)},k=async A=>{const z=await K.get(`/students/by-class/${A}`);x(z.data)};p.useEffect(()=>{y(),v()},[]),p.useEffect(()=>{o&&(S(o),u(""),x([]),a(""))},[o]),p.useEffect(()=>{c&&(k(c),a(""))},[c]);const j=async()=>{if(r._id)await K.patch(`/templates/${r._id}`,r);else{const A=await K.post("/templates",r);s(A.data)}await y()},_=r._id&&i?`/pdf/student/${i}?templateId=${r._id}`:"",b=r._id&&c?`/pdf/class/${c}/batch?templateId=${r._id}`:"";return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[n.jsx("h2",{className:"title",style:{margin:0},children:"Templates de carnets (JSON Avanc)"}),n.jsx(rr,{to:"/admin/template-builder",className:"btn",children:"Aller  l'diteur visuel"})]}),n.jsxs("div",{className:"grid2",children:[n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"diteur JSON"}),n.jsx("input",{placeholder:"Nom du template",value:r.name,onChange:A=>s({...r,name:A.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",marginBottom:8}}),n.jsx("textarea",{rows:12,value:JSON.stringify(r,null,2),onChange:A=>s(JSON.parse(A.target.value)),style:{width:"100%",padding:12,borderRadius:12,border:"1px solid #ddd"}}),n.jsxs("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:8},children:[n.jsx("button",{className:"btn",onClick:j,children:"Enregistrer"}),n.jsxs("select",{value:o,onChange:A=>l(A.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"",children:"Anne"}),d.map(A=>n.jsx("option",{value:A._id,children:A.name},A._id))]}),n.jsxs("select",{value:c,onChange:A=>u(A.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"",children:"Classe"}),h.map(A=>n.jsx("option",{value:A._id,children:A.name},A._id))]}),n.jsxs("select",{value:i,onChange:A=>a(A.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"",children:"lve"}),g.map(A=>n.jsxs("option",{value:A._id,children:[A.firstName," ",A.lastName]},A._id))]}),_&&n.jsx("a",{className:"btn secondary",href:_,target:"_blank",children:"Aperu PDF"}),b&&n.jsx("a",{className:"btn secondary",href:b,target:"_blank",children:"Export classe (ZIP)"})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Templates existants"}),e.map(A=>n.jsxs("div",{className:"competency",children:[n.jsx("div",{children:A.name}),n.jsx("div",{className:"toolbar",children:n.jsx("button",{className:"btn",onClick:()=>s(A),children:"Ouvrir"})})]},A._id))]})]})]})})}const L8=async e=>{const t=await e.arrayBuffer();try{return new TextDecoder("utf-8",{fatal:!0}).decode(t)}catch{try{return new TextDecoder("windows-1252").decode(t)}catch{return new TextDecoder("utf-8").decode(t)}}};function _re(){const e=Sn(),{activeYearId:t,refetchYears:r}=Yn(),{levels:s}=la(),[i,a]=p.useState([]),[o,l]=p.useState(null),[c,u]=p.useState(!1),d=fe=>{for(let Oe=1;Oe<=3;Oe++)if(!confirm(`${fe}

Confirmation ${Oe}/3`))return!1;return!0},[f,h]=p.useState({name:"",startDate:"",endDate:"",active:!0,activeSemester:1}),[m,g]=p.useState([]),[x,y]=p.useState(""),[v,S]=p.useState([]),[k,j]=p.useState([]),[_,b]=p.useState(""),[A,z]=p.useState(""),[D,w]=p.useState(""),[N,$]=p.useState(""),[E,q]=p.useState(""),[L,O]=p.useState(""),[B,I]=p.useState(""),[T,W]=p.useState(""),[re,ae]=p.useState(null),[Y,J]=p.useState(!1),[P,ce]=p.useState(!1),[pe,ye]=p.useState(""),[se,je]=p.useState(null),ve=(fe,Oe="success")=>je({message:fe,type:Oe}),le=p.useMemo(()=>k.filter(fe=>fe.promotion&&fe.promotion.from!==fe.promotion.to),[k]),oe=p.useMemo(()=>k.filter(fe=>!fe.promotion||fe.promotion.from===fe.promotion.to),[k]),de=p.useMemo(()=>{var Oe,Fe;const fe={};for(const Ve of le){const tt=`${((Oe=Ve.promotion)==null?void 0:Oe.from)||"?"}  ${((Fe=Ve.promotion)==null?void 0:Fe.to)||"?"} (${Ve.previousClassName||"?"})`;fe[tt]||(fe[tt]=[]),fe[tt].push(Ve)}return fe},[le]),Pe=p.useMemo(()=>{const fe={};for(const Oe of oe){const Fe=`${Oe.level||"?"} (${Oe.previousClassName||"?"})`;fe[Fe]||(fe[Fe]=[]),fe[Fe].push(Oe)}return fe},[oe]),Z=p.useMemo(()=>{if(!pe.trim())return v;const fe=pe.toLowerCase();return v.filter(Oe=>Oe.firstName.toLowerCase().includes(fe)||Oe.lastName.toLowerCase().includes(fe))},[v,pe]),ne=async()=>{const fe=await K.get("/school-years");a(fe.data.sort((Oe,Fe)=>Oe.name.localeCompare(Fe.name)))};p.useEffect(()=>{ne()},[]);const ee=p.useMemo(()=>{if(i.length===0)return"";let fe=i[0],Oe=new Date(fe.startDate).getTime();for(const Fe of i){const Ve=new Date(Fe.startDate).getTime();!isNaN(Ve)&&(isNaN(Oe)||Ve<Oe)&&(fe=Fe,Oe=Ve)}return fe._id},[i]),te=async fe=>{const Oe=await K.get("/classes",{params:{schoolYearId:fe}});g(Oe.data)},G=async fe=>{const Oe=await K.get(`/students/by-class/${fe}`);S(Oe.data)},H=async fe=>{const Oe=await K.get(`/students/unassigned/${fe}`);j(Oe.data)},ie=async fe=>{var Oe,Fe;l(fe),h({name:fe.name,startDate:((Oe=fe.startDate)==null?void 0:Oe.slice(0,10))||"",endDate:((Fe=fe.endDate)==null?void 0:Fe.slice(0,10))||"",active:!!fe.active,activeSemester:fe.activeSemester||1}),await te(fe._id),await H(fe._id),y(""),S([]),Q()},me=async(fe,Oe,Fe)=>{o&&(await K.post(`/students/${fe}/assign-section`,{schoolYearId:o._id,level:Oe,section:Fe}),await H(o._id),await te(o._id))},ke=async fe=>{if(fe.stopPropagation(),c)return;let Oe=new Date().getFullYear();const Fe=i.find(Ct=>Ct._id===ee);if(Fe){const Ct=Fe.name.split("/");if(Ct.length===2){const Ot=parseInt(Ct[0]);isNaN(Ot)||(Oe=Ot-1)}else{const Ot=Fe.name.match(/(\d{4})/);if(Ot)Oe=parseInt(Ot[1])-1;else{const et=new Date(Fe.startDate);isNaN(et.getTime())||(Oe=et.getFullYear()-1)}}}const Ve=`${Oe}/${Oe+1}`;if(i.some(Ct=>Ct.name===Ve)){alert("Cette anne scolaire existe dj");return}const tt=`${Oe}-09-01`,Wt=`${Oe+1}-07-01`;try{u(!0),await K.post("/school-years",{name:Ve,startDate:tt,endDate:Wt,active:!1}),await ne()}finally{u(!1)}},Be=async()=>{const fe=[...i].sort((Ct,Ot)=>Ct.name.localeCompare(Ot.name)),Oe=fe[fe.length-1];let Fe=new Date().getFullYear();if(Oe){const Ct=Oe.name.split("/");if(Ct.length===2){const Ot=parseInt(Ct[0]);isNaN(Ot)||(Fe=Ot+1)}else{const Ot=Oe.name.match(/(\d{4})/);Ot&&(Fe=parseInt(Ot[1])+1)}}const Ve=`${Fe}/${Fe+1}`,tt=`${Fe}-09-01`,Wt=`${Fe+1}-07-01`;await K.post("/school-years",{name:Ve,startDate:tt,endDate:Wt,active:!1}),await ne()},Te=async()=>{if(o)try{const fe={...f};o.activeSemester!==fe.activeSemester&&(fe.active=!0);const Oe=await K.patch(`/school-years/${o._id}`,fe);if(await ne(),await r(),l(Oe.data),Oe.data.active){const Fe=Oe.data.activeSemester||fe.activeSemester||1;ve(`L'anne ${Oe.data.name}  Semestre S${Fe} est maintenant actif`,"success")}else ve(`Modifications enregistres pour ${Oe.data.name}`,"success")}catch{ve("Erreur lors de l'enregistrement","error")}},qe=async(fe,Oe)=>{fe.stopPropagation(),d("tes-vous sr de vouloir supprimer cette anne scolaire ?")&&(await K.delete(`/school-years/${Oe}`),await ne(),(o==null?void 0:o._id)===Oe&&l(null))},Qe=async fe=>{if(!o)return;const Oe=m.filter(Ct=>Ct.level===fe),Fe=new Set(Oe.map(Ct=>Ct.name.replace(fe,"").trim())),Ve="ABCDEFGHIJK";let tt="A";for(const Ct of Ve)if(!Fe.has(Ct)){tt=Ct;break}const Wt=`${fe} ${tt}`;await K.post("/classes",{name:Wt,level:fe,schoolYearId:o._id}),await te(o._id)},Ze=async(fe,Oe)=>{fe.stopPropagation(),d("tes-vous sr de vouloir supprimer cette classe ?")&&(await K.delete(`/classes/${Oe}`),o&&await te(o._id),x===Oe&&(y(""),S([])))},ge=async fe=>{y(fe),await G(fe),Q(fe)},Ae=fe=>{ae(fe._id),b(fe.firstName),z(fe.lastName),w(fe.dateOfBirth?String(fe.dateOfBirth).slice(0,10):""),$(fe.fatherName||fe.parentName||""),q(fe.fatherEmail||""),O(fe.motherEmail||""),I(fe.studentEmail||""),W(x)},Le=async()=>{const fe=T||x;fe&&(re?await K.patch(`/students/${re}`,{firstName:_,lastName:A,dateOfBirth:D,fatherName:N,fatherEmail:E,motherEmail:L,studentEmail:B,classId:fe}):await K.post("/students",{firstName:_,lastName:A,dateOfBirth:D,fatherName:N,fatherEmail:E,motherEmail:L,studentEmail:B,classId:fe}),Q(x),await G(x))},Q=fe=>{ae(null),b(""),z(""),w(""),$(""),q(""),O(""),I(""),W(fe||x)},be=async fe=>{d("tes-vous sr de vouloir supprimer cet lve ?")&&(await K.delete(`/students/${fe}`),x&&await G(x))},we=async()=>{if(o)try{const fe=await K.get(`/students/unassigned/export/${o._id}`,{responseType:"blob"}),Oe=window.URL.createObjectURL(new Blob([fe.data])),Fe=document.createElement("a");Fe.href=Oe,Fe.setAttribute("download","students_to_assign.csv"),document.body.appendChild(Fe),Fe.click(),Fe.remove()}catch{alert("Erreur lors du tlchargement")}},Ne=(fe,Oe)=>`${fe.charAt(0)}${Oe.charAt(0)}`.toUpperCase(),V=m.find(fe=>fe._id===x);return n.jsxs("div",{className:"resources-page",children:[se&&n.jsx(ca,{message:se.message,type:se.type,onClose:()=>je(null)}),n.jsxs("header",{className:"resources-header",children:[n.jsxs("div",{className:"resources-header-left",children:[n.jsx("div",{className:"resources-header-icon-wrapper",children:n.jsx(Tl,{className:"resources-header-icon"})}),n.jsxs("div",{className:"resources-header-text",children:[n.jsx("h1",{children:"Ressources Scolaires"}),n.jsx("p",{children:"Gestion globale des annes, classes et affectations"})]})]}),n.jsxs("div",{className:"resources-header-actions",children:[n.jsxs("button",{className:"feature-btn",onClick:()=>J(!0),title:"Importer dans l'anne active",children:[n.jsx(Rl,{className:"btn-icon",size:18}),n.jsx("span",{children:"Importer lves"})]}),n.jsxs("button",{className:"feature-btn",onClick:()=>e("/admin/students"),children:[n.jsx(Ts,{className:"btn-icon",size:18}),n.jsx("span",{children:"Tous les lves"})]})]})]}),n.jsxs("div",{className:"stats-grid",children:[n.jsxs("div",{className:"stat-item",children:[n.jsx("div",{className:"stat-icon-wrapper blue",children:n.jsx(Yl,{size:24})}),n.jsxs("div",{className:"stat-content",children:[n.jsx("span",{className:"stat-value",children:i.length}),n.jsx("span",{className:"stat-label",children:"Annes scolaires"})]})]}),n.jsxs("div",{className:"stat-item",children:[n.jsx("div",{className:"stat-icon-wrapper purple",children:n.jsx(Tl,{size:24})}),n.jsxs("div",{className:"stat-content",children:[n.jsx("span",{className:"stat-value",children:m.length}),n.jsx("span",{className:"stat-label",children:"Classes actives"})]})]}),n.jsxs("div",{className:"stat-item",children:[n.jsx("div",{className:"stat-icon-wrapper green",children:n.jsx(Kl,{size:24})}),n.jsxs("div",{className:"stat-content",children:[n.jsx("span",{className:"stat-value",children:v.length}),n.jsx("span",{className:"stat-label",children:"lves (classe)"})]})]}),n.jsxs("div",{className:"stat-item",children:[n.jsx("div",{className:"stat-icon-wrapper orange",children:n.jsx(hb,{size:24})}),n.jsxs("div",{className:"stat-content",children:[n.jsx("span",{className:"stat-value text-orange",children:k.length}),n.jsx("span",{className:"stat-label",children:" affecter"})]})]})]}),n.jsxs("div",{className:"main-grid",children:[n.jsxs("div",{className:"column-card",children:[n.jsx("div",{className:"column-header",children:n.jsxs("div",{className:"column-header-title",children:[n.jsx(Yl,{className:"column-icon blue",size:20}),n.jsx("h3",{children:"Annes"})]})}),n.jsxs("div",{className:"column-body",children:[n.jsx("div",{className:"years-list-container",children:i.map(fe=>n.jsxs("div",{className:`list-item ${(o==null?void 0:o._id)===fe._id?"selected":""} ${fe.active?"active-year":""}`,onClick:()=>ie(fe),children:[n.jsxs("div",{className:"list-item-main",children:[n.jsx("span",{className:"year-title",children:fe.name}),n.jsxs("div",{className:"year-badges-row",children:[fe.active&&n.jsx("span",{className:"status-badge active",children:"Actif"}),fe.active&&fe.activeSemester&&n.jsxs("span",{className:"status-badge semester",children:["S",fe.activeSemester]})]})]}),n.jsxs("div",{className:"list-item-actions",children:[fe._id===ee&&n.jsx("button",{className:"icon-action-btn small",onClick:Oe=>ke(Oe),title:"Ajouter l'anne prcdente",disabled:c,children:n.jsx(Fs,{size:14})}),n.jsx("button",{className:"icon-action-btn small danger",onClick:Oe=>qe(Oe,fe._id),title:"Supprimer",children:n.jsx(Pa,{size:14})})]})]},fe._id))}),n.jsxs("button",{className:"primary-add-btn",onClick:Be,children:[n.jsx(Fs,{size:18}),n.jsx("span",{children:"Nouvelle anne"})]}),o&&n.jsxs("div",{className:"edit-panel",children:[n.jsxs("div",{className:"edit-panel-header",children:[n.jsx(M2,{size:16}),n.jsxs("span",{children:["Modifier ",o.name]})]}),n.jsxs("div",{className:"edit-form-group",children:[n.jsx("label",{children:"Nom"}),n.jsx("input",{value:f.name,onChange:fe=>h({...f,name:fe.target.value}),placeholder:"2024/2025"})]}),n.jsxs("div",{className:"edit-form-row",children:[n.jsxs("div",{className:"edit-form-group",children:[n.jsx("label",{children:"Dbut"}),n.jsx("input",{type:"date",value:f.startDate,onChange:fe=>h({...f,startDate:fe.target.value})})]}),n.jsxs("div",{className:"edit-form-group",children:[n.jsx("label",{children:"Fin"}),n.jsx("input",{type:"date",value:f.endDate,onChange:fe=>h({...f,endDate:fe.target.value})})]})]}),n.jsxs("div",{className:"semester-selector",children:[n.jsx("button",{className:`sem-btn ${(f.activeSemester||1)===1?"selected":""}`,onClick:()=>h({...f,activeSemester:1}),children:"S1"}),n.jsx("button",{className:`sem-btn ${(f.activeSemester||1)===2?"selected":""}`,onClick:()=>h({...f,activeSemester:2}),children:"S2"})]}),n.jsxs("div",{className:"edit-form-checkbox",children:[n.jsx("input",{type:"checkbox",checked:f.active,onChange:fe=>h({...f,active:fe.target.checked}),id:"activeCheck"}),n.jsx("label",{htmlFor:"activeCheck",children:"Anne active"})]}),n.jsxs("button",{className:"save-action-btn",onClick:Te,children:[n.jsx(B2,{size:16}),"Enregistrer"]})]})]})]}),n.jsxs("div",{className:`column-card ${o?"":"disabled"}`,children:[n.jsxs("div",{className:"column-header",children:[n.jsxs("div",{className:"column-header-title",children:[n.jsx(Tl,{className:"column-icon purple",size:20}),n.jsx("h3",{children:"Classes"})]}),o&&n.jsx("span",{className:"header-count",children:m.length})]}),n.jsx("div",{className:"column-body",children:o?n.jsxs("div",{className:"classes-list-wrapper",children:[s.filter(fe=>["PS","MS","GS"].includes(fe.name)).map(fe=>{const Oe=m.filter(Fe=>Fe.level===fe.name).sort((Fe,Ve)=>Fe.name.localeCompare(Ve.name));return n.jsxs("div",{className:"level-group",children:[n.jsxs("div",{className:"level-group-header",children:[n.jsx("span",{className:`level-pill ${fe.name.toLowerCase()}`,children:fe.name}),n.jsx("div",{className:"level-line"}),n.jsx("button",{className:"icon-action-btn",onClick:()=>Qe(fe.name),title:"Ajouter une section",children:n.jsx(Fs,{size:16})})]}),n.jsxs("div",{className:"sections-grid-new",children:[Oe.map(Fe=>{const Ve=Fe.name.replace(fe.name,"").trim()||Fe.name;return n.jsxs("div",{className:`section-card ${x===Fe._id?"selected":""} ${fe.name.toLowerCase()}`,onClick:()=>ge(Fe._id),children:[n.jsx("span",{className:"section-letter",children:Ve}),x===Fe._id&&n.jsx("button",{className:"delete-section-btn",onClick:tt=>Ze(tt,Fe._id),children:n.jsx(Pa,{size:12})})]},Fe._id)}),Oe.length===0&&n.jsx("span",{className:"empty-level-text",children:"Aucune classe"})]})]},fe._id)}),n.jsxs("button",{className:"import-action-btn",onClick:()=>J(!0),title:"Importer dans l'anne active",children:[n.jsx(Rl,{size:16}),n.jsx("span",{children:"Importer CSV"})]})]}):n.jsxs("div",{className:"empty-placeholder",children:[n.jsx(Tc,{size:48,className:"placeholder-icon"}),n.jsx("p",{children:"Slectionnez une anne"})]})})]}),n.jsxs("div",{className:`column-card ${x?"":"disabled"}`,children:[n.jsxs("div",{className:"column-header",children:[n.jsxs("div",{className:"column-header-title",children:[n.jsx(Kl,{className:"column-icon green",size:20}),n.jsx("h3",{children:"lves"})]}),V&&n.jsx("span",{className:"header-count",children:v.length})]}),n.jsx("div",{className:"column-body",children:x?n.jsxs("div",{className:"students-panel",children:[n.jsxs("div",{className:"student-input-area",children:[n.jsxs("div",{className:"student-form-row",children:[n.jsx("input",{className:"clean-input",placeholder:"Prnom",value:_,onChange:fe=>b(fe.target.value)}),n.jsx("input",{className:"clean-input",placeholder:"Nom",value:A,onChange:fe=>z(fe.target.value)})]}),n.jsxs("div",{className:"student-form-row",children:[n.jsx("input",{className:"clean-input",type:"date",value:D,onChange:fe=>w(fe.target.value),title:"Date de naissance"}),n.jsx("input",{className:"clean-input",placeholder:"Nom du pre",value:N,onChange:fe=>$(fe.target.value)})]}),n.jsxs("div",{className:"student-form-row",children:[n.jsx("input",{className:"clean-input",placeholder:"Email du pre",value:E,onChange:fe=>q(fe.target.value)}),n.jsx("input",{className:"clean-input",placeholder:"Email de la mre",value:L,onChange:fe=>O(fe.target.value)})]}),n.jsxs("div",{className:"student-form-row",children:[n.jsx("input",{className:"clean-input",placeholder:"Email de l'lve",value:B,onChange:fe=>I(fe.target.value)}),n.jsx("div",{})]}),re&&n.jsx("select",{className:"clean-select",value:T,onChange:fe=>W(fe.target.value),children:m.sort((fe,Oe)=>fe.name.localeCompare(Oe.name)).map(fe=>n.jsx("option",{value:fe._id,children:fe.name},fe._id))}),n.jsxs("div",{className:"student-form-actions",children:[n.jsxs("button",{className:`action-btn primary ${re?"warning":""}`,onClick:Le,disabled:!_.trim()||!A.trim()||!D.trim(),children:[re?n.jsx(B2,{size:16}):n.jsx(Fs,{size:16}),n.jsx("span",{children:re?"Mettre  jour":"Ajouter"})]}),re&&n.jsx("button",{className:"action-btn ghost",onClick:()=>Q(),children:n.jsx(Ai,{size:16})})]})]}),n.jsxs("div",{className:"search-bar",children:[n.jsx(No,{size:16,className:"search-icon"}),n.jsx("input",{placeholder:"Rechercher un lve...",value:pe,onChange:fe=>ye(fe.target.value)})]}),n.jsxs("div",{className:"students-list-new",children:[Z.map(fe=>n.jsxs("div",{className:"student-row",children:[n.jsx("div",{className:"student-avatar-small",children:Ne(fe.firstName,fe.lastName)}),n.jsx("div",{className:"student-info-col",children:n.jsxs("span",{className:"student-fullname",children:[fe.firstName," ",fe.lastName]})}),n.jsxs("div",{className:"student-row-actions",children:[n.jsx("button",{onClick:()=>Ae(fe),className:"icon-btn-row edit",children:n.jsx(M2,{size:14})}),n.jsx("button",{onClick:()=>be(fe._id),className:"icon-btn-row delete",children:n.jsx(Pa,{size:14})})]})]},fe._id)),Z.length===0&&n.jsx("div",{className:"empty-list-msg",children:"Aucun lve trouv"})]})]}):n.jsxs("div",{className:"empty-placeholder",children:[n.jsx(Tc,{size:48,className:"placeholder-icon"}),n.jsx("p",{children:"Slectionnez une classe"})]})})]})]}),o&&n.jsxs("div",{className:"unassigned-panel",children:[n.jsxs("div",{className:"unassigned-header-row",children:[n.jsxs("div",{className:"unassigned-title",children:[n.jsx(Lo,{className:"unassign-icon",size:24}),n.jsxs("div",{children:[n.jsx("h3",{children:"En attente d'affectation"}),n.jsxs("p",{children:[k.length," lves  placer"]})]})]}),n.jsxs("div",{className:"unassigned-actions-row",children:[n.jsxs("button",{className:"secondary-action-btn",onClick:we,children:[n.jsx(mb,{size:16})," CSV"]}),n.jsxs("button",{className:"secondary-action-btn",onClick:()=>ce(!0),children:[n.jsx(Rl,{size:16})," Importer affectations"]})]})]}),k.length>0?n.jsxs("div",{className:"unassigned-grid-layout",children:[Object.entries(Pe).map(([fe,Oe])=>n.jsxs("div",{className:"unassigned-card-group",children:[n.jsxs("div",{className:"group-header",children:[n.jsx("span",{className:"group-name",children:fe}),n.jsx("span",{className:"group-badge",children:Oe.length})]}),n.jsx("div",{className:"group-list",children:Oe.map(Fe=>n.jsxs("div",{className:"unassigned-item",children:[n.jsxs("span",{className:"u-name",children:[Fe.firstName," ",Fe.lastName]}),n.jsxs("select",{className:"u-select",onChange:Ve=>{Ve.target.value&&me(Fe._id,Fe.level||"MS",Ve.target.value)},defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"Section..."}),["A","B","C","D","E","F","G","H","I","J","K"].map(Ve=>n.jsx("option",{value:Ve,children:Ve},Ve))]})]},Fe._id))})]},fe)),Object.entries(de).map(([fe,Oe])=>n.jsxs("div",{className:"unassigned-card-group promoted",children:[n.jsxs("div",{className:"group-header",children:[n.jsx("span",{className:"group-name",children:fe}),n.jsx("span",{className:"group-badge promoted",children:Oe.length})]}),n.jsx("div",{className:"group-list",children:Oe.map(Fe=>n.jsxs("div",{className:"unassigned-item",children:[n.jsxs("span",{className:"u-name",children:[Fe.firstName," ",Fe.lastName]}),n.jsxs("select",{className:"u-select",onChange:Ve=>{Ve.target.value&&me(Fe._id,Fe.level||"MS",Ve.target.value)},defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"Section..."}),["A","B","C","D","E","F","G","H","I","J","K"].map(Ve=>n.jsx("option",{value:Ve,children:Ve},Ve))]})]},Fe._id))})]},fe))]}):n.jsxs("div",{className:"all-clear-message",children:[n.jsx($a,{size:48,className:"success-icon"}),n.jsx("p",{children:"Tous les lves sont affects pour cette anne !"})]})]}),n.jsx(Are,{isOpen:Y,onClose:()=>J(!1),onSuccess:()=>{o&&(H(o._id),te(o._id))}}),o&&n.jsx(Ere,{isOpen:P,onClose:()=>ce(!1),schoolYearId:o._id,onSuccess:()=>{H(o._id),te(o._id)}})]})}function Are({isOpen:e,onClose:t,onSuccess:r}){const{activeYearId:s,activeYear:i}=Yn(),[a,o]=p.useState(""),[l,c]=p.useState(null),[u,d]=p.useState(!1);p.useEffect(()=>{e&&(o(`FirstName,LastName,level,section,DateOfBirth,FatherName,FatherEmail,MotherEmail,StudentEmail
`),c(null),d(!1))},[e]);const f=async m=>{var y;const g=(y=m.target.files)==null?void 0:y[0];if(!g)return;const x=await L8(g);o(x)},h=async()=>{d(!0),c(null);let m=a;try{let g=m.split(/\r?\n/).filter(x=>x.trim().length>0);if(g.length>0){const x=g[0].toLowerCase();!x.includes("firstname")&&!x.includes("nom")&&!x.includes("prenom")&&(g=["FirstName,LastName,level,section,DateOfBirth,FatherName,FatherEmail,MotherEmail,StudentEmail",...g])}if(g.length>1){let x=g[0].split(",").map(j=>j.trim());x.findIndex(j=>j.toLowerCase().includes("date")||j.toLowerCase()==="dob")===-1&&(x.push("DateOfBirth"),g=[x.join(","),...g.slice(1).map(j=>`${j},2020-01-01`)]);const v=x.some(j=>j.toLowerCase()==="classname"),S=x.findIndex(j=>j.toLowerCase()==="level"),k=x.findIndex(j=>j.toLowerCase()==="section");if(!v&&S!==-1&&k!==-1){const j=[...x,"ClassName"],_=g.slice(1).map(b=>{const A=b.split(","),z=(A[S]||"").trim(),D=(A[k]||"").trim(),w=[z,D].filter(Boolean).join(" ").trim();return[...A,w].join(",")});m=[j.join(","),..._].join(`
`)}else m=g.join(`
`)}}catch{}if(!s){alert("Aucune anne scolaire active. Veuillez d'abord activer une anne."),d(!1);return}try{const g=await K.post("/import/students",{csv:m,schoolYearId:s,dryRun:!1});c(g.data),(g.data.added>0||g.data.updated>0)&&(r==null||r())}catch{alert("Erreur lors de l'import")}finally{d(!1)}};return e?n.jsx("div",{className:"modal-overlay",onClick:t,children:n.jsxs("div",{className:"modal-content",onClick:m=>m.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("div",{className:"modal-title",children:[n.jsx(Rl,{size:20,className:"modal-icon"}),n.jsxs("div",{children:[n.jsx("h3",{children:"Importer des lves"}),i&&n.jsxs("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",margin:"4px 0 0 0"},children:["Anne active: ",n.jsx("strong",{children:i.name})]})]})]}),n.jsx("button",{className:"modal-close",onClick:t,children:n.jsx(Ai,{size:20})})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"file-upload-zone",onClick:()=>{var m;return(m=document.getElementById("csv-upload"))==null?void 0:m.click()},children:[n.jsx("input",{type:"file",accept:".csv",onChange:f,style:{display:"none"},id:"csv-upload"}),n.jsx(yp,{size:32,className:"upload-icon"}),n.jsx("p",{className:"file-upload-text",children:"Cliquez pour slectionner un fichier CSV"}),n.jsx("p",{className:"file-upload-hint",children:"ou glissez-dposez le fichier ici"})]}),n.jsx("textarea",{className:"csv-textarea",value:a,onChange:m=>o(m.target.value),rows:8,placeholder:"FirstName,LastName,level,section,DateOfBirth,FatherName,FatherEmail,MotherEmail,StudentEmail"}),n.jsxs("div",{className:"format-hint",children:[n.jsx(Lo,{size:14}),"Format attendu: ",n.jsx("code",{children:"FirstName,LastName,level,section,DateOfBirth,FatherName,FatherEmail,MotherEmail,StudentEmail"})," (DateOfBirth: ",n.jsx("code",{children:"dd-mm-yyyy"}),", colonnes optionnelles: ",n.jsx("code",{children:"StudentId,LogicalKey"}),")"]}),n.jsxs("div",{className:"format-hint",style:{marginTop:"8px",color:"var(--success-color)"},children:[n.jsx($a,{size:14}),"Les classes seront cres automatiquement si elles n'existent pas"]}),l&&n.jsxs("div",{className:`import-result ${l.added>0?"success":"warning"}`,children:[n.jsx("h4",{className:"import-result-title",children:l.added>0?"Import russi":"Rsultat de l'import"}),n.jsxs("div",{className:"import-result-stats",children:[n.jsxs("div",{className:"import-stat",children:[n.jsx("div",{className:"import-stat-value",children:l.added}),n.jsx("div",{className:"import-stat-label",children:"Crs"})]}),n.jsxs("div",{className:"import-stat",children:[n.jsx("div",{className:"import-stat-value",children:l.updated}),n.jsx("div",{className:"import-stat-label",children:"Mis  jour"})]}),n.jsxs("div",{className:"import-stat",children:[n.jsx("div",{className:"import-stat-value",children:l.errorCount||0}),n.jsx("div",{className:"import-stat-label",children:"Erreurs"})]})]}),l.report&&l.report.filter(m=>m.status==="error").length>0&&n.jsx("div",{className:"import-errors",children:l.report.filter(m=>m.status==="error").map((m,g)=>n.jsx("div",{children:m.message||JSON.stringify(m)},g))})]})]}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{className:"modal-btn secondary",onClick:t,children:"Fermer"}),n.jsx("button",{className:"modal-btn primary",onClick:h,disabled:u||!a.trim(),children:u?"Importation...":"Importer"})]})]})}):null}function Ere({isOpen:e,onClose:t,schoolYearId:r,onSuccess:s}){var h;const[i,a]=p.useState(""),[o,l]=p.useState(null),[c,u]=p.useState(!1);p.useEffect(()=>{e&&(a(""),l(null),u(!1))},[e]);const d=async m=>{var y;const g=(y=m.target.files)==null?void 0:y[0];if(!g)return;const x=await L8(g);a(x)},f=async()=>{u(!0),l(null);try{const m=await K.post("/students/bulk-assign-section",{csv:i,schoolYearId:r});l(m.data),m.data.success>0&&s()}catch{alert("Erreur lors de l'import")}finally{u(!1)}};return e?n.jsx("div",{className:"modal-overlay",onClick:t,children:n.jsxs("div",{className:"modal-content",onClick:m=>m.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("div",{className:"modal-title",children:[n.jsx(Rl,{size:20,className:"modal-icon"}),n.jsx("h3",{children:"Affectation en masse"})]}),n.jsx("button",{className:"modal-close",onClick:t,children:n.jsx(Ai,{size:20})})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"file-upload-zone",onClick:()=>{var m;return(m=document.getElementById("bulk-csv-upload"))==null?void 0:m.click()},children:[n.jsx("input",{type:"file",accept:".csv",onChange:d,style:{display:"none"},id:"bulk-csv-upload"}),n.jsx(yp,{size:32,className:"upload-icon"}),n.jsx("p",{className:"file-upload-text",children:"Cliquez pour slectionner un fichier CSV"}),n.jsx("p",{className:"file-upload-hint",children:"ou glissez-dposez le fichier ici"})]}),n.jsx("textarea",{className:"csv-textarea",value:i,onChange:m=>a(m.target.value),rows:8,placeholder:"StudentId,FirstName,LastName,PreviousClass,TargetLevel,NextClass..."}),n.jsxs("div",{className:"format-hint",children:[n.jsx(Lo,{size:14}),"Colonnes requises: ",n.jsx("code",{children:"StudentId, NextClass"})]}),o&&n.jsxs("div",{className:`import-result ${o.success>0?"success":"warning"}`,children:[n.jsx("h4",{className:"import-result-title",children:o.success>0?"Affectation russie":"Rsultat"}),n.jsxs("div",{className:"import-result-stats",style:{gridTemplateColumns:"repeat(2, 1fr)"},children:[n.jsxs("div",{className:"import-stat",children:[n.jsx("div",{className:"import-stat-value",children:o.success}),n.jsx("div",{className:"import-stat-label",children:"Affects"})]}),n.jsxs("div",{className:"import-stat",children:[n.jsx("div",{className:"import-stat-value",children:((h=o.errors)==null?void 0:h.length)||0}),n.jsx("div",{className:"import-stat-label",children:"Erreurs"})]})]}),o.errors&&o.errors.length>0&&n.jsx("div",{className:"import-errors",children:o.errors.map((m,g)=>n.jsx("div",{children:JSON.stringify(m)},g))})]})]}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{className:"modal-btn secondary",onClick:t,children:"Fermer"}),n.jsx("button",{className:"modal-btn primary",onClick:f,disabled:c||!i.trim(),children:c?"Traitement...":"Lancer l'affectation"})]})]})}):null}const aa=Object.create(null);aa.open="0";aa.close="1";aa.ping="2";aa.pong="3";aa.message="4";aa.upgrade="5";aa.noop="6";const ch=Object.create(null);Object.keys(aa).forEach(e=>{ch[aa[e]]=e});const J0={type:"error",data:"parser error"},$8=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",D8=typeof ArrayBuffer=="function",M8=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,$w=({type:e,data:t},r,s)=>$8&&t instanceof Blob?r?s(t):n_(t,s):D8&&(t instanceof ArrayBuffer||M8(t))?r?s(t):n_(new Blob([t]),s):s(aa[e]+(t||"")),n_=(e,t)=>{const r=new FileReader;return r.onload=function(){const s=r.result.split(",")[1];t("b"+(s||""))},r.readAsDataURL(e)};function s_(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let ky;function Pre(e,t){if($8&&e.data instanceof Blob)return e.data.arrayBuffer().then(s_).then(t);if(D8&&(e.data instanceof ArrayBuffer||M8(e.data)))return t(s_(e.data));$w(e,!1,r=>{ky||(ky=new TextEncoder),t(ky.encode(r))})}const i_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lu=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<i_.length;e++)lu[i_.charCodeAt(e)]=e;const Ire=e=>{let t=e.length*.75,r=e.length,s,i=0,a,o,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const u=new ArrayBuffer(t),d=new Uint8Array(u);for(s=0;s<r;s+=4)a=lu[e.charCodeAt(s)],o=lu[e.charCodeAt(s+1)],l=lu[e.charCodeAt(s+2)],c=lu[e.charCodeAt(s+3)],d[i++]=a<<2|o>>4,d[i++]=(o&15)<<4|l>>2,d[i++]=(l&3)<<6|c&63;return u},Tre=typeof ArrayBuffer=="function",Dw=(e,t)=>{if(typeof e!="string")return{type:"message",data:B8(e,t)};const r=e.charAt(0);return r==="b"?{type:"message",data:Rre(e.substring(1),t)}:ch[r]?e.length>1?{type:ch[r],data:e.substring(1)}:{type:ch[r]}:J0},Rre=(e,t)=>{if(Tre){const r=Ire(e);return B8(r,t)}else return{base64:!0,data:e}},B8=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},F8="",Ore=(e,t)=>{const r=e.length,s=new Array(r);let i=0;e.forEach((a,o)=>{$w(a,!1,l=>{s[o]=l,++i===r&&t(s.join(F8))})})},zre=(e,t)=>{const r=e.split(F8),s=[];for(let i=0;i<r.length;i++){const a=Dw(r[i],t);if(s.push(a),a.type==="error")break}return s};function Lre(){return new TransformStream({transform(e,t){Pre(e,r=>{const s=r.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,s)}else{i=new Uint8Array(9);const a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(r)})}})}let Ny;function Lf(e){return e.reduce((t,r)=>t+r.length,0)}function $f(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)r[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),r}function $re(e,t){Ny||(Ny=new TextDecoder);const r=[];let s=0,i=-1,a=!1;return new TransformStream({transform(o,l){for(r.push(o);;){if(s===0){if(Lf(r)<1)break;const c=$f(r,1);a=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(Lf(r)<2)break;const c=$f(r,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(Lf(r)<8)break;const c=$f(r,8),u=new DataView(c.buffer,c.byteOffset,c.length),d=u.getUint32(0);if(d>Math.pow(2,21)-1){l.enqueue(J0);break}i=d*Math.pow(2,32)+u.getUint32(4),s=3}else{if(Lf(r)<i)break;const c=$f(r,i);l.enqueue(Dw(a?c:Ny.decode(c),t)),s=0}if(i===0||i>e){l.enqueue(J0);break}}}})}const W8=4;function pn(e){if(e)return Dre(e)}function Dre(e){for(var t in pn.prototype)e[t]=pn.prototype[t];return e}pn.prototype.on=pn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};pn.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this};pn.prototype.off=pn.prototype.removeListener=pn.prototype.removeAllListeners=pn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,i=0;i<r.length;i++)if(s=r[i],s===t||s.fn===t){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+e],this};pn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(r){r=r.slice(0);for(var s=0,i=r.length;s<i;++s)r[s].apply(this,t)}return this};pn.prototype.emitReserved=pn.prototype.emit;pn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};pn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const px=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,r)=>r(t,0),ai=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Mre="arraybuffer";function U8(e,...t){return t.reduce((r,s)=>(e.hasOwnProperty(s)&&(r[s]=e[s]),r),{})}const Bre=ai.setTimeout,Fre=ai.clearTimeout;function fx(e,t){t.useNativeTimers?(e.setTimeoutFn=Bre.bind(ai),e.clearTimeoutFn=Fre.bind(ai)):(e.setTimeoutFn=ai.setTimeout.bind(ai),e.clearTimeoutFn=ai.clearTimeout.bind(ai))}const Wre=1.33;function Ure(e){return typeof e=="string"?Hre(e):Math.ceil((e.byteLength||e.size)*Wre)}function Hre(e){let t=0,r=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(s++,r+=4);return r}function H8(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Yre(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}function Kre(e){let t={},r=e.split("&");for(let s=0,i=r.length;s<i;s++){let a=r[s].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}class Vre extends Error{constructor(t,r,s){super(t),this.description=r,this.context=s,this.type="TransportError"}}class Mw extends pn{constructor(t){super(),this.writable=!1,fx(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,r,s){return super.emitReserved("error",new Vre(t,r,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const r=Dw(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,r={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const r=Yre(t);return r.length?"?"+r:""}}class qre extends Mw{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||r()})),this.writable||(s++,this.once("drain",function(){--s||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const r=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};zre(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Ore(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=H8()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(t,r)}}let Y8=!1;try{Y8=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Gre=Y8;function Xre(){}class Qre extends qre{constructor(t){if(super(t),typeof location<"u"){const r=location.protocol==="https:";let s=location.port;s||(s=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,r){const s=this.request({method:"POST",data:t});s.on("success",r),s.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(r,s)=>{this.onError("xhr poll error",r,s)}),this.pollXhr=t}}class ra extends pn{constructor(t,r,s){super(),this.createRequest=t,fx(this,s),this._opts=s,this._method=s.method||"GET",this._uri=r,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const r=U8(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(r);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ra.requestsCount++,ra.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Xre,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ra.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ra.requestsCount=0;ra.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",a_);else if(typeof addEventListener=="function"){const e="onpagehide"in ai?"pagehide":"unload";addEventListener(e,a_,!1)}}function a_(){for(let e in ra.requests)ra.requests.hasOwnProperty(e)&&ra.requests[e].abort()}const Jre=function(){const e=K8({xdomain:!1});return e&&e.responseType!==null}();class Zre extends Qre{constructor(t){super(t);const r=t&&t.forceBase64;this.supportsBinary=Jre&&!r}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new ra(K8,this.uri(),t)}}function K8(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Gre))return new XMLHttpRequest}catch{}if(!t)try{return new ai[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const V8=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ene extends Mw{get name(){return"websocket"}doOpen(){const t=this.uri(),r=this.opts.protocols,s=V8?{}:U8(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,r,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const s=t[r],i=r===t.length-1;$w(s,this.supportsBinary,a=>{try{this.doWrite(s,a)}catch{}i&&px(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=H8()),this.supportsBinary||(r.b64=1),this.createUri(t,r)}}const Cy=ai.WebSocket||ai.MozWebSocket;class tne extends ene{createSocket(t,r,s){return V8?new Cy(t,r,s):r?new Cy(t,r):new Cy(t)}doWrite(t,r){this.ws.send(r)}}class rne extends Mw{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const r=$re(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(r).getReader(),i=Lre();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const a=()=>{s.read().then(({done:l,value:c})=>{l||(this.onPacket(c),a())}).catch(l=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const s=t[r],i=r===t.length-1;this._writer.write(s).then(()=>{i&&px(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const nne={websocket:tne,webtransport:rne,polling:Zre},sne=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ine=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Z0(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),s=e.indexOf("]");r!=-1&&s!=-1&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));let i=sne.exec(e||""),a={},o=14;for(;o--;)a[ine[o]]=i[o]||"";return r!=-1&&s!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=ane(a,a.path),a.queryKey=one(a,a.query),a}function ane(e,t){const r=/\/{2,9}/g,s=t.replace(r,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function one(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,a){i&&(r[i]=a)}),r}const e1=typeof addEventListener=="function"&&typeof removeEventListener=="function",dh=[];e1&&addEventListener("offline",()=>{dh.forEach(e=>e())},!1);class Do extends pn{constructor(t,r){if(super(),this.binaryType=Mre,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){const s=Z0(t);r.hostname=s.host,r.secure=s.protocol==="https"||s.protocol==="wss",r.port=s.port,s.query&&(r.query=s.query)}else r.host&&(r.hostname=Z0(r.host).host);fx(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Kre(this.opts.query)),e1&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},dh.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=W8,r.transport=t,this.id&&(r.sid=this.id);const s=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Do.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",Do.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(r+=Ure(i)),s>0&&r>this._maxPayload)return this.writeBuffer.slice(0,s);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,px(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,s){return this._sendPacket("message",t,r,s),this}send(t,r,s){return this._sendPacket("message",t,r,s),this}_sendPacket(t,r,s,i){if(typeof r=="function"&&(i=r,r=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const a={type:t,data:r,options:s};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},s=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Do.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),e1&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=dh.indexOf(this._offlineEventListener);s!==-1&&dh.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}Do.protocol=W8;class lne extends Do{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let r=this.createTransport(t),s=!1;Do.priorWebsocketSuccess=!1;const i=()=>{s||(r.send([{type:"ping",data:"probe"}]),r.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;Do.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(d(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=r.name,this.emitReserved("upgradeError",h)}}))};function a(){s||(s=!0,d(),r.close(),r=null)}const o=f=>{const h=new Error("probe error: "+f);h.transport=r.name,a(),this.emitReserved("upgradeError",h)};function l(){o("transport closed")}function c(){o("socket closed")}function u(f){r&&f.name!==r.name&&a()}const d=()=>{r.removeListener("open",i),r.removeListener("error",o),r.removeListener("close",l),this.off("close",c),this.off("upgrading",u)};r.once("open",i),r.once("error",o),r.once("close",l),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||r.open()},200):r.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const r=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&r.push(t[s]);return r}}let cne=class extends lne{constructor(t,r={}){const s=typeof t=="object"?t:r;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>nne[i]).filter(i=>!!i)),super(t,s)}};function dne(e,t="",r){let s=e;r=r||typeof location<"u"&&location,e==null&&(e=r.protocol+"//"+r.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=r.protocol+e:e=r.host+e),/^(https?|wss?):\/\//.test(e)||(typeof r<"u"?e=r.protocol+"//"+e:e="https://"+e),s=Z0(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const a=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+a+":"+s.port+t,s.href=s.protocol+"://"+a+(r&&r.port===s.port?"":":"+s.port),s}const une=typeof ArrayBuffer=="function",pne=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,q8=Object.prototype.toString,fne=typeof Blob=="function"||typeof Blob<"u"&&q8.call(Blob)==="[object BlobConstructor]",hne=typeof File=="function"||typeof File<"u"&&q8.call(File)==="[object FileConstructor]";function Bw(e){return une&&(e instanceof ArrayBuffer||pne(e))||fne&&e instanceof Blob||hne&&e instanceof File}function uh(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let r=0,s=e.length;r<s;r++)if(uh(e[r]))return!0;return!1}if(Bw(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return uh(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&uh(e[r]))return!0;return!1}function gne(e){const t=[],r=e.data,s=e;return s.data=t1(r,t),s.attachments=t.length,{packet:s,buffers:t}}function t1(e,t){if(!e)return e;if(Bw(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}else if(Array.isArray(e)){const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=t1(e[s],t);return r}else if(typeof e=="object"&&!(e instanceof Date)){const r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=t1(e[s],t));return r}return e}function mne(e,t){return e.data=r1(e.data,t),delete e.attachments,e}function r1(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=r1(e[r],t);else if(typeof e=="object")for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=r1(e[r],t));return e}const xne=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],yne=5;var pr;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(pr||(pr={}));class vne{constructor(t){this.replacer=t}encode(t){return(t.type===pr.EVENT||t.type===pr.ACK)&&uh(t)?this.encodeAsBinary({type:t.type===pr.EVENT?pr.BINARY_EVENT:pr.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let r=""+t.type;return(t.type===pr.BINARY_EVENT||t.type===pr.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(r+=t.nsp+","),t.id!=null&&(r+=t.id),t.data!=null&&(r+=JSON.stringify(t.data,this.replacer)),r}encodeAsBinary(t){const r=gne(t),s=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(s),i}}function o_(e){return Object.prototype.toString.call(e)==="[object Object]"}class Fw extends pn{constructor(t){super(),this.reviver=t}add(t){let r;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(t);const s=r.type===pr.BINARY_EVENT;s||r.type===pr.BINARY_ACK?(r.type=s?pr.EVENT:pr.ACK,this.reconstructor=new bne(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Bw(t)||t.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let r=0;const s={type:Number(t.charAt(0))};if(pr[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===pr.BINARY_EVENT||s.type===pr.BINARY_ACK){const a=r+1;for(;t.charAt(++r)!=="-"&&r!=t.length;);const o=t.substring(a,r);if(o!=Number(o)||t.charAt(r)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(t.charAt(r+1)==="/"){const a=r+1;for(;++r&&!(t.charAt(r)===","||r===t.length););s.nsp=t.substring(a,r)}else s.nsp="/";const i=t.charAt(r+1);if(i!==""&&Number(i)==i){const a=r+1;for(;++r;){const o=t.charAt(r);if(o==null||Number(o)!=o){--r;break}if(r===t.length)break}s.id=Number(t.substring(a,r+1))}if(t.charAt(++r)){const a=this.tryParse(t.substr(r));if(Fw.isPayloadValid(s.type,a))s.data=a;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,r){switch(t){case pr.CONNECT:return o_(r);case pr.DISCONNECT:return r===void 0;case pr.CONNECT_ERROR:return typeof r=="string"||o_(r);case pr.EVENT:case pr.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&xne.indexOf(r[0])===-1);case pr.ACK:case pr.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class bne{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=mne(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const jne=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Fw,Encoder:vne,get PacketType(){return pr},protocol:yne},Symbol.toStringTag,{value:"Module"}));function Ci(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const wne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class G8 extends pn{constructor(t,r,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Ci(t,"open",this.onopen.bind(this)),Ci(t,"packet",this.onpacket.bind(this)),Ci(t,"error",this.onerror.bind(this)),Ci(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){var s,i,a;if(wne.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(r.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const o={type:pr.EVENT,data:r};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const d=this.ids++,f=r.pop();this._registerAckCallback(d,f),o.id=d}const l=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,r){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=r;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);r.call(this,new Error("operation has timed out"))},i),o=(...l)=>{this.io.clearTimeoutFn(a),r.apply(this,l)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...r){return new Promise((s,i)=>{const a=(o,l)=>o?i(o):s(l);a.withError=!0,r.push(a),this.emit(t,...r)})}_addToQueue(t){let r;typeof t[t.length-1]=="function"&&(r=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...a)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(i)):(this._queue.shift(),r&&r(null,...a)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!t||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:pr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case pr.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pr.EVENT:case pr.BINARY_EVENT:this.onevent(t);break;case pr.ACK:case pr.BINARY_ACK:this.onack(t);break;case pr.DISCONNECT:this.ondisconnect();break;case pr.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const r=t.data||[];t.id!=null&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const s of r)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const r=this;let s=!1;return function(...i){s||(s=!0,r.packet({type:pr.ACK,id:t,data:i}))}}onack(t){const r=this.acks[t.id];typeof r=="function"&&(delete this.acks[t.id],r.withError&&t.data.unshift(null),r.apply(this,t.data))}onconnect(t,r){this.id=t,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:pr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let s=0;s<r.length;s++)if(t===r[s])return r.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const r=this._anyOutgoingListeners;for(let s=0;s<r.length;s++)if(t===r[s])return r.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const s of r)s.apply(this,t.data)}}}function Rd(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Rd.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+r:e-r}return Math.min(e,this.max)|0};Rd.prototype.reset=function(){this.attempts=0};Rd.prototype.setMin=function(e){this.ms=e};Rd.prototype.setMax=function(e){this.max=e};Rd.prototype.setJitter=function(e){this.jitter=e};class n1 extends pn{constructor(t,r){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(r=t,t=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,fx(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((s=r.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Rd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=t;const i=r.parser||jne;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(r=this.backoff)===null||r===void 0||r.setMin(t),this)}randomizationFactor(t){var r;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(r=this.backoff)===null||r===void 0||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(r=this.backoff)===null||r===void 0||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new cne(this.uri,this.opts);const r=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=Ci(r,"open",function(){s.onopen(),t&&t()}),a=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},o=Ci(r,"error",a);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),r.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Ci(t,"ping",this.onping.bind(this)),Ci(t,"data",this.ondata.bind(this)),Ci(t,"error",this.onerror.bind(this)),Ci(t,"close",this.onclose.bind(this)),Ci(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(r){this.onclose("parse error",r)}}ondecoded(t){px(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,r){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new G8(this,t,r),this.nsps[t]=s),s}_destroy(t){const r=Object.keys(this.nsps);for(const s of r)if(this.nsps[s].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let s=0;s<r.length;s++)this.engine.write(r[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,r){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},r);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Zd={};function ph(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const r=dne(e,t.path||"/socket.io"),s=r.source,i=r.id,a=r.path,o=Zd[i]&&a in Zd[i].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let c;return l?c=new n1(s,t):(Zd[i]||(Zd[i]=new n1(s,t)),c=Zd[i]),r.query&&!t.query&&(t.query=r.queryKey),c.socket(r.path,t)}Object.assign(ph,{Manager:n1,Socket:G8,io:ph,connect:ph});const X8=p.createContext(null),Od=()=>p.useContext(X8),Sne=({children:e})=>{const[t,r]=p.useState(null);return p.useEffect(()=>{const i=ph("/",{withCredentials:!0,transports:["websocket","polling"]});return r(i),()=>{i.close()}},[]),n.jsx(X8.Provider,{value:t,children:e})};function kne({templateId:e,templateName:t,currentVersion:r,onClose:s,onSave:i}){const[a,o]=p.useState(!0),[l,c]=p.useState(""),[u,d]=p.useState(!1),[f,h]=p.useState({}),[m,g]=p.useState(0),[x,y]=p.useState([]),[v,S]=p.useState(new Set),[k,j]=p.useState("all"),[_,b]=p.useState(""),[A,z]=p.useState(new Set),[D,w]=p.useState(new Set);p.useEffect(()=>{N()},[e]);const N=async()=>{var P,ce;try{o(!0),c("");const pe=await K.get(`/template-propagation/${e}/assignments`);h(pe.data.groupedByYear||{}),g(pe.data.totalCount||0),y(pe.data.versionsInUse||[]);const ye=new Set;for(const se of Object.values(pe.data.groupedByYear||{}))for(const je of Object.values(se.classes||{}))for(const ve of je.assignments||[])ye.add(ve._id);S(ye),z(new Set(Object.keys(pe.data.groupedByYear||{})))}catch(pe){c(((ce=(P=pe.response)==null?void 0:P.data)==null?void 0:ce.message)||"Erreur lors du chargement")}finally{o(!1)}},$=P=>{const ce=new Set(A);ce.has(P)?ce.delete(P):ce.add(P),z(ce)},E=P=>{const ce=new Set(D);ce.has(P)?ce.delete(P):ce.add(P),w(ce)},q=()=>{const P=new Set;for(const ce of Object.values(f))for(const pe of Object.values(ce.classes))for(const ye of pe.assignments)P.add(ye._id);S(P),j("all")},L=()=>{S(new Set),j("none")},O=(P,ce)=>{const pe=new Set(v),ye=f[P];if(ye)for(const se of Object.values(ye.classes))for(const je of se.assignments)ce?pe.add(je._id):pe.delete(je._id);S(pe),j("custom")},B=(P,ce,pe)=>{var ve;const ye=new Set(v),se=f[P],je=(ve=se==null?void 0:se.classes)==null?void 0:ve[ce];if(je)for(const le of je.assignments)pe?ye.add(le._id):ye.delete(le._id);S(ye),j("custom")},I=P=>{const ce=new Set(v);ce.has(P)?ce.delete(P):ce.add(P),S(ce),j("custom")},T=P=>{const ce=f[P];if(!ce)return!1;for(const pe of Object.values(ce.classes))for(const ye of pe.assignments)if(!v.has(ye._id))return!1;return!0},W=P=>{const ce=f[P];if(!ce)return!1;let pe=!1,ye=!1;for(const se of Object.values(ce.classes))for(const je of se.assignments)v.has(je._id)?pe=!0:ye=!0;return pe&&ye},re=(P,ce)=>{var se;const pe=f[P],ye=(se=pe==null?void 0:pe.classes)==null?void 0:se[ce];if(!ye)return!1;for(const je of ye.assignments)if(!v.has(je._id))return!1;return!0},ae=(P,ce)=>{var ve;const pe=f[P],ye=(ve=pe==null?void 0:pe.classes)==null?void 0:ve[ce];if(!ye)return!1;let se=!1,je=!1;for(const le of ye.assignments)v.has(le._id)?se=!0:je=!0;return se&&je},Y=async()=>{var P,ce;try{d(!0),c("");let pe;k==="all"?pe="all":k==="none"||v.size===0?pe="none":pe=Array.from(v),await i(pe,_||void 0)}catch(pe){c(((ce=(P=pe.response)==null?void 0:P.data)==null?void 0:ce.message)||"Erreur lors de la sauvegarde")}finally{d(!1)}},J=P=>{const pe={draft:{bg:"#fef3c7",color:"#92400e"},in_progress:{bg:"#dbeafe",color:"#1e40af"},completed:{bg:"#d1fae5",color:"#065f46"},signed:{bg:"#e0e7ff",color:"#3730a3"}}[P]||{bg:"#f3f4f6",color:"#4b5563"},ye={draft:"Brouillon",in_progress:"En cours",completed:"Complt",signed:"Sign"};return n.jsx("span",{style:{fontSize:11,padding:"2px 6px",borderRadius:4,background:pe.bg,color:pe.color,fontWeight:500},children:ye[P]||P})};return a?n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:40,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:32,marginBottom:16},children:""}),n.jsx("p",{style:{margin:0,color:"#6b7280"},children:"Chargement des carnets affects..."})]})}):n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:16,width:"90%",maxWidth:800,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[n.jsxs("div",{style:{padding:"24px 28px",borderBottom:"1px solid #e5e7eb",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px 16px 0 0",color:"#fff"},children:[n.jsx("h2",{style:{margin:0,fontSize:22,fontWeight:700},children:" Propagation des modifications"}),n.jsxs("p",{style:{margin:"8px 0 0",fontSize:14,opacity:.9},children:["Template: ",n.jsx("strong",{children:t})," (Version ",r,")"]})]}),n.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:[l&&n.jsxs("div",{style:{padding:"12px 16px",background:"#fee2e2",color:"#dc2626",borderRadius:8,marginBottom:16,fontSize:14},children:[" ",l]}),m===0?n.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:[n.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:""}),n.jsx("p",{style:{margin:0},children:"Aucun carnet n'est affect par ce template."}),n.jsx("p",{style:{margin:"8px 0 0",fontSize:14},children:"Vous pouvez sauvegarder les modifications sans impact."})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:10,padding:16,marginBottom:20},children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[n.jsx("span",{style:{fontSize:24},children:""}),n.jsxs("div",{children:[n.jsxs("p",{style:{margin:0,fontWeight:600,color:"#1e40af",fontSize:15},children:[m," carnet(s) utilisent ce template"]}),n.jsx("p",{style:{margin:"6px 0 0",color:"#3b82f6",fontSize:13},children:"Slectionnez les carnets qui doivent recevoir les nouvelles modifications. Les donnes saisies par les enseignants seront prserves."}),x.length>1&&n.jsxs("p",{style:{margin:"8px 0 0",color:"#6366f1",fontSize:13},children:[" Versions actuellement utilises: ",x.join(", ")]})]})]})}),n.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20},children:[n.jsx("button",{onClick:q,style:{padding:"10px 20px",background:k==="all"?"#4f46e5":"#f3f4f6",color:k==="all"?"#fff":"#374151",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14,transition:"all 0.2s"},children:" Tout slectionner"}),n.jsx("button",{onClick:L,style:{padding:"10px 20px",background:k==="none"?"#4f46e5":"#f3f4f6",color:k==="none"?"#fff":"#374151",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14,transition:"all 0.2s"},children:" Aucun (garder versions actuelles)"})]}),n.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,padding:"10px 14px",background:"#faf5ff",borderRadius:8,border:"1px solid #e9d5ff"},children:n.jsxs("span",{style:{fontSize:14,color:"#7c3aed",fontWeight:500},children:[" ",v.size," sur ",m," carnet(s) slectionn(s)"]})}),n.jsx("div",{style:{marginBottom:20},children:Object.entries(f).map(([P,ce])=>n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,marginBottom:12,overflow:"hidden"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",background:"#f9fafb",cursor:"pointer",borderBottom:A.has(P)?"1px solid #e5e7eb":"none"},onClick:()=>$(P),children:[n.jsx("input",{type:"checkbox",checked:T(P),ref:pe=>{pe&&(pe.indeterminate=W(P))},onChange:pe=>{pe.stopPropagation(),O(P,!T(P))},onClick:pe=>pe.stopPropagation(),style:{width:18,height:18,marginRight:12,cursor:"pointer"}}),n.jsxs("span",{style:{flex:1,fontWeight:600,color:"#111827",fontSize:15},children:[" ",ce.yearName||P]}),n.jsxs("span",{style:{fontSize:12,color:"#6b7280",marginRight:8},children:[Object.values(ce.classes).reduce((pe,ye)=>pe+ye.assignments.length,0)," lves"]}),n.jsx("span",{style:{fontSize:18,color:"#9ca3af"},children:A.has(P)?"":""})]}),A.has(P)&&n.jsx("div",{style:{padding:"8px 0"},children:Object.entries(ce.classes).map(([pe,ye])=>{const se=`${P}-${pe}`;return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 16px 10px 32px",cursor:"pointer",background:D.has(se)?"#f3f4f6":"transparent"},onClick:()=>E(se),children:[n.jsx("input",{type:"checkbox",checked:re(P,pe),ref:je=>{je&&(je.indeterminate=ae(P,pe))},onChange:je=>{je.stopPropagation(),B(P,pe,!re(P,pe))},onClick:je=>je.stopPropagation(),style:{width:16,height:16,marginRight:10,cursor:"pointer"}}),n.jsxs("span",{style:{flex:1,fontWeight:500,color:"#374151",fontSize:14},children:[" ",ye.className,ye.level&&n.jsx("span",{style:{marginLeft:8,fontSize:12,background:"#e0e7ff",color:"#3730a3",padding:"2px 8px",borderRadius:10},children:ye.level})]}),n.jsxs("span",{style:{fontSize:12,color:"#9ca3af",marginRight:8},children:[ye.assignments.length," lve(s)"]}),n.jsx("span",{style:{fontSize:14,color:"#9ca3af"},children:D.has(se)?"":""})]}),D.has(se)&&n.jsx("div",{style:{padding:"4px 0"},children:ye.assignments.map(je=>n.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"8px 16px 8px 56px",cursor:"pointer",background:v.has(je._id)?"#f0fdf4":"transparent",transition:"background 0.15s"},onMouseEnter:ve=>ve.currentTarget.style.background=v.has(je._id)?"#dcfce7":"#f9fafb",onMouseLeave:ve=>ve.currentTarget.style.background=v.has(je._id)?"#f0fdf4":"transparent",children:[n.jsx("input",{type:"checkbox",checked:v.has(je._id),onChange:()=>I(je._id),style:{width:14,height:14,marginRight:10,cursor:"pointer"}}),n.jsxs("span",{style:{flex:1,color:"#4b5563",fontSize:13},children:[" ",je.studentName]}),n.jsxs("span",{style:{fontSize:11,color:"#9ca3af",marginRight:8},children:["v",je.templateVersion]}),je.hasData&&n.jsx("span",{style:{fontSize:10,background:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:4,marginRight:8},children:" Donnes"}),J(je.status)]},je._id))})]},pe)})})]},P))}),n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"#374151",marginBottom:8},children:" Description des modifications (optionnel)"}),n.jsx("textarea",{value:_,onChange:P=>b(P.target.value),placeholder:"Ex: Ajout des colonnes pour le 2me semestre, correction du tableau d'valuation...",style:{width:"100%",padding:12,border:"1px solid #d1d5db",borderRadius:8,resize:"vertical",minHeight:60,fontSize:14,fontFamily:"inherit",boxSizing:"border-box"}})]})]})]}),n.jsxs("div",{style:{padding:"16px 28px",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#f9fafb",borderRadius:"0 0 16px 16px"},children:[n.jsx("button",{onClick:s,disabled:u,style:{padding:"12px 24px",background:"#fff",color:"#374151",border:"1px solid #d1d5db",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14},children:"Annuler"}),n.jsx("button",{onClick:Y,disabled:u,style:{padding:"12px 28px",background:u?"#9ca3af":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",border:"none",borderRadius:8,cursor:u?"not-allowed":"pointer",fontWeight:600,fontSize:14,display:"flex",alignItems:"center",gap:8},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:""}),"Sauvegarde en cours..."]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{children:""}),"Sauvegarder ",v.size>0?`(${v.size} mise(s)  jour)`:"(aucune mise  jour)"]})})]})]})})}function Nne({templateId:e,templateName:t,onClose:r}){const[s,i]=p.useState(!0),[a,o]=p.useState(""),[l,c]=p.useState(""),[u,d]=p.useState(null),[f,h]=p.useState(null),[m,g]=p.useState([]),[x,y]=p.useState(0),[v,S]=p.useState([]),[k,j]=p.useState(new Set),[_,b]=p.useState(new Set),[A,z]=p.useState({});p.useEffect(()=>{D()},[e]),p.useEffect(()=>{if(Object.entries(A).filter(([W,re])=>re!=="idle"&&re!=="rolling").length>0){const W=setTimeout(()=>{z(re=>{const ae={...re};for(const[Y,J]of Object.entries(ae))J!=="rolling"&&(ae[Number(Y)]="idle");return ae})},5e3);return()=>clearTimeout(W)}},[A]);const D=async()=>{var T,W;try{i(!0),o("");const re=await K.get(`/template-propagation/${e}/history`);d(re.data.template),h(re.data.currentVersionInfo),g(re.data.versionHistory||[]),y(re.data.totalAssignments||0),S(re.data.versionsInUse||[]),re.data.currentVersionInfo&&j(new Set([re.data.currentVersionInfo.version]))}catch(re){o(((W=(T=re.response)==null?void 0:T.data)==null?void 0:W.message)||"Erreur lors du chargement de l'historique")}finally{i(!1)}},w=async T=>{const W=A[T]||"idle";W==="idle"?z(re=>({...re,[T]:"confirm1"})):W==="confirm1"?z(re=>({...re,[T]:"confirm2"})):W==="confirm2"&&await N(T)},N=async T=>{var W,re;try{z(ce=>({...ce,[T]:"rolling"})),o(""),c("");const J=((await K.get(`/template-propagation/${e}/assignments`)).data.assignments||[]).filter(ce=>ce.templateVersion>T).map(ce=>ce._id);if(J.length===0){o("Aucun carnet  restaurer vers cette version."),z(ce=>({...ce,[T]:"idle"}));return}const P=await K.post(`/template-propagation/${e}/rollback`,{assignmentIds:J,targetVersion:T});c(` ${P.data.rolledBackCount} carnet(s) restaur(s) vers la version ${T}`),await D(),z(ce=>({...ce,[T]:"idle"})),setTimeout(()=>c(""),5e3)}catch(ae){o(((re=(W=ae.response)==null?void 0:W.data)==null?void 0:re.message)||"Erreur lors de la restauration"),z(Y=>({...Y,[T]:"idle"}))}},$=(T,W)=>{W.stopPropagation(),z(re=>({...re,[T]:"idle"}))},E=T=>{const W={idle:{background:"#fef3c7",color:"#92400e",border:"1px solid #fcd34d"},confirm1:{background:"#fed7aa",color:"#c2410c",border:"1px solid #fdba74"},confirm2:{background:"#fecaca",color:"#dc2626",border:"1px solid #f87171"},rolling:{background:"#dbeafe",color:"#1d4ed8",border:"1px solid #93c5fd"}},re={idle:" Restaurer",confirm1:" Confirmer?",confirm2:" VRAIMENT?",rolling:" En cours..."};return{style:W[T],text:re[T]}},q=T=>{const W=new Set(k);W.has(T)?W.delete(T):W.add(T),j(W)},L=T=>{const W=new Set(_);W.has(T)?W.delete(T):W.add(T),b(W)},O=T=>{if(!T)return"Date inconnue";try{return new Date(T).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return T}},B=(T,W)=>{const re=Object.entries(T);return re.length===0?n.jsx("div",{style:{padding:"16px",background:"#f9fafb",borderRadius:8,color:"#6b7280",textAlign:"center",fontSize:13},children:" Aucun carnet n'utilise cette version"}):n.jsx("div",{style:{marginTop:12},children:re.map(([ae,Y])=>{const J=`${W}-${ae}`,P=_.has(J),ce=Object.values(Y.classes).reduce((pe,ye)=>pe+ye.count,0);return n.jsxs("div",{style:{background:"#f9fafb",borderRadius:8,marginBottom:8,overflow:"hidden",border:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 12px",cursor:"pointer",background:"#fff"},onClick:()=>L(J),children:[n.jsx("span",{style:{fontSize:16,marginRight:8},children:""}),n.jsx("span",{style:{flex:1,fontWeight:500,color:"#374151",fontSize:14},children:Y.yearName}),n.jsxs("span",{style:{fontSize:12,background:"#dbeafe",color:"#1d4ed8",padding:"2px 8px",borderRadius:10,marginRight:8},children:[ce," lve(s)"]}),n.jsx("span",{style:{fontSize:14,color:"#9ca3af"},children:P?"":""})]}),P&&n.jsx("div",{style:{padding:"8px 12px 12px"},children:Object.entries(Y.classes).map(([pe,ye])=>n.jsxs("div",{style:{padding:"8px 12px",background:"#fff",borderRadius:6,marginBottom:6,border:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:6},children:[n.jsx("span",{style:{fontSize:14,marginRight:8},children:""}),n.jsx("span",{style:{fontWeight:500,color:"#4b5563",fontSize:13},children:ye.className}),ye.level&&n.jsx("span",{style:{marginLeft:8,fontSize:11,background:"#e0e7ff",color:"#3730a3",padding:"2px 6px",borderRadius:8},children:ye.level}),n.jsxs("span",{style:{marginLeft:"auto",fontSize:12,color:"#6b7280"},children:[ye.count," lve(s)"]})]}),n.jsxs("div",{style:{fontSize:12,color:"#9ca3af",lineHeight:1.5},children:[" ",ye.students.slice(0,5).join(", "),ye.students.length>5&&n.jsxs("span",{style:{color:"#6b7280"},children:[" ","et ",ye.students.length-5," autre(s)"]})]})]},pe))})]},ae)})})},I=T=>{const W=A[T]||"idle",{style:re,text:ae}=E(W),Y=W!=="idle"&&W!=="rolling";return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Y&&n.jsx("button",{onClick:J=>$(T,J),style:{padding:"4px 10px",background:"#f3f4f6",color:"#6b7280",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:500},children:" Annuler"}),n.jsx("button",{onClick:J=>{J.stopPropagation(),w(T)},disabled:W==="rolling",style:{padding:"4px 12px",...re,borderRadius:6,cursor:W==="rolling"?"not-allowed":"pointer",fontSize:12,fontWeight:600,transition:"all 0.2s",animation:W==="confirm2"?"pulse 0.5s infinite":"none"},children:ae})]})};return s?n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:40,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:32,marginBottom:16},children:""}),n.jsx("p",{style:{margin:0,color:"#6b7280"},children:"Chargement de l'historique..."})]})}):n.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:[n.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { opacity: 1; transform: scale(1); }
                    50% { opacity: 0.8; transform: scale(1.02); }
                }
            `}),n.jsxs("div",{style:{background:"#fff",borderRadius:16,width:"90%",maxWidth:800,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[n.jsxs("div",{style:{padding:"24px 28px",borderBottom:"1px solid #e5e7eb",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",borderRadius:"16px 16px 0 0",color:"#fff"},children:[n.jsx("h2",{style:{margin:0,fontSize:22,fontWeight:700,display:"flex",alignItems:"center",gap:10},children:" Historique des versions"}),n.jsx("p",{style:{margin:"8px 0 0",fontSize:14,opacity:.9},children:t})]}),n.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:[a&&n.jsxs("div",{style:{padding:"12px 16px",background:"#fee2e2",color:"#dc2626",borderRadius:8,marginBottom:16,fontSize:14},children:[" ",a]}),l&&n.jsx("div",{style:{padding:"12px 16px",background:"#d1fae5",color:"#065f46",borderRadius:8,marginBottom:16,fontSize:14,fontWeight:500},children:l}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16,marginBottom:24},children:[n.jsxs("div",{style:{background:"#eff6ff",borderRadius:12,padding:16,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#2563eb"},children:(u==null?void 0:u.currentVersion)||1}),n.jsx("div",{style:{fontSize:12,color:"#3b82f6",marginTop:4},children:"Version actuelle"})]}),n.jsxs("div",{style:{background:"#f0fdf4",borderRadius:12,padding:16,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#16a34a"},children:x}),n.jsx("div",{style:{fontSize:12,color:"#22c55e",marginTop:4},children:"Carnets affects"})]}),n.jsxs("div",{style:{background:"#faf5ff",borderRadius:12,padding:16,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#9333ea"},children:v.length}),n.jsx("div",{style:{fontSize:12,color:"#a855f7",marginTop:4},children:"Version(s) utilise(s)"})]})]}),n.jsx("div",{style:{background:"#fffbeb",border:"1px solid #fcd34d",borderRadius:10,padding:14,marginBottom:20},children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:10},children:[n.jsx("span",{style:{fontSize:20},children:""}),n.jsxs("div",{children:[n.jsx("p",{style:{margin:0,fontWeight:600,color:"#92400e",fontSize:14},children:"Restauration vers une version antrieure"}),n.jsxs("p",{style:{margin:"6px 0 0",color:"#a16207",fontSize:13},children:['Cliquez 3 fois sur "Restaurer" pour revenir  une version prcdente. Cette action dplacera tous les carnets des versions plus rcentes vers la version slectionne.',n.jsx("strong",{children:" Les donnes saisies par les enseignants seront prserves."})]})]})]})}),f&&n.jsxs("div",{style:{border:"2px solid #10b981",borderRadius:12,marginBottom:16,overflow:"hidden"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"14px 16px",background:"#ecfdf5",cursor:"pointer"},onClick:()=>q(f.version),children:[n.jsxs("div",{style:{background:"#10b981",color:"#fff",padding:"4px 10px",borderRadius:6,fontWeight:700,fontSize:14,marginRight:12},children:["v",f.version]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:600,color:"#065f46",fontSize:15},children:" Version actuelle"}),n.jsxs("div",{style:{fontSize:12,color:"#047857",marginTop:2},children:[f.assignmentCount," carnet(s) utilisent cette version"]})]}),n.jsx("span",{style:{fontSize:16,color:"#10b981"},children:k.has(f.version)?"":""})]}),k.has(f.version)&&n.jsx("div",{style:{padding:"12px 16px",background:"#fff"},children:B(f.distribution,f.version)})]}),m.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{fontSize:16,fontWeight:600,color:"#374151",marginBottom:12,display:"flex",alignItems:"center",gap:8},children:" Historique des modifications"}),m.map(T=>T.version===(u==null?void 0:u.currentVersion)?null:n.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,marginBottom:10,overflow:"hidden",opacity:T.assignmentCount===0?.7:1},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 14px",background:"#f9fafb",cursor:"pointer"},onClick:()=>q(T.version),children:[n.jsxs("div",{style:{background:T.assignmentCount>0?"#3b82f6":"#9ca3af",color:"#fff",padding:"3px 8px",borderRadius:5,fontWeight:600,fontSize:13,marginRight:12},children:["v",T.version]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:500,color:"#374151",fontSize:14},children:T.changeDescription}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280",marginTop:2},children:[" ",O(T.createdAt),T.assignmentCount>0&&n.jsxs("span",{style:{marginLeft:12},children:[" ",T.assignmentCount," carnet(s)"]})]})]}),I(T.version),n.jsx("span",{style:{fontSize:14,color:"#9ca3af",marginLeft:10},children:k.has(T.version)?"":""})]}),k.has(T.version)&&n.jsx("div",{style:{padding:"12px 14px",background:"#fff"},children:B(T.distribution,T.version)})]},T.version))]}),m.length===0&&!f&&n.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:[n.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:""}),n.jsx("p",{style:{margin:0},children:"Aucun historique disponible pour ce template."})]})]}),n.jsx("div",{style:{padding:"16px 28px",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"flex-end",background:"#f9fafb",borderRadius:"0 0 16px 16px"},children:n.jsx("button",{onClick:r,style:{padding:"12px 28px",background:"#6366f1",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14},children:"Fermer"})})]})]})}function Cne({templateId:e,templateName:t,currentVersion:r,onClose:s,onRestore:i}){const[a,o]=p.useState(!0),[l,c]=p.useState(""),[u,d]=p.useState([]),[f,h]=p.useState(null);p.useEffect(()=>{m()},[e]);const m=async()=>{var y,v;try{o(!0),c("");const S=await K.get(`/templates/${e}/state-history`);d(S.data.versionHistory||[])}catch(S){c(((v=(y=S.response)==null?void 0:y.data)==null?void 0:v.message)||"Erreur lors du chargement de l'historique")}finally{o(!1)}},g=y=>{if(!y)return"Date inconnue";try{return new Date(y).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return y}},x=y=>{if(!y)return"";try{const v=new Date(y),k=new Date().getTime()-v.getTime(),j=Math.floor(k/6e4),_=Math.floor(j/60),b=Math.floor(_/24);return j<1?" l'instant":j<60?`Il y a ${j} min`:_<24?`Il y a ${_}h`:b<7?`Il y a ${b} jour${b>1?"s":""}`:g(y)}catch{return""}};return a?n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:40,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:32,marginBottom:16},children:""}),n.jsx("p",{style:{margin:0,color:"#6b7280"},children:"Chargement de l'historique du template..."})]})}):n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:16,width:"90%",maxWidth:700,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[n.jsxs("div",{style:{padding:"24px 28px",borderBottom:"1px solid #e5e7eb",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",borderRadius:"16px 16px 0 0",color:"#fff"},children:[n.jsx("h2",{style:{margin:0,fontSize:22,fontWeight:700,display:"flex",alignItems:"center",gap:10},children:" Template History"}),n.jsxs("p",{style:{margin:"8px 0 0",fontSize:14,opacity:.9},children:[t," - Version actuelle: v",r]})]}),n.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:[l&&n.jsxs("div",{style:{padding:"12px 16px",background:"#fee2e2",color:"#dc2626",borderRadius:8,marginBottom:16,fontSize:14},children:[" ",l]}),n.jsx("div",{style:{background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:10,padding:14,marginBottom:20},children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:10},children:[n.jsx("span",{style:{fontSize:20},children:""}),n.jsxs("div",{children:[n.jsx("p",{style:{margin:0,fontWeight:600,color:"#1e40af",fontSize:14},children:"Historique des sauvegardes du template"}),n.jsx("p",{style:{margin:"6px 0 0",color:"#3b82f6",fontSize:13},children:"Cet historique montre toutes les versions sauvegardes du template, incluant les sauvegardes manuelles et automatiques."})]})]})}),u.length===0?n.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:[n.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:""}),n.jsx("p",{style:{margin:0},children:"Aucun historique disponible pour ce template."}),n.jsx("p",{style:{margin:"8px 0 0",fontSize:13,color:"#9ca3af"},children:"L'historique commence  s'enregistrer aprs la premire sauvegarde avec des affectations."})]}):n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:u.map((y,v)=>{const S=y.version===r,k=f===y.version;return n.jsxs("div",{style:{border:S?"2px solid #10b981":"1px solid #e5e7eb",borderRadius:12,overflow:"hidden",background:S?"#f0fdf4":"#fff"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"14px 16px",cursor:"pointer",gap:12},onClick:()=>h(k?null:y.version),children:[n.jsxs("div",{style:{background:S?"#10b981":"#6b7280",color:"#fff",padding:"4px 10px",borderRadius:6,fontWeight:700,fontSize:14},children:["v",y.version]}),n.jsx("div",{style:{background:y.saveType==="auto"?"#fef3c7":"#dbeafe",color:y.saveType==="auto"?"#d97706":"#2563eb",padding:"2px 8px",borderRadius:10,fontSize:11,fontWeight:600},children:y.saveType==="auto"?" Auto":" Manuel"}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:600,color:"#374151",fontSize:14},children:y.changeDescription||(S?" Version actuelle":"Sauvegarde")}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280",marginTop:2},children:[" ",x(y.createdAt),y.createdByName&&n.jsxs("span",{style:{marginLeft:12},children:[" ",y.createdByName]})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,fontSize:11,color:"#9ca3af"},children:[n.jsxs("span",{children:[" ",y.pageCount," pages"]}),n.jsxs("span",{children:[" ",y.blockCount," blocs"]})]}),n.jsx("span",{style:{fontSize:14,color:"#9ca3af"},children:k?"":""})]}),k&&n.jsxs("div",{style:{padding:"12px 16px",background:"#f9fafb",borderTop:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[n.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8,border:"1px solid #e5e7eb"},children:[n.jsx("div",{style:{fontSize:11,color:"#6b7280",marginBottom:4},children:"Date de sauvegarde"}),n.jsx("div",{style:{fontWeight:500,color:"#374151",fontSize:13},children:g(y.createdAt)})]}),n.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8,border:"1px solid #e5e7eb"},children:[n.jsx("div",{style:{fontSize:11,color:"#6b7280",marginBottom:4},children:"Sauvegard par"}),n.jsx("div",{style:{fontWeight:500,color:"#374151",fontSize:13},children:y.createdByName||y.createdBy||"Inconnu"})]})]}),!S&&i&&n.jsx("button",{onClick:()=>i(y.version),style:{width:"100%",padding:"10px 16px",background:"#fef3c7",color:"#92400e",border:"1px solid #fcd34d",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:13,display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:" Restaurer cette version"})]})]},y.version)})})]}),n.jsx("div",{style:{padding:"16px 28px",borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"flex-end",background:"#f9fafb",borderRadius:"0 0 16px 16px"},children:n.jsx("button",{onClick:s,style:{padding:"12px 28px",background:"#3b82f6",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14},children:"Fermer"})})]})})}const _ne=({imageUrl:e,imageWidth:t,imageHeight:r,initialCrop:s,onApply:i,onCancel:a})=>{const[o,l]=p.useState(s||null),[c,u]=p.useState(null),[d,f]=p.useState(null),h=p.useRef(null);p.useEffect(()=>{const k=new Image;k.onload=()=>{const j=k.naturalWidth,_=k.naturalHeight;if(f({width:j,height:_}),s){l({x:s.x,y:s.y,width:s.width,height:s.height,naturalWidth:s.naturalWidth??j,naturalHeight:s.naturalHeight??_});return}l({x:0,y:0,width:j,height:_,naturalWidth:j,naturalHeight:_})},k.src=e},[e,s]);const m=(k,j)=>{k.stopPropagation(),k.preventDefault(),o&&(u(j),h.current={x:k.clientX,y:k.clientY,crop:{...o}})};if(p.useEffect(()=>{if(!c||!d||!h.current)return;const k=t/d.width,j=b=>{if(!h.current)return;const A=(b.clientX-h.current.x)/k,z=(b.clientY-h.current.y)/k,D=h.current.crop;let w={...D};const N=20/k;switch(c){case"n":w.y=Math.max(0,Math.min(D.y+z,D.y+D.height-N)),w.height=D.height-(w.y-D.y);break;case"s":w.height=Math.max(N,Math.min(D.height+z,d.height-D.y));break;case"w":w.x=Math.max(0,Math.min(D.x+A,D.x+D.width-N)),w.width=D.width-(w.x-D.x);break;case"e":w.width=Math.max(N,Math.min(D.width+A,d.width-D.x));break;case"nw":w.x=Math.max(0,Math.min(D.x+A,D.x+D.width-N)),w.y=Math.max(0,Math.min(D.y+z,D.y+D.height-N)),w.width=D.width-(w.x-D.x),w.height=D.height-(w.y-D.y);break;case"ne":w.y=Math.max(0,Math.min(D.y+z,D.y+D.height-N)),w.width=Math.max(N,Math.min(D.width+A,d.width-D.x)),w.height=D.height-(w.y-D.y);break;case"sw":w.x=Math.max(0,Math.min(D.x+A,D.x+D.width-N)),w.width=D.width-(w.x-D.x),w.height=Math.max(N,Math.min(D.height+z,d.height-D.y));break;case"se":w.width=Math.max(N,Math.min(D.width+A,d.width-D.x)),w.height=Math.max(N,Math.min(D.height+z,d.height-D.y));break}l({...w,naturalWidth:D.naturalWidth??d.width,naturalHeight:D.naturalHeight??d.height})},_=()=>{u(null)};return window.addEventListener("mousemove",j),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",_)}},[c,d,t]),!d||!o)return null;const g=t/d.width,x={x:o.x*g,y:o.y*g,width:o.width*g,height:o.height*g},y=k=>({position:"absolute",background:"#fff",border:"2px solid #667eea",borderRadius:2,zIndex:10,cursor:k}),v=10,S=6;return n.jsxs("div",{style:{position:"absolute",top:0,left:0,width:t,height:r,pointerEvents:"none"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,width:t,height:x.y,background:"rgba(0,0,0,0.5)"}}),n.jsx("div",{style:{position:"absolute",top:x.y,left:0,width:x.x,height:x.height,background:"rgba(0,0,0,0.5)"}}),n.jsx("div",{style:{position:"absolute",top:x.y,left:x.x+x.width,width:t-x.x-x.width,height:x.height,background:"rgba(0,0,0,0.5)"}}),n.jsx("div",{style:{position:"absolute",top:x.y+x.height,left:0,width:t,height:r-x.y-x.height,background:"rgba(0,0,0,0.5)"}}),n.jsx("div",{style:{position:"absolute",top:x.y,left:x.x,width:x.width,height:x.height,border:"2px dashed #667eea",boxSizing:"border-box",pointerEvents:"none"}}),n.jsx("div",{style:{...y("nw-resize"),top:x.y-v/2,left:x.x-v/2,width:v,height:v,pointerEvents:"auto"},onMouseDown:k=>m(k,"nw")}),n.jsx("div",{style:{...y("ne-resize"),top:x.y-v/2,left:x.x+x.width-v/2,width:v,height:v,pointerEvents:"auto"},onMouseDown:k=>m(k,"ne")}),n.jsx("div",{style:{...y("sw-resize"),top:x.y+x.height-v/2,left:x.x-v/2,width:v,height:v,pointerEvents:"auto"},onMouseDown:k=>m(k,"sw")}),n.jsx("div",{style:{...y("se-resize"),top:x.y+x.height-v/2,left:x.x+x.width-v/2,width:v,height:v,pointerEvents:"auto"},onMouseDown:k=>m(k,"se")}),n.jsx("div",{style:{...y("n-resize"),top:x.y-S/2,left:x.x+x.width/2-15,width:30,height:S,pointerEvents:"auto"},onMouseDown:k=>m(k,"n")}),n.jsx("div",{style:{...y("s-resize"),top:x.y+x.height-S/2,left:x.x+x.width/2-15,width:30,height:S,pointerEvents:"auto"},onMouseDown:k=>m(k,"s")}),n.jsx("div",{style:{...y("w-resize"),top:x.y+x.height/2-15,left:x.x-S/2,width:S,height:30,pointerEvents:"auto"},onMouseDown:k=>m(k,"w")}),n.jsx("div",{style:{...y("e-resize"),top:x.y+x.height/2-15,left:x.x+x.width-S/2,width:S,height:30,pointerEvents:"auto"},onMouseDown:k=>m(k,"e")}),n.jsxs("div",{style:{position:"absolute",top:x.y+x.height+8,left:x.x+x.width/2,transform:"translateX(-50%)",display:"flex",gap:8,pointerEvents:"auto"},children:[n.jsx("button",{onClick:k=>{k.stopPropagation(),a()},style:{padding:"6px 12px",background:"#666",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12,fontWeight:500},children:"Annuler"}),n.jsx("button",{onClick:k=>{k.stopPropagation(),i(o)},style:{padding:"6px 12px",background:"#667eea",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12,fontWeight:600},children:" Appliquer"})]})]})},ga=800,no=1120,l_="livret:expanded-table-designs:v1",fh="rgba(255, 255, 255, 0.2)",c_=e=>{const t=e&&typeof e=="object"?e:{};return{rowGap:Number(t.rowGap||0),colGap:Number(t.colGap||0),borderRadius:Number(t.borderRadius||0),fontSize:Number(t.fontSize||12),textColor:String(t.textColor||"#000000"),borderColor:String(t.borderColor||"#000000"),borderWidth:Number(t.borderWidth??1),expandedRowHeight:Number(t.expandedRowHeight||34),expandedToggleStyle:String(t.expandedToggleStyle||"v2"),expandedDividerWidth:Number(t.expandedDividerWidth||.5),expandedDividerColor:String(t.expandedDividerColor||fh),expandedTopGap:Number(t.expandedTopGap||0)}},_y=e=>{const t=e==null?void 0:e.cells;if(!Array.isArray(t))return{color:"#000000",width:1,found:!1};for(const r of t)if(Array.isArray(r))for(const s of r){const i=s==null?void 0:s.borders;if(!(!i||typeof i!="object"))for(const a of["l","r","t","b"]){const o=i==null?void 0:i[a];if(o&&typeof o=="object"&&("width"in o||"color"in o))return{color:String((o==null?void 0:o.color)||"#000000"),width:Number((o==null?void 0:o.width)??0),found:!0}}}return{color:"#000000",width:1,found:!1}};function Ane(){var Uw;const e=Sn(),t=wn(),{levels:r}=la(),{activeYearId:s}=Yn(),[i,a]=p.useState("list"),[o,l]=p.useState({name:"Nouveau Template",pages:[{title:"Page 1",blocks:[]}]}),[c,u]=p.useState(""),[d,f]=p.useState(""),[h,m]=p.useState([]),[g,x]=p.useState([]),[y,v]=p.useState([]),[S,k]=p.useState(""),[j,_]=p.useState(0),[b,A]=p.useState(null),[z,D]=p.useState([]),[w,N]=p.useState([]),[$,E]=p.useState(1),[q,L]=p.useState(!0),O=p.useRef(null),[B,I]=p.useState(!0),[T,W]=p.useState(null),[re,ae]=p.useState("#000000"),[Y,J]=p.useState(1),[P,ce]=p.useState([]),[pe,ye]=p.useState(""),[se,je]=p.useState(""),[ve,le]=p.useState([]),[oe,de]=p.useState(""),[Pe,Z]=p.useState(!0),[ne,ee]=p.useState({}),[te,G]=p.useState("properties"),[H,ie]=p.useState({}),[me,ke]=p.useState([]),[Be,Te]=p.useState(null),qe=p.useRef(!1),[Qe,Ze]=p.useState(null),ge=p.useRef(null),Ae=p.useRef(!1),[Le,Q]=p.useState(null),[be,we]=p.useState(!0),Ne=p.useRef(null),V=p.useRef(""),fe=p.useRef(""),Oe=5*60*1e3,[Fe,Ve]=p.useState([]),[tt,Wt]=p.useState(-1),Ct=p.useRef(!1),Ot=p.useRef(""),et=p.useMemo(()=>JSON.stringify(o),[o]),nt=i==="edit"&&V.current!==""&&et!==V.current;p.useEffect(()=>{if(i!=="edit")return;const C=(o==null?void 0:o._id)||"";C&&fe.current!==C&&(fe.current=C,V.current=et)},[i,o==null?void 0:o._id,et]),p.useEffect(()=>{if(!nt)return;const C=F=>{F.preventDefault(),F.returnValue=""};return window.addEventListener("beforeunload",C),()=>window.removeEventListener("beforeunload",C)},[nt]);const ft=p.useRef("");p.useEffect(()=>{ft.current=typeof window<"u"?window.location.href:""},[t]),p.useEffect(()=>{if(!nt)return;const C=(X,ue)=>{if(ue.defaultPrevented||ue.button!==0||ue.metaKey||ue.ctrlKey||ue.shiftKey||ue.altKey)return!0;const U=(X.getAttribute("target")||"").toLowerCase();if(U&&U!=="_self"||X.hasAttribute("download"))return!0;const Ke=X.getAttribute("href")||"";return!!(!Ke||Ke.startsWith("mailto:")||Ke.startsWith("tel:")||Ke.startsWith("javascript:"))},F=X=>{var Ke;const ue=X.target,U=(Ke=ue==null?void 0:ue.closest)==null?void 0:Ke.call(ue,"a[href]");if(U&&!C(U,X))try{const he=U.getAttribute("href")||"";if(new URL(he,window.location.href).origin!==window.location.origin)return;window.confirm("Vous avez des modifications non enregistres. Quitter sans sauvegarder ?")||(X.preventDefault(),X.stopPropagation())}catch{return}},M=()=>{if(!window.confirm("Vous avez des modifications non enregistres. Quitter sans sauvegarder ?"))try{window.history.pushState(null,"",ft.current||window.location.href)}catch{}};return document.addEventListener("click",F,!0),window.addEventListener("popstate",M),()=>{document.removeEventListener("click",F,!0),window.removeEventListener("popstate",M)}},[nt]),p.useEffect(()=>{var C;try{const F=localStorage.getItem(l_);if(!F)return;const M=JSON.parse(F);if(Array.isArray(M)){const X=M.filter(ue=>ue&&typeof ue=="object").map(ue=>({id:String(ue.id||""),name:String(ue.name||""),style:c_(ue.style)})).filter(ue=>ue.id&&ue.name&&ue.style);ce(X),!pe&&((C=X[0])!=null&&C.id)&&ye(X[0].id)}}catch{}},[]),p.useEffect(()=>{var M,X,ue,U;if(b==null){Ot.current="";return}const C=(ue=(X=(M=o.pages)==null?void 0:M[j])==null?void 0:X.blocks)==null?void 0:ue[b];if(!C)return;const F=(U=C==null?void 0:C.props)!=null&&U.blockId?String(C.props.blockId):`${j}:${b}`;if(F!==Ot.current&&(Ot.current=F,C.type==="table")){const Ke=_y(C.props);ae(Ke.color),J(Ke.width)}},[b,j,o]);const vt=()=>{if(tt>=0){if(Ct.current=!0,tt===Fe.length-1){const C=[...Fe];if(JSON.stringify(C[C.length-1])!==JSON.stringify(o)){C.push(JSON.parse(JSON.stringify(o))),Ve(C),Wt(C.length-2),l(C[C.length-2]),Ct.current=!1;return}}if(tt>0){const C=tt-1;l(Fe[C]),Wt(C)}Ct.current=!1}},Zt=()=>{if(tt<Fe.length-1){Ct.current=!0;const C=tt+1;l(Fe[C]),Wt(C),Ct.current=!1}};p.useEffect(()=>{if(!q||!O.current)return;const C=new ResizeObserver(F=>{for(const M of F){const X=M.contentRect.width;if(X>0){const U=(X-48)/ga;E(Math.max(.1,U))}}});return C.observe(O.current),()=>C.disconnect()},[q]),p.useEffect(()=>{Fe.length===0&&o&&(Ve([JSON.parse(JSON.stringify(o))]),Wt(0))},[]);const Se=(C,F=!1)=>{if(!F&&!Ct.current){const M=Fe.slice(0,tt+1);M.push(JSON.parse(JSON.stringify(C))),M.length>50&&M.shift(),Ve(M),Wt(M.length-1)}l(C)},[Ie,Re]=p.useState(""),ht=p.useRef(null),Et=p.useRef(null),Mt=Od(),St=p.useRef(!1),ir=p.useRef(!1),$e=C=>{const F=(C.pages||[]).map(M=>({...M,blocks:(M.blocks||[]).map(X=>{const ue=X?{...X,props:X.props??{}}:{type:"unknown",props:{}};if(ue.props.blockId||(ue.props.blockId=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11)),ue.type==="table"){const U=he=>{const Ee=typeof he=="number"?he:parseFloat(String(he||"0"));return isNaN(Ee)?0:Ee},Ke={...ue.props};return Ke.rowGap=U(Ke.rowGap),Ke.colGap=U(Ke.colGap),Ke.expandedRowHeight=U(Ke.expandedRowHeight),Ke.expandedDividerWidth=U(Ke.expandedDividerWidth),Ke.columnWidths=(Ke.columnWidths||[]).map(he=>U(he)),Ke.rowHeights=(Ke.rowHeights||[]).map(he=>U(he)),{...ue,props:Ke}}return ue})}));return{...C,pages:F}},He=async C=>{var X;const F=(X=C.target.files)==null?void 0:X[0];if(!F)return;const M=new FormData;M.append("file",F);try{de("Importation en cours..."),await K.post("/templates/import-package",M),de("Import avec succs"),await ua()}catch(ue){console.error(ue),Re("chec de l'importation"),de("")}Et.current&&(Et.current.value="")},Ge=async C=>{var F,M,X;try{de("Exportation en cours...");const ue=await K.get(`/templates/${C}/export-package`);if(console.log("Export response:",ue),ue.data&&ue.data.success){let U=`Export russi : ${ue.data.fileName} (dans ${ue.data.path})`;ue.data.existed&&(U=`Export mis  jour (cras) : ${ue.data.fileName}`),de(U);try{await Kn()}catch{}}else throw console.error("Export failed response:",ue),new Error(((F=ue.data)==null?void 0:F.message)||"Export failed");setTimeout(()=>de(""),8e3)}catch(ue){console.error("Export exception:",ue);const U=((X=(M=ue.response)==null?void 0:M.data)==null?void 0:X.message)||ue.message||"Erreur lors de l'export";Re(U),de("")}};p.useEffect(()=>{if(i==="edit"&&o._id&&Mt){Mt.emit("join-template",o._id);const C=F=>{ir.current||(St.current=!0,l($e(F)))};return Mt.on("template-updated",C),()=>{Mt.emit("leave-template",o._id),Mt.off("template-updated",C)}}},[i,o._id,Mt]),p.useEffect(()=>{if(i==="edit"&&o._id&&Mt){if(St.current){St.current=!1;return}ir.current=!0;const C=setTimeout(()=>{Mt.emit("update-template",{templateId:o._id,template:o}),ir.current=!1},500);return()=>{clearTimeout(C)}}},[o,i,Mt]),p.useEffect(()=>{if(i!=="edit"||!o._id||!be){Ne.current&&(clearInterval(Ne.current),Ne.current=null);return}return Ne.current=setInterval(async()=>{const C=JSON.stringify(o);if(C!==V.current)try{(await K.get(`/template-propagation/${o._id}/assignments`)).data.totalCount>0?await K.patch(`/template-propagation/${o._id}`,{templateData:o,propagateToAssignmentIds:"all",changeDescription:`Auto-save ${new Date().toLocaleString("fr-FR")}`,saveType:"auto"}):await K.patch(`/templates/${o._id}`,{...o,saveType:"auto"}),V.current=C,de(" Auto-saved"),setTimeout(()=>de(""),2e3)}catch(F){console.error("[AutoSave] Error:",F)}},Oe),()=>{Ne.current&&(clearInterval(Ne.current),Ne.current=null)}},[i,o._id,be,o]),p.useEffect(()=>{const C=F=>{if(i!=="edit")return;const M=F.target,X=!!M&&(M.tagName==="INPUT"||M.tagName==="TEXTAREA"||M.tagName==="SELECT"||M.isContentEditable);if(!X&&(F.ctrlKey||F.metaKey)&&F.key==="z"&&!F.shiftKey&&(F.preventDefault(),vt()),!X&&(F.ctrlKey||F.metaKey)&&(F.key==="y"||F.shiftKey&&F.key==="z")&&(F.preventDefault(),Zt()),!X&&(F.ctrlKey||F.metaKey)&&F.key==="c"&&(F.preventDefault(),is()),!X&&(F.ctrlKey||F.metaKey)&&F.key==="v"&&(Ae.current=!1,setTimeout(()=>{Ae.current||vi()},0)),(F.key==="Delete"||F.key==="Backspace")&&!["INPUT","TEXTAREA"].includes(F.target.tagName)&&!F.target.isContentEditable&&(b!==null||z.length>0)){F.preventDefault();const ue=[...o.pages],U={...ue[j]},Ke=new Set(z);b!==null&&Ke.add(b);const he=U.blocks.filter((Ee,Ue)=>!Ke.has(Ue));ue[j]={...U,blocks:he},Se({...o,pages:ue}),A(null),D([])}};return window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)},[tt,Fe,i,vt,Zt,o,j,b,z,Be]),p.useEffect(()=>{const C=F=>{var Ke;if(i!=="edit")return;const M=F.target;if(!!M&&(M.tagName==="INPUT"||M.tagName==="TEXTAREA"||M.tagName==="SELECT"||M.isContentEditable))return;const ue=(Ke=F.clipboardData)==null?void 0:Ke.items;if(!ue||ue.length===0)return;const U=[];for(const he of Array.from(ue))if(he.kind==="file"){const Ee=he.getAsFile();Ee&&U.push(Ee)}U.length!==0&&U.some(da)&&(Ae.current=!0,F.preventDefault(),yi(U))};return window.addEventListener("paste",C),()=>window.removeEventListener("paste",C)},[i,o,j]);const[R,_e]=p.useState(!1),[We,jt]=p.useState(""),[Ht,Yt]=p.useState(!1),[_t,mr]=p.useState(!1),[yr,Kt]=p.useState(!1),[Sr,Me]=p.useState(!1),[rt,wt]=p.useState(!1),[ut,Bt]=p.useState([]),[gt,yt]=p.useState(!1),[bt,$t]=p.useState(null),[xe,pt]=p.useState(null),at=p.useMemo(()=>[{type:"text",props:{text:"Titre",fontSize:20,color:"#333"}},{type:"image",props:{url:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Eo_circle_pink_blank.svg/120px-Eo_circle_pink_blank.svg.png",width:120,height:120}},{type:"table",props:{x:100,y:100,columnWidths:[120,160],rowHeights:[40,40],cells:[[{text:"A1",fontSize:12,color:"#000",fill:"#fff",borders:{l:{color:"#000",width:1},r:{color:"#000",width:1},t:{color:"#000",width:1},b:{color:"#000",width:1}}},{text:"B1",fontSize:12,color:"#000",fill:"#fff",borders:{l:{color:"#000",width:1},r:{color:"#000",width:1},t:{color:"#000",width:1},b:{color:"#000",width:1}}}],[{text:"A2",fontSize:12,color:"#000",fill:"#fff",borders:{l:{color:"#000",width:1},r:{color:"#000",width:1},t:{color:"#000",width:1},b:{color:"#000",width:1}}},{text:"B2",fontSize:12,color:"#000",fill:"#fff",borders:{l:{color:"#000",width:1},r:{color:"#000",width:1},t:{color:"#000",width:1},b:{color:"#000",width:1}}}]]}},{type:"qr",props:{url:"https://example.com",width:120,height:120}},{type:"line",props:{x2:300,y2:0,stroke:"#b2bec3",strokeWidth:2}},{type:"arrow",props:{x2:120,y2:0,stroke:"#6c5ce7",strokeWidth:2}},{type:"rect",props:{width:160,height:80,color:"#eef1f7"}},{type:"circle",props:{radius:60,color:"#ffeaa7"}},{type:"student_photo",props:{width:100,height:100}},{type:"promotion_info",props:{field:"student",width:200,height:30,fontSize:12,color:"#2d3436",label:"Nom de l'lve"}},{type:"promotion_info",props:{field:"studentFirstName",width:120,height:30,fontSize:12,color:"#2d3436",label:"Prnom"}},{type:"promotion_info",props:{field:"studentLastName",width:120,height:30,fontSize:12,color:"#2d3436",label:"Nom de famille"}},{type:"teacher_text",props:{width:300,height:60,fontSize:12,color:"#2d3436",label:"Zone de texte prof",placeholder:"Texte ditable par le prof polyvalent..."}},{type:"promotion_info",props:{field:"currentLevel",width:100,height:30,fontSize:12,color:"#2d3436",label:"Niveau Actuel"}},{type:"promotion_info",props:{field:"class",width:100,height:30,fontSize:12,color:"#2d3436",label:"Classe"}},{type:"promotion_info",props:{field:"level",width:150,height:30,fontSize:12,color:"#2d3436",label:"Niveau Suivant (Passage)"}},{type:"promotion_info",props:{field:"year",width:120,height:30,fontSize:12,color:"#2d3436",label:"Anne Suivante"}},{type:"promotion_info",props:{field:"currentYear",width:120,height:30,fontSize:12,color:"#2d3436",label:"Anne Actuelle"}},{type:"final_signature_info",props:{field:"nextLevel",width:150,height:30,fontSize:12,color:"#2d3436",label:"Info (Legacy) - Niveau Suivant",placeholder:"..."}},{type:"signature_box",props:{width:200,height:80,label:"Signature",period:"mid-year"}},{type:"signature_date",props:{width:220,height:34,fontSize:12,color:"#2d3436",label:"Date Signature",level:"PS",semester:1,showMeta:!0,align:"flex-start"}},{type:"signature",props:{labels:["Directeur","Enseignant","Parent"],fontSize:12}},{type:"language_toggle",props:{radius:40,spacing:12,direction:"column",items:[{code:"en",label:"English",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",active:!1},{code:"fr",label:"Franais",logo:"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg",active:!1},{code:"ar",label:"",logo:"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg",active:!1}]}},{type:"language_toggle_v2",props:{radius:40,spacing:12,direction:"row",width:300,height:100,items:[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}]}},{type:"dropdown",props:{label:"Menu droulant",options:["Option 1","Option 2"],variableName:"var1",width:200,height:40,fontSize:12,color:"#333",semesters:[1,2]}},{type:"dropdown_reference",props:{dropdownNumber:1,text:"Rfrence dropdown #{number}",fontSize:12,color:"#2d3436"}},{type:"dynamic_text",props:{text:"{student.firstName} {student.lastName}",fontSize:14,color:"#2d3436",label:"Nom complet (Prnom + Nom)"}},{type:"dynamic_text",props:{text:"{student.fullNameFatherInitial}",fontSize:14,color:"#2d3436",label:"Nom complet (Prnom + initiale pre + nom)"}},{type:"dynamic_text",props:{text:"{student.dob_ddmmyyyy}",fontSize:14,color:"#2d3436",label:"Date de naissance (JJ/MM/AAAA)"}},{type:"gradebook_pocket",props:{width:90,number:"1",fontSize:20,label:"Title"}}],[]),fr=C=>{if(!C)return"";const F=new Date(C);if(isNaN(F.getTime()))return"";const M=String(F.getUTCDate()).padStart(2,"0"),X=String(F.getUTCMonth()+1).padStart(2,"0"),ue=String(F.getUTCFullYear());return`${M}/${X}/${ue}`},Dn=C=>{const F=String((C==null?void 0:C.fatherName)||(C==null?void 0:C.parentName)||"").trim();return F?F.charAt(0).toUpperCase():""},sn=()=>{const C=[];return o.pages.forEach((F,M)=>{F.blocks.forEach((X,ue)=>{X.type==="dropdown"&&C.push({pageIdx:M,blockIdx:ue,block:X})})}),C},gn=(C,F)=>{const M=C.currentTarget.getBoundingClientRect(),X=(C.clientX-M.left)/$,ue=(C.clientY-M.top)/$;ge.current={pageIndex:F,x:mn(X,0,ga),y:mn(ue,0,no)}},Or=C=>{const F=[...o.pages],M={...F[j]},X=(M.blocks||[]).map(Ee=>{var Ue;return((Ue=Ee.props)==null?void 0:Ue.z)??0}),ue=(X.length?Math.max(...X):0)+1,U=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11);let Ke={...C.props,x:100,y:100,z:ue,blockId:U};if(C.type==="dropdown"){const Ue=sn().reduce((Xe,Je)=>Math.max(Xe,Je.block.props.dropdownNumber||0),0);Ke.dropdownNumber=Ue+1}const he=[...M.blocks,{type:C.type,props:Ke}];F[j]={...M,blocks:he},Se({...o,pages:F}),A(he.length-1),W(null)},kr=()=>{if(b==null)return;const C=[...o.pages],F={...C[j]},M=F.blocks[b],X=JSON.parse(JSON.stringify(M.props));X.x=(X.x||0)+20,X.y=(X.y||0)+20;const ue=(F.blocks||[]).map(Ue=>{var Xe;return((Xe=Ue.props)==null?void 0:Xe.z)??0}),U=(ue.length?Math.max(...ue):0)+1;X.z=U;const Ke=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11);if(X.blockId=Ke,M.type==="dropdown"){const Xe=sn().reduce((Je,ot)=>Math.max(Je,ot.block.props.dropdownNumber||0),0);X.dropdownNumber=Xe+1}if(M.type==="table"&&X.cells){const Ue=X.cells.length;X.rowIds=Array.from({length:Ue},()=>window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11))}const he={type:M.type,props:X},Ee=[...F.blocks,he];C[j]={...F,blocks:Ee},Se({...o,pages:C}),A(Ee.length-1),W(null)},Ye=C=>{var Je,ot,ct,it,dt,kt,mt,Xt,Dt,hr;if(b==null)return;const F=[...o.pages],M={...F[j]},X=[...M.blocks],ue=X[b],U=Number(((Je=ue==null?void 0:ue.props)==null?void 0:Je.x)||0),Ke=Number(((ot=ue==null?void 0:ue.props)==null?void 0:ot.y)||0),he=Object.prototype.hasOwnProperty.call(C,"x")?Number(C.x||0):U,Ee=Object.prototype.hasOwnProperty.call(C,"y")?Number(C.y||0):Ke,Ue=he-U,Xe=Ee-Ke;if(X[b]={...X[b],props:{...X[b].props,...C}},(Ue!==0||Xe!==0)&&ue){if(ue.type==="table"){let Ft=-1;const Nt=(ct=ue.props)==null?void 0:ct.titleBlockId;if(typeof Nt=="string"&&Nt.trim()&&(Ft=X.findIndex(lt=>{var xt;return((xt=lt==null?void 0:lt.props)==null?void 0:xt.blockId)===Nt})),Ft<0){const lt=(it=ue.props)==null?void 0:it.blockId;typeof lt=="string"&&lt.trim()&&(Ft=X.findIndex(xt=>{var Gt;return(xt==null?void 0:xt.type)==="gradebook_pocket"&&((Gt=xt==null?void 0:xt.props)==null?void 0:Gt.linkedTableBlockId)===lt}))}if(Ft>=0){const lt=X[Ft];X[Ft]={...lt,props:{...lt.props,x:Number(((dt=lt.props)==null?void 0:dt.x)||0)+Ue,y:Number(((kt=lt.props)==null?void 0:kt.y)||0)+Xe}}}}if(ue.type==="gradebook_pocket"){let Ft=-1;const Nt=(mt=ue.props)==null?void 0:mt.linkedTableBlockId;if(typeof Nt=="string"&&Nt.trim()&&(Ft=X.findIndex(lt=>{var xt;return(lt==null?void 0:lt.type)==="table"&&((xt=lt==null?void 0:lt.props)==null?void 0:xt.blockId)===Nt})),Ft<0){const lt=(Xt=ue.props)==null?void 0:Xt.blockId;typeof lt=="string"&&lt.trim()&&(Ft=X.findIndex(xt=>{var Gt;return(xt==null?void 0:xt.type)==="table"&&((Gt=xt==null?void 0:xt.props)==null?void 0:Gt.titleBlockId)===lt}))}if(Ft>=0){const lt=X[Ft];X[Ft]={...lt,props:{...lt.props,x:Number(((Dt=lt.props)==null?void 0:Dt.x)||0)+Ue,y:Number(((hr=lt.props)==null?void 0:hr.y)||0)+Xe}}}}}F[j]={...M,blocks:X},Se({...o,pages:F})},qt=C=>{if(b==null)return;const F=[...o.pages],M={...F[j]},X=[...M.blocks],ue={...X[b].props},U=C(ue);X[b]={...X[b],props:U},F[j]={...M,blocks:X},Se({...o,pages:F})},zs=C=>{const F=C==null?void 0:C.runs;if(Array.isArray(F)&&F.length){const M=F.filter(X=>X&&typeof X=="object"&&typeof X.text=="string").map(X=>({text:String(X.text||""),bold:typeof X.bold=="boolean"?X.bold:void 0,underline:typeof X.underline=="boolean"?X.underline:void 0,color:typeof X.color=="string"&&X.color?X.color:void 0})).filter(X=>X.text.length>0);if(M.length)return M}return[{text:String((C==null?void 0:C.text)||"")}]},ys=C=>{const F=[];for(const M of C){if(!M.text)continue;const X=F[F.length-1];X&&X.bold===M.bold&&X.underline===M.underline&&X.color===M.color?X.text+=M.text:F.push({...M})}return F},mi=(C,F,M,X)=>{let ue=!1,U=!0,Ke=!0,he=0;for(const Ee of C){const Ue=Ee.text.length,Xe=he,Je=he+Ue,ot=Math.max(F,Xe),ct=Math.min(M,Je);if(ot<ct){ue=!0;const it=!!(typeof Ee.bold=="boolean"?Ee.bold:X.bold),dt=!!(typeof Ee.underline=="boolean"?Ee.underline:X.underline);it||(U=!1),dt||(Ke=!1)}he=Je}return{any:ue,allBold:U,allUnderline:Ke}},_r=(C,F,M)=>{const X=zs(C),ue=X.map(Ue=>Ue.text).join(""),U=Math.max(0,Math.min(F.start,ue.length)),Ke=Math.max(0,Math.min(F.end,ue.length));if(U>=Ke)return{text:ue,runs:X};const he=[];let Ee=0;for(const Ue of X){const Xe=Ue.text,Je=Xe.length,ot=Ee,ct=Ee+Je;if(ct<=U||ot>=Ke)he.push({...Ue});else{const it=Math.max(0,U-ot),dt=Math.min(Je,Ke-ot),kt=Xe.slice(0,it),mt=Xe.slice(it,dt),Xt=Xe.slice(dt);kt&&he.push({...Ue,text:kt}),mt&&he.push({...Ue,text:mt,...M}),Xt&&he.push({...Ue,text:Xt})}Ee=ct}return{text:ue,runs:ys(he)}},jr=C=>{ce(C);try{localStorage.setItem(l_,JSON.stringify(C))}catch{}},Jt=(C,F)=>{var mt;const M=(C==null?void 0:C.cells)||[],X=((mt=M==null?void 0:M[0])==null?void 0:mt[0])||{},ue=_y(C),U=Number((C==null?void 0:C.rowGap)||0),Ke=Number((C==null?void 0:C.colGap)||0),he=Number((C==null?void 0:C.borderRadius)||0),Ee=Number((X==null?void 0:X.fontSize)||12),Ue=String((X==null?void 0:X.color)||"#000000"),Xe=String((F==null?void 0:F.globalBorderColor)||ue.color||"#000000"),Je=Number((F==null?void 0:F.globalBorderWidth)??ue.width??1),ot=Number((C==null?void 0:C.expandedRowHeight)||34),ct=String((C==null?void 0:C.expandedToggleStyle)||"v2"),it=Number((C==null?void 0:C.expandedDividerWidth)||.5),dt=String(((C==null?void 0:C.expandedDividerColor)??"").toString().trim()||fh),kt=Number((C==null?void 0:C.expandedTopGap)||0);return{rowGap:U,colGap:Ke,borderRadius:he,fontSize:Ee,textColor:Ue,borderColor:Xe,borderWidth:Je,expandedRowHeight:ot,expandedToggleStyle:ct,expandedDividerWidth:it,expandedDividerColor:dt,expandedTopGap:kt}},Mn=C=>{const F=c_(C);ae(F.borderColor),J(F.borderWidth),qt(M=>{const X={...M,expandedRows:!0,rowGap:F.rowGap,colGap:F.colGap,borderRadius:F.borderRadius,expandedRowHeight:F.expandedRowHeight,expandedToggleStyle:F.expandedToggleStyle,expandedDividerWidth:F.expandedDividerWidth,expandedDividerColor:F.expandedDividerColor,expandedTopGap:F.expandedTopGap};return Array.isArray(M.cells)&&(X.cells=(M.cells||[]).map(ue=>(ue||[]).map(U=>{const Ke=(U==null?void 0:U.borders)||{};return{...U,fontSize:F.fontSize,color:F.textColor,borders:{...Ke,l:{...Ke.l||{},color:F.borderColor,width:F.borderWidth},r:{...Ke.r||{},color:F.borderColor,width:F.borderWidth},t:{...Ke.t||{},color:F.borderColor,width:F.borderWidth},b:{...Ke.b||{},color:F.borderColor,width:F.borderWidth}}}}))),X})},vs=()=>{var he,Ee;if(b==null)return;const C=se.trim();if(!C)return;const F=(Ee=(he=o.pages[j])==null?void 0:he.blocks)==null?void 0:Ee[b];if(!F||F.type!=="table")return;const M=_y(F.props),X=Jt(F.props,{globalBorderColor:M.color,globalBorderWidth:M.width}),ue=P.find(Ue=>Ue.name.toLowerCase()===C.toLowerCase()),U=(ue==null?void 0:ue.id)||(window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11)),Ke=[...P.filter(Ue=>Ue.id!==U),{id:U,name:C,style:X}].sort((Ue,Xe)=>Ue.name.localeCompare(Xe.name));jr(Ke),ye(U),je("")},is=()=>{if(b===null&&z.length===0)return;const C=o.pages[j],F=[],M=new Set(z);b!==null&&M.add(b),M.forEach(X=>{C.blocks[X]&&F.push(JSON.parse(JSON.stringify(C.blocks[X])))}),Te(F)},mn=(C,F,M)=>Math.max(F,Math.min(M,C)),da=C=>C?typeof C.type=="string"&&C.type.toLowerCase().startsWith("image/")?!0:/\.(png|jpe?g|gif|webp|bmp)$/i.test(C.name||""):!1,eo=async C=>{try{const F=window;if(typeof F.createImageBitmap=="function"){const M=await F.createImageBitmap(C),X={width:Number(M.width||0),height:Number(M.height||0)};if(typeof M.close=="function"&&M.close(),X.width>0&&X.height>0)return X}}catch{}return await new Promise(F=>{const M=URL.createObjectURL(C),X=new Image;X.onload=()=>{const ue={width:Number(X.naturalWidth||0),height:Number(X.naturalHeight||0)};URL.revokeObjectURL(M),F(ue.width>0&&ue.height>0?ue:null)},X.onerror=()=>{URL.revokeObjectURL(M),F(null)},X.src=M})},xi=C=>{const F=[...o.pages],M={...F[C.pageIndex]},X=(M.blocks||[]).map(Ue=>{var Xe;return((Xe=Ue.props)==null?void 0:Xe.z)??0}),ue=(X.length?Math.max(...X):0)+1,U=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11),Ke=mn(C.x,0,Math.max(0,ga-C.width)),he=mn(C.y,0,Math.max(0,no-C.height)),Ee=[...M.blocks,{type:"image",props:{url:C.url,width:C.width,height:C.height,x:Ke,y:he,z:ue,blockId:U}}];F[C.pageIndex]={...M,blocks:Ee},Se({...o,pages:F}),_(C.pageIndex),A(Ee.length-1),D([]),W(null)},yi=async C=>{var Ke;const F=C.filter(da);if(F.length===0)return;const M=ge.current,X=(M==null?void 0:M.pageIndex)??j,ue=(M==null?void 0:M.x)??ga/2,U=(M==null?void 0:M.y)??no/2;for(let he=0;he<F.length;he++){const Ee=F[he],Ue=await eo(Ee),Xe=(Ue==null?void 0:Ue.width)||320,Je=(Ue==null?void 0:Ue.height)||240,ct=Math.min(1,420/Math.max(Xe,Je)),it=Math.max(20,Math.round(Xe*ct)),dt=Math.max(20,Math.round(Je*ct)),kt=new FormData;kt.append("file",Ee);try{const mt=await K.post("/media/upload",kt),Xt=(Ke=mt==null?void 0:mt.data)!=null&&Ke.url?String(mt.data.url):"";if(!Xt)continue;xi({pageIndex:X,url:Xt,x:ue+he*20-it/2,y:U+he*20-dt/2,width:it,height:dt}),await zd()}catch{Re("chec du collage de limage")}}},vi=()=>{if(!Be||Be.length===0)return;const C=[...o.pages],F={...C[j]},M=(F.blocks||[]).map(Xe=>{var Je;return((Je=Xe.props)==null?void 0:Je.z)??0});let X=(M.length?Math.max(...M):0)+1,U=sn().reduce((Xe,Je)=>Math.max(Xe,Je.block.props.dropdownNumber||0),0);const Ke=Be.map(Xe=>{const Je=JSON.parse(JSON.stringify(Xe.props));return Je.x=(Je.x||0)+20,Je.y=(Je.y||0)+20,Je.z=X++,Xe.type==="dropdown"&&(U++,Je.dropdownNumber=U),{type:Xe.type,props:Je}}),he=[...F.blocks,...Ke];C[j]={...F,blocks:he},Se({...o,pages:C});const Ee=F.blocks.length,Ue=Ke.map((Xe,Je)=>Ee+Je);Ue.length===1?(A(Ue[0]),D([])):(A(null),D(Ue)),W(null)},tl=(C,F,M)=>{C.preventDefault();const X=C.clientX,ue=C.clientY,U=new Set;z.includes(M)||b===M?(z.forEach(Nt=>U.add(Nt)),b!==null&&U.add(b)):U.add(M);const he=o.pages[F].blocks;let Ee=!0;for(;Ee;)Ee=!1,Array.from(U).forEach(Nt=>{var xt,Gt,sr,an;const lt=he[Nt];if(lt){if(lt.type==="table"){let ar=-1;const or=(xt=lt.props)==null?void 0:xt.titleBlockId;if(typeof or=="string"&&or.trim()&&(ar=he.findIndex(er=>{var tr;return((tr=er==null?void 0:er.props)==null?void 0:tr.blockId)===or})),ar<0){const er=(Gt=lt.props)==null?void 0:Gt.blockId;typeof er=="string"&&er.trim()&&(ar=he.findIndex(tr=>{var zr;return(tr==null?void 0:tr.type)==="gradebook_pocket"&&((zr=tr==null?void 0:tr.props)==null?void 0:zr.linkedTableBlockId)===er}))}ar>=0&&!U.has(ar)&&(U.add(ar),Ee=!0)}if(lt.type==="gradebook_pocket"){let ar=-1;const or=(sr=lt.props)==null?void 0:sr.linkedTableBlockId;if(typeof or=="string"&&or.trim()&&(ar=he.findIndex(er=>{var tr;return(er==null?void 0:er.type)==="table"&&((tr=er==null?void 0:er.props)==null?void 0:tr.blockId)===or})),ar<0){const er=(an=lt.props)==null?void 0:an.blockId;typeof er=="string"&&er.trim()&&(ar=he.findIndex(tr=>{var zr;return(tr==null?void 0:tr.type)==="table"&&((zr=tr==null?void 0:tr.props)==null?void 0:zr.titleBlockId)===er}))}ar>=0&&!U.has(ar)&&(U.add(ar),Ee=!0)}}});const Ue=new Map;U.forEach(Nt=>{const lt=o.pages[F].blocks[Nt];lt&&Ue.set(Nt,{x:lt.props.x||0,y:lt.props.y||0})});const Xe=o.pages[F].blocks[M],Je=Xe.props.x||0,ot=Xe.props.y||0,ct=Xe.props.width||(Xe.type==="text"?120:Xe.type==="language_toggle"?80:Xe.type==="language_toggle_v2"?300:120),it=Xe.props.height||(Xe.type==="text"?60:Xe.type==="language_toggle"?200:Xe.type==="language_toggle_v2"?100:120),dt=o.pages[F].blocks.map((Nt,lt)=>({b:Nt,i:lt})).filter(Nt=>!U.has(Nt.i)).map(({b:Nt})=>({x:Nt.props.x||0,y:Nt.props.y||0,w:Nt.props.width||(Nt.type==="text"?120:Nt.type==="language_toggle"?80:Nt.type==="language_toggle_v2"?300:120),h:Nt.props.height||(Nt.type==="text"?60:Nt.type==="language_toggle"?200:Nt.type==="language_toggle_v2"?100:120)}));let kt=!1,mt=!1;const Xt=3;let Dt=o;const hr=Nt=>{const lt=Nt.clientX-X,xt=Nt.clientY-ue;if(!mt){if(Math.abs(lt)<Xt&&Math.abs(xt)<Xt)return;mt=!0}kt=!0;const Gt=[...o.pages],sr={...Gt[F]},an=[...sr.blocks];let ar=Math.max(0,Math.min(ga-20,Je+lt)),or=Math.max(0,Math.min(no-20,ot+xt));const er=5,tr=[];let zr=!1;const cr=ar+ct/2;for(const Vt of dt){const qn=Vt.x+Vt.w/2;if(Math.abs(ar-Vt.x)<er?(ar=Vt.x,tr.push({type:"x",pos:Vt.x}),zr=!0):Math.abs(ar+ct-(Vt.x+Vt.w))<er?(ar=Vt.x+Vt.w-ct,tr.push({type:"x",pos:Vt.x+Vt.w}),zr=!0):Math.abs(ar-(Vt.x+Vt.w))<er?(ar=Vt.x+Vt.w,tr.push({type:"x",pos:Vt.x+Vt.w}),zr=!0):Math.abs(ar+ct-Vt.x)<er?(ar=Vt.x-ct,tr.push({type:"x",pos:Vt.x}),zr=!0):Math.abs(cr-qn)<er&&(ar=qn-ct/2,tr.push({type:"x",pos:qn}),zr=!0),zr)break}let Xr=!1;const Ls=or+it/2;for(const Vt of dt){const qn=Vt.y+Vt.h/2;if(Math.abs(or-Vt.y)<er?(or=Vt.y,tr.push({type:"y",pos:Vt.y}),Xr=!0):Math.abs(or+it-(Vt.y+Vt.h))<er?(or=Vt.y+Vt.h-it,tr.push({type:"y",pos:Vt.y+Vt.h}),Xr=!0):Math.abs(or-(Vt.y+Vt.h))<er?(or=Vt.y+Vt.h,tr.push({type:"y",pos:Vt.y+Vt.h}),Xr=!0):Math.abs(or+it-Vt.y)<er?(or=Vt.y-it,tr.push({type:"y",pos:Vt.y}),Xr=!0):Math.abs(Ls-qn)<er&&(or=qn-it/2,tr.push({type:"y",pos:qn}),Xr=!0),Xr)break}ke(tr);const Vn=B&&!zr?Math.round(ar/10)*10:ar,on=B&&!Xr?Math.round(or/10)*10:or,$s=Vn-Je,as=on-ot;U.forEach(Vt=>{const qn=Ue.get(Vt);an[Vt]={...an[Vt],props:{...an[Vt].props,x:qn.x+$s,y:qn.y+as}}}),Gt[F]={...sr,blocks:an},Dt={...o,pages:Gt},l(Dt)},Ft=()=>{window.removeEventListener("mousemove",hr),window.removeEventListener("mouseup",Ft),ke([]),kt&&(Se(Dt),qe.current=!0,setTimeout(()=>{qe.current=!1},0))};window.addEventListener("mousemove",hr),window.addEventListener("mouseup",Ft)},rl=async()=>{if(o._id){try{if((await K.get(`/template-propagation/${o._id}/assignments`)).data.totalCount>0){Yt(!0);return}}catch(M){console.warn("Could not check for assignments, proceeding with normal save",M)}const C=await K.patch(`/templates/${o._id}`,o),F=$e(C.data);l(F),V.current=JSON.stringify(F),fe.current=String((F==null?void 0:F._id)||""),de(" Sauvegard"),setTimeout(()=>de(""),3e3)}else{const C=await K.post("/templates",o),F=$e(C.data);l(F),V.current=JSON.stringify(F),fe.current=String((F==null?void 0:F._id)||""),de(" Cr"),setTimeout(()=>de(""),3e3)}},bi=async(C,F)=>{try{Me(!0);const M=await K.patch(`/template-propagation/${o._id}`,{templateData:o,propagateToAssignmentIds:C,changeDescription:F}),X=$e(M.data.template);l(X),V.current=JSON.stringify(X),fe.current=String((X==null?void 0:X._id)||""),Yt(!1);const{propagation:ue}=M.data;let U=" Sauvegard";ue.hasSignificantChange&&(U=` Version ${ue.newVersion} - ${ue.propagatedCount} mise(s)  jour, ${ue.skippedCount} maintenu(s)`),de(U),setTimeout(()=>de(""),5e3)}finally{Me(!1)}},Fi=o._id&&c?(()=>{const C=localStorage.getItem("token");return`${(K.defaults.baseURL||"").replace(/\/$/,"")}/pdf-v2/student/${c}?templateId=${o._id}&token=${C}`})():"",Qp=o._id&&d?`/pdf/class/${d}/batch?templateId=${o._id}`:"",zd=async()=>{try{const C=await K.get("/media/list");N(C.data)}catch{}},ua=async()=>{var C,F;try{Re("");const M=await K.get("/templates");le(M.data)}catch(M){((C=M.response)==null?void 0:C.status)===401||((F=M.response)==null?void 0:F.status)===403?(Re("Session expire. Veuillez vous reconnecter."),setTimeout(()=>e("/login"),2e3)):Re("Impossible de charger les templates")}},to=async()=>{try{const C=await K.get("/school-years");if(m(C.data),!S){const F=s?(C.data||[]).find(ue=>ue._id===s):null,M=(C.data||[]).find(ue=>ue.active),X=F||M||(C.data||[])[0];X!=null&&X._id&&k(X._id)}}catch{}},pa=async C=>{try{const F=await K.get("/classes",{params:{schoolYearId:C}});x(F.data)}catch{}},fa=async C=>{try{const F=await K.get("/students",{params:{schoolYearId:S}}),ue=(await K.get("/students",{params:{schoolYearId:S}})).data.filter(U=>U.classId===C);v(ue)}catch{}},Ww=async C=>{var X;const F=(X=C.target.files)==null?void 0:X[0];if(!F)return;const M=new FormData;M.append("file",F);try{de("Importation en cours...");const ue=await K.post("/templates/import-pptx",M),U=$e(ue.data);l(U),V.current=JSON.stringify(U),fe.current=String((U==null?void 0:U._id)||""),de("Import avec succs"),await ua()}catch(ue){console.error(ue),Re("chec de l'importation PPTX"),de("")}ht.current&&(ht.current.value="")},hx=async()=>{if(We.trim())try{const C={name:We,pages:[{title:"Page 1",blocks:[]}]},F=await K.post("/templates",C),M=$e(F.data);l(M),V.current=JSON.stringify(M),fe.current=String((M==null?void 0:M._id)||""),a("edit"),_e(!1),jt(""),await ua()}catch{Re("Erreur lors de la cration")}},gx=async C=>{const F=H[C]||0;if(F<2){ie({...H,[C]:F+1});return}try{await K.delete(`/templates/${C}`);const M={...H};delete M[C],ie(M),await ua()}catch{Re("Erreur lors de la suppression")}},ha=async C=>{try{const F={name:`${C.name} (copie)`,pages:C.pages};await K.post("/templates",F),await ua()}catch{Re("Erreur lors de la duplication")}};p.useEffect(()=>{zd(),ua(),to()},[]),p.useEffect(()=>{S&&(pa(S),f(""),v([]),u(""))},[S]),p.useEffect(()=>{d&&(fa(d),u(""))},[d]);const xn=C=>{if(!C||C<=0)return"";const F=["B","KB","MB","GB","TB"],M=Math.floor(Math.log(C)/Math.log(1024));return`${(C/Math.pow(1024,M)).toFixed(M?1:0)} ${F[M]}`},Kn=async()=>{try{yt(!0),Re("");const C=await K.get("/templates/exports");Bt(C.data)}catch(C){console.error(C),Re("Impossible de charger les exports")}finally{yt(!1)}};return p.useEffect(()=>{const C=()=>pt(null);if(xe)return document.addEventListener("click",C),()=>document.removeEventListener("click",C)},[xe]),i==="list"?n.jsxs("div",{className:"container",style:{maxWidth:1400,margin:"0 auto"},children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"32px 40px",borderRadius:16,marginBottom:32,boxShadow:"0 8px 24px rgba(102, 126, 234, 0.25)"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{margin:0,fontSize:32,fontWeight:700,color:"#fff",marginBottom:8},children:"Bibliothque Templates"}),n.jsx("p",{style:{margin:0,fontSize:16,color:"rgba(255,255,255,0.9)"},children:"Crez et grez vos modles de livrets"})]}),n.jsxs("div",{children:[n.jsx("input",{type:"file",ref:Et,style:{display:"none"},accept:".zip",onChange:He}),n.jsx("button",{className:"btn",onClick:()=>{var C;return(C=Et.current)==null?void 0:C.click()},style:{background:"rgba(255,255,255,0.2)",color:"#fff",padding:"14px 28px",fontSize:16,fontWeight:600,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.3)",marginRight:16},children:" Importer"}),n.jsx("button",{className:"btn",onClick:async()=>{Re(""),await Kn(),wt(!0)},style:{background:"rgba(255,255,255,0.12)",color:"#fff",padding:"14px 22px",fontSize:16,fontWeight:600,boxShadow:"0 4px 12px rgba(0,0,0,0.08)",border:"1px solid rgba(255,255,255,0.18)",marginRight:12},children:" Exports"}),n.jsx("button",{className:"btn",onClick:()=>_e(!0),style:{background:"#fff",color:"#667eea",padding:"14px 28px",fontSize:16,fontWeight:600,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",border:"none"},children:" Nouveau Template"})]})]})}),Ie&&n.jsxs("div",{style:{padding:"16px 20px",background:"#fee",color:"#c33",borderRadius:12,marginBottom:24,border:"1px solid #fcc",fontWeight:500},children:[" ",Ie]}),ve.length===0?n.jsxs("div",{style:{textAlign:"center",padding:"80px 40px",background:"#f8f9fa",borderRadius:16,border:"2px dashed #dee2e6"},children:[n.jsx("div",{style:{fontSize:64,marginBottom:16,opacity:.3},children:""}),n.jsx("h3",{style:{fontSize:20,color:"#6c757d",marginBottom:8},children:"Aucun template trouv"}),n.jsx("p",{style:{color:"#adb5bd",marginBottom:24},children:"Crez votre premier template pour commencer"}),n.jsx("button",{className:"btn",onClick:()=>_e(!0),children:"Crer un template"})]}):n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:24},children:ve.map(C=>n.jsxs("div",{className:"card",onClick:()=>{const F=$e(C);l(F),V.current=JSON.stringify(F),fe.current=String((F==null?void 0:F._id)||""),a("edit"),_(0),A(null)},style:{display:"flex",flexDirection:"column",minHeight:280,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",border:"1px solid #e2e8f0",borderRadius:16,position:"relative",overflow:"hidden",background:"#fff",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)"},onMouseEnter:F=>{F.currentTarget.style.transform="translateY(-8px)",F.currentTarget.style.boxShadow="0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",F.currentTarget.style.borderColor="#cbd5e0"},onMouseLeave:F=>{F.currentTarget.style.transform="translateY(0)",F.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)",F.currentTarget.style.borderColor="#e2e8f0"},children:[n.jsxs("div",{style:{height:140,background:"linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[n.jsx("div",{style:{fontSize:48,filter:"drop-shadow(0 4px 6px rgba(0,0,0,0.1))"},children:""}),n.jsxs("div",{style:{position:"absolute",bottom:12,right:12,background:"rgba(255,255,255,0.9)",padding:"4px 10px",borderRadius:20,fontSize:12,fontWeight:600,color:"#4a5568",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[C.pages.length," Pages"]})]}),n.jsxs("div",{style:{flex:1,padding:"20px 24px 12px"},children:[n.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:18,fontWeight:700,color:"#2d3748",lineHeight:1.4,overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:C.name}),C.updatedAt&&n.jsxs("p",{style:{margin:0,fontSize:13,color:"#a0aec0"},children:["Modifi le ",new Date(C.updatedAt).toLocaleDateString()]})]}),n.jsxs("div",{style:{padding:"12px 24px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"auto"},children:[n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"btn icon-btn",onClick:F=>{F.stopPropagation(),ha(C)},title:"Dupliquer",style:{padding:8,borderRadius:8,background:"#f7fafc",border:"1px solid #e2e8f0",color:"#4a5568",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:F=>F.currentTarget.style.background="#edf2f7",onMouseLeave:F=>F.currentTarget.style.background="#f7fafc",children:""}),n.jsx("button",{className:"btn icon-btn",onClick:F=>{F.stopPropagation(),C._id&&Ge(C._id)},title:"Exporter",style:{padding:8,borderRadius:8,background:"#f7fafc",border:"1px solid #e2e8f0",color:"#4a5568",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:F=>F.currentTarget.style.background="#edf2f7",onMouseLeave:F=>F.currentTarget.style.background="#f7fafc",children:""}),n.jsx("button",{className:"btn icon-btn",onClick:F=>{F.stopPropagation(),C._id&&gx(C._id)},title:"Supprimer",style:{padding:8,borderRadius:8,background:(H[C._id]||0)>0?"#e53e3e":"#fff5f5",border:(H[C._id]||0)>0?"1px solid #c53030":"1px solid #fed7d7",color:(H[C._id]||0)>0?"#fff":"#e53e3e",cursor:"pointer",transition:"all 0.2s",minWidth:(H[C._id]||0)>0?100:40},onMouseEnter:F=>{(H[C._id]||0)===0&&(F.currentTarget.style.background="#fed7d7")},onMouseLeave:F=>{(H[C._id]||0)===0&&(F.currentTarget.style.background="#fff5f5")},children:(H[C._id]||0)===0?"":`Confirmer (${3-(H[C._id]||0)})`})]}),n.jsxs("button",{style:{padding:"8px 16px",fontSize:14,fontWeight:600,color:"#667eea",background:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:["diter ",n.jsx("span",{children:""})]})]})]},C._id))}),R&&n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{className:"card",style:{width:480,maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",border:"none",animation:"slideUp 0.3s ease-out"},children:[n.jsx("h3",{style:{margin:"0 0 20px 0",fontSize:24,fontWeight:600,color:"#2d3436"},children:" Crer un nouveau template"}),n.jsx("input",{autoFocus:!0,placeholder:"Nom du template (ex: Livret Scolaire 2024-2025)",value:We,onChange:C=>jt(C.target.value),onKeyDown:C=>C.key==="Enter"&&hx(),style:{width:"100%",padding:"14px 16px",borderRadius:10,border:"2px solid #e9ecef",marginBottom:24,boxSizing:"border-box",fontSize:15,transition:"all 0.2s"},onFocus:C=>C.target.style.borderColor="#667eea",onBlur:C=>C.target.style.borderColor="#e9ecef"}),n.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>_e(!1),style:{padding:"12px 24px",fontSize:15},children:"Annuler"}),n.jsx("button",{className:"btn",onClick:hx,style:{padding:"12px 28px",fontSize:15,fontWeight:600},children:"Crer"})]})]})}),rt&&n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:n.jsxs("div",{className:"card",style:{width:1e3,maxWidth:"95vw",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",border:"none",animation:"slideUp 0.3s ease-out",overflow:"hidden",borderRadius:16},children:[n.jsxs("div",{style:{padding:"24px 32px",borderBottom:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fff"},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700,color:"#1a202c"},children:" Exports disponibles"}),n.jsx("p",{style:{margin:"4px 0 0",color:"#718096",fontSize:14},children:"Grez vos fichiers exports"})]}),n.jsx("button",{className:"btn secondary",onClick:()=>wt(!1),style:{borderRadius:"50%",width:36,height:36,padding:0,display:"flex",alignItems:"center",justifyContent:"center",border:"none",background:"#f7fafc",color:"#a0aec0",cursor:"pointer",fontSize:18},children:""})]}),n.jsxs("div",{style:{padding:"16px 32px",background:"#f8fafc",borderBottom:"1px solid #edf2f7",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{style:{fontSize:14,color:"#4a5568",fontWeight:500},children:[ut.length," fichier",ut.length!==1?"s":""," trouv",ut.length!==1?"s":""]}),n.jsxs("button",{className:"btn secondary",onClick:Kn,disabled:gt,style:{padding:"8px 16px",fontSize:13,background:"#fff",border:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:8,color:"#4a5568",cursor:gt?"not-allowed":"pointer"},children:[n.jsx("span",{children:""}),gt?"Actualisation...":"Actualiser"]})]}),n.jsx("div",{style:{overflowY:"auto",padding:"0 0",flex:1,background:"#fff"},children:gt&&ut.length===0?n.jsxs("div",{style:{padding:60,textAlign:"center",color:"#a0aec0"},children:[n.jsx("div",{style:{fontSize:40,marginBottom:16},children:""}),"Chargement des exports..."]}):ut.length===0?n.jsxs("div",{style:{padding:60,textAlign:"center",color:"#a0aec0"},children:[n.jsx("div",{style:{fontSize:40,marginBottom:16},children:""}),n.jsx("div",{style:{fontSize:18,color:"#4a5568",fontWeight:500,marginBottom:8},children:"Aucun export trouv"}),n.jsx("p",{style:{margin:0},children:"Les fichiers exports apparatront ici."})]}):n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed"},children:[n.jsx("thead",{style:{position:"sticky",top:0,background:"#fff",zIndex:10},children:n.jsxs("tr",{style:{borderBottom:"2px solid #edf2f7"},children:[n.jsx("th",{style:{width:"45%",textAlign:"left",padding:"12px 20px",fontSize:12,fontWeight:600,color:"#a0aec0",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Nom du fichier"}),n.jsx("th",{style:{width:"20%",textAlign:"left",padding:"12px 20px",fontSize:12,fontWeight:600,color:"#a0aec0",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Export par"}),n.jsx("th",{style:{width:"15%",textAlign:"left",padding:"12px 20px",fontSize:12,fontWeight:600,color:"#a0aec0",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Date"}),n.jsx("th",{style:{width:"10%",textAlign:"right",padding:"12px 20px",fontSize:12,fontWeight:600,color:"#a0aec0",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Taille"}),n.jsx("th",{style:{width:"10%",textAlign:"right",padding:"12px 20px",fontSize:12,fontWeight:600,color:"#a0aec0",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Actions"})]})}),n.jsx("tbody",{children:ut.map((C,F)=>n.jsxs("tr",{style:{borderBottom:"1px solid #edf2f7",transition:"background 0.1s",background:F%2===0?"#fff":"#fafafa"},onMouseEnter:M=>M.currentTarget.style.background="#f0f4ff",onMouseLeave:M=>M.currentTarget.style.background=F%2===0?"#fff":"#fafafa",children:[n.jsx("td",{style:{padding:"12px 20px",verticalAlign:"middle"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,overflow:"hidden"},children:[n.jsx("div",{style:{flexShrink:0,width:36,height:36,background:C.fileName.endsWith(".zip")?"#ebf8ff":"#fff5f5",color:C.fileName.endsWith(".zip")?"#3182ce":"#e53e3e",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:C.fileName.endsWith(".zip")?"":""}),n.jsxs("div",{style:{minWidth:0,flex:1},children:[n.jsx("div",{title:C.fileName,style:{fontWeight:600,color:"#2d3748",marginBottom:2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C.fileName}),C.mtime&&Date.now()-new Date(C.mtime).getTime()<24*60*60*1e3&&n.jsx("span",{style:{fontSize:10,background:"#48bb78",color:"#fff",padding:"2px 6px",borderRadius:4,fontWeight:700,textTransform:"uppercase"},children:"Nouveau"})]})]})}),n.jsx("td",{style:{padding:"12px 20px",verticalAlign:"middle",color:"#4a5568",fontSize:13},children:C.exportedByName?n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"#cbd5e0",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:10,fontWeight:700},children:C.exportedByName.charAt(0).toUpperCase()}),n.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C.exportedByName})]}):n.jsx("span",{style:{color:"#a0aec0",fontStyle:"italic"},children:""})}),n.jsx("td",{style:{padding:"12px 20px",color:"#718096",fontSize:13,verticalAlign:"middle"},children:C.mtime?n.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[n.jsx("span",{style:{fontWeight:500,color:"#4a5568"},children:new Date(C.mtime).toLocaleDateString()}),n.jsx("span",{style:{fontSize:11},children:new Date(C.mtime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):""}),n.jsx("td",{style:{padding:"12px 20px",textAlign:"right",color:"#4a5568",fontSize:13,fontFamily:"monospace",verticalAlign:"middle"},children:xn(C.size)}),n.jsx("td",{style:{padding:"12px 20px",textAlign:"right",verticalAlign:"middle"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:6},children:[n.jsx("button",{className:"btn",title:"Tlcharger",onClick:async()=>{try{const M=await K.get(`/templates/exports/${encodeURIComponent(C.fileName)}`,{responseType:"blob"}),X=new Blob([M.data],{type:"application/zip"}),ue=URL.createObjectURL(X),U=document.createElement("a");U.href=ue,U.download=C.fileName,document.body.appendChild(U),U.click(),U.remove(),URL.revokeObjectURL(ue),de("Tlchargement termin"),setTimeout(()=>de(""),3e3)}catch{Re("chec du tlchargement")}},style:{padding:"6px 10px",borderRadius:6,background:"#ebf8ff",color:"#3182ce",border:"1px solid #bee3f8",cursor:"pointer"},children:""}),n.jsx("button",{className:"btn",title:"Supprimer",onClick:async()=>{if(confirm(`Supprimer ${C.fileName} ?`))try{$t(C.fileName),await K.delete(`/templates/exports/${encodeURIComponent(C.fileName)}`),await Kn(),de("Export supprim"),setTimeout(()=>de(""),3e3)}catch{Re("chec de la suppression")}finally{$t(null)}},disabled:bt===C.fileName,style:{padding:"6px 10px",borderRadius:6,background:"#fff5f5",color:"#e53e3e",border:"1px solid #fed7d7",cursor:bt===C.fileName?"wait":"pointer",opacity:bt===C.fileName?.7:1},children:""})]})})]},C.fileName))})]})}),n.jsx("div",{style:{padding:"16px 32px",borderTop:"1px solid #edf2f7",background:"#f8fafc",display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{className:"btn secondary",onClick:()=>wt(!1),style:{padding:"10px 24px",background:"#fff",border:"1px solid #cbd5e0",color:"#4a5568",fontWeight:600,borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",cursor:"pointer"},children:"Fermer"})})]})}),oe&&Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:24,right:24,zIndex:2147483647,padding:"16px 24px",background:"#10b981",color:"white",borderRadius:8,fontWeight:600,fontSize:16,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:12,maxWidth:400,border:"1px solid rgba(255,255,255,0.2)",pointerEvents:"none"},children:[n.jsx("span",{style:{fontSize:24},children:""}),n.jsx("span",{style:{wordBreak:"break-word",lineHeight:1.4},children:oe})]}),document.body),Ie&&Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:100,right:24,zIndex:2147483647,padding:"16px 24px",background:"#ef4444",color:"white",borderRadius:8,fontWeight:600,fontSize:16,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:12,maxWidth:400,border:"1px solid rgba(255,255,255,0.2)",pointerEvents:"none"},children:[n.jsx("span",{style:{fontSize:24},children:""}),n.jsx("span",{style:{wordBreak:"break-word",lineHeight:1.4},children:Ie})]}),document.body)]}):n.jsxs("div",{style:{background:"#f5f7fa",minHeight:"100vh",padding:24},children:[n.jsx(jd,{}),n.jsx(im,{}),(o==null?void 0:o.signingPage)&&n.jsx("button",{onClick:()=>{const C=Math.max(0,Math.min(o.pages.length-1,(o.signingPage||1)-1));_(C),Pe&&setTimeout(()=>{const F=document.getElementById(`page-${C}`);F&&F.scrollIntoView({behavior:"smooth",block:"start"})},100)},title:"Aller  la page de signature",style:{position:"fixed",right:"70px",bottom:"30px",zIndex:999,padding:"10px 16px",borderRadius:24,background:"#3b82f6",color:"white",border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",fontWeight:600,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",gap:8},children:" Signature Page"}),n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:"20px 28px",marginBottom:24,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[n.jsxs("button",{className:"btn secondary",onClick:()=>{nt&&!window.confirm("Vous avez des modifications non enregistres. Quitter sans sauvegarder ?")||(a("list"),ua())},style:{padding:"10px 20px",display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{children:""})," Retour"]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"btn secondary",onClick:vt,disabled:tt<=0,title:"Annuler (Ctrl+Z)",style:{padding:"10px 14px",opacity:tt<=0?.5:1,cursor:tt<=0?"not-allowed":"pointer"},children:""}),n.jsx("button",{className:"btn secondary",onClick:Zt,disabled:tt>=Fe.length-1,title:"Rtablir (Ctrl+Y)",style:{padding:"10px 14px",opacity:tt>=Fe.length-1?.5:1,cursor:tt>=Fe.length-1?"not-allowed":"pointer"},children:""})]}),n.jsx("div",{style:{height:32,width:1,background:"#e0e0e0"}}),n.jsx("div",{children:n.jsx("h2",{style:{margin:0,fontSize:22,fontWeight:600,color:"#2d3436"},children:o.name||"Sans titre"})})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsxs("button",{onClick:()=>we(!be),title:be?"Dsactiver l'enregistrement automatique":"Activer l'enregistrement automatique",style:{padding:"6px 12px 6px 16px",height:38,display:"flex",alignItems:"center",gap:10,background:be?"rgba(85, 239, 196, 0.15)":"#f8f9fa",border:`1px solid ${be?"#55efc4":"#e2e8f0"}`,color:be?"#00b894":"#636e72",fontWeight:600,fontSize:13,borderRadius:20,transition:"all 0.2s ease",cursor:"pointer"},children:[n.jsx("span",{children:"Auto Save"}),n.jsx("div",{style:{width:32,height:18,borderRadius:12,background:be?"#00b894":"#cbd5e0",position:"relative",transition:"background 0.2s ease",flexShrink:0},children:n.jsx("div",{style:{position:"absolute",top:2,left:be?16:2,width:14,height:14,borderRadius:"50%",background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",transition:"all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)"}})})]}),n.jsx("div",{style:{height:24,width:1,background:"#e0e0e0"}}),o._id&&n.jsx("button",{className:"btn secondary",onClick:()=>mr(!0),title:"Voir l'historique des carnets lves",style:{padding:"10px 16px",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",gap:8,background:"#faf5ff",border:"1px solid #e9d5ff",color:"#7c3aed"},children:" Student Gradebook History"}),o._id&&n.jsx("button",{className:"btn secondary",onClick:()=>Kt(!0),title:"Voir l'historique des sauvegardes du template",style:{padding:"10px 16px",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",gap:8,background:"#eff6ff",border:"1px solid #bfdbfe",color:"#2563eb"},children:" Template History"}),n.jsx("button",{className:"btn",onClick:async()=>{try{Re(""),de(""),await rl(),de("Enregistr avec succs"),setTimeout(()=>de(""),3e3),await ua()}catch{Re("chec de l'enregistrement"),setTimeout(()=>Re(""),3e3)}},style:{padding:"12px 32px",fontSize:15,fontWeight:600,display:"flex",alignItems:"center",gap:8},children:" Enregistrer"})]})]}),oe&&Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:24,right:24,zIndex:2147483647,padding:"16px 24px",background:"#10b981",color:"white",borderRadius:8,fontWeight:600,fontSize:16,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:12,maxWidth:400,border:"1px solid rgba(255,255,255,0.2)",pointerEvents:"none"},children:[n.jsx("span",{style:{fontSize:24},children:""}),n.jsx("span",{style:{wordBreak:"break-word",lineHeight:1.4},children:oe})]}),document.body),Ie&&Qi.createPortal(n.jsxs("div",{style:{position:"fixed",top:100,right:24,zIndex:2147483647,padding:"16px 24px",background:"#ef4444",color:"white",borderRadius:8,fontWeight:600,fontSize:16,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:12,maxWidth:400,border:"1px solid rgba(255,255,255,0.2)",pointerEvents:"none"},children:[n.jsx("span",{style:{fontSize:24},children:""}),n.jsx("span",{style:{wordBreak:"break-word",lineHeight:1.4},children:Ie})]}),document.body),n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:"24px 28px",marginBottom:24,boxShadow:"0 2px 12px rgba(0,0,0,0.08)"},children:[n.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("div",{style:{flex:"1 1 300px",minWidth:200},children:[n.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#6c757d",marginBottom:6},children:"NOM DU TEMPLATE"}),n.jsx("input",{placeholder:"Nom du template",value:o.name,onChange:C=>l({...o,name:C.target.value}),style:{width:"100%",padding:"10px 14px",borderRadius:8,border:"2px solid #e9ecef",fontSize:15,transition:"all 0.2s"},onFocus:C=>C.target.style.borderColor="#667eea",onBlur:C=>C.target.style.borderColor="#e9ecef"})]}),n.jsxs("div",{style:{flex:"0 0 120px"},children:[n.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#6c757d",marginBottom:6},children:"PAGE SIGNATURE"}),n.jsx("input",{type:"number",min:1,placeholder:"#",value:o.signingPage||"",onChange:C=>l({...o,signingPage:parseInt(C.target.value)||void 0}),style:{width:"100%",padding:"10px 14px",borderRadius:8,border:"2px solid #e9ecef",fontSize:15,transition:"all 0.2s"},onFocus:C=>C.target.style.borderColor="#667eea",onBlur:C=>C.target.style.borderColor="#e9ecef"})]}),n.jsxs("div",{style:{flex:"0 0 auto"},children:[n.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#6c757d",marginBottom:6},children:"PAGE ACTIVE"}),n.jsx("select",{value:j,onChange:C=>_(Number(C.target.value)),style:{padding:"10px 14px",borderRadius:8,border:"2px solid #e9ecef",fontSize:15,minWidth:180,cursor:"pointer"},children:o.pages.map((C,F)=>n.jsx("option",{value:F,children:C.title||`Page ${F+1}`},F))})]}),n.jsx("div",{style:{flex:"0 0 auto",paddingTop:22},children:n.jsxs("button",{className:"btn secondary",onClick:()=>{const C=[...o.pages,{title:`Page ${o.pages.length+1}`,blocks:[]}];l({...o,pages:C}),_(C.length-1),A(null)},style:{padding:"10px 20px",display:"flex",alignItems:"center",gap:8,fontSize:14},children:[n.jsx("span",{style:{fontSize:18},children:"+"})," Nouvelle page"]})}),n.jsxs("div",{style:{flex:"0 0 auto"},children:[n.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#6c757d",marginBottom:6},children:"FOND PAGE"}),n.jsx("input",{type:"color",value:o.pages[j].bgColor||"#ffffff",onChange:C=>{const F=[...o.pages];F[j]={...F[j],bgColor:C.target.value},l({...o,pages:F})},style:{width:60,height:40,padding:4,borderRadius:8,border:"2px solid #e9ecef",cursor:"pointer"}})]})]}),n.jsxs("div",{style:{marginTop:20,paddingTop:20,borderTop:"1px solid #e9ecef",display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",background:"#f8f9fa",borderRadius:8,cursor:"pointer",fontSize:14},children:[n.jsx("input",{type:"checkbox",checked:B,onChange:C=>I(C.target.checked),style:{width:18,height:18,cursor:"pointer"}}),n.jsx("span",{children:"Magntisme"})]}),n.jsx("button",{className:"btn secondary",onClick:vi,disabled:!Be||Be.length===0,style:{fontSize:13,padding:"8px 14px",opacity:!Be||Be.length===0?.5:1},children:" Coller"}),n.jsx("button",{className:"btn secondary",onClick:()=>Z(!Pe),style:{padding:"8px 16px",fontSize:14},children:Pe?" Vue page par page":" Vue continue"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,background:"#f8f9fa",padding:"8px 14px",borderRadius:8},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",paddingRight:10,borderRight:"1px solid #dee2e6"},children:[n.jsx("input",{type:"checkbox",checked:q,onChange:C=>L(C.target.checked)}),n.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Auto"})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,minWidth:200},children:[n.jsx("span",{style:{fontSize:14},children:" Zoom"}),n.jsx("input",{type:"range",min:.5,max:2,step:.1,value:$,disabled:q,onChange:C=>E(parseFloat(C.target.value)),style:{flex:1,opacity:q?.5:1,cursor:q?"not-allowed":"pointer"}}),n.jsxs("span",{style:{fontWeight:600,minWidth:45,textAlign:"right",fontSize:14},children:[Math.round($*100),"%"]})]})]}),n.jsx("div",{style:{flex:1}}),n.jsxs("select",{value:S,onChange:C=>k(C.target.value),style:{padding:"8px 12px",borderRadius:8,border:"2px solid #e9ecef",fontSize:13},children:[n.jsx("option",{value:"",children:"Anne scolaire"}),h.map(C=>n.jsx("option",{value:C._id,children:C.name},C._id))]}),n.jsxs("select",{value:d,onChange:C=>f(C.target.value),style:{padding:"8px 12px",borderRadius:8,border:"2px solid #e9ecef",fontSize:13},children:[n.jsx("option",{value:"",children:"Classe"}),g.map(C=>n.jsx("option",{value:C._id,children:C.name},C._id))]}),n.jsxs("select",{value:c,onChange:C=>u(C.target.value),style:{padding:"8px 12px",borderRadius:8,border:"2px solid #e9ecef",fontSize:13},children:[n.jsx("option",{value:"",children:"lve"}),y.map(C=>n.jsxs("option",{value:C._id,children:[C.firstName," ",C.lastName]},C._id))]}),Fi&&n.jsx("button",{className:"btn secondary",onClick:async()=>{try{const C=String(K.defaults.baseURL||"").replace(/\/$/,""),F=PM(C,o._id||"",c),M=y.find(ue=>ue._id===c),X=M?`${M.firstName} ${M.lastName}`:"Aperu";wd(F,X,"single",1)}catch{Re("chec de l'export PDF")}},style:{padding:"8px 16px",fontSize:14},children:" Exporter en PDF"}),Qp&&n.jsx("a",{className:"btn secondary",href:Qp,target:"_blank",style:{padding:"8px 16px",fontSize:14,textDecoration:"none"},children:" Export classe"})]}),n.jsxs("details",{style:{marginTop:20},children:[n.jsx("summary",{style:{cursor:"pointer",padding:"12px 16px",background:"#f8f9fa",borderRadius:8,fontSize:14,fontWeight:600,color:"#6c757d",userSelect:"none"},children:" Actions avances"}),n.jsxs("div",{style:{marginTop:12,display:"flex",gap:10,flexWrap:"wrap",padding:"16px",background:"#f8f9fa",borderRadius:8},children:[n.jsx("button",{className:"btn secondary",onClick:async()=>{const C=new Blob([JSON.stringify(o)],{type:"application/json"}),F=new FormData;F.append("file",new File([C],`${o.name||"template"}.json`,{type:"application/json"})),await K.post("/media/upload?folder=gradebook-templates",F),de("Modle enregistr dans mdias avec succs"),setTimeout(()=>de(""),3e3)},style:{fontSize:13,padding:"8px 14px"},children:" Enregistrer dans mdias"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=new Blob([JSON.stringify(o)],{type:"application/json"}),F=URL.createObjectURL(C),M=document.createElement("a");M.href=F,M.download=`${o.name||"template"}.json`,document.body.appendChild(M),M.click(),M.remove(),URL.revokeObjectURL(F)},style:{fontSize:13,padding:"8px 14px"},children:" Tlcharger JSON"}),n.jsx("button",{className:"btn secondary",onClick:()=>{var C;return(C=ht.current)==null?void 0:C.click()},style:{fontSize:13,padding:"8px 14px"},children:" Importer PPTX"}),n.jsx("input",{type:"file",ref:ht,style:{display:"none"},accept:".pptx",onChange:Ww})]})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"260px minmax(0, 1fr) 300px",gap:24,alignItems:"start"},children:[n.jsxs("div",{style:{position:"sticky",top:24,maxHeight:"calc(100vh - 48px)",overflowY:"auto",background:"#fff",borderRadius:16,padding:"24px 20px",boxShadow:"0 2px 12px rgba(0,0,0,0.08)",overflowX:"hidden"},children:[n.jsx("h3",{style:{margin:"0 0 20px 0",fontSize:18,fontWeight:600,color:"#2d3436",display:"flex",alignItems:"center",gap:8},children:" Composants"}),[{title:"Gnral",items:[...at.filter(C=>["text","image","table","qr","line","arrow","rect","circle","gradebook_pocket"].includes(C.type))]},{title:"Promotion & Signatures",items:[...at.filter(C=>["promotion_info","teacher_text","signature_box","signature_date","signature","student_photo"].includes(C.type))]},{title:"lve",items:[...at.filter(C=>["dynamic_text"].includes(C.type))]},{title:"Interactif",items:[...at.filter(C=>["language_toggle","language_toggle_v2","dropdown","dropdown_reference"].includes(C.type))]}].map((C,F)=>n.jsxs("div",{style:{marginBottom:24},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase",letterSpacing:"0.5px"},children:C.title}),C.items.map((M,X)=>n.jsxs("div",{onClick:()=>Or(M),style:{padding:"12px 14px",marginBottom:8,background:"#f8f9fa",border:"2px solid #e9ecef",borderRadius:10,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"space-between"},onMouseEnter:ue=>{ue.currentTarget.style.background="#e7f5ff",ue.currentTarget.style.borderColor="#667eea",ue.currentTarget.style.transform="translateX(4px)"},onMouseLeave:ue=>{ue.currentTarget.style.background="#f8f9fa",ue.currentTarget.style.borderColor="#e9ecef",ue.currentTarget.style.transform="translateX(0)"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[n.jsxs("span",{style:{fontSize:20},children:[M.type==="text"&&"",M.type==="image"&&"",M.type==="table"&&"",M.type==="qr"&&"",M.type==="line"&&"",M.type==="arrow"&&"",M.type==="rect"&&"",M.type==="circle"&&"",M.type==="promotion_info"&&"",M.type==="teacher_text"&&"",M.type==="signature_box"&&"",M.type==="signature_date"&&"",M.type==="signature"&&"",M.type==="student_photo"&&"",M.type==="language_toggle"&&"",M.type==="language_toggle_v2"&&"",M.type==="dropdown"&&"",M.type==="dropdown_reference"&&"",M.type==="dynamic_text"&&"",M.type==="gradebook_pocket"&&""]}),n.jsx("span",{style:{fontSize:13,fontWeight:500},children:M.props.label||(M.type==="text"?"Texte":M.type==="image"?"Image":M.type==="table"?"Tableau":M.type==="qr"?"QR Code":M.type==="line"?"Ligne":M.type==="arrow"?"Flche":M.type==="rect"?"Rectangle":M.type==="circle"?"Cercle":M.type==="promotion_info"?"Info Passage":M.type==="teacher_text"?"Zone Texte Prof":M.type==="signature_box"?"Signature Box":M.type==="signature_date"?"Date Signature (Subadmin)":M.type==="signature"?"Signatures (Noms)":M.type==="student_photo"?"Photo lve":M.type==="language_toggle"?"Langues (V1)":M.type==="language_toggle_v2"?"Langues (V2)":M.type==="dropdown"?"Menu droulant":M.type==="dropdown_reference"?"Rfrence Dropdown":M.type==="dynamic_text"?"Texte Dynamique":M.type==="gradebook_pocket"?"Title":M.type)})]}),n.jsx("span",{style:{fontSize:18,color:"#667eea"},children:"+"})]},X))]},F))]}),n.jsx("div",{ref:O,style:{display:"flex",flexDirection:"column",gap:24,alignItems:"flex-start",minWidth:0,overflowX:q?"hidden":"auto",paddingBottom:24},children:(Pe?o.pages:[o.pages[j]]).map((C,F)=>{const M=Pe?F:j;return n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",minWidth:"fit-content"},children:[Pe&&n.jsxs("div",{style:{marginBottom:12,padding:"8px 16px",background:"#667eea",color:"#fff",borderRadius:20,fontSize:13,fontWeight:600},children:["Page ",M+1," / ",o.pages.length]}),n.jsx("div",{style:{transform:`scale(${$})`,transformOrigin:"top center",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",borderRadius:8,overflow:"hidden",border:j===M?"3px solid #667eea":"1px solid #ddd",transition:"all 0.3s ease"},children:n.jsxs("div",{className:"card page-canvas",id:`page-${M}`,style:{height:no,width:ga,background:C.bgColor||"#fff",position:"relative",margin:0},onMouseMove:X=>gn(X,M),onClick:()=>_(M),children:[n.jsx("div",{className:"page-margins",style:{border:"1px dashed #b2bec3"}}),me.map((X,ue)=>n.jsx("div",{style:{position:"absolute",left:X.type==="x"?X.pos:0,top:X.type==="y"?X.pos:0,width:X.type==="x"?1:"100%",height:X.type==="y"?1:"100%",background:"#ff0055",zIndex:1e3,pointerEvents:"none"}},ue)),C.blocks.map((X,ue)=>{if(!X)return null;const U={...X,props:X.props??{}},Ke=(b===ue||z.includes(ue))&&j===M;return n.jsxs("div",{style:{position:"absolute",left:U.props.x||0,top:U.props.y||0,zIndex:U.props.z??ue,border:Ke?"3px solid #667eea":"1px dashed rgba(0,0,0,0.2)",padding:6,borderRadius:8,background:Ke?"rgba(102, 126, 234, 0.05)":"transparent",boxShadow:Ke?"0 0 0 1px rgba(102, 126, 234, 0.2)":"none",cursor:"move",transition:"all 0.15s ease"},onMouseDown:he=>tl(he,M,ue),onClick:he=>{if(he.stopPropagation(),!qe.current)if(_(M),he.shiftKey||he.ctrlKey||he.metaKey){const Ee=new Set(z);b!==null&&Ee.add(b),Ee.has(ue)?(Ee.delete(ue),b===ue&&A(null)):(Ee.add(ue),A(ue)),D(Array.from(Ee))}else A(ue),D([])},onMouseEnter:he=>{Ke||(he.currentTarget.style.borderColor="rgba(102, 126, 234, 0.5)",he.currentTarget.style.background="rgba(102, 126, 234, 0.02)")},onMouseLeave:he=>{Ke||(he.currentTarget.style.borderColor="rgba(0,0,0,0.2)",he.currentTarget.style.background="transparent")},children:[U.type==="text"&&n.jsx("div",{style:{color:U.props.color,fontSize:U.props.fontSize,fontWeight:U.props.bold?700:400,textDecoration:U.props.underline?"underline":"none",width:U.props.width,height:U.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(U.props.runs)&&U.props.runs.length?U.props.runs.map((he,Ee)=>n.jsx("span",{style:{color:he&&typeof he=="object"&&typeof he.color=="string"&&he.color?he.color:U.props.color||void 0,fontWeight:he&&typeof he=="object"&&typeof he.bold=="boolean"?he.bold?700:400:U.props.bold?700:400,textDecoration:he&&typeof he=="object"&&typeof he.underline=="boolean"?he.underline?"underline":"none":U.props.underline?"underline":"none"},children:(he==null?void 0:he.text)||""},Ee)):U.props.text}),U.type==="image"&&n.jsx(n.Fragment,{children:Le===U.props.blockId?n.jsxs("div",{style:{position:"relative",width:U.props.width||120,height:U.props.height||120},children:[n.jsx("img",{src:U.props.url,style:{width:U.props.width||120,height:U.props.height||120,borderRadius:8}}),n.jsx(_ne,{imageUrl:U.props.url,imageWidth:U.props.width||120,imageHeight:U.props.height||120,initialCrop:U.props.cropData,onApply:he=>{const Ee=U.props.width||120,Ue=U.props.height||120,Xe=he.naturalWidth||Ee,Je=he.naturalHeight||Ue,ot=Ee/Xe,ct=Ue/Je,it=Math.max(20,Math.round(he.width*ot)),dt=Math.max(20,Math.round(he.height*ct));Ye({cropData:he,width:it,height:dt}),Q(null)},onCancel:()=>Q(null)})]}):n.jsx(Fo,{src:U.props.url,displayWidth:U.props.width||120,displayHeight:U.props.height||120,cropData:U.props.cropData,borderRadius:8})}),U.type==="student_photo"&&(()=>{let he="";if(c){const Ee=y.find(Ue=>Ue._id===c);Ee&&Ee.avatarUrl&&(he=Ee.avatarUrl)}return he?n.jsx("img",{src:he,style:{width:U.props.width||100,height:U.props.height||100,objectFit:"cover",borderRadius:8}}):n.jsxs("div",{style:{width:U.props.width||100,height:U.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:[n.jsx("div",{style:{fontSize:24},children:""}),n.jsx("div",{style:{fontSize:10,color:"#666"},children:"Photo"})]})})(),U.type==="rect"&&n.jsx("div",{style:{width:U.props.width,height:U.props.height,background:U.props.color,borderRadius:U.props.radius||8,border:U.props.stroke?`${U.props.strokeWidth||1}px solid ${U.props.stroke}`:"none"}}),U.type==="circle"&&n.jsx("div",{style:{width:(U.props.radius||60)*2,height:(U.props.radius||60)*2,background:U.props.color,borderRadius:"50%",border:U.props.stroke?`${U.props.strokeWidth||1}px solid ${U.props.stroke}`:"none"}}),U.type==="gradebook_pocket"&&n.jsx(nc,{number:U.props.number||"1",width:U.props.width||120,fontSize:U.props.fontSize}),U.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:U.props.direction||"column",alignItems:"center",gap:U.props.spacing||12},children:(U.props.items||[]).map((he,Ee)=>{const Xe=(U.props.radius||40)*2;return n.jsx("div",{style:{width:Xe,height:Xe,borderRadius:"50%",overflow:"hidden",position:"relative",cursor:"pointer",boxShadow:he.active?"0 0 0 2px #6c5ce7":"none"},onClick:Je=>{Je.stopPropagation();const ot=[...o.pages],ct={...ot[j]},it=[...ct.blocks],dt=[...it[ue].props.items||[]];dt[Ee]={...dt[Ee],active:!dt[Ee].active},it[ue]={...it[ue],props:{...it[ue].props,items:dt}},ot[j]={...ct,blocks:it},l({...o,pages:ot})},children:he.logo?n.jsx("img",{src:he.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:he.active?"brightness(1.1)":"brightness(0.6)"}}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},Ee)})}),U.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:U.props.direction||"row",alignItems:"center",justifyContent:"center",gap:U.props.spacing||12,background:U.props.backgroundColor||"transparent",borderRadius:U.props.borderRadius||12,padding:U.props.padding||8,width:U.props.width,height:U.props.height,boxSizing:"border-box"},children:(U.props.items||[]).map((he,Ee)=>{const ot=`https://emojicdn.elk.sh/${(ct=>{const it=ct.emoji;if(it&&it.length>=2)return it;const dt=(ct.code||"").toLowerCase();return dt==="lb"||dt==="ar"?"":dt==="fr"?"":dt==="en"||dt==="uk"||dt==="gb"?"":""})(he)}?style=apple`;return n.jsx("div",{title:he.label,style:{width:40,height:40,minWidth:40,borderRadius:"50%",background:he.active?"#fff":"rgba(255, 255, 255, 0.5)",border:he.active?"2px solid #2563eb":"1px solid rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",transform:he.active?"scale(1.1)":"scale(1)",boxShadow:he.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",filter:"none",opacity:he.active?1:.5},onClick:ct=>{ct.stopPropagation();const it=[...o.pages],dt={...it[j]},kt=[...dt.blocks],mt=[...kt[ue].props.items||[]];mt[Ee]={...mt[Ee],active:!mt[Ee].active},kt[ue]={...kt[ue],props:{...kt[ue].props,items:mt}},it[j]={...dt,blocks:kt},l({...o,pages:it})},onMouseEnter:ct=>ct.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",onMouseLeave:ct=>ct.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)",children:n.jsx("img",{src:ot,style:{width:40*.75,height:40*.75,objectFit:"contain"},alt:""})},Ee)})}),U.type==="line"&&n.jsx("div",{style:{width:U.props.x2||100,height:U.props.strokeWidth||2,background:U.props.stroke||"#b2bec3"}}),U.type==="arrow"&&n.jsx("div",{style:{width:U.props.x2||100,height:U.props.strokeWidth||2,background:U.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${U.props.stroke||"#6c5ce7"}`}})}),U.type==="dynamic_text"&&n.jsx("div",{style:{color:U.props.color,fontSize:U.props.fontSize,width:U.props.width,height:U.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let he=U.props.text||"";if(c){const Ee=y.find(Ue=>Ue._id===c);if(Ee){const Ue=Dn(Ee),Xe=Ue?`${Ue}.`:"",Je=[Ee.firstName,Xe,Ee.lastName].filter(Boolean).join(" ");he=he.replace(/{student.firstName}/g,Ee.firstName).replace(/{student.lastName}/g,Ee.lastName).replace(/{student.fatherInitial}/g,Xe).replace(/{student.fullNameFatherInitial}/g,Je).replace(/{student.dob}/g,Ee.dateOfBirth?new Date(Ee.dateOfBirth).toLocaleDateString():"").replace(/{student.dob_ddmmyyyy}/g,fr(Ee.dateOfBirth))}}return Object.entries(ne).forEach(([Ee,Ue])=>{he=he.replace(new RegExp(`{${Ee}}`,"g"),Ue)}),he})()}),U.type==="student_info"&&n.jsx("div",{style:{color:U.props.color,fontSize:U.props.fontSize,width:U.props.width,height:U.props.height,overflow:"hidden"},children:(()=>{if(c){const he=y.find(Ee=>Ee._id===c);if(he)return`${he.firstName} ${he.lastName}, ${he.className||"Classe"}, ${he.dateOfBirth?new Date(he.dateOfBirth).toLocaleDateString():"Date"}`}return"Nom, Classe, Naissance"})()}),U.type==="category_title"&&n.jsx("div",{style:{color:U.props.color,fontSize:U.props.fontSize,width:U.props.width,height:U.props.height,overflow:"hidden"},children:"Titre catgorie"}),U.type==="competency_list"&&n.jsx("div",{style:{color:U.props.color,fontSize:U.props.fontSize,width:U.props.width,height:U.props.height,overflow:"hidden"},children:"Liste des comptences"}),U.type==="signature"&&n.jsx("div",{style:{fontSize:U.props.fontSize,width:U.props.width,height:U.props.height,overflow:"hidden"},children:(U.props.labels||[]).join(" / ")}),U.type==="signature_box"&&n.jsx("div",{style:{width:U.props.width||200,height:U.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:U.props.label||"Signature"}),U.type==="signature_date"&&n.jsx("div",{style:{width:U.props.width||220,height:U.props.height||34,border:"1px dashed #94a3b8",background:"#f8fafc",display:"flex",alignItems:"center",justifyContent:U.props.align||"flex-start",padding:"0 8px",fontSize:U.props.fontSize||12,color:U.props.color||"#2d3436",overflow:"hidden",whiteSpace:"nowrap"},children:`${U.props.level||""} S${U.props.semester||1} : 14:01:2026`}),U.type==="promotion_info"&&n.jsx("div",{style:{width:U.props.width||(U.props.field?150:300),height:U.props.height||(U.props.field?30:100),border:"1px dashed #6c5ce7",background:"#f0f4ff",padding:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontSize:U.props.fontSize||12,color:U.props.color||"#2d3436",textAlign:"center"},children:(()=>{var hr;const he=c?y.find(Ft=>Ft._id===c):null,Ee=d?g.find(Ft=>Ft._id===d):null,Ue=(Ee==null?void 0:Ee.level)||(he==null?void 0:he.level);let Xe=he==null?void 0:he.nextLevel;if(!Xe&&Ue&&r&&r.length>0){const Ft=[...r].sort((lt,xt)=>lt.order-xt.order),Nt=Ft.findIndex(lt=>lt.name===Ue);Nt!==-1&&Nt<Ft.length-1&&(Xe=Ft[Nt+1].name)}const Je=(Ee==null?void 0:Ee.name)||(he==null?void 0:he.className),ot=he?`${he.firstName} ${he.lastName}`:"(Nom de l'lve)",ct=(S?h.find(Ft=>Ft._id===S):null)||(s?h.find(Ft=>Ft._id===s):null)||h.find(Ft=>Ft.active),it=(hr=ct==null?void 0:ct.name)==null?void 0:hr.match(/(\d{4})/);if(!it)return null;const dt=parseInt(it[1],10),kt=`${dt}/${dt+1}`,mt=dt+1,Dt=`Next Year ${`${mt}/${mt+1}`}`;return U.props.field?U.props.field==="level"?n.jsx("div",{style:{fontWeight:"bold"},children:Xe?`Passage en ${Xe}`:"(Passage)"}):U.props.field==="student"?n.jsx("div",{children:ot}):U.props.field==="studentFirstName"?n.jsx("div",{children:he?he.firstName:"(Prnom)"}):U.props.field==="studentLastName"?n.jsx("div",{children:he?he.lastName:"(Nom de famille)"}):U.props.field==="year"?n.jsx("div",{children:Dt}):U.props.field==="currentYear"?n.jsx("div",{children:kt}):U.props.field==="class"?n.jsx("div",{children:Je||(c?"":"(Classe)")}):U.props.field==="currentLevel"?n.jsx("div",{children:Ue||"(Niveau)"}):n.jsxs("div",{children:["Variable inconnue: ",U.props.field]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:Xe?`Passage en ${Xe}`:"(Passage)"}),n.jsx("div",{children:ot}),n.jsx("div",{style:{fontSize:"0.9em",opacity:.7},children:Dt})]})})()}),U.type==="teacher_text"&&n.jsxs("div",{style:{width:U.props.width||300,height:U.props.height||60,border:"1px dashed #e17055",background:"#fff5f5",padding:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontSize:U.props.fontSize||12,color:U.props.color||"#2d3436",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:10,fontWeight:"bold",color:"#e17055",marginBottom:4},children:" Zone Texte Prof Polyvalent"}),n.jsx("div",{style:{fontSize:U.props.fontSize||12,color:"#666",fontStyle:"italic"},children:U.props.placeholder||"Texte ditable par le prof polyvalent..."})]}),U.type==="dropdown"&&n.jsxs("div",{style:{width:U.props.width||200,position:"relative"},children:[n.jsxs("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:["Dropdown #",U.props.dropdownNumber||"?"]}),U.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:U.props.label}),n.jsxs("div",{style:{width:"100%",minHeight:U.props.height||32,fontSize:U.props.fontSize||12,color:U.props.color||"#333",padding:"4px 24px 4px 8px",borderRadius:4,border:"1px solid #ccc",background:"#fff",cursor:"pointer",position:"relative",display:"flex",alignItems:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},onClick:he=>{he.stopPropagation();const Ee=`dropdown_${j}_${ue}`;pt(xe===Ee?null:Ee)},onMouseDown:he=>he.stopPropagation(),children:[(U.props.dropdownNumber?ne[`dropdown_${U.props.dropdownNumber}`]:U.props.variableName?ne[U.props.variableName]:"")||"Slectionner...",n.jsx("div",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:""})]}),xe===`dropdown_${j}_${ue}`&&n.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,maxHeight:300,overflowY:"auto",background:"#fff",border:"1px solid #ccc",borderRadius:4,marginTop:2,zIndex:9999,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onClick:he=>he.stopPropagation(),children:[n.jsx("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:U.props.fontSize||12,color:"#999",borderBottom:"1px solid #eee"},onClick:he=>{he.stopPropagation(),U.props.variableName&&ee({...ne,[U.props.variableName]:""}),U.props.dropdownNumber&&ee({...ne,[`dropdown_${U.props.dropdownNumber}`]:""}),pt(null)},onMouseEnter:he=>he.currentTarget.style.background="#f5f5f5",onMouseLeave:he=>he.currentTarget.style.background="#fff",children:"Slectionner..."}),(U.props.options||[]).map((he,Ee)=>n.jsx("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:U.props.fontSize||12,wordWrap:"break-word",whiteSpace:"pre-wrap",borderBottom:Ee<(U.props.options||[]).length-1?"1px solid #eee":"none"},onClick:Ue=>{Ue.stopPropagation(),U.props.variableName&&ee({...ne,[U.props.variableName]:he}),U.props.dropdownNumber&&ee({...ne,[`dropdown_${U.props.dropdownNumber}`]:he}),pt(null)},onMouseEnter:Ue=>Ue.currentTarget.style.background="#e8ecf8",onMouseLeave:Ue=>Ue.currentTarget.style.background="#fff",children:he},Ee))]})]}),U.type==="dropdown_reference"&&n.jsx("div",{style:{width:U.props.width||200,minHeight:U.props.height||"auto",color:U.props.color||"#2d3436",fontSize:U.props.fontSize||12,padding:"8px",background:"#f0f4ff",border:"1px dashed #6c5ce7",borderRadius:4,wordWrap:"break-word",whiteSpace:"pre-wrap",overflow:"hidden"},children:(()=>{const he=U.props.dropdownNumber||1;return ne[`dropdown_${he}`]||""||`[Dropdown #${he}]`})()}),U.type==="table"&&(()=>{const he=xt=>{const Gt=typeof xt=="number"?xt:parseFloat(String(xt||"0"));return isNaN(Gt)?0:Gt},Ee=(U.props.columnWidths||[]).map(he),Ue=(U.props.rowHeights||[]).map(he),Xe=U.props.cells||[],Je=he(U.props.colGap),ot=he(U.props.rowGap),ct=U.props.expandedRows||!1,it=he(U.props.expandedRowHeight||34),dt=he(U.props.expandedDividerWidth||.5),kt=U.props.expandedDividerColor||fh,mt=4,Xt=6,Dt=U.props.expandedLanguages||[{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1},{code:"ar",label:"Lebanese",emoji:"",active:!1}];let hr=0;const Ft=[0];for(let xt=0;xt<Ee.length;xt++)hr+=Ee[xt]||0,Ft[xt+1]=hr,hr+=Je;Ee.length>0&&(hr-=Je);let Nt=0;const lt=[0];for(let xt=0;xt<Ue.length;xt++)Nt+=Ue[xt]||0,ct&&(Nt+=it+mt+Xt),lt[xt+1]=Nt,Nt+=ot;return Ue.length>0&&(Nt-=ot),n.jsxs("div",{style:{position:"relative",width:hr,height:Nt,display:ct?"flex":"grid",flexDirection:"column",gap:`${ot}px ${Je}px`,gridTemplateColumns:ct?void 0:Ee.map(xt=>`${Math.max(1,xt)}px`).join(" "),gridTemplateRows:ct?void 0:Ue.map(xt=>`${Math.max(1,xt)}px`).join(" "),overflow:"visible",background:ot>0||Je>0?"transparent":U.props.backgroundColor||"transparent",borderRadius:ot>0||Je>0?0:U.props.borderRadius||0},children:[ct?Xe.map((xt,Gt)=>{var zr;const sr=U.props.borderRadius||0,an=Gt===0,ar=Gt===Ue.length-1,or=ot>0,er=((zr=xt[0])==null?void 0:zr.fill)||U.props.backgroundColor||"#f8f9fa",tr=Ue[Gt]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",width:hr,boxSizing:"border-box"},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:Ee.map(cr=>`${Math.max(1,cr)}px`).join(" "),columnGap:Je,height:tr,width:"100%",boxSizing:"border-box"},children:xt.map((cr,Xr)=>{var ac,nl,Gn,yn;const Ls=(ac=cr==null?void 0:cr.borders)==null?void 0:ac.l,Vn=(nl=cr==null?void 0:cr.borders)==null?void 0:nl.r,on=(Gn=cr==null?void 0:cr.borders)==null?void 0:Gn.t;(yn=cr==null?void 0:cr.borders)==null||yn.b;const $s=Xr===0,as=Xr===Ee.length-1,Vt={background:(cr==null?void 0:cr.fill)||(or&&U.props.backgroundColor?U.props.backgroundColor:"transparent"),borderLeft:Ls!=null&&Ls.width?`${Ls.width}px solid ${Ls.color||"#000"}`:"none",borderRight:Vn!=null&&Vn.width?`${Vn.width}px solid ${Vn.color||"#000"}`:"none",borderTop:on!=null&&on.width?`${on.width}px solid ${on.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:$s&&(or||an)?sr:0,borderTopRightRadius:as&&(or||an)?sr:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,display:"flex",alignItems:"center",overflow:"hidden"},qn=b===ue&&T&&T.ri===Gt&&T.ci===Xr;return n.jsx("div",{style:{...Vt,outline:qn?"2px solid #6c5ce7":"none"},onMouseDown:bs=>{bs.stopPropagation()},onClick:bs=>{bs.stopPropagation(),A(ue),W({ri:Gt,ci:Xr})},children:(cr==null?void 0:cr.text)&&n.jsx("div",{style:{fontSize:cr.fontSize||12,color:cr.color||"#000",whiteSpace:"pre-wrap"},children:cr.text})},`cell-${Gt}-${Xr}`)})}),n.jsxs("div",{style:{background:er,borderBottomLeftRadius:or||ar?sr:0,borderBottomRightRadius:or||ar?sr:0,height:it,position:"relative",paddingBottom:mt,width:"100%",boxSizing:"border-box"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:dt,background:kt,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:Xt,gap:8},children:(()=>{var Ls;const cr=((Ls=U.props.rowLanguages)==null?void 0:Ls[Gt])||Dt,Xr=U.props.expandedToggleStyle||"v2";return cr.map((Vn,on)=>{const $s=Math.max(12,Math.min(it-12,20)),as=Vn.active,Vt=Gn=>{Gn.stopPropagation();const yn=[...o.pages],bs={...yn[j]},mx=[...bs.blocks],xx={...mx[ue]},sl={...xx.props};if(sl.rowLanguages&&sl.rowLanguages[Gt]){const il=[...sl.rowLanguages||[]],yx=[...il[Gt]||[]];yx[on]={...yx[on],active:!as},il[Gt]=yx,sl.rowLanguages=il}else{const il=[...sl.expandedLanguages||[{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1},{code:"ar",label:"Lebanese",emoji:"",active:!1}]];il[on]={...il[on],active:!as},sl.expandedLanguages=il}xx.props=sl,mx[ue]=xx,bs.blocks=mx,yn[j]=bs,l({...o,pages:yn})};if(Xr==="v1"){const Gn=Vn.logo||(()=>{const yn=(Vn.code||"").toLowerCase();return yn==="en"||yn==="uk"||yn==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":yn==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":yn==="ar"||yn==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:$s,height:$s,borderRadius:"50%",overflow:"hidden",position:"relative",cursor:"pointer",boxShadow:as?"0 0 0 2px #6c5ce7":"none",opacity:as?1:.6},onClick:Vt,onMouseDown:yn=>yn.stopPropagation(),children:Gn?n.jsx("img",{src:Gn,style:{width:"100%",height:"100%",objectFit:"cover",filter:as?"brightness(1.1)":"brightness(0.6)"}}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},on)}const nl=`https://emojicdn.elk.sh/${(Gn=>{const yn=Gn.emoji;if(yn&&yn.length>=2)return yn;const bs=(Gn.code||"").toLowerCase();return bs==="lb"||bs==="ar"?"":bs==="fr"?"":bs==="en"||bs==="uk"||bs==="gb"?"":""})(Vn)}?style=apple`;return n.jsx("div",{title:Vn.label,style:{width:$s,height:$s,minWidth:$s,borderRadius:"50%",background:as?"#fff":"rgba(255, 255, 255, 0.5)",border:as?"0.5px solid #fff":"1px solid rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",transform:as?"scale(1.1)":"scale(1)",boxShadow:"none",opacity:as?1:.6},onClick:Vt,onMouseDown:Gn=>Gn.stopPropagation(),children:n.jsx("img",{src:nl,style:{width:$s*.7,height:$s*.7,objectFit:"contain"},alt:""})},on)})})()})]})]},`row-unit-${Gt}`)}):Xe.flatMap((xt,Gt)=>xt.map((sr,an)=>{var Vt,qn,ac,nl;const ar=(Vt=sr==null?void 0:sr.borders)==null?void 0:Vt.l,or=(qn=sr==null?void 0:sr.borders)==null?void 0:qn.r,er=(ac=sr==null?void 0:sr.borders)==null?void 0:ac.t,tr=(nl=sr==null?void 0:sr.borders)==null?void 0:nl.b,zr=U.props.borderRadius||0,cr=an===0,Xr=an===Ee.length-1,Ls=Gt===0,Vn=Gt===Ue.length-1,on=ot>0,$s={background:(sr==null?void 0:sr.fill)||(on&&U.props.backgroundColor?U.props.backgroundColor:"transparent"),borderLeft:ar!=null&&ar.width?`${ar.width}px solid ${ar.color||"#000"}`:"none",borderRight:or!=null&&or.width?`${or.width}px solid ${or.color||"#000"}`:"none",borderTop:er!=null&&er.width?`${er.width}px solid ${er.color||"#000"}`:"none",borderBottom:tr!=null&&tr.width?`${tr.width}px solid ${tr.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:cr&&(on||Ls)?zr:0,borderBottomLeftRadius:cr&&(on||Vn)?zr:0,borderTopRightRadius:Xr&&(on||Ls)?zr:0,borderBottomRightRadius:Xr&&(on||Vn)?zr:0,display:"flex",alignItems:"center",overflow:"hidden"},as=b===ue&&T&&T.ri===Gt&&T.ci===an;return n.jsx("div",{style:{...$s,outline:as?"2px solid #6c5ce7":"none"},onMouseDown:Gn=>{Gn.stopPropagation()},onClick:Gn=>{Gn.stopPropagation(),A(ue),W({ri:Gt,ci:an})},children:(sr==null?void 0:sr.text)&&n.jsx("div",{style:{fontSize:sr.fontSize||12,color:sr.color||"#000",whiteSpace:"pre-wrap"},children:sr.text})},`${Gt}-${an}`)})),Ee.map((xt,Gt)=>n.jsx("div",{style:{position:"absolute",left:Math.max(0,(Ft[Gt+1]||0)-3),top:0,width:6,height:Nt,cursor:"col-resize",zIndex:10},onMouseDown:sr=>{sr.stopPropagation();const an=sr.clientX,ar=Ee[Gt]||0,or=tr=>{const zr=(tr.clientX-an)/$,cr=[...Ee];cr[Gt]=Math.max(10,Math.round(ar+zr)),qt(Xr=>({...Xr,columnWidths:cr}))},er=()=>{window.removeEventListener("mousemove",or),window.removeEventListener("mouseup",er)};window.addEventListener("mousemove",or),window.addEventListener("mouseup",er)}},`col-h-${Gt}`)),Ue.map((xt,Gt)=>n.jsx("div",{style:{position:"absolute",left:0,top:Math.max(0,(lt[Gt+1]||0)-3-ot*0),width:hr,height:6,cursor:"row-resize",zIndex:10},onMouseDown:sr=>{sr.stopPropagation();const an=sr.clientY,ar=Ue[Gt]||0,or=tr=>{const zr=(tr.clientY-an)/$,cr=[...Ue];cr[Gt]=Math.max(10,Math.round(ar+zr)),qt(Xr=>({...Xr,rowHeights:cr}))},er=()=>{window.removeEventListener("mousemove",or),window.removeEventListener("mouseup",er)};window.addEventListener("mousemove",or),window.addEventListener("mouseup",er)}},`row-h-${Gt}`))]})})(),["image","text","dynamic_text","student_info","student_photo","category_title","competency_list","signature","signature_box","signature_date","promotion_info","teacher_text","language_toggle","language_toggle_v2","gradebook_pocket","rect"].includes(U.type)&&b===ue&&j===M&&n.jsx(n.Fragment,{children:["nw","n","ne","e","se","s","sw","w"].map(he=>{const Ee={position:"absolute",width:10,height:10,background:"#fff",border:"1px solid #6c5ce7",borderRadius:"50%",zIndex:10,cursor:`${he}-resize`};return he.includes("n")&&(Ee.top=-5),he.includes("s")&&(Ee.bottom=-5),he.includes("w")&&(Ee.left=-5),he.includes("e")&&(Ee.right=-5),(he==="n"||he==="s")&&(Ee.left="calc(50% - 5px)"),(he==="e"||he==="w")&&(Ee.top="calc(50% - 5px)"),n.jsx("div",{style:Ee,onMouseDown:Ue=>{Ue.stopPropagation();const Xe=Ue.clientX,Je=Ue.clientY,ot=U.props.width||(U.type==="text"?120:U.type==="language_toggle"?80:U.type==="language_toggle_v2"?300:120),ct=U.props.height||(U.type==="text"?60:U.type==="language_toggle"?200:U.type==="language_toggle_v2"?100:120),it=U.props.x||0,dt=U.props.y||0,kt=Xt=>{const Dt=Xt.clientX-Xe,hr=Xt.clientY-Je;let Ft=ot,Nt=ct,lt=it,xt=dt;he.includes("e")&&(Ft=Math.max(20,ot+Dt)),he.includes("s")&&(Nt=Math.max(20,ct+hr)),he.includes("w")&&(Ft=Math.max(20,ot-Dt),lt=it+(ot-Ft)),he.includes("n")&&(Nt=Math.max(20,ct-hr),xt=dt+(ct-Nt));const Gt={width:Ft,height:Nt,x:lt,y:xt};if(U.type==="language_toggle"){const sr=(U.props.direction||"column")==="column";Gt.radius=sr?Ft/2:Nt/2}Ye(Gt)},mt=()=>{window.removeEventListener("mousemove",kt),window.removeEventListener("mouseup",mt)};window.addEventListener("mousemove",kt),window.addEventListener("mouseup",mt)}},he)})})]},U.props.blockId||`block-${M}-${ue}`)})]})})]},M)})}),n.jsxs("div",{className:"template-builder-right-panel",style:{position:"sticky",top:24,maxHeight:"calc(100vh - 48px)",overflowY:"auto",background:"#fff",borderRadius:16,padding:"24px 20px",boxShadow:"0 2px 12px rgba(0,0,0,0.08)",overflowX:"hidden",minWidth:0},children:[n.jsxs("div",{style:{display:"flex",gap:8,marginBottom:20},children:[n.jsx("button",{className:te==="properties"?"btn":"btn secondary",onClick:()=>G("properties"),style:{flex:1,padding:"10px 16px",fontSize:14,fontWeight:600},children:" Proprits"}),n.jsx("button",{className:te==="slides"?"btn":"btn secondary",onClick:()=>G("slides"),style:{flex:1,padding:"10px 16px",fontSize:14,fontWeight:600},children:" Pages"})]}),te==="slides"?n.jsxs("div",{style:{display:"grid",gap:12},children:[n.jsxs("h3",{children:["Pages (",o.pages.length,")"]}),o.pages.map((C,F)=>n.jsxs("div",{className:"card",style:{padding:8,background:j===F?"#f0f4ff":"#fff",border:j===F?"2px solid var(--accent)":"1px solid #ddd"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsx("div",{style:{fontWeight:600,fontSize:14},onClick:()=>_(F),children:C.title||`Page ${F+1}`}),n.jsxs("div",{style:{display:"flex",gap:4},children:[n.jsx("button",{className:"btn secondary",style:{padding:"4px 8px",fontSize:11},onClick:()=>{if(F===0)return;const M=[...o.pages],X=M[F];M[F]=M[F-1],M[F-1]=X,l({...o,pages:M}),_(F-1)},disabled:F===0,children:""}),n.jsx("button",{className:"btn secondary",style:{padding:"4px 8px",fontSize:11},onClick:()=>{if(F===o.pages.length-1)return;const M=[...o.pages],X=M[F];M[F]=M[F+1],M[F+1]=X,l({...o,pages:M}),_(F+1)},disabled:F===o.pages.length-1,children:""}),n.jsx("button",{className:"btn secondary",style:{padding:"4px 8px",fontSize:11,background:"#ef4444",color:"#fff"},onClick:()=>{if(o.pages.length<=1||!confirm(`Supprimer "${C.title||`Page ${F+1}`}" ?`))return;const M=o.pages.filter((X,ue)=>ue!==F);l({...o,pages:M}),j>=M.length&&_(M.length-1)},children:""})]})]}),n.jsx("div",{style:{width:"100%",aspectRatio:`${ga}/${no}`,background:C.bgColor||"#fff",border:"1px solid #ccc",borderRadius:4,overflow:"hidden",position:"relative",cursor:"pointer",transform:"scale(0.95)"},onClick:()=>_(F),children:C.blocks.map((M,X)=>n.jsxs("div",{style:{position:"absolute",left:`${(M.props.x||0)/ga*100}%`,top:`${(M.props.y||0)/no*100}%`,fontSize:6,opacity:.7},children:[M.type==="text"&&n.jsx("div",{style:{color:M.props.color,fontSize:(M.props.fontSize||12)*.3,fontWeight:M.props.bold?700:400,textDecoration:M.props.underline?"underline":"none"},children:Array.isArray(M.props.runs)&&M.props.runs.length?M.props.runs.map(U=>String((U==null?void 0:U.text)||"")).join("").slice(0,20):(M.props.text||"").slice(0,20)}),M.type==="image"&&n.jsx(Fo,{src:M.props.url,displayWidth:(M.props.width||120)*.3,displayHeight:(M.props.height||120)*.3,cropData:M.props.cropData,borderRadius:2}),M.type==="rect"&&n.jsx("div",{style:{width:(M.props.width||80)*.3,height:(M.props.height||80)*.3,background:M.props.color,borderRadius:2}}),M.type==="gradebook_pocket"&&n.jsx("div",{style:{width:(M.props.width||120)*.3,height:(M.props.width||120)*.33,background:M.props.pocketFillColor||"#3498db",borderRadius:"2px 2px 8px 8px"}}),M.type==="signature_box"&&n.jsx("div",{style:{width:(M.props.width||200)*.3,height:(M.props.height||80)*.3,border:"none",background:"#fff"}}),M.type==="signature_date"&&n.jsx("div",{style:{width:(M.props.width||220)*.3,height:(M.props.height||34)*.3,border:"1px dashed #94a3b8",background:"#f8fafc"}})]},X))}),n.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"center"},children:n.jsx("button",{className:"btn secondary",style:{padding:"4px 12px",fontSize:11},onClick:()=>{const M=[...o.pages],X={title:`Page ${M.length+1}`,blocks:[]};M.splice(F+1,0,X),l({...o,pages:M}),_(F+1)},children:"+ Ajouter aprs"})}),n.jsx("div",{style:{marginTop:8,borderTop:"1px solid #eee",paddingTop:8},children:n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:C.excludeFromPdf||!1,onChange:M=>{const X=[...o.pages];X[F]={...X[F],excludeFromPdf:M.target.checked},l({...o,pages:X})}}),"Exclure du PDF"]})})]},F))]}):n.jsxs("div",{style:{display:"contents"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[n.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:600,color:"#2d3436"},children:z.length>1?`${z.length} blocs slectionns`:"Proprits du bloc"}),(z.length>0||b!==null)&&n.jsxs("button",{className:"btn secondary",style:{padding:"6px 12px",fontSize:12,color:"#e74c3c",borderColor:"#e74c3c",background:"#fff",display:"flex",alignItems:"center",gap:6},onClick:()=>{if(!confirm("Supprimer la slection ?"))return;const C=[...o.pages],F={...C[j]},M=new Set(z);b!==null&&M.add(b);const X=F.blocks.filter((ue,U)=>!M.has(U));C[j]={...F,blocks:X},Se({...o,pages:C}),A(null),D([])},title:"Supprimer la slection",children:[n.jsx("span",{children:""})," Supprimer"]})]}),z.length>1&&n.jsxs("div",{style:{marginBottom:16,padding:12,background:"#f0f4ff",borderRadius:10},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase"},children:"Alignement (sur le 1er slectionn)"}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginBottom:10},children:[n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Aligner  gauche sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]].props.x||0;z.forEach(ue=>{M[ue]={...M[ue],props:{...M[ue].props,x:X}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Gauche"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Centrer horizontalement sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]],ue=(X.props.x||0)+(X.props.width||100)/2;z.forEach(U=>{const he=M[U].props.width||100;M[U]={...M[U],props:{...M[U].props,x:ue-he/2}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Centre H"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Aligner  droite sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]],ue=(X.props.x||0)+(X.props.width||100);z.forEach(U=>{const he=M[U].props.width||100;M[U]={...M[U],props:{...M[U].props,x:ue-he}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Droite"})]}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginBottom:10},children:[n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Aligner en haut sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]].props.y||0;z.forEach(ue=>{M[ue]={...M[ue],props:{...M[ue].props,y:X}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Haut"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Centrer verticalement sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]],ue=(X.props.y||0)+(X.props.height||100)/2;z.forEach(U=>{const he=M[U].props.height||100;M[U]={...M[U],props:{...M[U].props,y:ue-he/2}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Centre V"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Aligner en bas sur le premier",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=M[z[0]],ue=(X.props.y||0)+(X.props.height||100);z.forEach(U=>{const he=M[U].props.height||100;M[U]={...M[U],props:{...M[U].props,y:ue-he}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Bas"})]}),n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,marginTop:12,textTransform:"uppercase"},children:"Distribution"}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Distribuer horizontalement",disabled:z.length<3,onClick:()=>{if(z.length<3)return;const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=[...z].sort((Je,ot)=>(M[Je].props.x||0)-(M[ot].props.x||0)),ue=M[X[0]],U=M[X[X.length-1]],Ke=ue.props.x||0,he=(U.props.x||0)+(U.props.width||100),Ee=X.reduce((Je,ot)=>Je+(M[ot].props.width||100),0),Ue=(he-Ke-Ee)/(X.length-1);let Xe=Ke;X.forEach(Je=>{const ot=M[Je].props.width||100;M[Je]={...M[Je],props:{...M[Je].props,x:Xe}},Xe+=ot+Ue}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Espacer H"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Distribuer verticalement",disabled:z.length<3,onClick:()=>{if(z.length<3)return;const C=[...o.pages],F={...C[j]},M=[...F.blocks],X=[...z].sort((Je,ot)=>(M[Je].props.y||0)-(M[ot].props.y||0)),ue=M[X[0]],U=M[X[X.length-1]],Ke=ue.props.y||0,he=(U.props.y||0)+(U.props.height||100),Ee=X.reduce((Je,ot)=>Je+(M[ot].props.height||100),0),Ue=(he-Ke-Ee)/(X.length-1);let Xe=Ke;X.forEach(Je=>{const ot=M[Je].props.height||100;M[Je]={...M[Je],props:{...M[Je].props,y:Xe}},Xe+=ot+Ue}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Espacer V"}),n.jsx("button",{className:"btn secondary",style:{padding:"6px 10px",fontSize:11},title:"Centrer sur la page",onClick:()=>{const C=[...o.pages],F={...C[j]},M=[...F.blocks];let X=1/0,ue=1/0,U=-1/0,Ke=-1/0;z.forEach(Je=>{const ot=M[Je],ct=ot.props.x||0,it=ot.props.y||0,dt=ot.props.width||100,kt=ot.props.height||100;X=Math.min(X,ct),ue=Math.min(ue,it),U=Math.max(U,ct+dt),Ke=Math.max(Ke,it+kt)});const he=U-X,Ee=Ke-ue,Ue=(ga-he)/2-X,Xe=(no-Ee)/2-ue;z.forEach(Je=>{const ot=M[Je];M[Je]={...M[Je],props:{...M[Je].props,x:(ot.props.x||0)+Ue,y:(ot.props.y||0)+Xe}}}),C[j]={...F,blocks:M},Se({...o,pages:C})},children:" Centrer Page"})]})]}),b!=null&&((Uw=o.pages[j])!=null&&Uw.blocks[b])?n.jsxs("div",{style:{display:"grid",gap:12},children:[n.jsx("div",{style:{padding:"10px 14px",background:"#f0f4ff",borderRadius:8,fontSize:13,fontWeight:600,color:"#667eea",textAlign:"center"},children:o.pages[j].blocks[b].type.toUpperCase()}),n.jsxs("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Position"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"X"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.x||0,onChange:C=>Ye({x:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Y"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.y||0,onChange:C=>Ye({y:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]})]}),n.jsxs("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Ordre d'affichage"}),n.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:n.jsx("input",{placeholder:"Z-index",type:"number",value:o.pages[j].blocks[b].props.z??b,onChange:C=>Ye({z:Number(C.target.value)}),style:{flex:1,padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"btn secondary",onClick:()=>{const C=o.pages[j].blocks.map(M=>{var X;return((X=M.props)==null?void 0:X.z)??0}),F=C.length?Math.max(...C):0;Ye({z:F+1})},style:{flex:1,padding:"8px 12px",fontSize:12},children:" Devant"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=o.pages[j].blocks.map(M=>{var X;return((X=M.props)==null?void 0:X.z)??0}),F=C.length?Math.min(...C):0;Ye({z:F-1})},style:{flex:1,padding:"8px 12px",fontSize:12},children:" Derrire"})]})]}),n.jsxs("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Style"}),n.jsxs("div",{style:{marginBottom:8},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Couleur"}),n.jsx("input",{type:"color",value:o.pages[j].blocks[b].props.color||"#000000",onChange:C=>Ye({color:C.target.value}),style:{width:"100%",height:40,padding:4,borderRadius:6,border:"2px solid #e9ecef",cursor:"pointer"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Taille police"}),n.jsx("input",{placeholder:"Taille",type:"number",value:o.pages[j].blocks[b].props.fontSize||o.pages[j].blocks[b].props.size||12,onChange:C=>Ye({fontSize:Number(C.target.value),size:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),o.pages[j].blocks[b].type==="text"&&n.jsxs("div",{style:{marginTop:10},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:6,fontWeight:600},children:"Texte"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsx("button",{className:"btn secondary",style:{padding:"8px 10px",fontSize:13,fontWeight:700,borderRadius:6,border:"2px solid #e9ecef",background:o.pages[j].blocks[b].props.bold?"#667eea":"#fff",color:o.pages[j].blocks[b].props.bold?"#fff":"#2d3436"},onClick:()=>Ye({bold:!o.pages[j].blocks[b].props.bold}),children:"Bold"}),n.jsx("button",{className:"btn secondary",style:{padding:"8px 10px",fontSize:13,fontWeight:700,borderRadius:6,border:"2px solid #e9ecef",background:o.pages[j].blocks[b].props.underline?"#667eea":"#fff",color:o.pages[j].blocks[b].props.underline?"#fff":"#2d3436",textDecoration:"underline"},onClick:()=>Ye({underline:!o.pages[j].blocks[b].props.underline}),children:"Underline"})]})]})]}),o.pages[j].blocks[b].type==="text"&&n.jsxs("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:8,fontWeight:600},children:"CONTENU"}),n.jsx("textarea",{placeholder:"Texte",rows:4,value:(()=>{const C=o.pages[j].blocks[b];return Array.isArray(C.props.runs)&&C.props.runs.length?C.props.runs.map(F=>String((F==null?void 0:F.text)||"")).join(""):C.props.text||""})(),onChange:C=>Ye({text:C.target.value,runs:null}),onSelect:C=>{const F=Number(C.currentTarget.selectionStart??0),M=Number(C.currentTarget.selectionEnd??0);Ze(F===M?null:{start:F,end:M})},style:{width:"100%",padding:"10px 12px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13,fontFamily:"inherit",resize:"vertical"}}),(()=>{const C=o.pages[j].blocks[b],F=Qe;if(!F||C.type!=="text")return null;const M=!!C.props.bold,X=!!C.props.underline,ue=zs(C.props),U=mi(ue,F.start,F.end,{bold:M,underline:X});return U.any?n.jsxs("div",{style:{marginTop:10},children:[n.jsxs("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:6,fontWeight:600},children:["Slection (",Math.max(0,F.end-F.start)," caractres)"]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[n.jsx("button",{className:"btn secondary",style:{padding:"8px 10px",fontSize:13,fontWeight:700,borderRadius:6,border:"2px solid #e9ecef",background:U.allBold?"#667eea":"#fff",color:U.allBold?"#fff":"#2d3436"},onClick:()=>{const Ke=!U.allBold,he=_r(C.props,F,{bold:Ke});Ye({text:he.text,runs:he.runs})},children:"Bold"}),n.jsx("button",{className:"btn secondary",style:{padding:"8px 10px",fontSize:13,fontWeight:700,borderRadius:6,border:"2px solid #e9ecef",background:U.allUnderline?"#667eea":"#fff",color:U.allUnderline?"#fff":"#2d3436",textDecoration:"underline"},onClick:()=>{const Ke=!U.allUnderline,he=_r(C.props,F,{underline:Ke});Ye({text:he.text,runs:he.runs})},children:"Underline"})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[n.jsx("input",{type:"color",value:String(C.props.color||"#000000"),onChange:Ke=>{const he=_r(C.props,F,{color:Ke.target.value});Ye({text:he.text,runs:he.runs})},style:{width:"100%",height:38,padding:4,borderRadius:6,border:"2px solid #e9ecef",cursor:"pointer"}}),n.jsx("button",{className:"btn secondary",style:{padding:"8px 10px",fontSize:12},onClick:()=>Ze(null),children:"Clear"})]})]}):null})()]}),o.pages[j].blocks[b].type==="image"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:8,fontWeight:600},children:"URL IMAGE"}),n.jsx("input",{placeholder:"URL image",value:o.pages[j].blocks[b].props.url||"",onChange:C=>Ye({url:C.target.value}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13,marginBottom:8}}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Largeur"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.width||120,onChange:C=>Ye({width:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Hauteur"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.height||120,onChange:C=>Ye({height:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]}),n.jsxs("label",{style:{display:"block",padding:"10px 14px",background:"#667eea",color:"#fff",borderRadius:6,textAlign:"center",cursor:"pointer",fontSize:13,fontWeight:600},children:[" Tlcharger une image",n.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:async C=>{var U;const F=(U=C.target.files)==null?void 0:U[0];if(!F)return;const M=new FormData;M.append("file",F);const ue=await(await fetch("/media/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:M})).json();ue!=null&&ue.url&&(Ye({url:ue.url}),await zd())}})]}),o.pages[j].blocks[b].props.url&&n.jsx("button",{onClick:()=>Q(o.pages[j].blocks[b].props.blockId||null),style:{display:"block",width:"100%",padding:"10px 14px",background:Le===o.pages[j].blocks[b].props.blockId?"#dc3545":"#28a745",color:"#fff",border:"none",borderRadius:6,textAlign:"center",cursor:"pointer",fontSize:13,fontWeight:600,marginTop:8},children:Le===o.pages[j].blocks[b].props.blockId?" Annuler le recadrage":" Recadrer l'image"}),o.pages[j].blocks[b].props.cropData&&n.jsx("button",{onClick:()=>Ye({cropData:void 0}),style:{display:"block",width:"100%",padding:"8px 14px",background:"#dc3545",color:"#fff",border:"none",borderRadius:6,textAlign:"center",cursor:"pointer",fontSize:12,fontWeight:500,marginTop:4},children:" Supprimer le recadrage"})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:w.filter(C=>C.type==="file").map(C=>n.jsxs("div",{className:"card",style:{padding:4,cursor:"pointer"},onClick:()=>Ye({url:`/uploads${C.path}`}),children:[n.jsx("img",{src:`/uploads${C.path}`,style:{width:"100%",height:80,objectFit:"cover",borderRadius:6}}),n.jsx("div",{className:"note",style:{fontSize:10,marginTop:4},children:C.name})]},C.path))})]}),o.pages[j].blocks[b].type==="table"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[o.pages[j].blocks[b].props.expandedRows&&n.jsxs("div",{style:{padding:"12px",background:"#f8f9fa",borderRadius:8,marginBottom:4},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:8,textTransform:"uppercase"},children:"Designs (Table Expand)"}),n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Design sauvegard"}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsxs("select",{value:pe,onChange:C=>ye(C.target.value),style:{flex:1,padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13},children:[n.jsx("option",{value:"",children:""}),P.map(C=>n.jsx("option",{value:C.id,children:C.name},C.id))]}),n.jsx("button",{className:"btn secondary",disabled:!pe,style:{fontSize:12,padding:"8px 10px"},onClick:()=>{const C=P.find(F=>F.id===pe);C&&Mn(C.style)},children:"Appliquer"})]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Sauvegarder le design actuel"}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("input",{value:se,onChange:C=>je(C.target.value),placeholder:"Nom du design",style:{flex:1,padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}}),n.jsx("button",{className:"btn secondary",disabled:!se.trim(),style:{fontSize:12,padding:"8px 10px"},onClick:vs,children:"Sauvegarder"})]})]})]})]}),n.jsxs("div",{style:{padding:"12px",background:"#f8f9fa",borderRadius:8,marginBottom:4},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:8,textTransform:"uppercase"},children:"Style Global"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Taille Police"}),n.jsx("input",{type:"number",placeholder:"Ex: 12",onChange:C=>{const F=Number(C.target.value);F>0&&qt(M=>({...M,cells:(M.cells||[]).map(X=>X.map(ue=>({...ue,fontSize:F})))}))},style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Couleur"}),n.jsx("input",{type:"color",onChange:C=>{qt(F=>({...F,cells:(F.cells||[]).map(M=>M.map(X=>({...X,color:C.target.value})))}))},style:{width:"100%",height:38,padding:4,borderRadius:6,border:"2px solid #e9ecef",cursor:"pointer"}})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Rayon (px)"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.borderRadius||0,onChange:C=>qt(F=>({...F,borderRadius:Number(C.target.value)})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Esp. Lignes"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.rowGap||0,onChange:C=>qt(F=>({...F,rowGap:Number(C.target.value)})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Esp. Cols"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.colGap||0,onChange:C=>qt(F=>({...F,colGap:Number(C.target.value)})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]}),n.jsxs("div",{style:{marginTop:12,borderTop:"1px solid #e9ecef",paddingTop:12},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:8,textTransform:"uppercase"},children:"Expansion des Lignes"}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:8},children:[n.jsx("input",{type:"checkbox",checked:o.pages[j].blocks[b].props.expandedRows||!1,onChange:C=>{var U;const F=C.target.checked,M=o.pages[j].blocks[b],X=M.props.x||0,ue=M.props.y||0;if(F){if(!(M.props.showExpandedTitle!==!1)){qt(dt=>({...dt,expandedRows:!0}));return}const he=M.props.blockId;if(typeof he=="string"&&he.trim()){const dt=o.pages[j].blocks.find(kt=>{var mt;return(kt==null?void 0:kt.type)==="gradebook_pocket"&&((mt=kt==null?void 0:kt.props)==null?void 0:mt.linkedTableBlockId)===he});if(dt&&typeof((U=dt.props)==null?void 0:U.blockId)=="string"&&dt.props.blockId.trim()){qt(kt=>({...kt,expandedRows:!0,showExpandedTitle:!0,titleBlockId:dt.props.blockId}));return}}if(M.props.titleBlockId&&o.pages[j].blocks.find(kt=>kt.props.blockId===M.props.titleBlockId)){qt(kt=>({...kt,expandedRows:!0}));return}const Ee=Number(M.props.titleOffsetX||0),Ue=Number(M.props.titleOffsetY||-265),Xe=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11),Je={type:"gradebook_pocket",props:{x:X+Ee,y:Math.max(0,ue+Ue),z:(M.props.z||0)+1,blockId:Xe,width:90,number:String(M.props.expandedTitleText||"A"),fontSize:18,linkedTableBlockId:M.props.blockId}},ot=[...o.pages],ct={...ot[j]},it=[...ct.blocks];it[b]={...it[b],props:{...it[b].props,expandedRows:!0,titleBlockId:Xe,titleOffsetX:Ee,titleOffsetY:Ue,showExpandedTitle:!0}},it.push(Je),ot[j]={...ct,blocks:it},Se({...o,pages:ot})}else{const Ke=M.props.titleBlockId,he=M.props.blockId,Ee=[...o.pages],Ue={...Ee[j]};let Xe=[...Ue.blocks];Xe[b]={...Xe[b],props:{...Xe[b].props,expandedRows:!1,titleBlockId:void 0}},Ke&&(Xe=Xe.filter(ot=>ot.props.blockId!==Ke)),typeof he=="string"&&he.trim()&&(Xe=Xe.filter(ot=>{var ct;return!((ot==null?void 0:ot.type)==="gradebook_pocket"&&((ct=ot==null?void 0:ot.props)==null?void 0:ct.linkedTableBlockId)===he)})),Ee[j]={...Ue,blocks:Xe},Se({...o,pages:Ee});const Je=Xe.findIndex(ot=>ot.props.blockId===M.props.blockId);Je!==b&&A(Je)}},style:{width:18,height:18,cursor:"pointer"}}),n.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Activer l'expansion des lignes"})]}),o.pages[j].blocks[b].props.expandedRows&&n.jsxs("div",{style:{padding:12,background:"#f0f4ff",borderRadius:8,marginTop:8},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:10},children:[n.jsx("input",{type:"checkbox",checked:o.pages[j].blocks[b].props.showExpandedTitle!==!1,onChange:C=>{var Xt;const F=C.target.checked,M=o.pages[j].blocks[b],X=Number(M.props.x||0),ue=Number(M.props.y||0),U=M.props.blockId,Ke=[...o.pages],he={...Ke[j]};let Ee=[...he.blocks];const Ue=M.props.titleBlockId,Xe=Ue?Ee.findIndex(Dt=>Dt.props.blockId===Ue):-1,Je=Xe>=0?Ee[Xe]:null,ot=!Je&&typeof U=="string"&&U.trim()?Ee.findIndex(Dt=>{var hr;return(Dt==null?void 0:Dt.type)==="gradebook_pocket"&&((hr=Dt==null?void 0:Dt.props)==null?void 0:hr.linkedTableBlockId)===U}):-1,ct=Je||(ot>=0?Ee[ot]:null);if(!F){const Dt=ct&&typeof((Xt=ct.props)==null?void 0:Xt.number)=="string"?ct.props.number:M.props.expandedTitleText;Ue&&(Ee=Ee.filter(hr=>hr.props.blockId!==Ue)),typeof U=="string"&&U.trim()&&(Ee=Ee.filter(hr=>{var Ft;return!((hr==null?void 0:hr.type)==="gradebook_pocket"&&((Ft=hr==null?void 0:hr.props)==null?void 0:Ft.linkedTableBlockId)===U)})),Ee[b]={...Ee[b],props:{...Ee[b].props,showExpandedTitle:!1,titleBlockId:void 0,expandedTitleText:Dt}},Ke[j]={...he,blocks:Ee},Se({...o,pages:Ke});return}if(ct){Ee[b]={...Ee[b],props:{...Ee[b].props,showExpandedTitle:!0,titleBlockId:ct.props.blockId}},Ke[j]={...he,blocks:Ee},Se({...o,pages:Ke});return}const it=Number(M.props.titleOffsetX||0),dt=Number(M.props.titleOffsetY||-265),kt=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11),mt={type:"gradebook_pocket",props:{x:X+it,y:Math.max(0,ue+dt),z:(M.props.z||0)+1,blockId:kt,width:90,number:String(M.props.expandedTitleText||"A"),fontSize:18,linkedTableBlockId:M.props.blockId}};Ee[b]={...Ee[b],props:{...Ee[b].props,showExpandedTitle:!0,titleBlockId:kt,titleOffsetX:it,titleOffsetY:dt}},Ee.push(mt),Ke[j]={...he,blocks:Ee},Se({...o,pages:Ke})},style:{width:18,height:18,cursor:"pointer"}}),n.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Afficher le titre"})]}),(()=>{var ot;const C=o.pages[j].blocks[b],F=Number(C.props.x||0),M=Number(C.props.y||0),X=C.props.blockId,ue=C.props.titleBlockId,U=typeof ue=="string"&&ue.trim()?o.pages[j].blocks.find(ct=>{var it;return((it=ct==null?void 0:ct.props)==null?void 0:it.blockId)===ue}):null,Ke=!U&&typeof X=="string"&&X.trim()?o.pages[j].blocks.find(ct=>{var it;return(ct==null?void 0:ct.type)==="gradebook_pocket"&&((it=ct==null?void 0:ct.props)==null?void 0:it.linkedTableBlockId)===X}):null,he=U||Ke,Ee=Number(C.props.titleOffsetX||0),Ue=Number(C.props.titleOffsetY||-265),Xe=he&&typeof((ot=he.props)==null?void 0:ot.number)=="string"&&he.props.number.length?he.props.number:String(C.props.expandedTitleText||"A"),Je=C.props.showExpandedTitle!==!1;return n.jsxs("div",{style:{marginBottom:12,padding:10,background:"#fff",borderRadius:6,border:"1px solid #e2e8f0"},children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#3498db"},children:" Texte du Titre"}),n.jsx("input",{type:"text",value:Xe,onChange:ct=>{var Nt;const it=ct.target.value,dt=[...o.pages],kt={...dt[j]},mt=[...kt.blocks],Xt={...mt[b]},Dt={...Xt.props,expandedTitleText:it};let Ft=Je?(()=>{if(typeof Dt.titleBlockId=="string"&&Dt.titleBlockId.trim()){const lt=mt.findIndex(xt=>{var Gt;return((Gt=xt==null?void 0:xt.props)==null?void 0:Gt.blockId)===Dt.titleBlockId});if(lt>=0)return lt}if(typeof X=="string"&&X.trim()){const lt=mt.findIndex(xt=>{var Gt;return(xt==null?void 0:xt.type)==="gradebook_pocket"&&((Gt=xt==null?void 0:xt.props)==null?void 0:Gt.linkedTableBlockId)===X});if(lt>=0)return lt}return-1})():-1;if(Je&&Ft<0){const lt=window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11),xt={type:"gradebook_pocket",props:{x:F+Ee,y:Math.max(0,M+Ue),z:(Dt.z||0)+1,blockId:lt,width:90,number:String(it||"A"),fontSize:18,linkedTableBlockId:X}};mt.push(xt),Dt.titleBlockId=lt,Ft=mt.length-1}if(Je&&Ft>=0){const lt=mt[Ft];mt[Ft]={...lt,props:{...lt.props,number:it}},typeof((Nt=mt[Ft].props)==null?void 0:Nt.blockId)=="string"&&mt[Ft].props.blockId.trim()&&(Dt.titleBlockId=mt[Ft].props.blockId)}mt[b]={...Xt,props:Dt},dt[j]={...kt,blocks:mt},Se({...o,pages:dt})},style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13},placeholder:"A, B, C..."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:10},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Dcalage X (px)"}),n.jsx("input",{type:"number",value:Ee,onChange:ct=>{const it=Number(ct.target.value),dt=[...o.pages],kt={...dt[j]},mt=[...kt.blocks],Xt={...mt[b]},Dt={...Xt.props,titleOffsetX:it};if(mt[b]={...Xt,props:Dt},Je){const Ft=(()=>{if(typeof Dt.titleBlockId=="string"&&Dt.titleBlockId.trim()){const Nt=mt.findIndex(lt=>{var xt;return((xt=lt==null?void 0:lt.props)==null?void 0:xt.blockId)===Dt.titleBlockId});if(Nt>=0)return Nt}if(typeof X=="string"&&X.trim()){const Nt=mt.findIndex(lt=>{var xt;return(lt==null?void 0:lt.type)==="gradebook_pocket"&&((xt=lt==null?void 0:lt.props)==null?void 0:xt.linkedTableBlockId)===X});if(Nt>=0)return Nt}return-1})();if(Ft>=0){const Nt=mt[Ft];mt[Ft]={...Nt,props:{...Nt.props,x:F+it}}}}dt[j]={...kt,blocks:mt},Se({...o,pages:dt})},style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Dcalage Y (px)"}),n.jsx("input",{type:"number",value:Ue,onChange:ct=>{const it=Number(ct.target.value),dt=[...o.pages],kt={...dt[j]},mt=[...kt.blocks],Xt={...mt[b]},Dt={...Xt.props,titleOffsetY:it};if(mt[b]={...Xt,props:Dt},Je){const Ft=(()=>{if(typeof Dt.titleBlockId=="string"&&Dt.titleBlockId.trim()){const Nt=mt.findIndex(lt=>{var xt;return((xt=lt==null?void 0:lt.props)==null?void 0:xt.blockId)===Dt.titleBlockId});if(Nt>=0)return Nt}if(typeof X=="string"&&X.trim()){const Nt=mt.findIndex(lt=>{var xt;return(lt==null?void 0:lt.type)==="gradebook_pocket"&&((xt=lt==null?void 0:lt.props)==null?void 0:xt.linkedTableBlockId)===X});if(Nt>=0)return Nt}return-1})();if(Ft>=0){const Nt=mt[Ft];mt[Ft]={...Nt,props:{...Nt.props,y:Math.max(0,M+it)}}}}dt[j]={...kt,blocks:mt},Se({...o,pages:dt})},style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]})]})})(),n.jsx("div",{style:{fontSize:11,color:"#6c757d",marginBottom:8},children:" Chaque ligne affichera une zone d'expansion avec les toggles de langue (V2) en dessous."}),n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Hauteur zone expansion"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.expandedRowHeight||34,onChange:C=>qt(F=>({...F,expandedRowHeight:Number(C.target.value)})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Type de toggles"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.expandedToggleStyle||"v2",onChange:C=>qt(F=>({...F,expandedToggleStyle:C.target.value})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13},children:[n.jsx("option",{value:"v2",children:"V2 (Emojis)"}),n.jsx("option",{value:"v1",children:"V1 (Drapeaux)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"paisseur ligne sparatrice"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.expandedDividerWidth||.5,onChange:C=>qt(F=>({...F,expandedDividerWidth:Number(C.target.value)})),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Couleur ligne sparatrice"}),n.jsxs("div",{style:{display:"flex",gap:4},children:[n.jsx("input",{type:"color",value:(()=>{const C=o.pages[j].blocks[b].props.expandedDividerColor||"";return C.startsWith("#")&&(C.length===7||C.length===4)?C:"#ffffff"})(),onChange:C=>qt(F=>({...F,expandedDividerColor:C.target.value})),style:{height:38,width:40,padding:0,border:"1px solid #ddd",borderRadius:4,cursor:"pointer"}}),n.jsx("input",{type:"text",value:o.pages[j].blocks[b].props.expandedDividerColor||fh,onChange:C=>qt(F=>({...F,expandedDividerColor:C.target.value})),style:{flex:1,padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]})]})]})]}),n.jsxs("div",{style:{marginTop:12,borderTop:"1px solid #e9ecef",paddingTop:12},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:8,textTransform:"uppercase"},children:"Bordures Globales"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"Couleur"}),n.jsx("input",{type:"color",value:re,onChange:C=>ae(C.target.value),style:{width:"100%",height:38,padding:4,borderRadius:6,border:"2px solid #e9ecef",cursor:"pointer"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:11,display:"block",marginBottom:4,fontWeight:600,color:"#6c757d"},children:"paisseur"}),n.jsx("input",{type:"number",value:Y,onChange:C=>J(Number(C.target.value)),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"btn secondary",style:{flex:1,fontSize:12},onClick:()=>{qt(C=>({...C,cells:(C.cells||[]).map(F=>F.map(M=>({...M,borders:{l:{color:re,width:Y},r:{color:re,width:Y},t:{color:re,width:Y},b:{color:re,width:Y}}})))}))},children:"Appliquer tout"}),n.jsx("button",{className:"btn secondary",style:{flex:1,fontSize:12,color:"#e53e3e",borderColor:"#fed7d7",background:"#fff5f5"},onClick:()=>{qt(C=>({...C,cells:(C.cells||[]).map(F=>F.map(M=>({...M,borders:{l:{width:0},r:{width:0},t:{width:0},b:{width:0}}})))}))},children:"Supprimer tout"})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{padding:"14px",background:"#fff",border:"1px solid #e2e8f0",borderRadius:10,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase"},children:"Colonnes"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(o.pages[j].blocks[b].props.columnWidths||[]).map((C,F)=>n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"24px 1fr 32px",gap:8,alignItems:"center"},children:[n.jsxs("div",{style:{fontSize:12,color:"#64748b",fontWeight:500},children:["#",F+1]}),n.jsx("input",{type:"number",value:Math.round(C),onChange:M=>{const X=[...o.pages[j].blocks[b].props.columnWidths||[]];X[F]=Number(M.target.value),qt(ue=>({...ue,columnWidths:X}))},style:{width:"100%",padding:"6px 10px",borderRadius:6,border:"1px solid #e2e8f0",fontSize:13,outline:"none",transition:"border-color 0.2s"},onFocus:M=>M.target.style.borderColor="#667eea",onBlur:M=>M.target.style.borderColor="#e2e8f0"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=o.pages[j].blocks[b].props,X=[...M.columnWidths||[]];if(!X.length)return;const ue=(M.cells||[]).map(U=>U.filter((Ke,he)=>he!==F));X.splice(F,1),qt(U=>({...U,columnWidths:X,cells:ue})),T&&(T.ci===F?W(null):T.ci>F&&W({ri:T.ri,ci:T.ci-1}))},style:{padding:"6px",color:"#ef4444",border:"1px solid #fee2e2",background:"#fef2f2",borderRadius:6,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:"Supprimer la colonne",children:""})]},F))}),n.jsx("div",{className:"toolbar",style:{display:"flex",gap:8,marginTop:12},children:n.jsx("button",{className:"btn secondary",style:{flex:1,padding:"8px",fontSize:12,justifyContent:"center"},onClick:()=>{const C=o.pages[j].blocks[b].props,F=[...C.columnWidths||[]];[...C.rowHeights||[]];const M=(C.cells||[]).map(X=>[...X,{text:"",fontSize:12,color:"#000",fill:"transparent",borders:{l:{},r:{},t:{},b:{}}}]);F.push(120),qt(X=>({...X,columnWidths:F,cells:M}))},children:"+ Ajouter colonne"})})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{padding:"14px",background:"#fff",border:"1px solid #e2e8f0",borderRadius:10,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#6c757d",marginBottom:10,textTransform:"uppercase"},children:"Lignes"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(()=>{const C=o.pages[j].blocks[b].props,F=(C.rowHeights||[]).length,M=(C.cells||[]).length,X=Math.max(F,M);return Array.from({length:X}).map((ue,U)=>{const Ke=(C.rowHeights||[])[U]??40;return n.jsxs("div",{style:{marginBottom:4,paddingBottom:8,borderBottom:U<X-1?"1px dashed #f1f5f9":"none"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"24px 1fr 32px",gap:8,alignItems:"center",marginBottom:4},children:[n.jsxs("div",{style:{fontWeight:500,fontSize:12,color:"#64748b"},children:["#",U+1]}),n.jsx("input",{type:"number",value:Math.round(Ke),onChange:he=>{const Ee=[...o.pages[j].blocks[b].props.rowHeights||[]];Ee[U]=Number(he.target.value),qt(Ue=>({...Ue,rowHeights:Ee}))},style:{width:"100%",padding:"6px 10px",borderRadius:6,border:"1px solid #e2e8f0",fontSize:13,outline:"none",transition:"border-color 0.2s"},onFocus:he=>he.target.style.borderColor="#667eea",onBlur:he=>he.target.style.borderColor="#e2e8f0",title:"Hauteur de la ligne"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const he=o.pages[j].blocks[b].props,Ee=[...he.rowHeights||[]];if(!Ee.length)return;Ee.splice(U,1);const Ue=(he.cells||[]).filter((Je,ot)=>ot!==U),Xe=[...he.rowLanguages||[]];Xe.length>U&&Xe.splice(U,1),qt(Je=>({...Je,rowHeights:Ee,cells:Ue,rowLanguages:Xe})),T&&(T.ri===U?W(null):T.ri>U&&W({ri:T.ri-1,ci:T.ci}))},style:{padding:"6px",color:"#ef4444",border:"1px solid #fee2e2",background:"#fef2f2",borderRadius:6,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:"Supprimer la ligne",children:""})]}),o.pages[j].blocks[b].props.expandedRows&&n.jsx("div",{style:{marginLeft:32},children:(()=>{var ct;const he=o.pages[j].blocks[b].props,Ee=U,Ue=(ct=he.rowLanguages)==null?void 0:ct[Ee],Xe=he.expandedLanguages||[{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1},{code:"ar",label:"Lebanese",emoji:"",active:!1}],Je=Ue||Xe,ot=!!Ue;return n.jsxs("div",{style:{marginTop:4},children:[n.jsx("div",{style:{marginTop:4},children:n.jsxs("div",{style:{borderRadius:6,background:"#f0fff4",border:"1px solid #c6f6d5",padding:8},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsxs("div",{style:{fontSize:11,color:"#276749",fontWeight:600},children:["Langues (",Je.length,")"]}),ot&&n.jsx("button",{className:"btn secondary",style:{padding:"2px 6px",fontSize:10,color:"#c53030",background:"#fff",border:"1px solid #feb2b2",borderRadius:4},onClick:()=>{qt(it=>{const dt=[...it.rowLanguages||[]];return dt.length>Ee&&(dt[Ee]=void 0),{...it,rowLanguages:dt}})},children:"Rtablir Global"})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[Je.map((it,dt)=>n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 40px auto",gap:4,alignItems:"center",padding:4,background:"#fff",borderRadius:4,border:"1px solid #e2e8f0"},children:[n.jsx("input",{type:"text",value:it.emoji,onChange:kt=>{qt(mt=>{const Xt=[...mt.rowLanguages||[]],Dt=Xt[Ee]?[...Xt[Ee]]:JSON.parse(JSON.stringify(Je));return Dt[dt]={...Dt[dt],emoji:kt.target.value},Xt[Ee]=Dt,{...mt,rowLanguages:Xt}})},style:{width:24,textAlign:"center",padding:2,borderRadius:3,border:"1px solid #ddd",fontSize:12}}),n.jsx("input",{type:"text",value:it.label,onChange:kt=>{qt(mt=>{const Xt=[...mt.rowLanguages||[]],Dt=Xt[Ee]?[...Xt[Ee]]:JSON.parse(JSON.stringify(Je));return Dt[dt]={...Dt[dt],label:kt.target.value},Xt[Ee]=Dt,{...mt,rowLanguages:Xt}})},style:{width:"100%",padding:"2px 4px",borderRadius:3,border:"1px solid #ddd",fontSize:11}}),n.jsxs("select",{value:it.level||"",onChange:kt=>{qt(mt=>{const Xt=[...mt.rowLanguages||[]],Dt=Xt[Ee]?[...Xt[Ee]]:JSON.parse(JSON.stringify(Je));return Dt[dt]={...Dt[dt],level:kt.target.value},Xt[Ee]=Dt,{...mt,rowLanguages:Xt}})},title:"Niveau",style:{width:"100%",padding:"0px",borderRadius:3,border:"1px solid #ddd",fontSize:10,height:22},children:[n.jsx("option",{value:"",children:"-"}),n.jsx("option",{value:"PS",children:"PS"}),n.jsx("option",{value:"MS",children:"MS"}),n.jsx("option",{value:"GS",children:"GS"})]}),n.jsx("button",{style:{background:"none",border:"none",color:"#e53e3e",cursor:"pointer",fontSize:10},onClick:()=>{qt(kt=>{const mt=[...kt.rowLanguages||[]],Xt=mt[Ee]?[...mt[Ee]]:JSON.parse(JSON.stringify(Je));return Xt.splice(dt,1),mt[Ee]=Xt,{...kt,rowLanguages:mt}})},children:""})]},dt)),n.jsx("div",{style:{marginTop:2},children:n.jsxs("select",{value:"",onChange:it=>{const dt=it.target.value;dt&&qt(kt=>{const mt=[...kt.rowLanguages||[]],Xt=mt[Ee]?[...mt[Ee]]:JSON.parse(JSON.stringify(Je));let Dt={code:"new",label:"New",emoji:"",active:!1};return dt==="fr"?Dt={code:"fr",label:"French",emoji:"",active:!1}:dt==="en"?Dt={code:"en",label:"English",emoji:"",active:!1}:dt==="lb"&&(Dt={code:"lb",label:"Lebanese",emoji:"",active:!1}),Xt.push(Dt),mt[Ee]=Xt,{...kt,rowLanguages:mt}})},style:{width:"100%",padding:"4px",fontSize:11,border:"1px solid #bee3f8",background:"#ebf8ff",color:"#3182ce",borderRadius:3,cursor:"pointer"},children:[n.jsx("option",{value:"",children:"+ Ajouter langue..."}),n.jsx("option",{value:"fr",children:" French"}),n.jsx("option",{value:"en",children:" English"}),n.jsx("option",{value:"ar",children:" Lebanese"})]})})]})]})}),")"]})})()})]},U)})})()}),n.jsx("div",{className:"toolbar",style:{display:"flex",gap:8,marginTop:12},children:n.jsx("button",{className:"btn secondary",style:{flex:1,padding:"8px",fontSize:12,justifyContent:"center"},onClick:()=>{var he;const C=o.pages[j].blocks[b].props,F=[...C.rowHeights||[]],X=[...C.columnWidths||[]].map(()=>({text:"",fontSize:12,color:"#000",fill:"transparent",borders:{l:{},r:{},t:{},b:{}}})),ue=[...C.cells||[]];F.push(40),ue.push(X);const U=[...C.rowIds||[]];for(;U.length<(((he=C.cells)==null?void 0:he.length)||0);)U.push(window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11));U.push(window.crypto.randomUUID?window.crypto.randomUUID():Math.random().toString(36).substring(2,11));const Ke=[...C.rowLanguages||[]];qt(Ee=>({...Ee,rowHeights:F,cells:ue,rowLanguages:Ke,rowIds:U}))},children:"+ Ajouter ligne"})})]}),T&&n.jsxs("div",{children:[n.jsxs("div",{className:"note",children:["Cellule: ligne ",T.ri+1,", colonne ",T.ci+1]}),(()=>{var M,X;const F=((X=(M=o.pages[j].blocks[b].props.cells)==null?void 0:M[T.ri])==null?void 0:X[T.ci])||{};return n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("textarea",{rows:3,placeholder:"Texte",value:F.text||"",onChange:ue=>{qt(U=>{const Ke=U.cells.map((he,Ee)=>he.map((Ue,Xe)=>Ee===T.ri&&Xe===T.ci?{...Ue,text:ue.target.value}:Ue));return{...U,cells:Ke}})},style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{type:"number",placeholder:"Taille police",value:F.fontSize||12,onChange:ue=>{qt(U=>{const Ke=U.cells.map((he,Ee)=>he.map((Ue,Xe)=>Ee===T.ri&&Xe===T.ci?{...Ue,fontSize:Number(ue.target.value)}:Ue));return{...U,cells:Ke}})},style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Couleur texte",value:F.color||"",onChange:ue=>{qt(U=>{const Ke=U.cells.map((he,Ee)=>he.map((Ue,Xe)=>Ee===T.ri&&Xe===T.ci?{...Ue,color:ue.target.value}:Ue));return{...U,cells:Ke}})},style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Fond",value:F.fill||"",onChange:ue=>{qt(U=>{const Ke=U.cells.map((he,Ee)=>he.map((Ue,Xe)=>Ee===T.ri&&Xe===T.ci?{...Ue,fill:ue.target.value}:Ue));return{...U,cells:Ke}})},style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("div",{className:"toolbar",style:{display:"grid",gap:8},children:["l","r","t","b"].map(ue=>{var U,Ke,he,Ee;return n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("input",{placeholder:`Bordure ${ue} couleur`,value:((Ke=(U=F.borders)==null?void 0:U[ue])==null?void 0:Ke.color)||"",onChange:Ue=>{qt(Xe=>{const Je=Xe.cells.map((ot,ct)=>ot.map((it,dt)=>{var kt;return ct===T.ri&&dt===T.ci?{...it,borders:{...it.borders,[ue]:{...((kt=it.borders)==null?void 0:kt[ue])||{},color:Ue.target.value}}}:it}));return{...Xe,cells:Je}})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",flex:1}}),n.jsx("input",{placeholder:`Bordure ${ue} largeur`,type:"number",value:Number(((Ee=(he=F.borders)==null?void 0:he[ue])==null?void 0:Ee.width)||0),onChange:Ue=>{qt(Xe=>{const Je=Xe.cells.map((ot,ct)=>ot.map((it,dt)=>{var kt;return ct===T.ri&&dt===T.ci?{...it,borders:{...it.borders,[ue]:{...((kt=it.borders)==null?void 0:kt[ue])||{},width:Number(Ue.target.value)}}}:it}));return{...Xe,cells:Je}})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:120}})]},ue)})})]})})()]})]})]})]}),o.pages[j].blocks[b].type==="student_photo"&&n.jsx("div",{style:{padding:"14px",background:"#f8f9fa",borderRadius:10,marginBottom:8},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Largeur"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.width||0,onChange:C=>Ye({width:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Hauteur"}),n.jsx("input",{type:"number",value:o.pages[j].blocks[b].props.height||0,onChange:C=>Ye({height:Number(C.target.value)}),style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"2px solid #e9ecef",fontSize:13}})]})]})}),o.pages[j].blocks[b].type==="category_title"&&n.jsx("input",{placeholder:"ID catgorie",value:o.pages[j].blocks[b].props.categoryId||"",onChange:C=>Ye({categoryId:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),o.pages[j].blocks[b].type==="competency_list"&&n.jsx("input",{placeholder:"ID catgorie (optionnel)",value:o.pages[j].blocks[b].props.categoryId||"",onChange:C=>Ye({categoryId:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),(o.pages[j].blocks[b].type==="signature_box"||o.pages[j].blocks[b].type==="final_signature_box")&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:"Configuration Signature"}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Type (Priode)"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.period||"mid-year",onChange:C=>Ye({period:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"mid-year",children:"Mi-Anne (Semestre 1)"}),n.jsx("option",{value:"end-year",children:"Fin d'Anne (Semestre 2)"})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Label"}),n.jsx("input",{placeholder:"Label",value:o.pages[j].blocks[b].props.label||"",onChange:C=>Ye({label:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Niveau spcifique (Optionnel)"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.level||"",onChange:C=>Ye({level:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Tous les niveaux"}),r.map(C=>n.jsx("option",{value:C.name,children:C.name},C.name))]}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||200,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||80,onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),o.pages[j].blocks[b].type==="signature_date"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:"Date de signature (Subadmin)"}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Niveau"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.level||"",onChange:C=>Ye({level:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Tous les niveaux"}),n.jsx("option",{value:"PS",children:"PS"}),n.jsx("option",{value:"MS",children:"MS"}),n.jsx("option",{value:"GS",children:"GS"})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Semestre"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.semester||1,onChange:C=>Ye({semester:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:1,children:"Semestre 1"}),n.jsx("option",{value:2,children:"Semestre 2"})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Label (optionnel)"}),n.jsx("input",{placeholder:"Label",value:o.pages[j].blocks[b].props.label||"",onChange:C=>Ye({label:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:o.pages[j].blocks[b].props.showMeta!==!1,onChange:C=>Ye({showMeta:C.target.checked})}),"Afficher niveau + semestre"]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||220,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||34,onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsx("input",{placeholder:"Taille",type:"number",value:o.pages[j].blocks[b].props.fontSize||12,onChange:C=>Ye({fontSize:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{type:"color",value:o.pages[j].blocks[b].props.color||"#2d3436",onChange:C=>Ye({color:C.target.value}),style:{height:38,padding:4,borderRadius:8,border:"1px solid #ddd",width:"100%"}})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Alignement"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.align||"flex-start",onChange:C=>Ye({align:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"flex-start",children:"Gauche"}),n.jsx("option",{value:"center",children:"Centre"}),n.jsx("option",{value:"flex-end",children:"Droite"})]})]}),o.pages[j].blocks[b].type==="promotion_info"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:"Configuration Info Passage"}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Type d'information"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.field||"",onChange:C=>Ye({field:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"-- Complet (Bloc rsum) --"}),n.jsx("option",{value:"currentLevel",children:"Niveau Actuel (ex: PS)"}),n.jsx("option",{value:"nextLevel",children:"Niveau Suivant (ex: MS)"}),n.jsx("option",{value:"year",children:"Anne Suivante (ex: 2026/2027)"}),n.jsx("option",{value:"currentYear",children:"Anne Actuelle (ex: 2025/2026)"}),n.jsx("option",{value:"class",children:"Classe (ex: A)"}),n.jsx("option",{value:"student",children:"Nom complet de l'lve"}),n.jsx("option",{value:"studentFirstName",children:"Prnom de l'lve"}),n.jsx("option",{value:"studentLastName",children:"Nom de famille de l'lve"}),n.jsx("option",{value:"level",children:'Label Passage (ex: "Passage en MS")'})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Visibilit par Niveau (Optionnel)"}),n.jsx("div",{className:"note",style:{marginBottom:4},children:"Afficher ce bloc uniquement pour ce niveau."}),n.jsxs("select",{value:o.pages[j].blocks[b].props.level||"",onChange:C=>Ye({level:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Tous les niveaux"}),r.map(C=>n.jsx("option",{value:C.name,children:C.name},C.name))]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Visibilit par Priode (Optionnel)"}),n.jsx("div",{className:"note",style:{marginBottom:4},children:"Lier ce bloc  une signature (Mi-Anne ou Fin d'Anne)."}),n.jsxs("select",{value:o.pages[j].blocks[b].props.period||"",onChange:C=>Ye({period:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Toujours visible"}),n.jsx("option",{value:"mid-year",children:"Mi-Anne seulement"}),n.jsx("option",{value:"end-year",children:"Fin d'Anne seulement"})]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Niveau cible (Avanc)"}),n.jsx("div",{className:"note",style:{marginBottom:4},children:"Force le calcul de promotion vers ce niveau (ex: Vers MS). Utile si le niveau de l'lve est ambigu."}),n.jsxs("select",{value:o.pages[j].blocks[b].props.targetLevel||"",onChange:C=>Ye({targetLevel:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Automatique (Bas sur niveau actuel)"}),n.jsx("option",{value:"MS",children:"Vers MS"}),n.jsx("option",{value:"GS",children:"Vers GS"}),n.jsx("option",{value:"EB1",children:"Vers EB1"}),n.jsx("option",{value:"KG2",children:"Vers KG2"}),n.jsx("option",{value:"KG3",children:"Vers KG3"})]}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||(o.pages[j].blocks[b].props.field?150:300),onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||(o.pages[j].blocks[b].props.field?30:100),onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),o.pages[j].blocks[b].type==="teacher_text"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:"Configuration Zone Texte Prof Polyvalent"}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Libell"}),n.jsx("input",{placeholder:"Zone de texte prof",type:"text",value:o.pages[j].blocks[b].props.label||"",onChange:C=>Ye({label:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"}}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Texte d'aide (placeholder)"}),n.jsx("input",{placeholder:"Texte ditable par le prof polyvalent...",type:"text",value:o.pages[j].blocks[b].props.placeholder||"",onChange:C=>Ye({placeholder:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"}}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Visibilit par Niveau (Optionnel)"}),n.jsx("div",{className:"note",style:{marginBottom:4},children:"Afficher ce bloc uniquement pour ce niveau."}),n.jsxs("select",{value:o.pages[j].blocks[b].props.level||"",onChange:C=>Ye({level:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Tous les niveaux"}),r.map(C=>n.jsx("option",{value:C.name,children:C.name},C.name))]}),n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Visibilit par Priode (Optionnel)"}),n.jsx("div",{className:"note",style:{marginBottom:4},children:"Lier ce bloc  une signature (Mi-Anne ou Fin d'Anne)."}),n.jsxs("select",{value:o.pages[j].blocks[b].props.period||"",onChange:C=>Ye({period:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"},children:[n.jsx("option",{value:"",children:"Toujours visible"}),n.jsx("option",{value:"mid-year",children:"Mi-Anne seulement"}),n.jsx("option",{value:"end-year",children:"Fin d'Anne seulement"})]}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||300,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||60,onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),o.pages[j].blocks[b].type==="language_toggle"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Rayon"}),n.jsx("input",{placeholder:"Rayon",type:"number",value:o.pages[j].blocks[b].props.radius||40,onChange:C=>Ye({radius:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Espace"}),n.jsx("input",{placeholder:"Espacement",type:"number",value:o.pages[j].blocks[b].props.spacing||12,onChange:C=>Ye({spacing:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Taille Police"}),n.jsx("input",{placeholder:"Taille",type:"number",value:o.pages[j].blocks[b].props.fontSize||10,onChange:C=>Ye({fontSize:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Direction"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.direction||"column",onChange:C=>Ye({direction:C.target.value}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"column",children:"Vertical"}),n.jsx("option",{value:"row",children:"Horizontal"})]})]}),n.jsxs("div",{className:"note",children:["Langues (",(o.pages[j].blocks[b].props.items||[]).length,")"]}),(o.pages[j].blocks[b].props.items||[]).map((C,F)=>n.jsxs("div",{className:"card",style:{padding:8,background:"#f9f9f9"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[n.jsxs("select",{value:C.code||"en",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]],ue={en:{code:"en",label:"English",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg"},fr:{code:"fr",label:"Franais",logo:"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg"},ar:{code:"ar",label:"",logo:"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg"}};X[F]={...X[F],...ue[M.target.value]},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",flex:1},children:[n.jsx("option",{value:"en",children:"English"}),n.jsx("option",{value:"fr",children:"Franais"}),n.jsx("option",{value:"ar",children:""})]}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=[...o.pages[j].blocks[b].props.items||[]];M[F]={...M[F],active:!M[F].active},Ye({items:M})},style:{padding:"4px 12px"},children:C.active?"Actif":"Inactif"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=(o.pages[j].blocks[b].props.items||[]).filter((X,ue)=>ue!==F);Ye({items:M})},style:{padding:"4px 8px",background:"#ef4444",color:"#fff"},children:""})]}),n.jsx("input",{placeholder:"Label (optionnel)",value:C.label||"",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]];X[F]={...X[F],label:M.target.value},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%",marginBottom:8}}),n.jsx("input",{placeholder:"Logo URL (optionnel)",value:C.logo||"",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]];X[F]={...X[F],logo:M.target.value},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"}}),n.jsxs("div",{style:{marginTop:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#6c757d",marginBottom:4},children:"Niveaux assigns:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:r.map(M=>n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:(C.levels||[]).includes(M.name),onChange:X=>{const ue=[...o.pages[j].blocks[b].props.items||[]],U=ue[F].levels||[];X.target.checked?ue[F]={...ue[F],levels:[...U,M.name]}:ue[F]={...ue[F],levels:U.filter(Ke=>Ke!==M.name)},Ye({items:ue})}}),M.name]},M.name))})]})]},F)),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=[...o.pages[j].blocks[b].props.items||[]];C.push({code:"en",label:"English",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",active:!1}),Ye({items:C})},children:"+ Ajouter une langue"})]}),o.pages[j].blocks[b].type==="language_toggle_v2"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Largeur"}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||300,onChange:C=>Ye({width:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Hauteur"}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||100,onChange:C=>Ye({height:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]}),n.jsx("div",{style:{display:"flex",gap:8},children:n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Couleur Fond"}),n.jsxs("div",{style:{display:"flex",gap:4},children:[n.jsx("input",{type:"color",value:o.pages[j].blocks[b].props.backgroundColor||"#1e3a8a",onChange:C=>Ye({backgroundColor:C.target.value}),style:{height:38,width:40,padding:0,border:"1px solid #ddd",borderRadius:4}}),n.jsx("input",{type:"text",value:o.pages[j].blocks[b].props.backgroundColor||"#1e3a8a",onChange:C=>Ye({backgroundColor:C.target.value}),style:{flex:1,padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]})}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Rayon (Border Radius)"}),n.jsx("input",{placeholder:"Rayon",type:"number",value:o.pages[j].blocks[b].props.borderRadius||12,onChange:C=>Ye({borderRadius:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Padding"}),n.jsx("input",{placeholder:"Padding",type:"number",value:o.pages[j].blocks[b].props.padding||24,onChange:C=>Ye({padding:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Espace (Gap)"}),n.jsx("input",{placeholder:"Espacement",type:"number",value:o.pages[j].blocks[b].props.spacing||12,onChange:C=>Ye({spacing:Number(C.target.value)}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),n.jsxs("div",{style:{flex:1},children:[n.jsx("label",{style:{display:"block",fontSize:11,color:"#6c757d",marginBottom:4,fontWeight:600},children:"Direction"}),n.jsxs("select",{value:o.pages[j].blocks[b].props.direction||"row",onChange:C=>Ye({direction:C.target.value}),style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #ddd"},children:[n.jsx("option",{value:"column",children:"Vertical"}),n.jsx("option",{value:"row",children:"Horizontal"})]})]})]}),n.jsxs("div",{className:"note",children:["Langues (",(o.pages[j].blocks[b].props.items||[]).length,")"]}),(o.pages[j].blocks[b].props.items||[]).map((C,F)=>n.jsxs("div",{className:"card",style:{padding:8,background:"#f9f9f9"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[n.jsxs("select",{value:C.code||"en",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]],ue={en:{code:"en",label:"English",emoji:"",logo:"https://flagcdn.com/gb.svg"},fr:{code:"fr",label:"Franais",emoji:"",logo:"https://flagcdn.com/fr.svg"},ar:{code:"ar",label:"",emoji:"",logo:"https://flagcdn.com/lb.svg"},lb:{code:"lb",label:"Lebanese",emoji:"",logo:"https://flagcdn.com/lb.svg"}};X[F]={...X[F],...ue[M.target.value]},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",flex:1},children:[n.jsx("option",{value:"en",children:"English"}),n.jsx("option",{value:"fr",children:"Franais"}),n.jsx("option",{value:"ar",children:""}),n.jsx("option",{value:"lb",children:"Lebanese"})]}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=[...o.pages[j].blocks[b].props.items||[]];M[F]={...M[F],active:!M[F].active},Ye({items:M})},style:{padding:"4px 12px"},children:C.active?"Actif":"Inactif"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=(o.pages[j].blocks[b].props.items||[]).filter((X,ue)=>ue!==F);Ye({items:M})},style:{padding:"4px 8px",background:"#ef4444",color:"#fff"},children:""})]}),n.jsx("input",{placeholder:"Label (optionnel)",value:C.label||"",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]];X[F]={...X[F],label:M.target.value},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%",marginBottom:8}}),n.jsx("input",{placeholder:"Logo URL (optionnel)",value:C.logo||"",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]];X[F]={...X[F],logo:M.target.value},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%",marginBottom:8}}),n.jsx("input",{placeholder:"Emoji",value:C.emoji||"",onChange:M=>{const X=[...o.pages[j].blocks[b].props.items||[]];X[F]={...X[F],emoji:M.target.value},Ye({items:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%"}}),n.jsxs("div",{style:{marginTop:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#6c757d",marginBottom:4},children:"Niveaux assigns:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:r.map(M=>n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:(C.levels||[]).includes(M.name),onChange:X=>{const ue=[...o.pages[j].blocks[b].props.items||[]],U=ue[F].levels||[];X.target.checked?ue[F]={...ue[F],levels:[...U,M.name]}:ue[F]={...ue[F],levels:U.filter(Ke=>Ke!==M.name)},Ye({items:ue})}}),M.name]},M.name))})]})]},F)),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=[...o.pages[j].blocks[b].props.items||[]];C.push({code:"en",label:"English",emoji:"",logo:"https://flagcdn.com/gb.svg",active:!1}),Ye({items:C})},children:"+ Ajouter une langue"})]}),o.pages[j].blocks[b].type==="dropdown"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{style:{padding:8,background:"#f0f4ff",borderRadius:8,fontWeight:"bold",color:"#6c5ce7"},children:["Dropdown #",o.pages[j].blocks[b].props.dropdownNumber||"?"]}),n.jsx("input",{placeholder:"Label",value:o.pages[j].blocks[b].props.label||"",onChange:C=>Ye({label:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Nom variable (ex: obs1)",value:o.pages[j].blocks[b].props.variableName||"",onChange:C=>Ye({variableName:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsxs("div",{style:{marginTop:8,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#6c757d",marginBottom:4},children:"Niveaux assigns:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:r.map(C=>n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:(o.pages[j].blocks[b].props.levels||[]).includes(C.name),onChange:F=>{const M=o.pages[j].blocks[b].props.levels||[];F.target.checked?Ye({levels:[...M,C.name]}):Ye({levels:M.filter(X=>X!==C.name)})}}),C.name]},C.name))})]}),n.jsxs("div",{style:{marginTop:8,marginBottom:8},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#6c757d",marginBottom:4},children:"Semestres assigns:"}),n.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[1,2].map(C=>n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:(o.pages[j].blocks[b].props.semesters||[1,2]).includes(C),onChange:F=>{const M=o.pages[j].blocks[b].props.semesters||[1,2];F.target.checked?Ye({semesters:[...M,C].sort()}):Ye({semesters:M.filter(X=>X!==C)})}}),"Semestre ",C]},C))})]}),n.jsxs("div",{className:"note",children:["Options (",(o.pages[j].blocks[b].props.options||[]).length,")"]}),(o.pages[j].blocks[b].props.options||[]).map((C,F)=>n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("input",{placeholder:`Option ${F+1}`,value:C,onChange:M=>{const X=[...o.pages[j].blocks[b].props.options||[]];X[F]=M.target.value,Ye({options:X})},style:{padding:8,borderRadius:8,border:"1px solid #ddd",flex:1}}),n.jsx("button",{className:"btn secondary",onClick:()=>{const M=(o.pages[j].blocks[b].props.options||[]).filter((X,ue)=>ue!==F);Ye({options:M})},style:{padding:"4px 8px",background:"#ef4444",color:"#fff"},children:""})]},F)),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=[...o.pages[j].blocks[b].props.options||[],""];Ye({options:C})},children:"+ Ajouter une option"}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||200,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur",type:"number",value:o.pages[j].blocks[b].props.height||32,onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]}),o.pages[j].blocks[b].type==="dropdown_reference"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:"Rfrence  un dropdown"}),n.jsx("input",{placeholder:"Numro du dropdown",type:"number",min:"1",value:o.pages[j].blocks[b].props.dropdownNumber||1,onChange:C=>Ye({dropdownNumber:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Largeur",type:"number",value:o.pages[j].blocks[b].props.width||200,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Hauteur minimale",type:"number",value:o.pages[j].blocks[b].props.height||40,onChange:C=>Ye({height:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsxs("div",{style:{padding:8,background:"#fff9e6",borderRadius:8,fontSize:12},children:[" Ce bloc affichera la valeur slectionne dans le Dropdown #",o.pages[j].blocks[b].props.dropdownNumber||1]})]}),o.pages[j].blocks[b].type==="gradebook_pocket"&&n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsx("div",{className:"note",children:" Title - Configuration"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[n.jsxs("div",{style:{display:"grid",gap:4},children:[n.jsx("label",{style:{fontSize:12,fontWeight:500},children:"Texte / Numro"}),n.jsx("input",{placeholder:"Ex: 1, A, CP...",value:o.pages[j].blocks[b].props.number||"1",onChange:C=>Ye({number:C.target.value}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%",boxSizing:"border-box"}})]}),n.jsxs("div",{style:{display:"grid",gap:4},children:[n.jsx("label",{style:{fontSize:12,fontWeight:500},children:"Taille Police"}),n.jsx("input",{type:"number",placeholder:"Auto",value:o.pages[j].blocks[b].props.fontSize||"",onChange:C=>Ye({fontSize:C.target.value?Number(C.target.value):void 0}),style:{padding:8,borderRadius:8,border:"1px solid #ddd",width:"100%",boxSizing:"border-box"}})]})]}),n.jsxs("div",{style:{display:"grid",gap:4},children:[n.jsx("label",{style:{fontSize:12,fontWeight:500},children:"Taille (largeur)"}),n.jsx("input",{type:"number",min:"60",max:"300",value:o.pages[j].blocks[b].props.width||120,onChange:C=>Ye({width:Number(C.target.value)}),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[n.jsx("button",{className:"btn secondary",onClick:kr,style:{flex:1},children:"Dupliquer le bloc"}),n.jsx("button",{className:"btn secondary",onClick:is,style:{flex:1},children:"Copier"}),n.jsx("button",{className:"btn secondary",onClick:()=>{const C=[...o.pages],F={...C[j]},M=F.blocks.filter((X,ue)=>ue!==b);C[j]={...F,blocks:M},l({...o,pages:C}),A(null),W(null)},style:{flex:1,color:"#dc3545",borderColor:"#ffcdd2",background:"#fff"},children:"Supprimer"})]})]}):n.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6c757d"},children:[n.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.3},children:""}),n.jsx("p",{style:{margin:0,fontSize:14},children:"Slectionnez un bloc sur le canevas pour modifier ses proprits"})]})]})]})]}),Ht&&o._id&&n.jsx(kne,{templateId:o._id,templateName:o.name,currentVersion:o.currentVersion||1,onClose:()=>Yt(!1),onSave:bi}),_t&&o._id&&n.jsx(Nne,{templateId:o._id,templateName:o.name,onClose:()=>mr(!1)}),yr&&o._id&&n.jsx(Cne,{templateId:o._id,templateName:o.name,currentVersion:o.currentVersion||1,onClose:()=>Kt(!1)})]})}function Ene(){const e=typeof window<"u"?sessionStorage.getItem("role")||localStorage.getItem("role"):null,t=typeof window<"u"?sessionStorage.getItem("token")||localStorage.getItem("token"):null,r=typeof window<"u"?sessionStorage.getItem("displayName")||localStorage.getItem("displayName"):null,s=Sn(),i=wn(),{activeYear:a,years:o,activeYearId:l,setActiveYearId:c}=Yn(),[u,d]=p.useState({});p.useEffect(()=>{K.get("/settings/public").then(g=>{d(g.data.nav_permissions||{})}).catch(g=>console.error(g))},[]);const f=(g,x)=>{var y;return((y=u[g])==null?void 0:y[x])!==!1},h=()=>{sessionStorage.getItem("token")&&(sessionStorage.removeItem("token"),sessionStorage.removeItem("role"),sessionStorage.removeItem("displayName")),localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("displayName"),s("/login")},m=g=>g===i.pathname?!0:["/admin","/subadmin/dashboard","/aefe/dashboard"].includes(g)?i.pathname===g:i.pathname.startsWith(g);return n.jsxs("div",{className:"navbar",children:[n.jsx("div",{className:"nav-left",children:n.jsxs(rr,{to:e==="ADMIN"?"/admin":e==="SUBADMIN"?"/subadmin/dashboard":e==="AEFE"?"/aefe/dashboard":"/teacher/classes",className:"nav-brand",style:{display:"flex",alignItems:"center",gap:"15px"},children:[n.jsx("img",{src:"/logosklnav.jpg",alt:"Logo SKL",style:{height:"66px",objectFit:"contain"}}),n.jsx("img",{src:"/logoaefenav.jpg",alt:"Logo AEFE",style:{height:"66px",objectFit:"contain"}})]})}),n.jsxs("div",{className:"nav-center",children:[e==="ADMIN"&&n.jsxs(n.Fragment,{children:[n.jsx(rr,{to:"/admin",className:`nav-link ${m("/admin")?"active":""}`,children:"Accueil"}),n.jsx(rr,{to:"/admin/ressource",className:`nav-link ${m("/admin/ressource")?"active":""}`,children:"Structure Scolaire"}),n.jsx(rr,{to:"/admin/users",className:`nav-link ${m("/admin/users")?"active":""}`,children:"Utilisateurs"}),n.jsx(rr,{to:"/admin/assignments",className:`nav-link ${m("/admin/assignments")?"active":""}`,children:"Assignations"}),n.jsx(rr,{to:"/admin/template-builder",className:`nav-link ${m("/admin/template-builder")?"active":""}`,children:"Templates"})]}),e==="SUBADMIN"&&n.jsxs(n.Fragment,{children:[f("SUBADMIN","dashboard")&&n.jsx(rr,{to:"/subadmin/dashboard",className:`nav-link ${m("/subadmin/dashboard")?"active":""}`,children:"Tableau de bord"}),f("SUBADMIN","progress")&&n.jsx(rr,{to:"/subadmin/progress",className:`nav-link ${m("/subadmin/progress")?"active":""}`,children:"Progression"}),f("SUBADMIN","teacher-progress")&&n.jsx(rr,{to:"/subadmin/teacher-progress",className:`nav-link ${m("/subadmin/teacher-progress")?"active":""}`,children:"Suivi Enseignants"}),f("SUBADMIN","gradebooks")&&n.jsx(rr,{to:"/subadmin/gradebooks",className:`nav-link ${m("/subadmin/gradebooks")?"active":""}`,children:"Carnet"}),f("SUBADMIN","eleves")&&n.jsx(rr,{to:"/subadmin/eleves",className:`nav-link ${m("/subadmin/eleves")?"active":""}`,children:"lves"}),f("SUBADMIN","signature")&&n.jsx(rr,{to:"/subadmin/signature",className:`nav-link ${m("/subadmin/signature")?"active":""}`,children:"Ma signature"}),n.jsx(rr,{to:"/subadmin/suggestion",className:`nav-link ${m("/subadmin/suggestion")?"active":""}`,children:"Suggestion"})]}),e==="AEFE"&&n.jsxs(n.Fragment,{children:[f("AEFE","dashboard")&&n.jsx(rr,{to:"/aefe/dashboard",className:`nav-link ${m("/aefe/dashboard")?"active":""}`,children:"Tableau de bord"}),f("AEFE","progress")&&n.jsx(rr,{to:"/aefe/progress",className:`nav-link ${m("/aefe/progress")?"active":""}`,children:"Progression"}),f("AEFE","teacher-progress")&&n.jsx(rr,{to:"/aefe/teacher-progress",className:`nav-link ${m("/aefe/teacher-progress")?"active":""}`,children:"Suivi Enseignants"}),n.jsx(rr,{to:"/aefe/suggestion",className:`nav-link ${m("/aefe/suggestion")?"active":""}`,children:"Suggestion"})]}),e==="TEACHER"&&t&&n.jsx(n.Fragment,{children:f("TEACHER","classes")&&n.jsx(rr,{to:"/teacher/classes",className:`nav-link ${m("/teacher/classes")?"active":""}`,children:"Mes Classes"})})]}),n.jsx("div",{className:"nav-right",children:t?n.jsxs(n.Fragment,{children:[o.length>0&&e==="ADMIN"&&n.jsxs("div",{style:{marginRight:"16px",position:"relative",display:"inline-flex",alignItems:"center"},children:[n.jsx("select",{value:l,onChange:g=>c(g.target.value),style:{appearance:"none",backgroundColor:"rgba(108, 92, 231, 0.1)",border:"1px solid rgba(108, 92, 231, 0.2)",borderRadius:"16px",padding:"4px 28px 4px 12px",color:"var(--primary)",fontWeight:"600",fontSize:"0.85rem",cursor:"pointer",outline:"none",fontFamily:"inherit"},children:o.map(g=>n.jsxs("option",{value:g._id,children:[g.name," ",g.active?"(Actif)":""]},g._id))}),n.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",right:"10px",pointerEvents:"none",color:"var(--primary)"},children:n.jsx("polyline",{points:"1 1 5 5 9 1"})})]}),e==="ADMIN"&&n.jsx(n.Fragment,{children:n.jsx(rr,{to:"/admin/settings",className:`nav-link ${m("/admin/settings")?"active":""}`,title:"Paramtres",style:{marginRight:"16px",display:"inline-flex",alignItems:"center"},children:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"3"}),n.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})}),r&&n.jsxs("span",{style:{marginRight:"16px",fontWeight:"500",color:"#333",display:"inline-flex",alignItems:"center",gap:"8px"},children:[n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",style:{opacity:.6},children:n.jsx("path",{d:"M10 10c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),r]}),n.jsx("button",{className:"btn secondary",onClick:h,children:"Dconnexion"})]}):n.jsx(rr,{to:"/login",className:"btn",children:"Connexion"})})]})}function Pne(){var l,c,u;const[e,t]=p.useState(null),[r,s]=p.useState(!1);p.useEffect(()=>{(sessionStorage.getItem("token")||localStorage.getItem("token"))&&i()},[]);const i=async()=>{try{const d=await Fh.getStatus();t(d)}catch(d){console.error("Failed to check impersonation status:",d)}},a=async()=>{try{s(!0),await Fh.stop(),sessionStorage.removeItem("token"),sessionStorage.removeItem("role"),sessionStorage.removeItem("displayName"),window.close(),setTimeout(()=>{window.closed||(alert("Please close this tab manually or use the close button"),window.location.href="/login")},500)}catch(d){console.error("Failed to stop impersonation:",d),alert("Failed to exit impersonation mode")}finally{s(!1)}},o=d=>{switch(d){case"ADMIN":return"Administrateur";case"SUBADMIN":return"Prfet";case"AEFE":return"RPP ET DIRECTION";case"TEACHER":return"Enseignant";default:return d||""}};return!e||!e.isImpersonating?null:n.jsxs("div",{style:{backgroundColor:"#ff9800",color:"#000",padding:"8px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"2px solid #f57c00",fontWeight:"bold",fontSize:"14px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("span",{style:{fontSize:"20px"},children:""}),n.jsxs("div",{children:[n.jsxs("div",{children:[n.jsx("strong",{children:"ADMIN MODE:"})," Logged in as ",(l=e.impersonatedUser)==null?void 0:l.displayName," (",o((c=e.impersonatedUser)==null?void 0:c.role),")"]}),n.jsxs("div",{style:{fontSize:"12px",opacity:.9,marginTop:"2px"},children:["Full account access  Original admin: ",(u=e.actualAdmin)==null?void 0:u.displayName]})]})]}),n.jsx("button",{onClick:a,disabled:r,style:{backgroundColor:"#000",color:"#fff",border:"none",padding:"8px 20px",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontWeight:"bold",fontSize:"14px"},children:r?" Exiting...":" Exit & Close Tab"})]})}function Ine(){const[e,t]=p.useState(""),[r,s]=p.useState([]),[i,a]=p.useState(!1),o=p.useRef(null),l=async()=>{a(!0);try{const x=await K.get("/media/list",{params:{folder:e}});s(x.data)}catch(x){console.error(x)}finally{a(!1)}},c=x=>{for(let y=1;y<=3;y++)if(!confirm(`${x}

Confirmation ${y}/3`))return!1;return!0};p.useEffect(()=>{l()},[e]);const u=async x=>{const y=new FormData;y.append("file",x);try{await fetch(`/media/upload?folder=${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:y}),await l()}catch{alert("Upload failed")}},d=async()=>{const x=prompt("Nom du nouveau dossier:");if(x)try{await K.post("/media/mkdir",{folder:e?`${e}/${x}`:x}),await l()}catch{alert("Erreur lors de la cration du dossier")}},f=async x=>{const y=prompt("Renommer vers:",x.name);if(!y||y===x.name)return;x.path;const v=e||"",S=v?`${v}/${y}`:y;try{await K.post("/media/rename",{from:x.path,to:S}),await l()}catch{alert("Erreur lors du renommage")}},h=async x=>{if(c(`Supprimer ${x.name} ?`))try{await K.post("/media/delete",{target:x.path}),await l()}catch{alert("Erreur lors de la suppression")}},m=()=>{if(!e)return;const x=e.split("/");x.pop(),t(x.join("/"))},g=e.split("/").filter(Boolean);return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[n.jsx("h2",{className:"title",style:{margin:0},children:"Mdiathque"}),n.jsxs("div",{className:"toolbar",children:[n.jsxs("button",{className:"btn secondary",onClick:d,children:[n.jsx("span",{style:{marginRight:8},children:"+"})," Dossier"]}),n.jsxs("button",{className:"btn",onClick:()=>{var x;return(x=o.current)==null?void 0:x.click()},children:[n.jsx("span",{style:{marginRight:8},children:""})," Upload"]}),n.jsx("input",{type:"file",ref:o,style:{display:"none"},onChange:x=>{var v;const y=(v=x.target.files)==null?void 0:v[0];y&&(u(y),x.target.value="")}})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,padding:"8px 12px",background:"#f8f9fa",borderRadius:8},children:[n.jsx("button",{onClick:()=>t(""),style:{border:"none",background:"none",cursor:"pointer",color:e?"var(--primary)":"var(--text)",fontWeight:500},children:"Home"}),g.map((x,y)=>{const v=g.slice(0,y+1).join("/");return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{color:"#ccc"},children:"/"}),n.jsx("button",{onClick:()=>t(v),style:{border:"none",background:"none",cursor:"pointer",color:y===g.length-1?"var(--text)":"var(--primary)",fontWeight:y===g.length-1?600:500},children:x})]},v)})]}),i?n.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--muted)"},children:"Chargement..."}):n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:16},children:[e&&n.jsxs("div",{className:"card",style:{padding:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",background:"#f8f9fa",border:"1px dashed #ccc",boxShadow:"none"},onClick:m,children:[n.jsx("div",{style:{fontSize:32,marginBottom:8},children:".."}),n.jsx("div",{style:{fontSize:14,fontWeight:500},children:"Retour"})]}),r.map(x=>{var y;return n.jsx("div",{className:"card",style:{padding:0,overflow:"hidden",position:"relative",transition:"transform 0.2s",border:"1px solid #eee"},children:x.type==="folder"?n.jsxs("div",{onClick:()=>t(e?`${e}/${x.name}`:x.name),style:{padding:24,display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",background:"#fff8e1",height:"100%",boxSizing:"border-box"},children:[n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"#f59e0b",style:{marginBottom:12},children:n.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})}),n.jsx("div",{style:{fontWeight:500,textAlign:"center",wordBreak:"break-word"},children:x.name})]}):n.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsx("div",{style:{height:120,background:"#eee",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:x.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)?n.jsx("img",{src:`/uploads${x.path}`,style:{width:"100%",height:"100%",objectFit:"cover"}}):n.jsxs("div",{style:{fontSize:12,color:"#666",padding:8,textAlign:"center"},children:[(y=x.name.split(".").pop())==null?void 0:y.toUpperCase()," File"]})}),n.jsxs("div",{style:{padding:12,flex:1,display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{fontSize:13,fontWeight:500,marginBottom:8,wordBreak:"break-word",flex:1},title:x.name,children:x.name}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[n.jsx("button",{onClick:()=>f(x),style:{padding:4,border:"1px solid #ddd",borderRadius:4,background:"white",cursor:"pointer"},title:"Renommer",children:""}),n.jsx("button",{onClick:()=>h(x),style:{padding:4,border:"1px solid #ddd",borderRadius:4,background:"white",cursor:"pointer",color:"red"},title:"Supprimer",children:""})]})]})]})},x.path)}),r.length===0&&!e&&n.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:40,color:"var(--muted)"},children:"Aucun fichier. Commencez par uploader quelque chose."})]})]})})}function Tne(){const{classId:e}=oa(),{activeYear:t}=Yn(),[r,s]=p.useState([]),[i,a]=p.useState([]),[o,l]=p.useState(""),[c,u]=p.useState("all"),[d,f]=p.useState(""),[h,m]=p.useState("name_asc"),[g,x]=p.useState(!0),[y,v]=p.useState(""),[S,k]=p.useState(!0);p.useEffect(()=>{e&&(async()=>{x(!0),v("");try{const O=K.get(`/teacher/classes/${e}/students`).then(W=>s(W.data)),B=K.get(`/teacher/classes/${e}/assignments`).then(W=>a(W.data)),I=K.get("/teacher/classes").then(W=>{const re=W.data.find(ae=>ae._id===e);re&&l(re.name)}),T=K.get("/settings/public").then(W=>{W.data.teacher_quick_grading_enabled!==void 0&&k(W.data.teacher_quick_grading_enabled)}).catch(()=>{});await Promise.all([O,B,I,T])}catch(O){v("Impossible de charger les donnes"),console.error(O)}finally{x(!1)}})()},[e]);const j=(t==null?void 0:t.activeSemester)||1,_=L=>j===2?!!L.isCompletedSem2:!!L.isCompletedSem1||!!L.isCompleted,b=p.useMemo(()=>{const L=new Map;for(const O of i){const B=L.get(O.studentId);B?B.push(O):L.set(O.studentId,[O])}return L},[i]),A=p.useMemo(()=>{const L=new Map;for(const B of i){const I=L.get(B.studentId)||{total:0,completed:0},T={total:I.total+1,completed:I.completed+(_(B)?1:0)};L.set(B.studentId,T)}const O=new Map;return L.forEach((B,I)=>{const T=B.total>0?Math.round(B.completed/B.total*100):0;O.set(I,{completed:B.completed,total:B.total,isFullyComplete:B.total>0&&B.completed===B.total,completionPercentage:T})}),O},[i,j]),z=L=>A.get(L)||{completed:0,total:0,isFullyComplete:!1,completionPercentage:0},D=L=>(L||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),w=p.useMemo(()=>{const L=D(d),O=r.filter(B=>{const I=D(`${B.firstName} ${B.lastName}`),T=D(`${B.lastName} ${B.firstName}`);if(!(!L||I.includes(L)||T.includes(L)))return!1;if(c==="all")return!0;const{isFullyComplete:re}=z(B._id);return c==="completed"?re:c==="incomplete"?!re:!0});return O.sort((B,I)=>{const T=D(B.lastName),W=D(I.lastName),re=D(B.firstName),ae=D(I.firstName),Y=()=>{const ce=T.localeCompare(W);return ce!==0?ce:re.localeCompare(ae)},J=()=>{const ce=re.localeCompare(ae);return ce!==0?ce:T.localeCompare(W)},P=()=>{const ce=z(B._id).completionPercentage,pe=z(I._id).completionPercentage;return ce!==pe?pe-ce:Y()};return h==="name_asc"?Y():h==="name_desc"?-Y():h==="firstName_asc"?J():h==="firstName_desc"?-J():h==="progress_desc"?P():h==="progress_asc"?-P():0}),O},[r,c,d,h,A]),N=i.length,$=i.filter(L=>_(L)).length,E=N>0?Math.round($/N*100):0,q=N>0?{totalAssignments:N,completedAssignments:$,completionPercentage:E}:null;return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:24},children:[n.jsx(rr,{to:"/teacher/classes",className:"btn secondary",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:42,padding:"0 20px",borderRadius:21,background:"#f1f5f9",color:"#475569",fontWeight:600,border:"1px solid #e2e8f0",textDecoration:"none",transition:"all 0.2s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},children:" Retour aux classes"}),n.jsxs("div",{children:[n.jsxs("h2",{className:"title",style:{fontSize:24,margin:0,color:"#1e293b",display:"flex",alignItems:"center",gap:12},children:[n.jsx("span",{children:" lves de la classe"}),o&&n.jsx("span",{style:{background:"#e2e8f0",padding:"4px 12px",borderRadius:8,fontSize:"0.9em",color:"#334155"},children:o})]}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:4},children:[n.jsxs("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:["Semestre actif : S",j]}),(t==null?void 0:t.name)&&n.jsxs("div",{className:"note",style:{fontSize:13,background:"#eef2ff",padding:"4px 10px",borderRadius:8,color:"#3730a3"},children:["Anne : ",t.name]})]})]})]}),g&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Chargement..."}),y&&n.jsx("div",{className:"note",style:{color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca"},children:y}),q&&n.jsxs("div",{style:{marginTop:20,marginBottom:20,padding:20,background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[n.jsx("div",{className:"note",style:{fontSize:15,fontWeight:600,color:"#475569"},children:" Progression de la classe"}),n.jsxs("div",{style:{fontSize:24,fontWeight:"bold",color:q.completionPercentage===100?"#10b981":"#6c5ce7",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[q.completionPercentage,"%"]})]}),n.jsxs("div",{className:"note",style:{fontSize:13,marginBottom:10,color:"#64748b"},children:[q.completedAssignments," / ",q.totalAssignments," carnets termins (S",j,")"]}),n.jsx("div",{style:{width:"100%",height:14,background:"#e2e8f0",borderRadius:999,overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.06)"},children:n.jsx("div",{style:{width:`${q.completionPercentage}%`,height:"100%",background:q.completionPercentage===100?"linear-gradient(90deg, #10b981 0%, #059669 100%)":"linear-gradient(90deg, #6c5ce7 0%, #5b4bc4 100%)",transition:"width 0.5s ease",boxShadow:q.completionPercentage>0?"0 2px 8px rgba(108, 92, 231, 0.4)":"none"}})})]}),n.jsxs("div",{style:{marginTop:20,marginBottom:20,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,flex:"1 1 320px"},children:[n.jsx("span",{className:"note",style:{fontSize:14,fontWeight:500,color:"#475569",whiteSpace:"nowrap"},children:" Rechercher:"}),n.jsx("input",{value:d,onChange:L=>f(L.target.value),placeholder:"Prnom ou nom",style:{width:"100%",padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white",outline:"none"}})]}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,flex:"0 0 auto"},children:[n.jsx("span",{className:"note",style:{fontSize:14,fontWeight:500,color:"#475569",whiteSpace:"nowrap"},children:" Trier:"}),n.jsxs("select",{value:h,onChange:L=>m(L.target.value),style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white",cursor:"pointer",outline:"none"},children:[n.jsx("option",{value:"name_asc",children:"Nom (A  Z)"}),n.jsx("option",{value:"name_desc",children:"Nom (Z  A)"}),n.jsx("option",{value:"firstName_asc",children:"Prnom (A  Z)"}),n.jsx("option",{value:"firstName_desc",children:"Prnom (Z  A)"}),n.jsx("option",{value:"progress_desc",children:"Progression (plus  moins)"}),n.jsx("option",{value:"progress_asc",children:"Progression (moins  plus)"})]})]}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,flex:"0 0 auto"},children:[n.jsx("span",{className:"note",style:{fontSize:14,fontWeight:500,color:"#475569",whiteSpace:"nowrap"},children:" Filtrer:"}),n.jsxs("select",{value:c,onChange:L=>u(L.target.value),style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white",cursor:"pointer",outline:"none"},children:[n.jsx("option",{value:"all",children:"Tous"}),n.jsx("option",{value:"completed",children:"Termins"}),n.jsx("option",{value:"incomplete",children:"Non termins"})]})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:18,marginTop:20},children:[w.map(L=>{const O=z(L._id),B=b.get(L._id)||[];return n.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",gap:14,position:"relative",transition:"all 0.3s ease",border:"1px solid #e2e8f0",background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[O.isFullyComplete&&n.jsx("div",{style:{position:"absolute",top:10,right:10,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"bold",boxShadow:"0 3px 10px rgba(16, 185, 129, 0.4)"},children:""}),n.jsx("img",{className:"avatar",loading:"lazy",src:L.avatarUrl||`https://api.dicebear.com/9.x/thumbs/svg?seed=${L.firstName}-${L.lastName}`,alt:"",style:{width:64,height:64,borderRadius:"50%",border:"3px solid #e2e8f0",objectFit:"cover"}}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{className:"title",style:{fontSize:17,marginBottom:4,color:"#1e293b",fontWeight:600},children:[L.firstName," ",L.lastName]}),n.jsx("div",{className:"note",style:{fontSize:13,fontWeight:500},children:O.total>0?n.jsx("span",{style:{color:O.isFullyComplete?"#10b981":"#6c5ce7"},children:O.isFullyComplete?"Termin":"Pas encore termin"}):n.jsx("span",{style:{color:"#94a3b8"},children:"Aucun carnet"})})]})]}),B.length>0&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,marginTop:8},children:B.map(I=>n.jsxs("div",{style:{display:"flex",gap:6},children:[S&&n.jsx(rr,{to:`/teacher/templates/${I._id}/quick`,style:{textDecoration:"none",flex:1},children:n.jsxs("div",{style:{padding:"8px 12px",background:_(I)?"#ecfdf5":"white",border:`1px solid ${_(I)?"#10b981":"#e2e8f0"}`,borderRadius:6,fontSize:13,color:"#334155",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},onMouseEnter:T=>{T.currentTarget.style.borderColor="#6c5ce7",T.currentTarget.style.transform="translateX(2px)"},onMouseLeave:T=>{T.currentTarget.style.borderColor=_(I)?"#10b981":"#e2e8f0",T.currentTarget.style.transform="translateX(0)"},children:[n.jsx("span",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:" Notation rapide"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsxs("div",{style:{display:"flex",gap:2},children:[n.jsx("span",{style:{fontSize:10,padding:"2px 4px",borderRadius:4,background:I.isCompletedSem1?"#10b981":"#f1f5f9",color:I.isCompletedSem1?"white":"#94a3b8",fontWeight:600},children:"S1"}),n.jsx("span",{style:{fontSize:10,padding:"2px 4px",borderRadius:4,background:I.isCompletedSem2?"#10b981":"#f1f5f9",color:I.isCompletedSem2?"white":"#94a3b8",fontWeight:600},children:"S2"})]}),_(I)?n.jsx("span",{style:{color:"#10b981"},children:""}):n.jsx("span",{style:{color:"#6c5ce7"},children:""})]})]})}),n.jsx(rr,{to:`/teacher/templates/${I._id}/edit`,style:{textDecoration:"none",flex:S?void 0:1},title:"Vue complte du carnet",children:n.jsxs("div",{style:{padding:S?"8px 10px":"8px 12px",background:S?"#f1f5f9":_(I)?"#ecfdf5":"white",border:`1px solid ${S?"#e2e8f0":_(I)?"#10b981":"#e2e8f0"}`,borderRadius:6,fontSize:13,color:S?"#64748b":"#334155",display:"flex",alignItems:"center",justifyContent:S?"center":"space-between",transition:"all 0.2s ease",height:"100%",gap:8},onMouseEnter:T=>{T.currentTarget.style.background="#e0e7ff",T.currentTarget.style.color="#4338ca",T.currentTarget.style.borderColor="#6c5ce7"},onMouseLeave:T=>{T.currentTarget.style.background=S?"#f1f5f9":_(I)?"#ecfdf5":"white",T.currentTarget.style.color=S?"#64748b":"#334155",T.currentTarget.style.borderColor=S?"#e2e8f0":_(I)?"#10b981":"#e2e8f0"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[" ",!S&&n.jsx("span",{style:{fontWeight:500},children:"Ouvrir le carnet"})]}),!S&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsxs("div",{style:{display:"flex",gap:2},children:[n.jsx("span",{style:{fontSize:10,padding:"2px 4px",borderRadius:4,background:I.isCompletedSem1?"#10b981":"#f1f5f9",color:I.isCompletedSem1?"white":"#94a3b8",fontWeight:600},children:"S1"}),n.jsx("span",{style:{fontSize:10,padding:"2px 4px",borderRadius:4,background:I.isCompletedSem2?"#10b981":"#f1f5f9",color:I.isCompletedSem2?"white":"#94a3b8",fontWeight:600},children:"S2"})]}),_(I)?n.jsx("span",{style:{color:"#10b981"},children:""}):n.jsx("span",{style:{color:"#6c5ce7"},children:""})]})]})})]},I._id))})]},L._id)}),!g&&w.length===0&&n.jsx("div",{className:"note",children:d.trim()?"Aucun lve ne correspond  la recherche.":c==="all"?"Aucun lve dans cette classe.":`Aucun lve ${c==="completed"?"termin":"non termin"}.`})]})]})})}function Rne(){const{studentId:e}=oa(),{activeYear:t}=Yn(),r=(t==null?void 0:t.activeSemester)||1,[s,i]=p.useState([]),[a,o]=p.useState(""),[l,c]=p.useState(!0),[u,d]=p.useState(""),[f,h]=p.useState(null);p.useEffect(()=>{e&&(async()=>{try{c(!0);const y=await K.get(`/teacher/students/${e}/templates`);if(i(y.data),y.data.length>0&&y.data[0].student){const v=y.data[0].student;o(`${v.firstName} ${v.lastName}`)}}catch(y){d("Impossible de charger les carnets"),console.error(y)}finally{c(!1)}})()},[e]);const m=x=>r===2?!!x.isMyWorkCompletedSem2:!!x.isMyWorkCompletedSem1||!!x.isMyWorkCompleted,g=async(x,y)=>{try{h(x),d("");const v=y?"unmark-done":"mark-done",S=await K.post(`/teacher/templates/${x}/${v}`,{semester:r});i(k=>k.map(j=>{if(j._id!==x)return j;const _={...j,...S.data};return r===2?_.isMyWorkCompletedSem2=!y:(_.isMyWorkCompletedSem1=!y,_.isMyWorkCompleted=!y),_}))}catch(v){d("chec de la mise  jour"),console.error(v)}finally{h(null)}};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("button",{className:"btn secondary",onClick:()=>window.history.back(),style:{marginBottom:20,display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0"},children:" Retour"}),n.jsxs("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:[" Carnets - ",a||"lve"]}),n.jsx("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:"Grez les carnets de comptences assigns  cet lve"}),l&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Chargement..."}),u&&n.jsx("div",{className:"note",style:{color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca",marginTop:16},children:u}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:18,marginTop:20},children:[s.map(x=>{var v;const y=m(x);return n.jsxs("div",{className:"card",style:{position:"relative",transition:"all 0.3s ease",border:"1px solid #e2e8f0",background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)"},children:[y&&n.jsx("div",{style:{position:"absolute",top:14,right:14,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,fontWeight:"bold",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.4)"},children:""}),n.jsx("div",{className:"title",style:{fontSize:18,paddingRight:x.isCompleted?50:0,marginBottom:8,color:"#1e293b",fontWeight:600},children:((v=x.template)==null?void 0:v.name)||"Carnet"}),n.jsxs("div",{className:"note",style:{fontSize:13,color:"#64748b",marginBottom:4},children:["Statut: ",n.jsx("span",{style:{fontWeight:500},children:x.status==="draft"?" Brouillon":x.status==="in_progress"?" En cours":x.status==="completed"?" Termin":x.status==="signed"?" Sign":x.status})]}),x.isCompleted&&x.completedAt&&n.jsxs("div",{className:"note",style:{fontSize:12,marginTop:6,color:"#10b981",fontWeight:500},children:[" Marqu termin le ",new Date(x.completedAt).toLocaleDateString("fr-FR")]}),n.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[n.jsx(rr,{to:`/teacher/templates/${x._id}/edit`,style:{textDecoration:"none",flex:1},children:n.jsx("button",{className:"btn",style:{width:"100%",background:"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)",fontWeight:500,padding:"10px 16px",boxShadow:"0 2px 8px rgba(108, 92, 231, 0.3)"},children:" diter"})}),n.jsx("button",{className:y?"btn secondary":"btn",onClick:()=>g(x._id,y),disabled:f===x._id,style:{background:y?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",minWidth:130,fontWeight:500,padding:"10px 16px",boxShadow:y?"0 2px 8px rgba(245, 158, 11, 0.3)":"0 2px 8px rgba(16, 185, 129, 0.3)"},children:f===x._id?" ...":y?" Incomplet":" Termin"})]})]},x._id)}),!l&&s.length===0&&n.jsx("div",{className:"note",children:"Aucun carnet assign  cet lve."})]})]})})}const Ay=800,d_=1120;function One(){const{assignmentId:e}=oa(),[t,r]=p.useState(null),[s,i]=p.useState(null),[a,o]=p.useState(null),[l,c]=p.useState(0),[u,d]=p.useState(!0),[f,h]=p.useState(!0),[m,g]=p.useState(""),[x,y]=p.useState(""),[v,S]=p.useState(null),[k,j]=p.useState(!1),[_,b]=p.useState([]),[A,z]=p.useState(!1),[D,w]=p.useState([]),[N,$]=p.useState({}),[E,q]=p.useState(!1),[L,O]=p.useState(!1),[B,I]=p.useState(!1),[T,W]=p.useState(1),[re,ae]=p.useState(1),[Y,J]=p.useState(!1),[P,ce]=p.useState(!0),[pe,ye]=p.useState({}),se=p.useRef(null),je=()=>{const Q=se.current?se.current.clientWidth:window.innerWidth;return Math.max(0,Math.min(window.innerWidth,Q)-48)/Ay},{levels:ve}=la(),{activeYear:le}=Yn(),oe=Od(),de=(Q,be,we)=>{if(!we)return!0;const Ne={};ve.forEach(fe=>{Ne[fe.name.toUpperCase()]=fe.order});const V=Ne[we.toUpperCase()];if(V===void 0)return!0;if(Q){const fe=Ne[Q.toUpperCase()];return fe===void 0?!0:fe<=V}return be&&be.length>0?be.some(fe=>{const Oe=Ne[fe.toUpperCase()];return Oe===void 0?!0:Oe<=V}):!0},Pe=(Q,be)=>{if(!be||!Q||Q.length===0)return!0;const we=be.toUpperCase(),Ne=Q.map(V=>V.toUpperCase());return Ne.length===1&&Ne[0]===we},Z=p.useMemo(()=>t?t.pages.map((Q,be)=>({page:Q,originalIndex:be})).filter((Q,be)=>t.signingPage===void 0||be!==t.signingPage-1):[],[t]),ne=Q=>{if(!Q||typeof window>"u")return Q;if(Q.includes("localhost:4000")){const be=window.location.hostname,we=window.location.protocol;return Q.replace(/http(s)?:\/\/localhost:4000/,`${we}//${be}:4000`)}return Q};p.useEffect(()=>{const Q=()=>{Y&&ae(je())};return Y&&(Q(),window.addEventListener("resize",Q)),()=>window.removeEventListener("resize",Q)},[Y]),p.useEffect(()=>{if(e&&oe){const Q=`assignment:${e}`;oe.emit("join-room",Q);const be=we=>{if(we.type==="language-toggle"&&r(Ne=>{var Ve;if(!Ne)return Ne;const V={...Ne},{pageIndex:fe,blockIndex:Oe,items:Fe}=we;return(Ve=V.pages[fe])!=null&&Ve.blocks[Oe]&&(V.pages[fe].blocks[Oe].props.items=Fe),V}),we.type==="assignment-data"&&o(Ne=>{if(!Ne||we.assignmentId&&we.assignmentId!==Ne._id)return Ne;const V={...Ne.data||{},...we.data||{}};return{...Ne,data:V}}),we.type==="completion-update"){if(we.assignmentId&&we.assignmentId!==(a==null?void 0:a._id))return;if(we.assignmentPatch&&o(Ne=>Ne&&{...Ne,...we.assignmentPatch}),we.languageCompletions){const Ne=me({languageCompletions:we.languageCompletions});$(Ne),D.length===0&&Array.isArray(we.languages)&&we.languages.length>0&&w(we.languages.map(H).filter(Boolean));const V=Be(1,Ne,we.languages),fe=Be(2,Ne,we.languages);O(V),I(fe),q(V)}}};return oe.on("update-received",be),()=>{oe.emit("leave-room",Q),oe.off("update-received",be)}}},[e,oe]);const ee=Q=>{if(!oe||!e)return;const be={type:"assignment-data",assignmentId:e,data:Q,dataVersion:a==null?void 0:a.dataVersion};oe.emit("broadcast-update",{roomId:`assignment:${e}`,payload:be},we=>{(!we||we.status!=="ok")&&console.warn("Socket update ack failed or not received",we)})};p.useEffect(()=>{e&&(async()=>{try{h(!0);const[be,we]=await Promise.all([K.get(`/teacher/template-assignments/${e}`),K.get("/settings/public").catch(()=>({data:{}}))]),Ne=be;r(Ne.data.template),i(Ne.data.student),o(Ne.data.assignment),j(Ne.data.canEdit),b(Ne.data.allowedLanguages||[]),z(Ne.data.isProfPolyvalent||!1),w(Ne.data.completionLanguages||[]),$(Ne.data.languageCompletion||me(Ne.data.assignment)),q(Ne.data.isMyWorkCompleted||!1),O(Ne.data.isMyWorkCompletedSem1||!1),I(Ne.data.isMyWorkCompletedSem2||!1),W(Ne.data.activeSemester||1),we.data.teacher_quick_grading_enabled!==void 0&&ce(we.data.teacher_quick_grading_enabled),we.data.block_visibility_settings!==void 0&&ye(we.data.block_visibility_settings||{})}catch(be){g("Impossible de charger le carnet"),console.error(be)}finally{h(!1)}})()},[e]),p.useEffect(()=>{const Q=()=>S(null);if(v)return document.addEventListener("click",Q),()=>document.removeEventListener("click",Q)},[v]);const te=(Q,be,we,Ne)=>Ne?`block:${Ne}`:`tpl:${Q||""}:p:${be}:b:${we}`,G=async(Q,be,we)=>{var Ne,V,fe,Oe,Fe,Ve,tt;try{y("Enregistrement...");const Wt=(fe=(V=(Ne=t==null?void 0:t.pages)==null?void 0:Ne[Q])==null?void 0:V.blocks)==null?void 0:fe[be],Ct=(Oe=Wt==null?void 0:Wt.props)==null?void 0:Oe.blockId,Ot={pageIndex:Q,blockIndex:be,blockId:Ct,items:we},et=a==null?void 0:a.dataVersion;typeof et=="number"&&(Ot.expectedDataVersion=et);const nt=await K.patch(`/teacher/template-assignments/${e}/language-toggle`,Ot);if(t){const ft={...t};ft.pages[Q].blocks[be].props.items=we,r(ft),oe&&oe.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"language-toggle",pageIndex:Q,blockIndex:be,items:we,changeId:(Fe=nt.data)==null?void 0:Fe.changeId,dataVersion:(Ve=nt.data)==null?void 0:Ve.dataVersion}},vt=>{(!vt||vt.status!=="ok")&&console.warn("Socket ack failed")})}nt&&nt.data&&typeof nt.data.dataVersion=="number"&&o(ft=>ft&&{...ft,data:ft.data,dataVersion:nt.data.dataVersion}),y("Enregistr avec succs "),setTimeout(()=>y(""),3e3)}catch(Wt){if(((tt=Wt==null?void 0:Wt.response)==null?void 0:tt.status)===409){g("Conflit dtect  vos modifications n'ont pas t appliques. Rechargez et ressayez.");try{const Ct=await K.get(`/teacher/template-assignments/${e}`);r(Ct.data.template),o(Ct.data.assignment)}catch(Ct){console.error("Failed to reload after conflict",Ct)}}else g("chec de l'enregistrement");y(""),console.error(Wt)}},H=Q=>{const be=(Q||"").toLowerCase();return be?be==="lb"||be==="ar"?"ar":be==="en"||be==="uk"||be==="gb"?"en":be==="fr"?"fr":be:""},ie=Q=>{const be=H(Q);return be==="ar"?"Arabe":be==="en"?"Anglais":be==="fr"?"Polyvalent":Q||"Langue"},me=Q=>{const be={};return((Q==null?void 0:Q.languageCompletions)||[]).forEach(Ne=>{const V=H(Ne.code);V&&(be[V]={completed:Ne.completed,completedSem1:Ne.completedSem1,completedSem2:Ne.completedSem2})}),be},ke=(Q,be)=>{const we=N[H(be)];return we?Q===1?!!(we.completedSem1||we.completed):!!we.completedSem2:!1},Be=(Q,be,we)=>{const Ne=be||N,V=we&&we.length>0?we:D;return V.length===0?!1:V.every(fe=>{const Oe=Ne[H(fe)];return Oe?Q===1?!!(Oe.completedSem1||Oe.completed):!!Oe.completedSem2:!1})},Te=p.useMemo(()=>D.length>0?Be(T):T===1?L:B,[T,D,L,B,N]),qe=k&&!Te,Qe=async(Q,be)=>{var we,Ne,V,fe,Oe,Fe,Ve,tt,Wt,Ct;if(a)try{y("Enregistrement...");const Ot=be&&be.length>0?be:D,et=Ot.length>0?Ot.every(Ie=>ke(Q,Ie)):Q===1?L:B,nt=et?"unmark-done":"mark-done",ft=await K.post(`/teacher/templates/${e}/${nt}`,{semester:Q,languages:Ot});o(ft.data);const vt=me(ft.data);$(vt),D.length===0&&Ot.length>0&&w(Ot.map(H).filter(Boolean));const Zt=Be(1,vt,Ot),Se=Be(2,vt,Ot);Q===1?(O(Zt),q(Zt)):I(Se),oe&&oe.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"completion-update",assignmentId:e,assignmentPatch:{languageCompletions:(we=ft.data)==null?void 0:we.languageCompletions,teacherCompletions:(Ne=ft.data)==null?void 0:Ne.teacherCompletions,isCompletedSem1:(V=ft.data)==null?void 0:V.isCompletedSem1,isCompletedSem2:(fe=ft.data)==null?void 0:fe.isCompletedSem2,isCompleted:(Oe=ft.data)==null?void 0:Oe.isCompleted,completedAtSem1:(Fe=ft.data)==null?void 0:Fe.completedAtSem1,completedAtSem2:(Ve=ft.data)==null?void 0:Ve.completedAtSem2,completedAt:(tt=ft.data)==null?void 0:tt.completedAt,status:(Wt=ft.data)==null?void 0:Wt.status},languageCompletions:(Ct=ft.data)==null?void 0:Ct.languageCompletions,languages:Ot}}),y(et?"Rouvert avec succs":"Termin avec succs "),setTimeout(()=>y(""),3e3)}catch(Ot){g("Erreur lors de la mise  jour du statut"),console.error(Ot)}},Ze=Q=>{if(!Q)return null;if(ve&&ve.length>0){const we=ve.find(Ne=>Ne.name===Q);if(we){const Ne=ve.find(V=>V.order===we.order+1);if(Ne)return Ne.name}}const be=(Q||"").toUpperCase();return be==="TPS"?"PS":be==="PS"?"MS":be==="MS"?"GS":be==="GS"?"EB1":be==="KG1"?"KG2":be==="KG2"?"KG3":be==="KG3"?"EB1":null},ge=Q=>{if(Q.props.level)return Q.props.level;const be=(Q.props.label||"").toUpperCase();return/\bTPS\b/.test(be)?"TPS":/\bPS\b/.test(be)?"PS":/\bMS\b/.test(be)?"MS":/\bGS\b/.test(be)?"GS":/\bEB1\b/.test(be)?"EB1":/\bKG1\b/.test(be)?"KG1":/\bKG2\b/.test(be)?"KG2":/\bKG3\b/.test(be)?"KG3":null},Ae=Q=>{if(!Q)return"";const be=Q.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!be)return"";const we=parseInt(be[1],10),Ne=be[2],V=parseInt(be[3],10);return Number.isNaN(we)||Number.isNaN(V)?"":`${we+1}${Ne}${V+1}`},Le=(Q,be)=>{var Ve;const we=String((Q==null?void 0:Q.year)||"");if(we){const tt=Ae(we);if(tt)return tt}const Ne=Ae(le==null?void 0:le.name);if(Ne)return Ne;if(!we)return"";const V=((Ve=a==null?void 0:a.data)==null?void 0:Ve.signatures)||[],fe=String((Q==null?void 0:Q.from)||be||""),Oe=Array.isArray(V)?V.filter(tt=>(tt==null?void 0:tt.type)==="end_of_year"&&(tt==null?void 0:tt.schoolYearName)).find(tt=>fe?tt!=null&&tt.level?String(tt.level)===fe:!1:!0):null;return Oe!=null&&Oe.schoolYearName?String(Oe.schoolYearName):Ae(we)||we};return f?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Chargement..."})})}):m&&!t?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",style:{color:"crimson"},children:m})})}):t?n.jsxs("div",{style:{padding:24},children:[n.jsx(jd,{}),n.jsx(im,{}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>window.history.back(),style:{display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0"},children:" Retour"}),P&&n.jsx("a",{href:`/teacher/templates/${e}/quick`,className:"btn secondary",style:{display:"inline-flex",alignItems:"center",gap:8,background:"#fef3c7",color:"#92400e",fontWeight:500,border:"1px solid #fcd34d",textDecoration:"none"},children:" Notation rapide"})]}),n.jsxs("div",{style:{marginBottom:20,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:16},children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b",display:"flex",alignItems:"center",gap:12},children:[n.jsxs("span",{children:[" dition du carnet - ",s?`${s.firstName} ${s.lastName}`:"lve"]}),(s==null?void 0:s.level)&&n.jsx("span",{style:{fontSize:14,background:"#e0e7ff",color:"#4338ca",padding:"4px 10px",borderRadius:16,fontWeight:600},children:s.level}),(s==null?void 0:s.className)&&n.jsx("span",{style:{fontSize:14,background:"#f1f5f9",color:"#475569",padding:"4px 10px",borderRadius:16,fontWeight:600},children:s.className}),n.jsxs("span",{style:{fontSize:14,background:T===2?"#dbeafe":"#fef3c7",color:T===2?"#1e40af":"#92400e",padding:"4px 10px",borderRadius:16,fontWeight:700,border:`1px solid ${T===2?"#93c5fd":"#fcd34d"}`},children:["S",T]})]}),n.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,fontSize:13,fontWeight:500,background:(a==null?void 0:a.status)==="signed"?"#d1fae5":(a==null?void 0:a.status)==="completed"?"#dbeafe":"#fef3c7",color:(a==null?void 0:a.status)==="signed"?"#065f46":(a==null?void 0:a.status)==="completed"?"#1e40af":"#92400e",border:`1px solid ${(a==null?void 0:a.status)==="signed"?"#6ee7b7":(a==null?void 0:a.status)==="completed"?"#93c5fd":"#fcd34d"}`},children:[(a==null?void 0:a.status)==="draft"&&" Brouillon",(a==null?void 0:a.status)==="in_progress"&&" En cours",(a==null?void 0:a.status)==="completed"&&" Termin",(a==null?void 0:a.status)==="signed"&&" Sign",!["draft","in_progress","completed","signed"].includes((a==null?void 0:a.status)||"")&&(a==null?void 0:a.status)]})]}),k&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[1,2].map(Q=>{const we=!(T===Q),Ne=D.length>0?D.every(V=>ke(Q,V)):Q===1?L:B;return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"6px 10px",background:we?"transparent":"#f0f9ff",borderRadius:8,border:we?"1px solid transparent":"1px solid #bae6fd"},children:[n.jsxs("div",{style:{fontWeight:800,fontSize:13,color:we?"#94a3b8":"#0369a1",minWidth:50},children:["SEM ",Q]}),!we&&n.jsx("div",{style:{height:20,width:1,background:"#cbd5e1"}}),D.length>1&&n.jsx("button",{className:"btn",onClick:()=>Qe(Q,D),disabled:we,style:{padding:"4px 10px",fontSize:12,borderRadius:6,border:"1px solid #e2e8f0",background:we?"#f1f5f9":Ne?"#dcfce7":"#fff",color:we?"#94a3b8":Ne?"#166534":"#475569",cursor:we?"not-allowed":"pointer",fontWeight:600,boxShadow:we?"none":"0 1px 2px rgba(0,0,0,0.05)",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},title:we?`Semestre ${Q} inactif`:Ne?"Tout rouvrir":"Tout terminer",children:Ne?" Tout Termin":" Tout Valider"}),D.length===0&&n.jsx("button",{className:"btn",onClick:()=>Qe(Q),disabled:we,style:{padding:"5px 12px",fontSize:13,borderRadius:6,border:"1px solid #e2e8f0",background:we?"#f1f5f9":Ne?"#dcfce7":"#fff",color:we?"#94a3b8":Ne?"#166534":"#0f172a",cursor:we?"not-allowed":"pointer",fontWeight:600,boxShadow:we?"none":"0 1px 2px rgba(0,0,0,0.05)",transition:"all 0.2s"},children:Ne?` Semestre ${Q} Termin`:`Valider Semestre ${Q}`}),D.length>0&&D.map(V=>{const fe=ke(Q,V);return n.jsxs("button",{onClick:()=>Qe(Q,[V]),disabled:we,className:"btn",style:{padding:"4px 10px",fontSize:12,borderRadius:100,border:`1px solid ${fe?"#22c55e":"#cbd5e1"}`,background:we?"#f1f5f9":fe?"#22c55e":"#fff",color:we?"#94a3b8":fe?"#fff":"#475569",cursor:we?"not-allowed":"pointer",fontWeight:600,transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},children:[fe&&n.jsx("span",{children:""}),ie(V)]},V)})]},Q)})})]}),x&&n.jsxs("div",{style:{padding:"14px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",borderRadius:8,marginBottom:16,fontWeight:600,fontSize:14,textAlign:"center",boxShadow:"0 2px 8px rgba(16, 185, 129, 0.3)"},children:[" ",x]}),m&&n.jsxs("div",{style:{padding:"14px 20px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"white",borderRadius:8,marginBottom:16,fontWeight:600,fontSize:14,textAlign:"center",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:[" ",m]}),n.jsxs("div",{style:{marginTop:20,marginBottom:20,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",padding:16,background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>d(!u),style:{background:u?"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)":"#f1f5f9",color:u?"white":"#475569",fontWeight:500,border:"1px solid #cbd5e1",padding:"10px 16px",boxShadow:u?"0 2px 8px rgba(108, 92, 231, 0.3)":"none"},children:u?" Vue page par page":" Vue continue"}),n.jsx("div",{style:{height:24,width:1,background:"#cbd5e1",margin:"0 8px"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"white",padding:"4px 8px",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>{J(!1),ae(Q=>Math.max(.2,Q-.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom Out",children:""}),n.jsxs("span",{style:{fontSize:13,fontWeight:600,minWidth:40,textAlign:"center"},children:[Math.round(re*100),"%"]}),n.jsx("button",{className:"btn secondary",onClick:()=>{J(!1),ae(Q=>Math.min(2,Q+.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom In",children:"+"})]}),n.jsx("button",{className:"btn secondary",onClick:()=>{Y?(J(!1),ae(1)):(ae(je()),J(!0))},style:{background:Y?"#e0e7ff":"white",color:Y?"#4338ca":"#475569",border:"1px solid #e2e8f0",padding:"8px 12px",fontWeight:500},children:Y?" Ajust":" Ajuster"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flex:1,justifyContent:"flex-end"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>c(Math.max(0,l-1)),disabled:l===0||u,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:l===0||u?.5:1,cursor:l===0||u?"not-allowed":"pointer",fontWeight:500},children:" Prcdent"}),n.jsx("select",{value:l,onChange:Q=>{const be=Number(Q.target.value);c(be),u&&setTimeout(()=>{var V;const we=(V=Z[be])==null?void 0:V.originalIndex,Ne=document.getElementById(`page-${we}`);Ne&&Ne.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white",minWidth:150},children:Z.map((Q,be)=>n.jsx("option",{value:be,children:Q.page.title||`Page ${Q.originalIndex+1}`},be))}),n.jsx("button",{className:"btn secondary",onClick:()=>c(Math.min(Z.length-1,l+1)),disabled:l===Z.length-1||u,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:l===Z.length-1||u?.5:1,cursor:l===Z.length-1||u?"not-allowed":"pointer",fontWeight:500},children:"Suivant "})]})]}),n.jsx("div",{ref:se,style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center",overflowX:"hidden",width:"100%"},children:(u?Z:Z[l]?[Z[l]]:[]).map((Q,be)=>{const we=Q.page,Ne=Q.originalIndex;return n.jsx("div",{style:{width:Ay*re,height:d_*re,position:"relative",transition:"width 0.2s ease-out, height 0.2s ease-out"},children:n.jsxs("div",{id:`page-${Ne}`,className:"card page-canvas",style:{height:d_,width:Ay,background:we.bgColor||"#fff",overflow:"hidden",position:"absolute",top:0,left:0,transform:`scale(${re})`,transformOrigin:"top left",transition:"transform 0.2s ease-out",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",border:"1px solid #e2e8f0"},children:[u&&n.jsxs("div",{style:{position:"absolute",top:-36,left:0,color:"#64748b",fontSize:15,fontWeight:600,background:"#f8fafc",padding:"4px 12px",borderRadius:6,border:"1px solid #e2e8f0"},children:[" Page ",Ne+1]}),n.jsx("div",{className:"page-margins"}),we.blocks.map((V,fe)=>{var Wt,Ct,Ot;if(!V||!V.props)return null;const Oe=typeof((Wt=V==null?void 0:V.props)==null?void 0:Wt.blockId)=="string"&&V.props.blockId.trim()?V.props.blockId.trim():null,Fe=te(t==null?void 0:t._id,Ne,fe,Oe),Ve=((s==null?void 0:s.level)||"PS").toUpperCase(),tt=(Ot=(Ct=pe==null?void 0:pe[Ve])==null?void 0:Ct.teacher)==null?void 0:Ot[Fe];return tt&&(tt==="never"||tt==="after_sem1"&&!signature&&!finalSignature||tt==="after_sem2"&&!finalSignature)?null:n.jsxs("div",{style:{position:"absolute",left:V.props.x||0,top:V.props.y||0,zIndex:V.props.z??fe,padding:6},children:[V.type==="text"&&n.jsx("div",{style:{color:V.props.color,fontSize:V.props.fontSize,fontWeight:V.props.bold?700:400,textDecoration:V.props.underline?"underline":"none",width:V.props.width,height:V.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(V.props.runs)&&V.props.runs.length?V.props.runs.map((et,nt)=>n.jsx("span",{style:{color:et&&typeof et=="object"&&typeof et.color=="string"&&et.color?et.color:V.props.color||void 0,fontWeight:et&&typeof et=="object"&&typeof et.bold=="boolean"?et.bold?700:400:V.props.bold?700:400,textDecoration:et&&typeof et=="object"&&typeof et.underline=="boolean"?et.underline?"underline":"none":V.props.underline?"underline":"none"},children:(et==null?void 0:et.text)||""},nt)):V.props.text}),V.type==="image"&&n.jsx(Fo,{src:ne(V.props.url),displayWidth:V.props.width||120,displayHeight:V.props.height||120,cropData:V.props.cropData,borderRadius:8}),V.type==="student_photo"&&(s!=null&&s.avatarUrl?n.jsx("img",{src:ne(s.avatarUrl),style:{width:V.props.width||100,height:V.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:V.props.width||100,height:V.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),V.type==="gradebook_pocket"&&n.jsx(nc,{number:V.props.number||"1",width:V.props.width||120,fontSize:V.props.fontSize}),V.type==="rect"&&n.jsx("div",{style:{width:V.props.width,height:V.props.height,background:V.props.color,borderRadius:V.props.radius||8,border:V.props.stroke?`${V.props.strokeWidth||1}px solid ${V.props.stroke}`:"none"}}),V.type==="circle"&&n.jsx("div",{style:{width:(V.props.radius||60)*2,height:(V.props.radius||60)*2,background:V.props.color,borderRadius:"50%",border:V.props.stroke?`${V.props.strokeWidth||1}px solid ${V.props.stroke}`:"none"}}),V.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:V.props.spacing||12},children:(V.props.items||[]).map((et,nt)=>{const ft=de(void 0,et.levels,s==null?void 0:s.level),vt=(()=>{const Et=et.code;return A?Et==="fr":_.length===0||Et&&_.includes(Et)})(),Zt=ft&&vt,Se=ke(T,et.code),Ie=qe&&Zt&&!Se,ht=(V.props.radius||40)*2;return n.jsx("div",{style:{width:ht,height:ht,borderRadius:"50%",overflow:"hidden",position:"relative",cursor:Ie?"pointer":"not-allowed",boxShadow:et.active?"0 0 0 3px #6c5ce7":"0 0 0 1px #ddd",transition:"all 0.2s ease",opacity:Ie?1:et.active?.9:.5,pointerEvents:Ie?"auto":"none"},onClick:Et=>{if(Et.stopPropagation(),!Ie)return;const Mt=[...V.props.items||[]];Mt[nt]={...Mt[nt],active:!Mt[nt].active},G(Ne,fe,Mt)},children:et.logo?n.jsx("img",{src:ne(et.logo),style:{width:"100%",height:"100%",objectFit:"cover",filter:et.active?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},nt)})}),V.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:V.props.direction||"row",alignItems:"center",justifyContent:"center",gap:V.props.spacing||12,background:V.props.backgroundColor||"transparent",borderRadius:V.props.borderRadius||12,padding:V.props.padding||8,width:V.props.width,height:V.props.height,boxSizing:"border-box"},children:(V.props.items||[]).map((et,nt)=>{const ft=de(void 0,et.levels,s==null?void 0:s.level),vt=(()=>{const St=et.code;return A?St==="fr":_.length===0||St&&_.includes(St)})(),Zt=ft&&vt,Se=ke(T,et.code),Ie=qe&&Zt&&!Se,Re=40,ht=St=>{const ir=St.emoji;if(ir&&ir.length>=2)return ir;const $e=(St.code||"").toLowerCase();return $e==="lb"||$e==="ar"?"":$e==="fr"?"":$e==="en"||$e==="uk"||$e==="gb"?"":""},Et=ht(et),Mt=`https://emojicdn.elk.sh/${Et}?style=apple`;return n.jsx("div",{title:et.label,style:{width:Re,height:Re,minWidth:Re,borderRadius:"50%",background:et.active?"#fff":"rgba(255, 255, 255, 0.5)",border:et.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:Ie?"pointer":"not-allowed",boxShadow:et.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",transition:"all 0.2s ease",transform:et.active?"scale(1.1)":"scale(1)",opacity:Ie?et.active?1:.6:et.active?.9:.4,pointerEvents:Ie?"auto":"none",filter:"none"},onClick:St=>{if(St.stopPropagation(),!Ie)return;const ir=[...V.props.items||[]];ir[nt]={...ir[nt],active:!ir[nt].active},G(Ne,fe,ir)},onMouseEnter:St=>St.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",onMouseLeave:St=>St.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)",children:Et?n.jsx("img",{src:Mt,style:{width:Re*.9,height:Re*.9,objectFit:"contain"},alt:""}):et.logo?n.jsx("img",{src:ne(et.logo),style:{width:Re*.9,height:Re*.9,objectFit:"contain"},alt:""}):n.jsx("span",{style:{fontSize:20,lineHeight:1},children:ht(et)})},nt)})}),V.type==="line"&&n.jsx("div",{style:{width:V.props.x2||100,height:V.props.strokeWidth||2,background:V.props.stroke||"#b2bec3"}}),V.type==="arrow"&&n.jsx("div",{style:{width:V.props.x2||100,height:V.props.strokeWidth||2,background:V.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${V.props.stroke||"#6c5ce7"}`}})}),V.type==="dynamic_text"&&n.jsx("div",{style:{color:V.props.color,fontSize:V.props.fontSize,width:V.props.width,height:V.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let et=V.props.text||"";if(s){const nt=String((s==null?void 0:s.fatherName)||(s==null?void 0:s.parentName)||"").trim(),ft=nt?nt.charAt(0).toUpperCase():"",vt=ft?`${ft}.`:"",Zt=[s.firstName,vt,s.lastName].filter(Boolean).join(" "),Se=s.dateOfBirth?new Date(s.dateOfBirth):new Date(NaN),Ie=isNaN(Se.getTime())?"":`${String(Se.getUTCDate()).padStart(2,"0")}/${String(Se.getUTCMonth()+1).padStart(2,"0")}/${String(Se.getUTCFullYear())}`;et=et.replace(/{student.firstName}/g,s.firstName).replace(/{student.lastName}/g,s.lastName).replace(/{student.dob}/g,s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"").replace(/{student.fatherInitial}/g,vt).replace(/{student.fullNameFatherInitial}/g,Zt).replace(/{student.dob_ddmmyyyy}/g,Ie)}return a!=null&&a.data&&Object.entries(a.data).forEach(([nt,ft])=>{et=et.replace(new RegExp(`{${nt}}`,"g"),String(ft))}),et})()}),V.type==="student_info"&&n.jsx("div",{style:{color:V.props.color,fontSize:V.props.fontSize,width:V.props.width,height:V.props.height,overflow:"hidden"},children:s?`${s.firstName} ${s.lastName}`:"Nom, Classe, Naissance"}),V.type==="category_title"&&n.jsx("div",{style:{color:V.props.color,fontSize:V.props.fontSize,width:V.props.width,height:V.props.height,overflow:"hidden"},children:"Titre catgorie"}),V.type==="competency_list"&&n.jsx("div",{style:{color:V.props.color,fontSize:V.props.fontSize,width:V.props.width,height:V.props.height,overflow:"hidden"},children:"Liste des comptences"}),V.type==="signature"&&n.jsx("div",{style:{fontSize:V.props.fontSize,width:V.props.width,height:V.props.height,overflow:"hidden"},children:(V.props.labels||[]).join(" / ")}),V.type==="dropdown"&&(()=>{const et=Pe(V.props.levels,s==null?void 0:s.level),ft=(V.props.semesters||[1,2]).includes(T),vt=et&&ft,Zt=qe&&(A||_.length===0)&&vt;return n.jsxs("div",{style:{width:V.props.width||200,position:"relative"},children:[n.jsxs("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:["Dropdown #",V.props.dropdownNumber||"?"]}),V.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:V.props.label}),n.jsxs("div",{style:{width:"100%",minHeight:V.props.height||32,fontSize:V.props.fontSize||12,color:V.props.color||"#333",padding:"4px 24px 4px 8px",borderRadius:4,border:"1px solid #ccc",borderLeft:Zt?"4px solid #10b981":"1px solid #ccc",background:Zt?"#fff":"#f9f9f9",cursor:Zt?"pointer":"not-allowed",opacity:vt?1:.7,position:"relative",display:"flex",alignItems:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},onClick:Se=>{if(Se.stopPropagation(),!Zt)return;const Ie=`dropdown_${Ne}_${fe}`;S(v===Ie?null:Ie)},children:[(()=>{var Ie,Re;return(V.props.dropdownNumber?(Ie=a==null?void 0:a.data)==null?void 0:Ie[`dropdown_${V.props.dropdownNumber}`]:V.props.variableName?(Re=a==null?void 0:a.data)==null?void 0:Re[V.props.variableName]:"")||"Slectionner..."})(),n.jsx("div",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:""})]}),v===`dropdown_${Ne}_${fe}`&&n.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,maxHeight:300,overflowY:"auto",background:"#fff",border:"1px solid #ccc",borderRadius:4,marginTop:2,zIndex:9999,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onClick:Se=>Se.stopPropagation(),children:[n.jsx("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:V.props.fontSize||12,color:"#999",borderBottom:"1px solid #eee"},onClick:async Se=>{if(Se.stopPropagation(),a){const Ie=V.props.dropdownNumber?`dropdown_${V.props.dropdownNumber}`:V.props.variableName;if(Ie){const Re={...a.data,[Ie]:""};o({...a,data:Re});try{await K.patch(`/teacher/template-assignments/${a._id}/data`,{data:{[Ie]:""}}),ee({[Ie]:""}),y("Enregistr avec succs "),setTimeout(()=>y(""),3e3)}catch{g("Erreur sauvegarde")}}}S(null)},onMouseEnter:Se=>Se.currentTarget.style.background="#f5f5f5",onMouseLeave:Se=>Se.currentTarget.style.background="#fff",children:"Slectionner..."}),(V.props.options||[]).map((Se,Ie)=>n.jsx("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:V.props.fontSize||12,wordWrap:"break-word",whiteSpace:"pre-wrap",borderBottom:Ie<(V.props.options||[]).length-1?"1px solid #eee":"none"},onClick:async Re=>{if(Re.stopPropagation(),a){const ht=V.props.dropdownNumber?`dropdown_${V.props.dropdownNumber}`:V.props.variableName;if(ht){const Et={...a.data,[ht]:Se};o({...a,data:Et});try{await K.patch(`/teacher/template-assignments/${a._id}/data`,{data:{[ht]:Se}}),ee({[ht]:Se}),y("Enregistr avec succs "),setTimeout(()=>y(""),3e3)}catch{g("Erreur sauvegarde")}}}S(null)},onMouseEnter:Re=>Re.currentTarget.style.background="#e8ecf8",onMouseLeave:Re=>Re.currentTarget.style.background="#fff",children:Se},Ie))]})]})})(),V.type==="dropdown_reference"&&(()=>{var vt;const et=V.props.dropdownNumber||1,nt=(vt=a==null?void 0:a.data)==null?void 0:vt[`dropdown_${et}`],ft=typeof nt=="string"?nt.trim():nt;return ft?n.jsx("div",{style:{color:V.props.color||"#333",fontSize:V.props.fontSize||12,width:V.props.width||200,minHeight:V.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:String(ft)}):null})(),V.type==="table"&&(()=>{const et=R=>{const _e=typeof R=="number"?R:parseFloat(String(R||"0"));return isNaN(_e)?0:_e},nt=(V.props.columnWidths||[]).map(et),ft=(V.props.rowHeights||[]).map(et),vt=V.props.cells||[],Zt=et(V.props.colGap),Se=et(V.props.rowGap),Ie=V.props.expandedRows||!1,Re=et(V.props.expandedRowHeight||34),ht=et(V.props.expandedDividerWidth||.5),Et=V.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",Mt=4,St=6,ir=V.props.expandedLanguages||[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}],$e=V.props.expandedToggleStyle||"v2";let He=0;for(let R=0;R<nt.length;R++)He+=nt[R]||0,He+=Zt;nt.length>0&&(He-=Zt);let Ge=0;for(let R=0;R<ft.length;R++)Ge+=ft[R]||0,Ie&&(Ge+=Re+Mt),Ge+=Se;return ft.length>0&&(Ge-=Se),n.jsx("div",{style:{position:"relative",width:He,height:Ge,display:Ie?"flex":"grid",flexDirection:"column",gap:`${Se}px ${Zt}px`,gridTemplateColumns:Ie?void 0:nt.map(R=>`${Math.max(1,Math.round(R))}px`).join(" "),gridTemplateRows:Ie?void 0:ft.map(R=>`${Math.max(1,Math.round(R))}px`).join(" "),overflow:"visible",background:Se>0||Zt>0?"transparent":V.props.backgroundColor||"transparent",borderRadius:Se>0||Zt>0?0:V.props.borderRadius||0},children:Ie?vt.map((R,_e)=>{var yr;const We=V.props.borderRadius||0,jt=_e===0,Ht=_e===ft.length-1,Yt=Se>0,_t=((yr=R[0])==null?void 0:yr.fill)||V.props.backgroundColor||"#f8f9fa",mr=ft[_e]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",marginBottom:Ie&&!Ht?Se:0},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:nt.map(Kt=>`${Math.max(1,Math.round(Kt))}px`).join(" "),columnGap:Zt,height:mr},children:R.map((Kt,Sr)=>{var yt,bt,$t,xe;const Me=(yt=Kt==null?void 0:Kt.borders)==null?void 0:yt.l,rt=(bt=Kt==null?void 0:Kt.borders)==null?void 0:bt.r,wt=($t=Kt==null?void 0:Kt.borders)==null?void 0:$t.t;(xe=Kt==null?void 0:Kt.borders)==null||xe.b;const ut=Sr===0,Bt=Sr===nt.length-1,gt={background:(Kt==null?void 0:Kt.fill)||(Yt&&V.props.backgroundColor?V.props.backgroundColor:"transparent"),borderLeft:Me!=null&&Me.width?`${Me.width}px solid ${Me.color||"#000"}`:"none",borderRight:rt!=null&&rt.width?`${rt.width}px solid ${rt.color||"#000"}`:"none",borderTop:wt!=null&&wt.width?`${wt.width}px solid ${wt.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:ut&&(Yt||jt)?We:0,borderTopRightRadius:Bt&&(Yt||jt)?We:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:gt,children:(Kt==null?void 0:Kt.text)&&n.jsx("div",{style:{fontSize:Kt.fontSize||12,color:Kt.color||"#000",whiteSpace:"pre-wrap"},children:Kt.text})},`cell-${_e}-${Sr}`)})}),n.jsxs("div",{style:{background:_t,borderBottomLeftRadius:Yt||Ht?We:0,borderBottomRightRadius:Yt||Ht?We:0,height:Re,position:"relative",paddingBottom:Mt},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:ht,background:Et,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:St,gap:8},children:(()=>{var yt,bt,$t,xe,pt;const Kt=typeof((yt=V==null?void 0:V.props)==null?void 0:yt.blockId)=="string"&&V.props.blockId.trim()?V.props.blockId.trim():null,Sr=Array.isArray((bt=V==null?void 0:V.props)==null?void 0:bt.rowIds)?V.props.rowIds:[],Me=typeof(Sr==null?void 0:Sr[_e])=="string"&&Sr[_e].trim()?Sr[_e].trim():null,rt=Kt&&Me?`table_${Kt}_row_${Me}`:null,wt=`table_${Ne}_${fe}_row_${_e}`,ut=rt||wt,Bt=(($t=V.props.rowLanguages)==null?void 0:$t[_e])||ir,gt=(rt?(xe=a==null?void 0:a.data)==null?void 0:xe[rt]:null)||((pt=a==null?void 0:a.data)==null?void 0:pt[wt])||Bt;return gt.map((at,fr)=>{const Dn=de(at.level,at.levels,s==null?void 0:s.level),sn=(()=>{const _r=at.code;return A?_r==="fr":_.length===0||_r&&_.includes(_r)||_r==="lb"&&_.includes("ar")||_r==="ar"&&_.includes("ar")||(_r==="uk"||_r==="gb")&&_.includes("en")})(),gn=Dn&&sn,Or=ke(T,at.code),kr=qe&&gn&&!Or,Ye=Math.max(12,Math.min(Re-12,20)),qt=at.active;if($e==="v1"){const _r=at.logo||(()=>{const jr=(at.code||"").toLowerCase();return jr==="en"||jr==="uk"||jr==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":jr==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":jr==="ar"||jr==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:Ye,height:Ye,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:qt?"0 0 0 2px #6c5ce7":"none",opacity:kr?qt?1:.6:qt?.9:.5,cursor:kr?"pointer":"default",zIndex:100},onMouseDown:async jr=>{if(jr.stopPropagation(),jr.preventDefault(),!kr)return;const Jt=[...gt];if(Jt[fr]={...Jt[fr],active:!Jt[fr].active},a){const Mn={...a.data,[ut]:Jt};o({...a,data:Mn});try{await K.patch(`/teacher/template-assignments/${a._id}/data`,{data:{[ut]:Jt}}),ee({[ut]:Jt})}catch{g("Erreur sauvegarde")}}},children:_r?n.jsx("img",{src:_r,style:{width:"100%",height:"100%",objectFit:"cover",filter:qt?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},fr)}const mi=`https://emojicdn.elk.sh/${(_r=>{const jr=_r.emoji;if(jr&&jr.length>=2)return jr;const Jt=(_r.code||"").toLowerCase();return Jt==="lb"||Jt==="ar"?"":Jt==="fr"?"":Jt==="en"||Jt==="uk"||Jt==="gb"?"":""})(at)}?style=apple`;return n.jsx("div",{title:gn?at.label:`${at.label}${at!=null&&at.level&&(s!=null&&s.level)?` (niveau ${at.level}  ${s.level})`:""}`,style:{width:Ye,height:Ye,minWidth:Ye,borderRadius:"50%",background:qt?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:qt?"scale(1.1)":"scale(1)",boxShadow:"none",opacity:kr?qt?1:.6:qt?.9:.5,cursor:kr?"pointer":"default",zIndex:100},onMouseDown:async _r=>{if(_r.stopPropagation(),_r.preventDefault(),!kr)return;const jr=[...gt];if(jr[fr]={...jr[fr],active:!jr[fr].active},a){const Jt={...a.data,[ut]:jr};o({...a,data:Jt});try{await K.patch(`/teacher/template-assignments/${a._id}/data`,{data:{[ut]:jr}}),ee({[ut]:jr})}catch{g("Erreur sauvegarde")}}},children:n.jsx("img",{src:mi,style:{width:Ye*.9,height:Ye*.9,objectFit:"contain"},alt:""})},fr)})})()})]})]},`row-unit-${_e}`)}):vt.flatMap((R,_e)=>R.map((We,jt)=>{var Bt,gt,yt,bt;const Ht=(Bt=We==null?void 0:We.borders)==null?void 0:Bt.l,Yt=(gt=We==null?void 0:We.borders)==null?void 0:gt.r,_t=(yt=We==null?void 0:We.borders)==null?void 0:yt.t,mr=(bt=We==null?void 0:We.borders)==null?void 0:bt.b,yr=V.props.borderRadius||0,Kt=jt===0,Sr=jt===nt.length-1,Me=_e===0,rt=_e===ft.length-1,wt=Se>0,ut={background:(We==null?void 0:We.fill)||(wt&&V.props.backgroundColor?V.props.backgroundColor:"transparent"),borderLeft:Ht!=null&&Ht.width?`${Ht.width}px solid ${Ht.color||"#000"}`:"none",borderRight:Yt!=null&&Yt.width?`${Yt.width}px solid ${Yt.color||"#000"}`:"none",borderTop:_t!=null&&_t.width?`${_t.width}px solid ${_t.color||"#000"}`:"none",borderBottom:mr!=null&&mr.width?`${mr.width}px solid ${mr.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Kt&&(wt||Me)?yr:0,borderBottomLeftRadius:Kt&&(wt||rt)?yr:0,borderTopRightRadius:Sr&&(wt||Me)?yr:0,borderBottomRightRadius:Sr&&(wt||rt)?yr:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:ut,children:(We==null?void 0:We.text)&&n.jsx("div",{style:{fontSize:We.fontSize||12,color:We.color||"#000",whiteSpace:"pre-wrap"},children:We.text})},`${_e}-${jt}`)}))})})(),V.type==="qr"&&n.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=${V.props.width||120}x${V.props.height||120}&data=${encodeURIComponent(V.props.url||"")}`,style:{width:V.props.width||120,height:V.props.height||120},alt:"QR Code"}),V.type==="promotion_info"&&n.jsx("div",{style:{width:V.props.width||(V.props.field?150:300),height:V.props.height||(V.props.field?30:100),border:V.props.field?"none":"1px solid #6c5ce7",padding:V.props.field?0:10,borderRadius:8,fontSize:V.props.fontSize||12,color:V.props.color||"#2d3436",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:(()=>{var Zt;if(V.props.level&&(s!=null&&s.level)&&V.props.level!==s.level||V.props.targetLevel&&(s!=null&&s.level)&&Ze(s.level)!==V.props.targetLevel)return null;const et=((Zt=a==null?void 0:a.data)==null?void 0:Zt.promotions)||[],nt=ge(V),ft=V.props.targetLevel;if(V.props.field==="student")return n.jsxs("div",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]});if(V.props.field==="studentFirstName")return n.jsx("div",{children:s==null?void 0:s.firstName});if(V.props.field==="studentLastName")return n.jsx("div",{children:s==null?void 0:s.lastName});if(V.props.field==="currentLevel")return n.jsx("div",{children:s==null?void 0:s.level});let vt=null;if(ft&&(vt=et.find(Se=>Se.to===ft)),!vt&&nt&&(vt=et.find(Se=>Se.from===nt)),!vt&&!ft&&!nt&&et.length===1&&(vt={...et[0]}),vt)!vt.class&&(s!=null&&s.className)&&(vt.class=s.className),vt.from||(nt?vt.from=nt:s!=null&&s.level&&(vt.from=s.level));else{let Se;if(le&&le.name){const Et=le.name.match(/(\d{4})/);Et&&(Se=parseInt(Et[1],10))}if(!Se){const Et=new Date().getFullYear();Se=new Date().getMonth()>=8?Et:Et-1}const Ie=`${Se}/${Se+1}`,Re=nt||(s==null?void 0:s.level)||"",ht=ft||Ze(Re)||"?";vt={year:Ie,from:Re,to:ht,class:(s==null?void 0:s.className)||""}}if(vt){const Se=Le(vt,nt);if(V.props.field){if(V.props.field==="level")return n.jsx("div",{style:{fontWeight:"bold"},children:vt.to});if(V.props.field==="student")return n.jsxs("div",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]});if(V.props.field==="studentFirstName")return n.jsx("div",{children:s==null?void 0:s.firstName});if(V.props.field==="studentLastName")return n.jsx("div",{children:s==null?void 0:s.lastName});if(V.props.field==="year")return n.jsx("div",{children:Se});if(V.props.field==="currentYear"){const Ie=(le==null?void 0:le.name)||vt.year||"";return n.jsx("div",{children:String(Ie)})}else if(V.props.field==="class"){const Ie=vt.class||"",Re=Ie.split(/\s*[-\s]\s*/),ht=Re.length?Re[Re.length-1]:Ie;return n.jsx("div",{children:ht})}else if(V.props.field==="currentLevel")return n.jsx("div",{children:vt.from||""})}else return n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",vt.to]}),n.jsxs("div",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),n.jsxs("div",{style:{fontSize:(V.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Anne ",Se]})]})}return null})()}),V.type==="teacher_text"&&n.jsxs("div",{style:{width:V.props.width||300,height:V.props.height||60,border:"1px solid #ddd",borderRadius:4,padding:8,fontSize:V.props.fontSize||12,color:V.props.color||"#2d3436",background:qe&&A?"#fff":"#f9f9f9",cursor:qe&&A?"text":"not-allowed",position:"relative"},children:[(()=>{var vt,Zt;if(V.props.level&&(s!=null&&s.level)&&V.props.level!==s.level)return null;const nt=(typeof((vt=V==null?void 0:V.props)==null?void 0:vt.blockId)=="string"&&V.props.blockId.trim()?V.props.blockId.trim():null)||`teacher_text_${Ne}_${fe}`,ft=((Zt=a==null?void 0:a.data)==null?void 0:Zt[nt])||"";return qe&&A?n.jsx("textarea",{value:ft,placeholder:V.props.placeholder||"Tapez votre texte ici...",onChange:async Se=>{const Ie=Se.target.value;if(a){const Re={...a.data,[nt]:Ie};o({...a,data:Re});try{await K.patch(`/teacher/template-assignments/${a._id}/data`,{data:{[nt]:Ie}}),ee({[nt]:Ie}),y("Enregistr avec succs "),setTimeout(()=>y(""),2e3)}catch(ht){console.error("Failed to save teacher text:",ht),y("Erreur de sauvegarde "),setTimeout(()=>y(""),3e3)}}},style:{width:"100%",height:"100%",border:"none",outline:"none",resize:"none",background:"transparent",fontSize:"inherit",color:"inherit",fontFamily:"inherit"}}):n.jsx("div",{style:{width:"100%",height:"100%",whiteSpace:"pre-wrap",color:ft?"inherit":"#999"},children:ft||V.props.placeholder||"Texte ditable par le prof polyvalent..."})})(),V.props.label&&n.jsx("div",{style:{position:"absolute",top:-10,left:8,background:"#fff",padding:"2px 6px",fontSize:10,color:"#e17055",fontWeight:"bold"},children:V.props.label})]}),V.type==="final_signature_box"&&n.jsx("div",{style:{width:V.props.width||200,height:V.props.height||80,border:"none",background:"#fff",display:"none",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(a==null?void 0:a.status)==="signed"?" Sign Fin Anne":V.props.label||"Signature Fin Anne"}),V.type==="final_signature_info"&&n.jsx("div",{style:{width:V.props.width||150,height:V.props.height||30,fontSize:V.props.fontSize||12,color:V.props.color||"#333",display:"flex",alignItems:"center",justifyContent:V.props.align||"flex-start"},children:(a==null?void 0:a.status)==="signed"?n.jsxs(n.Fragment,{children:[V.props.field==="year"&&n.jsx("span",{children:(()=>{var ft;const nt=(((ft=a==null?void 0:a.data)==null?void 0:ft.signatures)||[]).find(vt=>vt.type==="end_of_year");return nt&&nt.schoolYearName?nt.schoolYearName:le&&le.name?le.name:new Date().getFullYear()})()}),V.props.field==="student"&&n.jsxs("span",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),V.props.field==="studentFirstName"&&n.jsx("span",{children:s==null?void 0:s.firstName}),V.props.field==="studentLastName"&&n.jsx("span",{children:s==null?void 0:s.lastName}),V.props.field==="nextLevel"&&n.jsx("span",{children:Ze((s==null?void 0:s.level)||"")})]}):n.jsx("span",{style:{color:"#ccc"},children:V.props.placeholder||"..."})}),V.type==="signature_box"&&n.jsx("div",{style:{width:V.props.width||200,height:V.props.height||80,border:"none",background:"#fff",display:"none",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(a==null?void 0:a.status)==="signed"?" Sign":V.props.label||"Signature"})]},fe)})]})},Ne)})})]})]}):n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Carnet introuvable"})})})}function zne(){const{assignmentId:e}=oa(),[t,r]=p.useState(null),[s,i]=p.useState(null),[a,o]=p.useState([]),[l,c]=p.useState([]),[u,d]=p.useState(!0),[f,h]=p.useState(""),[m,g]=p.useState(null),[x,y]=p.useState(new Set),[v,S]=p.useState(!1),[k,j]=p.useState([]),[_,b]=p.useState(!1),[A,z]=p.useState([]),[D,w]=p.useState({}),[N,$]=p.useState(!1),[E,q]=p.useState(!1),[L,O]=p.useState(1),[B,I]=p.useState(""),{activeYear:T}=Yn(),W=Od(),{levels:re}=la(),Y=v&&!(L===1?N:E),J=p.useCallback((ee,te,G)=>{if(!G)return!0;const H={};re.forEach(me=>{H[me.name.toUpperCase()]=me.order});const ie=H[G.toUpperCase()];if(ie===void 0)return!0;if(ee){const me=H[ee.toUpperCase()];return me===void 0?!0:me<=ie}return te&&te.length>0?te.some(me=>{const ke=H[me.toUpperCase()];return ke===void 0?!0:ke<=ie}):!0},[re]),P=p.useCallback((ee,te,G)=>{const H=[],ie=[];return ee!=null&&ee.pages?(ee.pages.forEach((me,ke)=>{if(!(me!=null&&me.blocks))return;const Be=(Te,qe,Qe)=>{const ge=(me.blocks||[]).slice(0,Math.max(0,Te)).filter(be=>(be==null?void 0:be.type)==="text"&&(be==null?void 0:be.props)&&typeof be.props.text=="string").map(be=>({text:(be.props.text||"").trim(),x:typeof be.props.x=="number"?be.props.x:Number(be.props.x??0),y:typeof be.props.y=="number"?be.props.y:Number(be.props.y??0),fontSize:typeof be.props.fontSize=="number"?be.props.fontSize:Number(be.props.fontSize??0)})).filter(be=>{if(!be.text)return!1;const we=be.text.toLowerCase();return!(we==="titre"||we==="title"||!(be.y<=qe)||typeof Qe=="number"&&Number.isFinite(Qe)&&Number.isFinite(be.x)&&Math.abs(be.x-Qe)>600)}),Ae=ge.filter(be=>be.fontSize>=14&&qe-be.y<=700),Le=Ae.length>0?Ae:ge;if(Le.length===0)return"";const Q=Le.reduce((be,we)=>we.y>be.y?we:be,Le[0]);return(Q==null?void 0:Q.text)||""};me.blocks.forEach((Te,qe)=>{var Qe,Ze;if(Te!=null&&Te.props){if(["language_toggle","language_toggle_v2"].includes(Te.type)){const ge=Te.props.blockId||`${ke}_${qe}`,Ae=Te.props.level;if(Ae&&G&&Ae!==G)return;const Le=Te.props.blockId?`language_toggle_${Te.props.blockId}`:`language_toggle_${ke}_${qe}`,Q=te==null?void 0:te[Le],we=(Te.props.items||[]).map((V,fe)=>{var Oe;return{...V,active:((Oe=Q==null?void 0:Q[fe])==null?void 0:Oe.active)??V.active??!1,sourceIndex:fe}}),Ne=we.filter(V=>J(void 0,V.levels,G));if(Ne.length>0){const V=typeof Te.props.y=="number"?Te.props.y:Number(Te.props.y??0),fe=typeof Te.props.x=="number"?Te.props.x:Number(Te.props.x??0),Oe=Be(qe,V,fe),Fe=Te.props.label||`Texte ${H.length+1}`;H.push({blockId:ge,pageIndex:ke,blockIndex:qe,title:Oe||void 0,label:Fe,level:Ae,items:Ne,sourceItems:we})}}if(Te.type==="table"&&Te.props.expandedRows){const ge=Te.props.cells||[],Ae=Te.props.expandedLanguages||[],Le=Te.props.rowLanguages||{},Q=Array.isArray(Te.props.rowIds)?Te.props.rowIds:[],be=typeof Te.props.blockId=="string"&&Te.props.blockId.trim()?Te.props.blockId.trim():null,we=Te.props.level,Ne=typeof Te.props.y=="number"?Te.props.y:Number(Te.props.y??0),V=typeof Te.props.x=="number"?Te.props.x:Number(Te.props.x??0);let fe="";const Oe=Te.props.titleBlockId;if(Oe){const Fe=me.blocks.find(Ve=>{var tt;return((tt=Ve==null?void 0:Ve.props)==null?void 0:tt.blockId)===Oe});Fe&&Fe.type==="gradebook_pocket"&&(fe=((Qe=Fe.props)==null?void 0:Qe.number)||"")}if(!fe&&Te.props.expandedTitleText&&(fe=Te.props.expandedTitleText),fe||(fe=Be(qe,Ne,V)),we&&G&&we!==G)return;ge.forEach((Fe,Ve)=>{const tt=Fe[0],Wt=(tt==null?void 0:tt.text)||(tt==null?void 0:tt.value)||`Ligne ${Ve+1}`,Ct=Le[Ve]||Ae;if(!Array.isArray(Ct)||Ct.length===0)return;const Ot=typeof Q[Ve]=="string"&&Q[Ve].trim()?Q[Ve].trim():null,et=be&&Ot?`table_${be}_row_${Ot}`:null,nt=`table_${ke}_${qe}_row_${Ve}`,ft=et||nt,vt=et&&(te==null?void 0:te[et])||(te==null?void 0:te[nt]),Zt=Ct.map((Ie,Re)=>{var ht;return{...Ie,active:((ht=vt==null?void 0:vt[Re])==null?void 0:ht.active)??Ie.active??!1,sourceIndex:Re}}),Se=Zt.filter(Ie=>{const Re=Ie.level,ht=Ie.levels;return J(Re,ht,G)});Se.length>0&&H.push({blockId:ft,pageIndex:ke,blockIndex:qe,rowIndex:Ve,title:fe||void 0,label:Wt,level:we,items:Se,sourceItems:Zt,isTableRow:!0,tableBlockId:be,rowId:Ot})})}if(Te.type==="dropdown"){const ge=Te.props.semesters||[1,2],Ae=Te.props.levels||[];if(Ae.length>0&&G){const Ne=G.toUpperCase(),V=Ae.map(Oe=>Oe.toUpperCase());if(!(V.length===1&&V[0]===Ne))return}const Le=typeof((Ze=Te==null?void 0:Te.props)==null?void 0:Ze.blockId)=="string"&&Te.props.blockId.trim()?Te.props.blockId.trim():null,Q=Le?`dropdown_${Le}`:null,be=Te.props.dropdownNumber?`dropdown_${Te.props.dropdownNumber}`:Te.props.variableName||`dropdown_${ke}_${qe}`,we=Q||be;ie.push({blockId:`dropdown_${ke}_${qe}`,pageIndex:ke,blockIndex:qe,label:Te.props.label||`Dropdown ${Te.props.dropdownNumber||""}`,options:Te.props.options||[],dataKey:we,semesters:ge,levels:Ae,currentValue:(Q?te==null?void 0:te[Q]:void 0)??(te==null?void 0:te[be])??""})}}})}),{rows:H,drops:ie}):{rows:H,drops:ie}},[]);p.useEffect(()=>{e&&(async()=>{var te,G;try{d(!0);const H=await K.get(`/teacher/template-assignments/${e}`);r(H.data.student),i(H.data.assignment),S(H.data.canEdit),j(H.data.allowedLanguages||[]),b(H.data.isProfPolyvalent||!1),z(H.data.completionLanguages||[]),w(H.data.languageCompletion||ve(H.data.assignment)),$(H.data.isMyWorkCompletedSem1||!1),q(H.data.isMyWorkCompletedSem2||!1),O(H.data.activeSemester||1);const{rows:ie,drops:me}=P(H.data.template,(te=H.data.assignment)==null?void 0:te.data,((G=H.data.student)==null?void 0:G.level)||"");o(ie),c(me)}catch(H){h("Impossible de charger le carnet"),console.error(H)}finally{d(!1)}})()},[e,P]),p.useEffect(()=>{if(e&&W){const ee=`assignment:${e}`;W.emit("join-room",ee);const te=G=>{if(G.type==="language-toggle"&&o(H=>H.map(ie=>!ie.isTableRow&&ie.pageIndex===G.pageIndex&&ie.blockIndex===G.blockIndex?{...ie,items:G.items}:ie)),G.type==="assignment-data"){if(G.assignmentId&&G.assignmentId!==(s==null?void 0:s._id))return;i(H=>H&&{...H,data:{...H.data||{},...G.data}}),o(H=>H.map(ie=>{var me;return ie.isTableRow&&((me=G.data)!=null&&me[ie.blockId])?{...ie,items:G.data[ie.blockId]}:ie})),c(H=>H.map(ie=>{var me;return((me=G.data)==null?void 0:me[ie.dataKey])!==void 0?{...ie,currentValue:G.data[ie.dataKey]}:ie}))}if(G.type==="completion-update"){if(G.assignmentId&&G.assignmentId!==(s==null?void 0:s._id))return;if(G.assignmentPatch&&i(H=>H&&{...H,...G.assignmentPatch}),G.languageCompletions){const H=ve({languageCompletions:G.languageCompletions});w(H),A.length===0&&Array.isArray(G.languages)&&G.languages.length>0&&z(G.languages.map(se).filter(Boolean));const ie=oe(1,H,G.languages),me=oe(2,H,G.languages);$(ie),q(me)}}};return W.on("update-received",te),()=>{W.emit("leave-room",ee),W.off("update-received",te)}}},[e,W,s==null?void 0:s._id]);const ce=p.useCallback(ee=>{const te=(ee||"").toLowerCase();return _?te==="fr":!!(k.length===0||k.includes(te)||(te==="lb"||te==="ar")&&k.includes("ar")||(te==="uk"||te==="gb")&&k.includes("en"))},[_,k]),pe=async(ee,te)=>{var ie,me,ke,Be;if(!Y)return;const G=ee.items[te];if(!ce(G.code)||le(L,G.code))return;const H=`${ee.blockId}_${te}`;y(Te=>new Set(Te).add(H));try{const Te=ee.items.map((Ae,Le)=>Le===te?{...Ae,active:!Ae.active}:Ae),qe=ee.sourceItems||ee.items,Qe=ee.items[te],Ze=Qe.sourceIndex,ge=qe.map((Ae,Le)=>Ze!==void 0&&Le===Ze?{...Ae,active:!Ae.active}:Ze===void 0&&Ae.code===Qe.code?{...Ae,active:!Ae.active}:Ae);if(o(Ae=>Ae.map(Le=>Le.blockId===ee.blockId?{...Le,items:Te,sourceItems:ge}:Le)),ee.isTableRow){const Ae=ee.blockId;await K.patch(`/teacher/template-assignments/${e}/data`,{data:{[Ae]:ge}}),W&&W.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"assignment-data",assignmentId:e,data:{[Ae]:ge}}})}else{const Ae={pageIndex:ee.pageIndex,blockIndex:ee.blockIndex,blockId:ee.blockId,items:ge};s!=null&&s.dataVersion&&(Ae.expectedDataVersion=s.dataVersion);const Le=await K.patch(`/teacher/template-assignments/${e}/language-toggle`,Ae);(ie=Le.data)!=null&&ie.dataVersion&&i(Q=>Q&&{...Q,dataVersion:Le.data.dataVersion}),W&&W.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"language-toggle",pageIndex:ee.pageIndex,blockIndex:ee.blockIndex,items:ge,changeId:(me=Le.data)==null?void 0:me.changeId,dataVersion:(ke=Le.data)==null?void 0:ke.dataVersion}})}}catch(Te){o(qe=>qe.map(Qe=>Qe.blockId===ee.blockId?{...Qe,items:ee.items,sourceItems:ee.sourceItems}:Qe)),((Be=Te==null?void 0:Te.response)==null?void 0:Be.status)===409?g({message:"Conflit dtect. Rechargez la page.",type:"error"}):g({message:"Erreur lors de la sauvegarde",type:"error"})}finally{y(Te=>{const qe=new Set(Te);return qe.delete(H),qe})}},ye=async(ee,te)=>{if(!(!Y||!_&&k.length>0))try{const G={[ee.dataKey]:te};c(H=>H.map(ie=>ie.blockId===ee.blockId?{...ie,currentValue:te}:ie)),await K.patch(`/teacher/template-assignments/${e}/data`,{data:G}),W&&W.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"assignment-data",assignmentId:e,data:G}}),g({message:"Enregistr",type:"success"})}catch{g({message:"Erreur lors de la sauvegarde",type:"error"})}},se=ee=>{const te=(ee||"").toLowerCase();return te?te==="lb"||te==="ar"?"ar":te==="en"||te==="uk"||te==="gb"?"en":te==="fr"?"fr":te:""},je=ee=>{const te=se(ee);return te==="ar"?"Arabe":te==="en"?"Anglais":te==="fr"?"Polyvalent":ee||"Langue"},ve=ee=>{const te={};return((ee==null?void 0:ee.languageCompletions)||[]).forEach(H=>{const ie=se(H.code);ie&&(te[ie]={completed:H.completed,completedSem1:H.completedSem1,completedSem2:H.completedSem2})}),te},le=(ee,te)=>{const G=D[se(te)];return G?ee===1?!!(G.completedSem1||G.completed):!!G.completedSem2:!1},oe=(ee,te,G)=>{const H=te||D,ie=G&&G.length>0?G:A;return ie.length===0?!1:ie.every(me=>{const ke=H[se(me)];return ke?ee===1?!!(ke.completedSem1||ke.completed):!!ke.completedSem2:!1})},de=async(ee,te)=>{var G,H,ie,me,ke,Be,Te,qe,Qe,Ze;if(s)try{const ge=te&&te.length>0?te:A,Ae=ge.length>0?ge.every(V=>le(ee,V)):ee===1?N:E,Le=Ae?"unmark-done":"mark-done",Q=await K.post(`/teacher/templates/${e}/${Le}`,{semester:ee,languages:ge});i(Q.data);const be=ve(Q.data);w(be),A.length===0&&ge.length>0&&z(ge.map(se).filter(Boolean));const we=oe(1,be,ge),Ne=oe(2,be,ge);ee===1?$(we):q(Ne),W&&W.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"completion-update",assignmentId:e,assignmentPatch:{languageCompletions:(G=Q.data)==null?void 0:G.languageCompletions,teacherCompletions:(H=Q.data)==null?void 0:H.teacherCompletions,isCompletedSem1:(ie=Q.data)==null?void 0:ie.isCompletedSem1,isCompletedSem2:(me=Q.data)==null?void 0:me.isCompletedSem2,isCompleted:(ke=Q.data)==null?void 0:ke.isCompleted,completedAtSem1:(Be=Q.data)==null?void 0:Be.completedAtSem1,completedAtSem2:(Te=Q.data)==null?void 0:Te.completedAtSem2,completedAt:(qe=Q.data)==null?void 0:qe.completedAt,status:(Qe=Q.data)==null?void 0:Qe.status},languageCompletions:(Ze=Q.data)==null?void 0:Ze.languageCompletions,languages:ge}}),g({message:Ae?"Semestre rouvert":"Semestre marqu comme termin",type:"success"})}catch{g({message:"Erreur lors de la mise  jour",type:"error"})}},Pe=ee=>{if(ee.emoji&&ee.emoji.length>=2)return ee.emoji;const te=(ee.code||"").toLowerCase();return te==="lb"||te==="ar"?"":te==="fr"?"":te==="en"||te==="uk"||te==="gb"?"":""},Z=p.useMemo(()=>{let ee=a;if(B.trim()){const te=B.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");ee=ee.filter(G=>G.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(te))}return ee=[...ee].sort((te,G)=>{const H=(te.title||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),ie=(G.title||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return!H&&ie?1:H&&!ie?-1:H.localeCompare(ie,"fr",{numeric:!0,sensitivity:"base"})}),ee},[a,B]),ne=p.useMemo(()=>{const ee=(t==null?void 0:t.level)||"",te=ee.toUpperCase();return l.filter(G=>{if(!G.semesters.includes(L))return!1;if(G.levels&&G.levels.length>0&&ee){const H=G.levels.map(ie=>ie.toUpperCase());return H.length===1&&H[0]===te}return!0})},[l,L,t==null?void 0:t.level]);return u?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",style:{textAlign:"center",padding:40},children:"Chargement..."})})}):f&&!t?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",style:{color:"crimson",textAlign:"center",padding:40},children:f})})}):n.jsxs("div",{style:{padding:24,maxWidth:1200,margin:"0 auto"},children:[n.jsx(jd,{}),m&&n.jsx(ca,{message:m.message,type:m.type,onClose:()=>g(null)}),n.jsxs("div",{className:"card",style:{marginBottom:24},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:24,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>window.history.back(),style:{display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0",padding:"10px 16px",borderRadius:8},children:" Retour"}),n.jsx(rr,{to:`/teacher/templates/${e}/edit`,className:"btn secondary",style:{display:"inline-flex",alignItems:"center",gap:8,background:"#e0e7ff",color:"#4338ca",fontWeight:500,border:"1px solid #c7d2fe",padding:"10px 16px",borderRadius:8,textDecoration:"none"},children:" Vue complte"}),n.jsx("div",{style:{flex:1}}),v&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[1,2].map(ee=>{const G=!(L===ee),H=A.length>0?A.every(ie=>le(ee,ie)):ee===1?N:E;return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"6px 10px",background:G?"transparent":"#f0f9ff",borderRadius:8,border:G?"1px solid transparent":"1px solid #bae6fd"},children:[n.jsxs("div",{style:{fontWeight:800,fontSize:13,color:G?"#94a3b8":"#0369a1",minWidth:30},children:["S",ee]}),!G&&n.jsx("div",{style:{height:20,width:1,background:"#cbd5e1"}}),A.length>1&&n.jsx("button",{className:"btn",onClick:()=>de(ee,A),disabled:G,style:{padding:"4px 10px",fontSize:12,borderRadius:6,border:"1px solid #e2e8f0",background:G?"#f1f5f9":H?"#dcfce7":"#fff",color:G?"#94a3b8":H?"#166534":"#475569",cursor:G?"not-allowed":"pointer",fontWeight:600,boxShadow:G?"none":"0 1px 2px rgba(0,0,0,0.05)",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},title:G?`Semestre ${ee} inactif`:H?"Tout rouvrir":"Tout terminer",children:H?" Tout Termin":" Tout Valider"}),A.length===0&&n.jsx("button",{className:"btn",onClick:()=>de(ee),disabled:G,style:{padding:"5px 12px",fontSize:13,borderRadius:6,border:"1px solid #e2e8f0",background:G?"#f1f5f9":H?"#dcfce7":"#fff",color:G?"#94a3b8":H?"#166534":"#0f172a",cursor:G?"not-allowed":"pointer",fontWeight:600,boxShadow:G?"none":"0 1px 2px rgba(0,0,0,0.05)",transition:"all 0.2s"},children:H?` S${ee} Termin`:`Valider S${ee}`}),A.length>0&&A.map(ie=>{const me=le(ee,ie);return n.jsxs("button",{onClick:()=>de(ee,[ie]),disabled:G,className:"btn",style:{padding:"4px 10px",fontSize:12,borderRadius:100,border:`1px solid ${me?"#22c55e":"#cbd5e1"}`,background:G?"#f1f5f9":me?"#22c55e":"#fff",color:G?"#94a3b8":me?"#fff":"#475569",cursor:G?"not-allowed":"pointer",fontWeight:600,transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},children:[me&&n.jsx("span",{children:""}),je(ie)]},ie)})]},ee)})})]}),n.jsxs("div",{style:{marginBottom:24},children:[n.jsxs("h2",{style:{fontSize:24,margin:0,color:"#1e293b",display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[n.jsx("span",{children:" Notation rapide"}),n.jsxs("span",{style:{color:"#6c5ce7"},children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),(t==null?void 0:t.level)&&n.jsx("span",{style:{fontSize:14,background:"#e0e7ff",color:"#4338ca",padding:"4px 12px",borderRadius:16,fontWeight:600},children:t.level}),(t==null?void 0:t.className)&&n.jsx("span",{style:{fontSize:14,background:"#f1f5f9",color:"#475569",padding:"4px 12px",borderRadius:16,fontWeight:600},children:t.className}),n.jsxs("span",{style:{fontSize:14,background:L===2?"#dbeafe":"#fef3c7",color:L===2?"#1e40af":"#92400e",padding:"4px 12px",borderRadius:16,fontWeight:700,border:`1px solid ${L===2?"#93c5fd":"#fcd34d"}`},children:["S",L]})]}),n.jsxs("p",{style:{color:"#64748b",marginTop:8,fontSize:14},children:["Cliquez sur les drapeaux pour activer/dsactiver les langues pour chaque texte.",_&&" (Prof polyvalent: Franais uniquement)"]})]}),n.jsx("div",{style:{marginBottom:24},children:n.jsx("input",{type:"text",placeholder:" Rechercher un texte...",value:B,onChange:ee=>I(ee.target.value),style:{width:"100%",maxWidth:400,padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,outline:"none"}})}),(_||k.length===0)&&ne.length>0&&n.jsxs("div",{style:{marginBottom:24,padding:16,background:"#fef3c7",borderRadius:12,border:"1px solid #fcd34d"},children:[n.jsx("h3",{style:{fontSize:16,color:"#92400e",marginBottom:12,fontWeight:600},children:" Champs supplmentaires (Prof Polyvalent)"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:12},children:ne.map(ee=>n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:13,color:"#78350f",fontWeight:500,marginBottom:4,display:"block"},children:ee.label}),n.jsxs("select",{value:ee.currentValue,onChange:te=>ye(ee,te.target.value),disabled:!Y,style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #fcd34d",fontSize:14,background:"white",cursor:Y?"pointer":"not-allowed",opacity:Y?1:.6},children:[n.jsx("option",{value:"",children:"Slectionner..."}),ee.options.map((te,G)=>n.jsx("option",{value:te,children:te},G))]})]},ee.blockId))})]}),n.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,overflow:"hidden"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f8fafc"},children:[n.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:14,fontWeight:600,color:"#475569",borderBottom:"2px solid #e2e8f0",minWidth:80,maxWidth:160},children:"Titre"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:14,fontWeight:600,color:"#475569",borderBottom:"2px solid #e2e8f0"},children:"Texte"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:14,fontWeight:600,color:"#475569",borderBottom:"2px solid #e2e8f0",width:200},children:"Langues"})]})}),n.jsx("tbody",{children:Z.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:3,style:{padding:40,textAlign:"center",color:"#94a3b8",fontSize:14},children:B.trim()?"Aucun texte ne correspond  la recherche.":"Aucun texte trouv pour ce niveau."})}):Z.map((ee,te)=>n.jsxs("tr",{style:{background:te%2===0?"#fff":"#f8fafc",transition:"background 0.2s"},onMouseEnter:G=>G.currentTarget.style.background="#f0f4ff",onMouseLeave:G=>G.currentTarget.style.background=te%2===0?"#fff":"#f8fafc",children:[n.jsx("td",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",textAlign:"center",verticalAlign:"middle"},children:ee.title&&n.jsx("span",{title:ee.title,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",minWidth:32,height:32,padding:ee.title.length>2?"4px 12px":"4px 8px",borderRadius:ee.title.length>2?16:"50%",background:"linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%)",color:"#fff",fontWeight:700,fontSize:ee.title.length>3?12:14,boxShadow:"0 2px 6px rgba(108, 92, 231, 0.3)",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"default"},children:ee.title})}),n.jsx("td",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:14,color:"#1e293b"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{fontWeight:500},children:ee.label}),ee.level&&n.jsx("span",{style:{fontSize:11,background:"#e0e7ff",color:"#4338ca",padding:"2px 6px",borderRadius:4,fontWeight:600},children:ee.level})]})}),n.jsx("td",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",textAlign:"center"},children:n.jsx("div",{style:{display:"flex",justifyContent:"center",gap:8},children:ee.items.map((G,H)=>{const ie=ce(G.code),me=x.has(`${ee.blockId}_${H}`),ke=le(L,G.code),Be=Y&&ie&&!ke&&!me,qe=`https://emojicdn.elk.sh/${Pe(G)}?style=apple`;return n.jsxs("button",{onClick:()=>pe(ee,H),disabled:!Be,title:`${G.label||G.code}${ie?"":" (non autoris)"}`,style:{width:44,height:44,borderRadius:"50%",border:G.active?"3px solid #6c5ce7":"2px solid #e2e8f0",background:G.active?"#f0f4ff":"#fff",cursor:Be?"pointer":"not-allowed",opacity:ie?ke?.6:1:.4,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",transform:G.active?"scale(1.1)":"scale(1)",boxShadow:G.active?"0 2px 8px rgba(108, 92, 231, 0.3)":"none",position:"relative"},children:[me?n.jsx("span",{style:{fontSize:16},children:""}):n.jsx("img",{src:qe,alt:G.label||G.code,style:{width:28,height:28,objectFit:"contain",filter:G.active?"none":"grayscale(50%)"}}),G.active&&n.jsx("span",{style:{position:"absolute",bottom:-2,right:-2,background:"#10b981",color:"white",borderRadius:"50%",width:16,height:16,fontSize:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"},children:""})]},H)})})})]},ee.blockId))})]})}),n.jsxs("div",{style:{marginTop:24,padding:16,background:"#f8fafc",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("h4",{style:{fontSize:13,color:"#64748b",marginBottom:8,fontWeight:600},children:"Lgende des langues"}),n.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"#475569"},children:[n.jsx("img",{src:"https://emojicdn.elk.sh/?style=apple",alt:"FR",style:{width:20,height:20}}),"Franais (Polyvalent)"]}),n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"#475569"},children:[n.jsx("img",{src:"https://emojicdn.elk.sh/?style=apple",alt:"AR",style:{width:20,height:20}}),"Arabe"]}),n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"#475569"},children:[n.jsx("img",{src:"https://emojicdn.elk.sh/?style=apple",alt:"EN",style:{width:20,height:20}}),"Anglais"]})]})]})]})]})}function u_(){const t=wn().pathname.includes("/aefe"),r=t?"/aefe":"/subadmin",s=t?"/aefe":"/subadmin",{activeYear:i,isLoading:a}=Yn(),[o,l]=p.useState([]),[c,u]=p.useState([]),[d,f]=p.useState([]),[h,m]=p.useState([]),[g,x]=p.useState("all"),[y,v]=p.useState(!0),[S,k]=p.useState(""),[j,_]=p.useState({}),[b,A]=p.useState({}),[z,D]=p.useState({}),[w,N]=p.useState(null);p.useEffect(()=>{(async()=>{var ie;try{const me=await K.get(`${r}/signature`);N(!!me.data.signatureUrl)}catch(me){((ie=me.response)==null?void 0:ie.status)===404?N(!1):console.error("Error checking signature:",me)}})()},[r]),p.useEffect(()=>{(async()=>{var ie,me;try{v(!0);const[ke,Be,Te,qe]=await Promise.all([K.get(`${r}/teachers`),K.get(`${r}/pending-signatures`),K.get(`${r}/classes`),K.get(`${r}/promoted-students`)]);l(ke.data),u(Be.data),f(Te.data),m(qe.data)}catch(ke){k("Impossible de charger les donnes: "+(((me=(ie=ke.response)==null?void 0:ie.data)==null?void 0:me.message)||ke.message)),console.error(ke)}finally{v(!1)}})()},[r]);const $=H=>{var ie;return!!((ie=H.signatures)!=null&&ie.standard||H.signature)},E=H=>{var ie;return!!((ie=H.signatures)!=null&&ie.final)},q=H=>$(H)||E(H),L=c.filter(H=>g==="all"?!0:g==="signed"?q(H):g==="unsigned"?!q(H):!0),O=H=>{const ie={};return H.forEach(me=>{const ke=me.level||"Sans niveau",Be=me.className||"Sans classe";ie[ke]||(ie[ke]={}),ie[ke][Be]||(ie[ke][Be]=[]),ie[ke][Be].push(me)}),ie},B=O(L),I=O(c),T=Object.keys(B).sort(),W=(H,ie)=>{const me=`${H}-${ie}`;_(ke=>({...ke,[me]:!ke[me]}))},re=H=>{A(ie=>({...ie,[H]:!ie[H]}))},ae=async(H,ie)=>{const me=ie.map(Be=>Be.assignmentId).filter(Boolean);if(me.length===0)return;const ke=(K.defaults.baseURL||"").replace(/\/$/,"");IM(ke,me,H,`Carnets - ${H}`)},Y=c.length,J=c.filter($).length,P=c.filter(E).length,ce=Object.keys(I).reduce((H,ie)=>{const me=Object.values(I[ie]).flat(),ke=me.length,Be=me.filter($).length;return H[ie]={total:ke,signed:Be},H},{}),pe=Object.entries(ce).map(([H,ie])=>({label:H,total:ie.total,completed:ie.signed})).sort((H,ie)=>H.label.localeCompare(ie.label)),ye=Object.keys(I).reduce((H,ie)=>{const me=Object.values(I[ie]).flat(),ke=me.length,Be=me.filter(E).length;return H[ie]={total:ke,signed:Be},H},{}),se=Object.entries(ye).map(([H,ie])=>({label:H,total:ie.total,completed:ie.signed})).sort((H,ie)=>H.label.localeCompare(ie.label)),je={},ve={};Object.keys(I).forEach(H=>{Object.entries(I[H]).forEach(([ie,me])=>{const ke=`${ie}`;je[ke]||(je[ke]={total:0,signed:0}),ve[ke]||(ve[ke]={total:0,signed:0}),je[ke].total+=me.length,je[ke].signed+=me.filter($).length,ve[ke].total+=me.length,ve[ke].signed+=me.filter(E).length})});const le=Object.entries(je).map(([H,ie])=>({label:H,total:ie.total,completed:ie.signed})).sort((H,ie)=>H.label.localeCompare(ie.label)),oe=Object.entries(ve).map(([H,ie])=>({label:H,total:ie.total,completed:ie.signed})).sort((H,ie)=>H.label.localeCompare(ie.label)),de={};h.forEach(H=>{const ie=`${H.fromLevel||"?"}  ${H.toLevel||"?"}`;if(de[ie]||(de[ie]={total:0,signed:0}),de[ie].total+=1,H.assignmentId){const me=c.find(ke=>ke._id===H.assignmentId);me&&E(me)&&(de[ie].signed+=1)}});const Pe=Object.entries(de).map(([H,ie])=>({label:H,total:ie.total,completed:ie.signed})).sort((H,ie)=>H.label.localeCompare(ie.label)),Z=(i==null?void 0:i.activeSemester)===2?2:1,ne=Z===1?"Semestre 1":"Semestre 2",ee=Z===1?J:P,te=Z===1?pe:se,G=Z===1?le:oe;return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:28,flexWrap:"wrap",gap:16},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{fontSize:26,margin:0,color:"#0f172a",fontWeight:700,letterSpacing:"-0.02em"},children:"Tableau de bord"}),!t&&n.jsx("p",{style:{margin:"6px 0 0 0",fontSize:14,color:"#64748b",fontWeight:400},children:Y>0?`${Y} lve${Y>1?"s":""}  ${d.length} classe${d.length>1?"s":""}`:"Aucun lve"})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",fontSize:13,fontWeight:600,borderRadius:8,background:"#f1f5f9",color:"#475569",border:"1px solid #e2e8f0"},children:ne}),(i==null?void 0:i.name)&&n.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 12px",fontSize:13,fontWeight:600,borderRadius:8,background:"#eef2ff",color:"#4f46e5",border:"1px solid #c7d2fe"},children:i.name})]})]}),w===!1&&!t&&n.jsx(rr,{to:`${s}/signature`,style:{textDecoration:"none"},children:n.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,padding:"8px 14px",marginBottom:16,background:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:H=>{H.currentTarget.style.background="#fee2e2",H.currentTarget.style.borderColor="#f87171"},onMouseLeave:H=>{H.currentTarget.style.background="#fef2f2",H.currentTarget.style.borderColor="#fecaca"},children:[n.jsx(xb,{size:14,color:"#dc2626"}),n.jsx("span",{style:{fontSize:13,fontWeight:600,color:"#dc2626"},children:"Signature manquante  Cliquez pour ajouter"})]})}),y&&n.jsxs("div",{style:{textAlign:"center",padding:40,color:"#64748b",fontSize:14},children:[n.jsx("div",{style:{width:32,height:32,border:"3px solid #e2e8f0",borderTopColor:"#6366f1",borderRadius:"50%",margin:"0 auto 12px",animation:"spin 1s linear infinite"}}),"Chargement..."]}),S&&n.jsx("div",{style:{color:"#dc2626",background:"#fef2f2",padding:"12px 16px",borderRadius:10,border:"1px solid #fecaca",fontSize:14,fontWeight:500,marginBottom:20},children:S}),t&&!y&&n.jsx("div",{style:{padding:"20px 0"},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:24,marginBottom:32},children:[n.jsxs("a",{href:"/aefe/progress",style:{textDecoration:"none",display:"block",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:20,padding:28,color:"white",position:"relative",overflow:"hidden",boxShadow:"0 10px 40px -10px rgba(102, 126, 234, 0.5)",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:H=>{H.currentTarget.style.transform="translateY(-4px)",H.currentTarget.style.boxShadow="0 20px 50px -10px rgba(102, 126, 234, 0.6)"},onMouseLeave:H=>{H.currentTarget.style.transform="translateY(0)",H.currentTarget.style.boxShadow="0 10px 40px -10px rgba(102, 126, 234, 0.5)"},children:[n.jsx("div",{style:{position:"absolute",top:-20,right:-20,width:120,height:120,background:"rgba(255,255,255,0.1)",borderRadius:"50%"}}),n.jsx("div",{style:{position:"absolute",bottom:-30,right:40,width:80,height:80,background:"rgba(255,255,255,0.08)",borderRadius:"50%"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:16},children:[n.jsx("div",{style:{background:"rgba(255,255,255,0.2)",borderRadius:14,padding:12,backdropFilter:"blur(10px)"},children:n.jsx(Uh,{size:28,strokeWidth:2})}),n.jsx("h3",{style:{margin:0,fontSize:22,fontWeight:700},children:"Progression"})]}),n.jsx("p",{style:{margin:0,fontSize:14,opacity:.9,lineHeight:1.6},children:"Suivez la progression globale des lves et les statistiques de compltion par niveau"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:20,opacity:.9},children:[n.jsx("span",{style:{fontSize:14,fontWeight:600},children:"Accder"}),n.jsx(Tc,{size:18})]})]}),n.jsxs("a",{href:"/aefe/teacher-progress",style:{textDecoration:"none",display:"block",background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",borderRadius:20,padding:28,color:"white",position:"relative",overflow:"hidden",boxShadow:"0 10px 40px -10px rgba(17, 153, 142, 0.5)",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:H=>{H.currentTarget.style.transform="translateY(-4px)",H.currentTarget.style.boxShadow="0 20px 50px -10px rgba(17, 153, 142, 0.6)"},onMouseLeave:H=>{H.currentTarget.style.transform="translateY(0)",H.currentTarget.style.boxShadow="0 10px 40px -10px rgba(17, 153, 142, 0.5)"},children:[n.jsx("div",{style:{position:"absolute",top:-20,right:-20,width:120,height:120,background:"rgba(255,255,255,0.1)",borderRadius:"50%"}}),n.jsx("div",{style:{position:"absolute",bottom:-30,right:40,width:80,height:80,background:"rgba(255,255,255,0.08)",borderRadius:"50%"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:16},children:[n.jsx("div",{style:{background:"rgba(255,255,255,0.2)",borderRadius:14,padding:12,backdropFilter:"blur(10px)"},children:n.jsx(Ts,{size:28,strokeWidth:2})}),n.jsx("h3",{style:{margin:0,fontSize:22,fontWeight:700},children:"Suivi Enseignants"})]}),n.jsx("p",{style:{margin:0,fontSize:14,opacity:.9,lineHeight:1.6},children:"Consultez le travail des enseignants et leur avancement dans la saisie des carnets"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:20,opacity:.9},children:[n.jsx("span",{style:{fontSize:14,fontWeight:600},children:"Accder"}),n.jsx(Tc,{size:18})]})]}),n.jsxs("a",{href:"/aefe/suggestion",style:{textDecoration:"none",display:"block",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",borderRadius:20,padding:28,color:"white",position:"relative",overflow:"hidden",boxShadow:"0 10px 40px -10px rgba(79, 172, 254, 0.5)",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:H=>{H.currentTarget.style.transform="translateY(-4px)",H.currentTarget.style.boxShadow="0 20px 50px -10px rgba(79, 172, 254, 0.6)"},onMouseLeave:H=>{H.currentTarget.style.transform="translateY(0)",H.currentTarget.style.boxShadow="0 10px 40px -10px rgba(79, 172, 254, 0.5)"},children:[n.jsx("div",{style:{position:"absolute",top:-20,right:-20,width:120,height:120,background:"rgba(255,255,255,0.1)",borderRadius:"50%"}}),n.jsx("div",{style:{position:"absolute",bottom:-30,right:40,width:80,height:80,background:"rgba(255,255,255,0.08)",borderRadius:"50%"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:16},children:[n.jsx("div",{style:{background:"rgba(255,255,255,0.2)",borderRadius:14,padding:12,backdropFilter:"blur(10px)"},children:n.jsx(Z4,{size:28,strokeWidth:2})}),n.jsx("h3",{style:{margin:0,fontSize:22,fontWeight:700},children:"Suggestion"})]}),n.jsx("p",{style:{margin:0,fontSize:14,opacity:.9,lineHeight:1.6},children:"Proposez des suggestions d'apprciations aux enseignants pour amliorer les carnets"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:20,opacity:.9},children:[n.jsx("span",{style:{fontSize:14,fontWeight:600},children:"Accder"}),n.jsx(Tc,{size:18})]})]})]})}),!t&&n.jsxs(n.Fragment,{children:[!y&&n.jsx(z8,{title:` Progression  ${ne}`,total:Y,completed:ee,perLevelBreakdown:te,perClassBreakdown:G,promuBreakdown:Pe,showPromu:Z===2&&h.length>0}),h.length>0&&n.jsxs("div",{style:{marginBottom:32},children:[n.jsx("h3",{style:{fontSize:22,color:"#1e293b",fontWeight:600,marginBottom:16},children:" lves Promus (En attente d'affectation)"}),Object.entries(h.reduce((H,ie)=>{const me=`${ie.fromLevel||"?"}  ${ie.toLevel||"?"}`;return H[me]||(H[me]=[]),H[me].push(ie),H},{})).sort().map(([H,ie])=>{const me=b[H];return n.jsxs("div",{style:{marginBottom:20,borderRadius:14,border:"1px solid #e2e8f0",overflow:"hidden",background:"white"},children:[(()=>{const ke=z[H]||{status:"idle",progress:0},Be=ie.filter(be=>!!be.assignmentId).length,Te=ie.length,qe=ke.status==="preparing"||ke.status==="downloading",Qe=Be>0,Ze=!Qe||qe;let ge=`Tlcharger (${Be})`;ke.status==="preparing"&&(ge="Prparation"),ke.status==="downloading"&&(ge=ke.progress===-1?"Gnration":`Tlchargement ${ke.progress}%`),ke.status==="done"&&(ge="Tlcharg"),ke.status==="error"&&(ge="Ressayer");const Ae=ke.status!=="idle",Le=ke.status==="preparing"||ke.status==="downloading",Q=ke.status==="preparing"||ke.status==="downloading"&&ke.progress===-1;return n.jsx("div",{style:{padding:"12px 14px",background:"#f8fafc",borderBottom:me?"1px solid #e2e8f0":"none"},children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:12},children:[n.jsxs("div",{onClick:()=>re(H),style:{minWidth:0,cursor:"pointer",flex:1},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[n.jsx("span",{style:{fontSize:12,color:"#64748b"},children:me?"":""}),n.jsx("h4",{style:{fontSize:16,color:"#0f172a",margin:0,fontWeight:700},children:H}),n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:999,border:"1px solid #e2e8f0",background:"#ffffff",fontSize:12,color:"#475569",fontWeight:600},children:[Be,"/",Te," carnets"]}),!Qe&&n.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:999,border:"1px solid #fed7aa",background:"#fff7ed",fontSize:12,color:"#9a3412",fontWeight:700},children:"Aucun carnet disponible"})]}),Ae&&n.jsxs("div",{"aria-live":"polite",style:{marginTop:8,fontSize:13,color:ke.status==="error"?"#b91c1c":"#64748b",display:"flex",alignItems:"center",gap:8},children:[Q&&n.jsx("span",{className:"spinner","aria-hidden":"true"}),ke.status==="done"&&n.jsx(fb,{size:16,color:"#16a34a"}),ke.status==="error"&&n.jsx(yb,{size:16,color:"#b91c1c"}),ke.status==="preparing"&&"Prparation de larchive",ke.status==="downloading"&&(ke.progress===-1?"Gnration des carnets":`Tlchargement en cours ${ke.progress}%`),ke.status==="done"&&"Tlchargement termin",ke.status==="error"&&(ke.error||"Erreur pendant le tlchargement")]})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:8},children:[n.jsxs("button",{onClick:()=>ae(H,ie),disabled:Ze,className:"btn",style:{padding:"10px 12px",fontSize:13,background:ke.status==="error"?"#b91c1c":"#0f172a",color:"white",borderRadius:10,border:`1px solid ${ke.status==="error"?"#b91c1c":"#0f172a"}`,opacity:Ze?.55:1,cursor:Ze?"not-allowed":"pointer",whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",gap:8},children:[n.jsx(mb,{size:16}),ge]}),Le&&n.jsx("div",{style:{width:260},children:ke.progress===-1?n.jsx("div",{className:"progress-track progress-indeterminate"}):n.jsx("div",{className:"progress-track",children:n.jsx("div",{className:"progress-fill",style:{width:`${Math.max(0,Math.min(100,ke.progress))}%`}})})})]})]})})})(),me&&n.jsx("div",{style:{background:"white",borderRadius:0,overflow:"hidden"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:13,color:"#64748b",fontWeight:600},children:"lve"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:13,color:"#64748b",fontWeight:600},children:"Date de promotion"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:13,color:"#64748b",fontWeight:600},children:"Action"})]})}),n.jsx("tbody",{children:ie.map(ke=>n.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[n.jsx("td",{style:{padding:"12px 16px",fontSize:14,color:"#1e293b",fontWeight:500},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[ke.avatarUrl&&n.jsx("img",{src:ke.avatarUrl,alt:"",style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid #e2e8f0"}}),n.jsxs("span",{children:[ke.firstName," ",ke.lastName]})]})}),n.jsx("td",{style:{padding:"12px 16px",fontSize:14,color:"#64748b"},children:new Date(ke.date).toLocaleDateString("fr-FR")}),n.jsx("td",{style:{padding:"12px 16px",textAlign:"right"},children:ke.assignmentId&&n.jsx(rr,{to:`${s}/templates/${ke.assignmentId}/review`,style:{display:"inline-block",padding:"6px 12px",background:"#3b82f6",color:"white",borderRadius:6,textDecoration:"none",fontSize:13,fontWeight:500},children:"Voir le carnet"})})]},ke._id))})]})})]},H)})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:28,marginBottom:16},children:[n.jsx("h3",{style:{margin:0,fontSize:22,color:"#1e293b",fontWeight:600},children:" Tous les carnets"}),n.jsxs("select",{value:g,onChange:H=>x(H.target.value),style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white",cursor:"pointer"},children:[n.jsx("option",{value:"all",children:"Tous"}),n.jsx("option",{value:"signed",children:"Signs"}),n.jsx("option",{value:"unsigned",children:"Non signs"})]})]}),T.length>0?T.map(H=>n.jsxs("div",{style:{marginBottom:24},children:[n.jsxs("h4",{style:{fontSize:18,color:"#334155",marginBottom:12,borderBottom:"2px solid #e2e8f0",paddingBottom:8},children:["Niveau: ",H]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:Object.keys(B[H]).sort().map(ie=>{const me=B[H][ie],ke=`${H}-${ie}`,Be=j[ke],Te=me.filter($).length,qe=me.filter(E).length,Qe=me.length;return n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:8,overflow:"hidden"},children:[n.jsxs("div",{onClick:()=>W(H,ie),style:{padding:"12px 16px",background:"#f8fafc",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",userSelect:"none"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{fontSize:12,color:"#64748b"},children:Be?"":""}),n.jsx("span",{style:{fontWeight:600,color:"#1e293b"},children:ie})]}),n.jsxs("div",{style:{fontSize:14,color:"#64748b"},children:[n.jsx("span",{style:{color:"#334155",fontWeight:600},children:"S1"})," ",Te,"/",Qe,n.jsx("span",{style:{color:"#94a3b8",margin:"0 8px"},children:""}),n.jsx("span",{style:{color:"#334155",fontWeight:600},children:"S2"})," ",qe,"/",Qe]})]}),Be&&n.jsx("div",{style:{padding:16,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16,background:"white",borderTop:"1px solid #e2e8f0"},children:Object.values(me.reduce((Ze,ge)=>{const Ae=ge.studentId||(ge.student?`${ge.student.firstName} ${ge.student.lastName}`:"unknown");return Ze[Ae]||(Ze[Ae]=[]),Ze[Ae].push(ge),Ze},{})).sort((Ze,ge)=>{var Q,be;const Ae=(Q=Ze[0])!=null&&Q.student?`${Ze[0].student.lastName} ${Ze[0].student.firstName}`:"",Le=(be=ge[0])!=null&&be.student?`${ge[0].student.lastName} ${ge[0].student.firstName}`:"";return Ae.localeCompare(Le)}).map(Ze=>{const ge=Ze[0].student,Ae=Ze.some(Le=>Le.isPromoted);return n.jsxs("div",{className:"card",style:{border:Ae?"1px solid #86efac":"1px solid #e2e8f0",background:Ae?"#f0fdf4":"#fff",padding:16,borderRadius:10,boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[n.jsx("div",{style:{marginBottom:12},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(ge==null?void 0:ge.avatarUrl)&&n.jsx("img",{src:ge.avatarUrl,alt:"",style:{width:32,height:32,borderRadius:"50%",objectFit:"cover",border:"1px solid #e2e8f0"}}),n.jsx("h3",{style:{fontSize:18,color:"#1e293b",fontWeight:700,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:ge?`${ge.firstName} ${ge.lastName}`:"lve Inconnu"}),Ae?n.jsx("span",{style:{fontSize:10,background:"#166534",color:"#fff",padding:"2px 8px",borderRadius:12,fontWeight:600,whiteSpace:"nowrap"},children:"Promu"}):n.jsx("span",{style:{fontSize:10,background:"#f1f5f9",color:"#64748b",padding:"2px 8px",borderRadius:12,fontWeight:600,whiteSpace:"nowrap",border:"1px solid #cbd5e1"},children:"Non promu"})]})}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Ze.map(Le=>{var Q,be;return n.jsx(rr,{to:`${s}/templates/${Le._id}/review`,style:{textDecoration:"none"},children:n.jsxs("div",{style:{padding:"8px 10px",background:"#f8fafc",borderRadius:6,border:"1px solid #e2e8f0",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:we=>{we.currentTarget.style.borderColor="#94a3b8",we.currentTarget.style.background="#f1f5f9"},onMouseLeave:we=>{we.currentTarget.style.borderColor="#e2e8f0",we.currentTarget.style.background="#f8fafc"},children:[n.jsxs("div",{style:{flex:1,minWidth:0},children:[n.jsx("div",{style:{fontSize:13,fontWeight:600,color:"#334155",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Ouvrir"}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:6},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:11},children:[n.jsx("span",{style:{color:"#64748b"},children:"Mi-anne"}),(Q=Le.signatures)!=null&&Q.standard?n.jsx("span",{style:{color:"#059669",display:"flex",alignItems:"center",gap:3,fontWeight:500},children:" Sign"}):n.jsx("span",{style:{color:"#d97706",display:"flex",alignItems:"center",gap:3},children:""})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:11},children:[n.jsx("span",{style:{color:"#64748b"},children:"Fin d'anne"}),(be=Le.signatures)!=null&&be.final?n.jsx("span",{style:{color:"#059669",display:"flex",alignItems:"center",gap:3,fontWeight:500},children:" Sign"}):n.jsx("span",{style:{color:"#d97706",display:"flex",alignItems:"center",gap:3},children:""})]})]})]}),n.jsx("div",{style:{color:"#94a3b8",fontSize:12,marginLeft:8},children:""})]})},Le._id)})})]},Ze[0].studentId||Math.random().toString())})})]},ie)})})]},H)):!y&&n.jsx("div",{className:"note",children:g==="all"?"Aucun carnet.":g==="signed"?"Aucun carnet sign.":"Aucun carnet non sign."})]})]})})}function p_(){const{teacherId:e}=oa(),s=wn().pathname.includes("/aefe")?"/aefe":"/subadmin",[i,a]=p.useState([]),[o,l]=p.useState(!0),[c,u]=p.useState("");return p.useEffect(()=>{e&&(async()=>{try{l(!0);const f=await K.get(`${s}/teachers/${e}/changes`);a(f.data)}catch(f){u("Impossible de charger les modifications"),console.error(f)}finally{l(!1)}})()},[e,s]),n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("button",{className:"btn secondary",onClick:()=>window.history.back(),style:{marginBottom:20,display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0"},children:" Retour"}),n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:" Modifications de l'enseignant"}),n.jsx("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:"Historique des modifications apportes aux carnets par l'enseignant"}),o&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Chargement..."}),c&&n.jsx("div",{className:"note",style:{color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca",marginTop:16},children:c}),n.jsxs("div",{style:{marginTop:20},children:[i.map(d=>{var f,h;return n.jsxs("div",{className:"card",style:{marginBottom:16,border:"1px solid #e2e8f0",background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",transition:"all 0.3s ease"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:10,gap:12,flexWrap:"wrap"},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{className:"title",style:{fontSize:18,marginBottom:4,color:"#1e293b",fontWeight:600},children:d.templateName||"Carnet"}),n.jsxs("div",{className:"note",style:{fontSize:13,color:"#64748b"},children:[" ",d.studentName||"lve"]})]}),n.jsxs("div",{className:"note",style:{fontSize:12,color:"#6c5ce7",background:"#f5f3ff",padding:"6px 12px",borderRadius:6,border:"1px solid #e9d5ff",fontWeight:500},children:[" ",new Date(d.timestamp).toLocaleString("fr-FR")]})]}),n.jsxs("div",{className:"note",style:{fontSize:13,color:"#475569",marginTop:8,padding:8,background:"#f8fafc",borderRadius:6,border:"1px solid #e2e8f0"},children:[n.jsx("span",{style:{fontWeight:600},children:"Type:"})," ",d.changeType," |",n.jsx("span",{style:{fontWeight:600},children:" Page"})," ",d.pageIndex+1,",",n.jsx("span",{style:{fontWeight:600},children:" Bloc"})," ",d.blockIndex+1]}),d.before&&d.after&&n.jsxs("div",{style:{marginTop:12,padding:14,background:"#fafafa",borderRadius:8,border:"1px solid #e5e7eb"},children:[n.jsxs("div",{style:{fontSize:13,marginBottom:8},children:[n.jsx("strong",{style:{color:"#dc2626"},children:" Avant:"}),n.jsx("div",{style:{marginTop:4,padding:8,background:"#fee2e2",borderRadius:6,fontSize:12,fontFamily:"monospace",color:"#991b1b",wordBreak:"break-all"},children:JSON.stringify((f=d.before.items)==null?void 0:f.map(m=>({code:m.code,active:m.active})))})]}),n.jsxs("div",{style:{fontSize:13,marginTop:10},children:[n.jsx("strong",{style:{color:"#10b981"},children:" Aprs:"}),n.jsx("div",{style:{marginTop:4,padding:8,background:"#d1fae5",borderRadius:6,fontSize:12,fontFamily:"monospace",color:"#065f46",wordBreak:"break-all"},children:JSON.stringify((h=d.after.items)==null?void 0:h.map(m=>({code:m.code,active:m.active})))})]})]})]},d._id)}),!o&&i.length===0&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:32,color:"#64748b",background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:" Aucune modification enregistre."})]})]})})}const Ey=800,f_=1120;function h_(){const{assignmentId:e}=oa(),t=Sn(),s=wn().pathname.includes("/aefe/"),i=s?"/aefe":"/subadmin",a=s?"/aefe/dashboard":"/subadmin/dashboard",[o,l]=p.useState(null),[c,u]=p.useState(null),[d,f]=p.useState(null),[h,m]=p.useState(null),[g,x]=p.useState(null),[y,v]=p.useState(null),[S,k]=p.useState(0),[j,_]=p.useState(!0),[b,A]=p.useState(!0),[z,D]=p.useState("");p.useEffect(()=>{c&&console.log("[SubAdminTemplateReview] Student data loaded:",{firstName:c.firstName,level:c.level,className:c.className,fullObject:c})},[c]);const[w,N]=p.useState(!1),[$,E]=p.useState(!1),[q,L]=p.useState(!1),[O,B]=p.useState(!1),[I,T]=p.useState(!1),[W,re]=p.useState(!1),[ae,Y]=p.useState(1),[J,P]=p.useState(!1),[ce,pe]=p.useState(!1),[ye,se]=p.useState(!1),[je,ve]=p.useState(!1),[le,oe]=p.useState(null),[de,Pe]=p.useState([]),[Z,ne]=p.useState(1),[ee,te]=p.useState(!1),[G,H]=p.useState({}),ie=p.useRef(null),me=()=>{const $e=ie.current?ie.current.clientWidth:window.innerWidth;return Math.max(0,Math.min(window.innerWidth,$e)-48)/Ey},[ke,Be]=p.useState(null),[Te,qe]=p.useState(null),[Qe,Ze]=p.useState(null),[ge,Ae]=p.useState(!1),{levels:Le}=la(),{activeYear:Q}=Yn(),be=Od(),we=($e,He,Ge)=>{if(!Ge)return!0;const R={};Le.forEach(We=>{R[We.name.toUpperCase()]=We.order});const _e=R[Ge.toUpperCase()];if(_e===void 0)return!0;if($e){const We=R[$e.toUpperCase()];return We===void 0?!0:We<=_e}return He&&He.length>0?He.some(We=>{const jt=R[We.toUpperCase()];return jt===void 0?!0:jt<=_e}):!0},Ne=($e,He="info")=>{Be({message:$e,type:He})};p.useEffect(()=>{const $e=()=>{ee&&ne(me())};return ee&&($e(),window.addEventListener("resize",$e)),()=>window.removeEventListener("resize",$e)},[ee]),p.useEffect(()=>{if(!e||!be)return;const $e=`assignment:${e}`;be.emit("join-room",$e);const He=Ge=>{Ge.type==="language-toggle"&&l(R=>{var Yt;if(!R)return R;const _e={...R},{pageIndex:We,blockIndex:jt,items:Ht}=Ge;return(Yt=_e.pages[We])!=null&&Yt.blocks[jt]&&(_e.pages[We].blocks[jt].props.items=Ht),_e}),Ge.type==="assignment-data"&&f(R=>{if(!R||Ge.assignmentId&&Ge.assignmentId!==R._id)return R;const _e={...R.data||{},...Ge.data||{}};return{...R,data:_e}})};return be.on("update-received",He),()=>{be.emit("leave-room",$e),be.off("update-received",He)}},[e,be]);const V=$e=>{if(!be||!e)return;const He={type:"assignment-data",assignmentId:e,data:$e,dataVersion:d==null?void 0:d.dataVersion};be.emit("broadcast-update",{roomId:`assignment:${e}`,payload:He},Ge=>{(!Ge||Ge.status!=="ok")&&console.warn("Socket update ack failed",Ge)})};p.useEffect(()=>{e&&(async()=>{try{A(!0);const He=await K.get(`${i}/templates/${e}/review`);l(He.data.template),u(He.data.student),f(He.data.assignment),m(He.data.signature),x(He.data.finalSignature),v(He.data.teacherStatus||null),se(He.data.canEdit),T(He.data.isPromoted),re(He.data.isSignedByMe),Y(He.data.activeSemester||1),P(He.data.eligibleForSign===!0),Pe(He.data.subadminAssignedLevels||[])}catch(He){D("Impossible de charger le carnet"),console.error(He)}finally{A(!1)}})()},[e,i]),p.useEffect(()=>{(async()=>{try{const He=await K.get("/settings/public");H(He.data.block_visibility_settings||{})}catch{}})()},[]),p.useEffect(()=>{(async()=>{var He;try{const Ge=await K.get(`${i}/signature`);Ze(!!Ge.data.signatureUrl)}catch(Ge){((He=Ge.response)==null?void 0:He.status)===404?Ze(!1):console.error("Error checking signature:",Ge)}})()},[i]),p.useEffect(()=>{const $e=()=>oe(null);if(le)return document.addEventListener("click",$e),()=>document.removeEventListener("click",$e)},[le]);const fe=async($e,He,Ge)=>{var R,_e,We;try{const jt={type:"language_toggle",pageIndex:$e,blockIndex:He,items:Ge},Ht=d==null?void 0:d.dataVersion;typeof Ht=="number"&&(jt.expectedDataVersion=Ht);const Yt=await K.patch(`${i}/templates/${e}/data`,jt);if(o){const _t={...o};_t.pages[$e].blocks[He].props.items=Ge,l(_t),be&&e&&be.emit("broadcast-update",{roomId:`assignment:${e}`,payload:{type:"language-toggle",pageIndex:$e,blockIndex:He,items:Ge,changeId:(R=Yt.data)==null?void 0:R.changeId,dataVersion:(_e=Yt.data)==null?void 0:_e.dataVersion}},mr=>{(!mr||mr.status!=="ok")&&console.warn("Socket ack failed for language-toggle",mr)})}Yt&&Yt.data&&typeof Yt.data.dataVersion=="number"&&f(_t=>_t&&{..._t,data:_t.data,dataVersion:Yt.data.dataVersion})}catch(jt){if(((We=jt==null?void 0:jt.response)==null?void 0:We.status)===409){Ne("Conflit dtect  vos modifications n'ont pas t appliques. Rechargez.","error");try{const Ht=await K.get(`${i}/templates/${e}/review`);l(Ht.data.template),f(Ht.data.assignment)}catch(Ht){console.error("Failed to reload after conflict",Ht)}}else Ne("chec de l'enregistrement","error"),console.error(jt)}},Oe=($e,He,Ge,R)=>R?`block:${R}`:`tpl:${$e||""}:p:${He}:b:${Ge}`,Fe={TPS:0,PS:1,MS:2,GS:3,EB1:4,KG1:1,KG2:2,KG3:3},Ve=$e=>{if(!$e)return!1;const He=((c==null?void 0:c.level)||"").toUpperCase(),Ge=$e.toUpperCase(),R=Fe[He]??99;return(Fe[Ge]??99)>R},tt=$e=>{var jt,Ht,Yt;if(!$e)return{hasSem1:!!h,hasSem2:!!g};const He=$e.toUpperCase(),Ge=((jt=d==null?void 0:d.data)==null?void 0:jt.signatures)||[],R=((Ht=d==null?void 0:d.data)==null?void 0:Ht.promotions)||[];let _e=!1,We=!1;return((Yt=c==null?void 0:c.level)==null?void 0:Yt.toUpperCase())===He&&(_e=!!h,We=!!g),Ge.forEach(_t=>{var mr,yr;if(_t.schoolYearName){const Kt=R.find(Sr=>Sr.year===_t.schoolYearName);Kt&&((mr=Kt.from)==null?void 0:mr.toUpperCase())===He&&((_t.type==="standard"||!_t.type)&&(_e=!0),_t.type==="end_of_year"&&(We=!0))}((yr=_t.level)==null?void 0:yr.toUpperCase())===He&&((_t.type==="standard"||!_t.type)&&(_e=!0),_t.type==="end_of_year"&&(We=!0))}),{hasSem1:_e,hasSem2:We}},Wt=$e=>{if(!$e)return null;if(Le&&Le.length>0){const Ge=Le.find(R=>R.name===$e);if(Ge){const R=Le.find(_e=>_e.order===Ge.order+1);if(R)return R.name}}const He=($e||"").toUpperCase();return He==="TPS"?"PS":He==="PS"?"MS":He==="MS"?"GS":He==="GS"?"EB1":He==="KG1"?"KG2":He==="KG2"?"KG3":He==="KG3"?"EB1":null},Ct=$e=>{if($e.props.level)return $e.props.level;const He=($e.props.label||"").toUpperCase();return/\bPS\b/.test(He)?"PS":/\bMS\b/.test(He)?"MS":/\bGS\b/.test(He)?"GS":/\bEB1\b/.test(He)?"EB1":/\bKG1\b/.test(He)?"KG1":/\bKG2\b/.test(He)?"KG2":/\bKG3\b/.test(He)?"KG3":null},Ot=$e=>{var R,_e,We;const He=((R=$e.props)==null?void 0:R.semester)??((_e=$e.props)==null?void 0:_e.semestre)??null;if(He===1||He==="1")return 1;if(He===2||He==="2")return 2;const Ge=String(((We=$e.props)==null?void 0:We.period)||"");return Ge==="mid-year"?1:Ge==="end-year"?2:null},et=$e=>{var yr,Kt,Sr;const{level:He,semester:Ge}=$e,R=[],_e=(yr=d==null?void 0:d.data)==null?void 0:yr.signatures;Array.isArray(_e)&&R.push(..._e),h&&R.push(h),g&&R.push(g);const We=Array.isArray((Kt=d==null?void 0:d.data)==null?void 0:Kt.promotions)?(Sr=d==null?void 0:d.data)==null?void 0:Sr.promotions:[],jt=Me=>String(Me||"").trim().toLowerCase(),Ht=jt(He),Yt=Me=>{const rt=String((Me==null?void 0:Me.signaturePeriodId)||""),wt=String((Me==null?void 0:Me.type)||"standard");return Ge===1?rt.endsWith("_sem1")||wt==="standard":Ge===2?rt.endsWith("_sem2")||rt.endsWith("_end_of_year")||wt==="end_of_year":!0},_t=Me=>{if(!Ht)return!0;const rt=jt(Me==null?void 0:Me.level);if(rt)return rt===Ht;if(Me!=null&&Me.schoolYearName){const ut=We.find(gt=>String((gt==null?void 0:gt.year)||"")===String(Me.schoolYearName)),Bt=jt((ut==null?void 0:ut.from)||(ut==null?void 0:ut.fromLevel));if(Bt&&Bt===Ht)return!0}if(Me!=null&&Me.schoolYearId){const ut=We.find(gt=>String((gt==null?void 0:gt.schoolYearId)||"")===String(Me.schoolYearId)),Bt=jt((ut==null?void 0:ut.from)||(ut==null?void 0:ut.fromLevel));if(Bt&&Bt===Ht)return!0}const wt=jt(c==null?void 0:c.level);return!!wt&&wt===Ht};return R.filter(Me=>Me&&(Me==null?void 0:Me.signedAt)).filter(Yt).filter(_t).sort((Me,rt)=>new Date(rt.signedAt).getTime()-new Date(Me.signedAt).getTime())[0]||null},nt=$e=>{if(!$e)return"";const He=$e.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!He)return"";const Ge=parseInt(He[1],10),R=He[2],_e=parseInt(He[3],10);return Number.isNaN(Ge)||Number.isNaN(_e)?"":`${Ge+1}${R}${_e+1}`},ft=($e,He)=>{var Yt;const Ge=String(($e==null?void 0:$e.year)||"");if(Ge){const _t=nt(Ge);if(_t)return _t}const R=nt(Q==null?void 0:Q.name);if(R)return R;if(!Ge)return"";const _e=((Yt=d==null?void 0:d.data)==null?void 0:Yt.signatures)||[],We=String(($e==null?void 0:$e.from)||He||""),jt=Array.isArray(_e)?_e.filter(_t=>(_t==null?void 0:_t.type)==="end_of_year"&&(_t==null?void 0:_t.schoolYearName)).find(_t=>We?_t!=null&&_t.level?String(_t.level)===We:!1:!0):null;return jt!=null&&jt.schoolYearName?String(jt.schoolYearName):nt(Ge)||Ge},vt=($e,He,Ge)=>{var Yt;const R=((Yt=d==null?void 0:d.data)==null?void 0:Yt.signatures)||[],_e=Ge==="end-year",We=Ge==="mid-year",Ht=R.filter(_t=>{if(_e){if(_t.type!=="end_of_year")return!1}else if(We&&_t.type&&_t.type!=="standard")return!1;return!(_t.level&&He&&_t.level!==He)}).sort((_t,mr)=>{const yr=new Date(_t.signedAt||0).getTime();return new Date(mr.signedAt||0).getTime()-yr})[0];if(Ht){let _t=String(Ht.schoolYearName||"").trim();if(!_t&&Ht.signedAt){const mr=new Date(Ht.signedAt),yr=mr.getFullYear(),Sr=mr.getMonth()>=8?yr:yr-1;_t=`${Sr}/${Sr+1}`}if(_t)return _t}return String(($e==null?void 0:$e.year)||"")},Zt=async()=>{if(!(c!=null&&c.level))return;const $e=Wt(c.level);$e&&qe({isOpen:!0,title:"Confirmer la promotion",content:n.jsxs("div",{children:[n.jsxs("p",{children:["Voulez-vous vraiment faire passer ",n.jsx("strong",{children:c.firstName})," en ",n.jsx("strong",{children:$e})," ?"]}),n.jsx("p",{style:{color:"#64748b",fontSize:"0.9em"},children:"L'lve sera retir de sa classe actuelle."})]}),onConfirm:async()=>{var He,Ge,R,_e;try{pe(!0);const We=await K.post(`${i}/templates/${e}/promote`,{nextLevel:$e});Ne("lve promu avec succs !","success"),We.data.student&&u(We.data.student),We.data.assignment&&f(We.data.assignment),T(!0)}catch(We){((Ge=(He=We.response)==null?void 0:He.data)==null?void 0:Ge.error)==="already_promoted"?Ne("Cet lve a dj t promu cette anne.","info"):(_e=(R=We.response)==null?void 0:R.data)!=null&&_e.message?Ne(`chec de la promotion: ${We.response.data.message}`,"error"):Ne("chec de la promotion","error"),console.error(We)}finally{pe(!1),qe(null)}}})},Se=async()=>{var He,Ge,R,_e;if(Qe===!1){Ae(!0);return}if(!((d==null?void 0:d.isCompletedSem1)||(d==null?void 0:d.isCompleted))){Ne("Le semestre 1 n'est pas termin par les enseignants.","error");return}if(!J){Ne("Le carnet n'est pas encore prt pour la signature ou vous n'tes pas assign.","error");return}try{N(!0);const We=await K.post(`${i}/templates/${e}/sign`);console.log("[handleSign] Sign response:",We.data);const jt=await K.get(`${i}/templates/${e}/review`);console.log("[handleSign] Review response:",jt.data),m(jt.data.signature),x(jt.data.finalSignature),f(jt.data.assignment),re(jt.data.isSignedByMe),P(jt.data.eligibleForSign===!0),Ne("Carnet sign avec succs","success")}catch(We){console.error("[handleSign] Error:",We);const jt=((Ge=(He=We.response)==null?void 0:He.data)==null?void 0:Ge.message)||((_e=(R=We.response)==null?void 0:R.data)==null?void 0:_e.error)||"chec de la signature";Ne(jt,"error")}finally{N(!1)}},Ie=async()=>{try{E(!0),await K.delete(`${i}/templates/${e}/sign`);const $e=await K.get(`${i}/templates/${e}/review`);m($e.data.signature),x($e.data.finalSignature),f($e.data.assignment),re($e.data.isSignedByMe),Ne("Signature annule","success")}catch($e){Ne("chec de la suppression de signature","error"),console.error($e)}finally{E(!1)}},Re=async()=>{if(Qe===!1){Ae(!0);return}if(!(d==null?void 0:d.isCompletedSem2)){Ne("Le semestre 2 n'est pas termin par les enseignants.","info");return}try{L(!0),await K.post(`${i}/templates/${e}/sign`,{type:"end_of_year"});const He=await K.get(`${i}/templates/${e}/review`);m(He.data.signature),x(He.data.finalSignature),f(He.data.assignment),re(He.data.isSignedByMe),Ne("Carnet sign (fin d'anne) avec succs","success")}catch(He){Ne("chec de la signature fin d'anne","error"),console.error(He)}finally{L(!1)}},ht=async()=>{try{B(!0),await K.delete(`${i}/templates/${e}/sign`,{data:{type:"end_of_year"}});const $e=await K.get(`${i}/templates/${e}/review`);m($e.data.signature),x($e.data.finalSignature),f($e.data.assignment),re($e.data.isSignedByMe),Ne("Signature (fin d'anne) annule","success")}catch($e){Ne("chec de la suppression de signature fin d'anne","error"),console.error($e)}finally{B(!1)}},Et=async()=>{if(o&&c)try{const $e=(K.defaults.baseURL||"").replace(/\/$/,""),He=vb($e,c._id,o._id||""),Ge=`${c.firstName} ${c.lastName}`;wd(He,Ge,"single",1)}catch($e){Ne("chec de l'export PDF","error"),console.error($e)}},Mt=($e,He)=>{if(!(d!=null&&d.data))return;if(He){const We=`${$e}_${He}`;if(d.data[We]!==void 0)return d.data[We]}let Ge=null;const R=d.data.promotions||[];if(R.length>0&&(Ge=[...R].sort((jt,Ht)=>{const Yt=new Date(jt.date||0).getTime(),_t=new Date(Ht.date||0).getTime();return Yt-_t})[0].from),!Ge||He===Ge||!He)return d.data[$e]},St=async($e,He,Ge)=>{if(!d)return;const R=He?`${$e}_${He}`:$e,_e={...d.data,[R]:Ge};f({...d,data:_e});try{await K.patch(`${i}/templates/${d._id}/data`,{data:{[R]:Ge}}),V({[R]:Ge})}catch{D("Erreur sauvegarde")}};if(b)return n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Chargement..."})})});if(z&&!o)return n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",style:{color:"crimson"},children:z})})});if(!o)return n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Carnet introuvable"})})});const ir=($e,He)=>{var _t,mr,yr,Kt,Sr;const Ge=y==null?void 0:y[He],R=(_t=Ge==null?void 0:Ge.teachers)!=null&&_t.length?Ge.teachers.map(Me=>Me.name).join(", "):"Non assign",_e=ae===2?Ge==null?void 0:Ge.doneSem2:Ge==null?void 0:Ge.doneSem1,We=(mr=Ge==null?void 0:Ge.teachers)!=null&&mr.length?_e?"Fait":" faire":"Non assign",jt=(yr=Ge==null?void 0:Ge.teachers)!=null&&yr.length?_e?"#16a34a":"#dc2626":"#64748b",Ht=(Kt=Ge==null?void 0:Ge.teachers)!=null&&Kt.length?_e?"#dcfce7":"#fee2e2":"#f1f5f9",Yt=(Sr=Ge==null?void 0:Ge.teachers)!=null&&Sr.length?_e?"#86efac":"#fecaca":"#e2e8f0";return n.jsxs("div",{style:{padding:"10px 12px",borderRadius:12,background:Ht,border:`1px solid ${Yt}`,minWidth:180,flex:"1 1 200px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsx("div",{style:{fontWeight:600,color:"#0f172a",fontSize:14},children:$e}),n.jsx("div",{style:{fontSize:12,fontWeight:700,color:jt,background:"rgba(255,255,255,0.7)",borderRadius:999,padding:"4px 10px",border:`1px solid ${Yt}`,whiteSpace:"nowrap"},children:We})]}),n.jsx("div",{style:{marginTop:6,fontSize:12,color:"#475569",lineHeight:1.3},children:R})]})};return n.jsxs("div",{style:{padding:24},children:[n.jsx(jd,{}),n.jsx(im,{}),(o==null?void 0:o.signingPage)&&n.jsx("button",{onClick:()=>{const $e=(o.signingPage||1)-1;k($e),j&&setTimeout(()=>{const He=document.getElementById(`page-${$e}`);He&&He.scrollIntoView({behavior:"smooth",block:"start"})},100)},title:"Aller  la page de signature",style:{position:"fixed",right:"70px",bottom:"30px",zIndex:999,padding:"10px 16px",borderRadius:24,background:"#3b82f6",color:"white",border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",fontWeight:600,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",gap:8},children:" Signature Page"}),ke&&n.jsx(ca,{message:ke.message,type:ke.type,onClose:()=>Be(null)}),n.jsx(pd,{isOpen:!!Te,onClose:()=>qe(null),title:(Te==null?void 0:Te.title)||"",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn secondary",onClick:()=>qe(null),children:"Annuler"}),n.jsx("button",{className:"btn",onClick:Te==null?void 0:Te.onConfirm,children:"Confirmer"})]}),children:Te==null?void 0:Te.content}),n.jsx(pd,{isOpen:ge,onClose:()=>Ae(!1),title:" Signature manquante",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn secondary",onClick:()=>Ae(!1),style:{background:"#f1f5f9",color:"#475569",border:"1px solid #e2e8f0"},children:"Annuler"}),n.jsx("button",{className:"btn",onClick:()=>{Ae(!1),t(`${s?"/aefe":"/subadmin"}/signature`)},style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",color:"white",boxShadow:"0 2px 8px rgba(220, 38, 38, 0.3)"},children:" Ajouter ma signature"})]}),children:n.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[n.jsx("div",{style:{width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"3px solid #fecaca",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",fontSize:36},children:""}),n.jsx("p",{style:{fontSize:16,color:"#1e293b",marginBottom:12,fontWeight:500},children:"Vous devez d'abord ajouter votre signature"}),n.jsx("p",{style:{fontSize:14,color:"#64748b",lineHeight:1.5},children:"Pour signer les carnets des lves, vous devez tlcharger une image de votre signature. Cette signature sera automatiquement insre dans les carnets que vous signez."})]})}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:[" Examen du carnet - ",c?`${c.firstName} ${c.lastName}`:"lve"]}),n.jsx("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:n.jsx("button",{className:"btn secondary",onClick:()=>t(a),style:{display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0",padding:"8px 12px"},children:" Retour au tableau de bord"})})]}),ye&&!s&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{fontSize:14,fontWeight:500,color:je?"#10b981":"#64748b"},children:je?"Mode dition":"Mode Lecture"}),n.jsx("div",{onClick:()=>ve(!je),style:{width:48,height:24,background:je?"#10b981":"#cbd5e1",borderRadius:12,position:"relative",cursor:"pointer",transition:"background 0.3s ease"},children:n.jsx("div",{style:{width:20,height:20,background:"white",borderRadius:"50%",position:"absolute",top:2,left:je?26:2,transition:"left 0.3s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})})]})]}),n.jsxs("div",{style:{marginTop:14,display:"flex",flexWrap:"wrap",gap:12,alignItems:"stretch",padding:14,background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("div",{style:{flex:"1 1 240px",minWidth:220},children:n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[n.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#334155",background:"white",border:"1px solid #e2e8f0",borderRadius:999,padding:"6px 12px"},children:["Niveau: ",(c==null?void 0:c.level)||""]}),n.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#334155",background:"white",border:"1px solid #e2e8f0",borderRadius:999,padding:"6px 12px"},children:["Classe: ",(c==null?void 0:c.className)||""]}),n.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#1e40af",background:"#dbeafe",border:"1px solid #93c5fd",borderRadius:999,padding:"6px 12px"},children:["Semestre ",ae]})]})}),n.jsxs("div",{style:{flex:"2 1 520px",display:"flex",flexWrap:"wrap",gap:10,alignItems:"stretch"},children:[ir("Arabe","arabic"),ir("Anglais","english"),ir("Polyvalent","polyvalent")]})]}),n.jsxs("div",{className:"note",style:{marginTop:8,fontSize:13},children:[n.jsx("span",{style:{fontWeight:500},children:"Statut:"})," ",(d==null?void 0:d.status)==="signed"?" Sign ":(d==null?void 0:d.status)==="completed"?" Termin":d==null?void 0:d.status]}),z&&n.jsx("div",{className:"note",style:{marginTop:12,color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca"},children:z}),!s&&n.jsxs("div",{style:{marginTop:20,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[h?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"note",style:{padding:12,background:"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)",borderRadius:8,border:"1px solid #6ee7b7",color:"#065f46",fontWeight:500},children:[" Sign le ",new Date(h.signedAt).toLocaleString("fr-FR")]}),n.jsx("button",{className:"btn",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(245, 158, 11, 0.3)"},onClick:Ie,disabled:$,children:$?" Annulation...":" Annuler la signature"})]}):n.jsx("button",{className:"btn",onClick:Se,disabled:w||!J||!(d!=null&&d.isCompletedSem1||d!=null&&d.isCompleted),style:{background:J&&(d!=null&&d.isCompletedSem1||d!=null&&d.isCompleted)?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#cbd5e1",fontWeight:500,padding:"12px 20px",boxShadow:J&&(d!=null&&d.isCompletedSem1||d!=null&&d.isCompleted)?"0 2px 8px rgba(16, 185, 129, 0.3)":"none",cursor:J&&(d!=null&&d.isCompletedSem1||d!=null&&d.isCompleted)?"pointer":"not-allowed"},title:J?d!=null&&d.isCompletedSem1||d!=null&&d.isCompleted?"":"Semestre 1 non termin":"Le carnet n'est pas prt pour la signature",children:w?" Signature...":" Signer ce carnet"}),g?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"note",style:{padding:12,background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",borderRadius:8,border:"1px solid #93c5fd",color:"#1e40af",fontWeight:500},children:[" Sign fin anne le ",new Date(g.signedAt).toLocaleString("fr-FR")]}),n.jsx("button",{className:"btn",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(245, 158, 11, 0.3)"},onClick:ht,disabled:O,children:O?" Annulation...":" Annuler la signature fin anne"})]}):n.jsx("button",{className:"btn",onClick:Re,disabled:q||!(d!=null&&d.isCompletedSem2)||ae!==2,style:{background:!(d!=null&&d.isCompletedSem2)||ae!==2?"#cbd5e1":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",fontWeight:500,padding:"12px 20px",boxShadow:!(d!=null&&d.isCompletedSem2)||ae!==2?"none":"0 2px 8px rgba(59, 130, 246, 0.3)",cursor:!(d!=null&&d.isCompletedSem2)||ae!==2?"not-allowed":"pointer"},title:ae!==2?"Le semestre 2 n'est pas encore actif":d!=null&&d.isCompletedSem2?"":"L'enseignant n'a pas encore termin ce carnet (Semestre 2)",children:q?" Signature...":" Signer ce carnet fin annes"}),(c==null?void 0:c.level)&&Wt(c.level)&&n.jsx("button",{className:"btn",onClick:Zt,disabled:ce||I||!g,style:{background:I||!g?"#cbd5e1":"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",fontWeight:500,padding:"12px 20px",boxShadow:I||!g?"none":"0 2px 8px rgba(139, 92, 246, 0.3)",color:I||!g?"#64748b":"white",border:"none",cursor:I||!g?"not-allowed":"pointer"},title:I?"lve dj promu cette anne":g?"":"Vous devez signer le carnet (fin anne) avant de promouvoir l'lve",children:ce?" Promotion...":I?"Dj promu":`Passer en classe suprieure ${Wt(c.level)}`}),n.jsx("button",{className:"btn secondary",onClick:Et,style:{background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0",padding:"12px 20px"},children:" Exporter en PDF"})]}),n.jsxs("div",{style:{marginTop:20,marginBottom:16,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",padding:16,background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>_(!j),style:{background:j?"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)":"#f1f5f9",color:j?"white":"#475569",fontWeight:500,border:"1px solid #cbd5e1",padding:"10px 16px"},children:j?" Vue page par page":" Vue continue"}),n.jsx("div",{style:{height:24,width:1,background:"#cbd5e1",margin:"0 8px"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"white",padding:"4px 8px",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>{te(!1),ne($e=>Math.max(.2,$e-.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom Out",children:""}),n.jsxs("span",{style:{fontSize:13,fontWeight:600,minWidth:40,textAlign:"center"},children:[Math.round(Z*100),"%"]}),n.jsx("button",{className:"btn secondary",onClick:()=>{te(!1),ne($e=>Math.min(2,$e+.1))},style:{padding:"6px 10px",fontSize:16,lineHeight:1},title:"Zoom In",children:"+"})]}),n.jsx("button",{className:"btn secondary",onClick:()=>{ee?(te(!1),ne(1)):(ne(me()),te(!0))},style:{background:ee?"#e0e7ff":"white",color:ee?"#4338ca":"#475569",border:"1px solid #e2e8f0",padding:"8px 12px",fontWeight:500},children:ee?" Ajust":" Ajuster"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>k(Math.max(0,S-1)),disabled:S===0||j,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:S===0||j?.5:1},children:" Prcdent"}),n.jsx("select",{value:S,onChange:$e=>{const He=Number($e.target.value);k(He),j&&setTimeout(()=>{const Ge=document.getElementById(`page-${He}`);Ge&&Ge.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white"},children:o.pages.map(($e,He)=>n.jsx("option",{value:He,children:$e.title||`Page ${He+1}`},He))}),n.jsx("button",{className:"btn secondary",onClick:()=>k(Math.min(o.pages.length-1,S+1)),disabled:S===o.pages.length-1||j,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:S===o.pages.length-1||j?.5:1},children:"Suivant "})]})]}),n.jsx("div",{ref:ie,style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center",overflowX:"hidden",width:"100%"},children:(j?o.pages:[o.pages[S]]).map(($e,He)=>{const Ge=j?He:S;return n.jsx("div",{style:{width:Ey*Z,height:f_*Z,position:"relative",transition:"width 0.2s ease-out, height 0.2s ease-out"},children:n.jsxs("div",{id:`page-${Ge}`,className:"card page-canvas",style:{height:f_,width:Ey,background:$e.bgColor||"#fff",overflow:"hidden",position:"absolute",top:0,left:0,transform:`scale(${Z})`,transformOrigin:"top left",transition:"transform 0.2s ease-out",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",border:"1px solid #e2e8f0"},children:[j&&n.jsxs("div",{style:{position:"absolute",top:-30,left:0,color:"#888",fontSize:14,fontWeight:600},children:["Page ",Ge+1]}),n.jsx("div",{className:"page-margins"}),$e.blocks.map((R,_e)=>{var _t,mr,yr,Kt,Sr;if(!R||!R.props)return null;const We=Ct(R);if(Ve(We))return null;const jt=typeof((_t=R==null?void 0:R.props)==null?void 0:_t.blockId)=="string"&&R.props.blockId.trim()?R.props.blockId.trim():null,Ht=Oe(o==null?void 0:o._id,Ge,_e,jt);let Yt=!0;if(We){const Me=(yr=(mr=G==null?void 0:G[We.toUpperCase()])==null?void 0:mr.subadmin)==null?void 0:yr[Ht],{hasSem1:rt,hasSem2:wt}=tt(We);Me&&(Me==="never"||Me==="after_sem1"&&!rt&&!wt||Me==="after_sem2"&&!wt)&&(Yt=!1)}else{const Me=((c==null?void 0:c.level)||"PS").toUpperCase(),rt=Fe[Me]??99,wt=Object.keys(Fe).filter(gt=>Fe[gt]<=rt);let ut=!1,Bt=!1;for(const gt of wt){const yt=(Sr=(Kt=G==null?void 0:G[gt])==null?void 0:Kt.subadmin)==null?void 0:Sr[Ht];if(yt){ut=!0;const{hasSem1:bt,hasSem2:$t}=tt(gt);if(yt==="always"){Bt=!0;break}else if(yt==="after_sem1"&&(bt||$t)){Bt=!0;break}else if(yt==="after_sem2"&&$t){Bt=!0;break}}}Yt=!ut||Bt}return Yt?n.jsxs("div",{style:{position:"absolute",left:R.props.x||0,top:R.props.y||0,zIndex:R.props.z??_e,padding:6},children:[R.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:R.props.direction||"row",alignItems:"center",justifyContent:"center",gap:R.props.spacing||12,background:R.props.backgroundColor||"transparent",borderRadius:R.props.borderRadius||12,padding:R.props.padding||8,width:R.props.width,height:R.props.height,boxSizing:"border-box"},children:(R.props.items||[]).map((Me,rt)=>{const wt=!(Me.levels&&Me.levels.length>0&&(c!=null&&c.level)&&!Me.levels.includes(c.level)),ut=de.length===0||!(Me.levels&&Me.levels.length>0)||Me.levels.some(xe=>de.includes(xe)),Bt=wt&&ut,gt=40,yt=xe=>{const pt=xe.emoji;if(pt&&pt.length>=2)return pt;const at=(xe.code||"").toLowerCase();return at==="lb"||at==="ar"?"":at==="fr"?"":at==="en"||at==="uk"||at==="gb"?"":""},bt=yt(Me),$t=`https://emojicdn.elk.sh/${bt}?style=apple`;return n.jsx("div",{title:Me.label,style:{width:gt,height:gt,minWidth:gt,borderRadius:"50%",background:Me.active?"#fff":"rgba(255, 255, 255, 0.5)",border:Me.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:je&&ye?Bt?"pointer":"not-allowed":"default",boxShadow:Me.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",transition:"all 0.2s ease",transform:Me.active?"scale(1.1)":"scale(1)",opacity:Bt?Me.active?1:je&&ye?.6:.9:Me.active?.9:.5,filter:"none"},onClick:xe=>{if(xe.stopPropagation(),!je||!ye||!Bt)return;const pt=[...R.props.items||[]];pt[rt]={...pt[rt],active:!pt[rt].active},fe(Ge,_e,pt)},onMouseEnter:xe=>xe.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",onMouseLeave:xe=>xe.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)",children:bt?n.jsx("img",{src:$t,style:{width:gt*.9,height:gt*.9,objectFit:"contain"},alt:""}):Me.logo?n.jsx("img",{src:Me.logo,style:{width:gt*.9,height:gt*.9,objectFit:"contain"},alt:""}):n.jsx("span",{style:{fontSize:20,lineHeight:1},children:yt(Me)})},rt)})}),R.type==="text"&&n.jsx("div",{style:{color:R.props.color,fontSize:R.props.fontSize,fontWeight:R.props.bold?700:400,textDecoration:R.props.underline?"underline":"none",width:R.props.width,height:R.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(R.props.runs)&&R.props.runs.length?R.props.runs.map((Me,rt)=>n.jsx("span",{style:{color:Me&&typeof Me=="object"&&typeof Me.color=="string"&&Me.color?Me.color:R.props.color||void 0,fontWeight:Me&&typeof Me=="object"&&typeof Me.bold=="boolean"?Me.bold?700:400:R.props.bold?700:400,textDecoration:Me&&typeof Me=="object"&&typeof Me.underline=="boolean"?Me.underline?"underline":"none":R.props.underline?"underline":"none"},children:(Me==null?void 0:Me.text)||""},rt)):R.props.text}),R.type==="image"&&n.jsx(Fo,{src:R.props.url,displayWidth:R.props.width||120,displayHeight:R.props.height||120,cropData:R.props.cropData,borderRadius:8}),R.type==="student_photo"&&(c!=null&&c.avatarUrl?n.jsx("img",{src:c.avatarUrl,style:{width:R.props.width||100,height:R.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:R.props.width||100,height:R.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),R.type==="rect"&&n.jsx("div",{style:{width:R.props.width,height:R.props.height,background:R.props.color,borderRadius:R.props.radius||8,border:R.props.stroke?`${R.props.strokeWidth||1}px solid ${R.props.stroke}`:"none"}}),R.type==="circle"&&n.jsx("div",{style:{width:(R.props.radius||60)*2,height:(R.props.radius||60)*2,background:R.props.color,borderRadius:"50%",border:R.props.stroke?`${R.props.strokeWidth||1}px solid ${R.props.stroke}`:"none"}}),R.type==="gradebook_pocket"&&n.jsx(nc,{number:R.props.number||"1",width:R.props.width||120,fontSize:R.props.fontSize}),R.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:R.props.spacing||12},children:(R.props.items||[]).map((Me,rt)=>{const wt=!(Me.levels&&Me.levels.length>0&&(c!=null&&c.level)&&!Me.levels.includes(c.level)),ut=de.length===0||!(Me.levels&&Me.levels.length>0)||Me.levels.some(bt=>de.includes(bt)),Bt=wt&&ut,yt=(R.props.radius||40)*2;return n.jsx("div",{style:{width:yt,height:yt,borderRadius:"50%",overflow:"hidden",position:"relative",cursor:je&&ye?Bt?"pointer":"not-allowed":"default",boxShadow:Me.active?"0 0 0 3px #6c5ce7":"0 0 0 1px #ddd",transition:"all 0.2s ease",opacity:Bt?je&&ye||Me.active?1:.9:Me.active?.9:.5},onClick:bt=>{if(bt.stopPropagation(),!je||!ye||!Bt)return;const $t=[...R.props.items||[]];$t[rt]={...$t[rt],active:!$t[rt].active},fe(Ge,_e,$t)},children:Me.logo?n.jsx("img",{src:Me.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:Me.active?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},rt)})}),R.type==="line"&&n.jsx("div",{style:{width:R.props.x2||100,height:R.props.strokeWidth||2,background:R.props.stroke||"#b2bec3"}}),R.type==="arrow"&&n.jsx("div",{style:{width:R.props.x2||100,height:R.props.strokeWidth||2,background:R.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${R.props.stroke||"#6c5ce7"}`}})}),R.type==="dynamic_text"&&n.jsx("div",{style:{color:R.props.color,fontSize:R.props.fontSize,width:R.props.width,height:R.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let Me=R.props.text||"";if(c){const rt=String((c==null?void 0:c.fatherName)||(c==null?void 0:c.parentName)||"").trim(),wt=rt?rt.charAt(0).toUpperCase():"",ut=wt?`${wt}.`:"",Bt=[c.firstName,ut,c.lastName].filter(Boolean).join(" "),gt=c.dateOfBirth?new Date(c.dateOfBirth):new Date(NaN),yt=isNaN(gt.getTime())?"":`${String(gt.getUTCDate()).padStart(2,"0")}/${String(gt.getUTCMonth()+1).padStart(2,"0")}/${String(gt.getUTCFullYear())}`;Me=Me.replace(/{student.firstName}/g,c.firstName).replace(/{student.lastName}/g,c.lastName).replace(/{student.dob}/g,c.dateOfBirth?new Date(c.dateOfBirth).toLocaleDateString():"").replace(/{student.fatherInitial}/g,ut).replace(/{student.fullNameFatherInitial}/g,Bt).replace(/{student.dob_ddmmyyyy}/g,yt)}return d!=null&&d.data&&Object.entries(d.data).forEach(([rt,wt])=>{Me=Me.replace(new RegExp(`{${rt}}`,"g"),String(wt))}),Me})()}),R.type==="student_info"&&n.jsx("div",{style:{color:R.props.color,fontSize:R.props.fontSize,width:R.props.width,height:R.props.height,overflow:"hidden"},children:"Nom, Classe, Naissance"}),R.type==="category_title"&&n.jsx("div",{style:{color:R.props.color,fontSize:R.props.fontSize,width:R.props.width,height:R.props.height,overflow:"hidden"},children:"Titre catgorie"}),R.type==="competency_list"&&n.jsx("div",{style:{color:R.props.color,fontSize:R.props.fontSize,width:R.props.width,height:R.props.height,overflow:"hidden"},children:"Liste des comptences"}),R.type==="dropdown"&&(()=>{const Me=we(void 0,R.props.levels,c==null?void 0:c.level),wt=(R.props.semesters||[1,2]).includes(ae),ut=de.length===0||!(R.props.levels&&R.props.levels.length>0)||R.props.levels.some(gt=>de.includes(gt)),Bt=Me&&wt&&ut;return n.jsxs("div",{style:{width:R.props.width||200,position:"relative",opacity:Bt?1:.5,pointerEvents:Bt?"auto":"none"},children:[n.jsxs("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:["Dropdown #",R.props.dropdownNumber||"?"]}),R.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:R.props.label}),n.jsxs("div",{style:{width:"100%",minHeight:R.props.height||32,fontSize:R.props.fontSize||12,color:R.props.color||"#333",padding:"4px 24px 4px 8px",borderRadius:4,border:"1px solid #ccc",background:je&&ye&&Bt?"#fff":"#f9f9f9",cursor:je&&ye&&Bt?"pointer":"default",position:"relative",display:"flex",alignItems:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},onClick:gt=>{if(gt.stopPropagation(),!je||!ye||!Bt)return;const yt=`dropdown_${Ge}_${_e}`;oe(le===yt?null:yt)},children:[(()=>{const gt=R.props.dropdownNumber?`dropdown_${R.props.dropdownNumber}`:R.props.variableName,yt=Ct(R);return Mt(gt||"",yt)||"Slectionner..."})(),n.jsx("div",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:""})]}),le===`dropdown_${Ge}_${_e}`&&n.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,maxHeight:300,overflowY:"auto",background:"#fff",border:"1px solid #ccc",borderRadius:4,marginTop:2,zIndex:9999,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onClick:gt=>gt.stopPropagation(),children:[n.jsx("div",{style:{padding:"8px 12px",cursor:"pointer",fontSize:R.props.fontSize||12,color:"#999",borderBottom:"1px solid #eee"},onClick:async gt=>{if(gt.stopPropagation(),!(!je||!ye||!Bt)){if(d){const yt=R.props.dropdownNumber?`dropdown_${R.props.dropdownNumber}`:R.props.variableName,bt=Ct(R);yt&&await St(yt,bt,"")}oe(null)}},onMouseEnter:gt=>gt.currentTarget.style.background="#f5f5f5",onMouseLeave:gt=>gt.currentTarget.style.background="#fff",children:"Slectionner..."}),(R.props.options||[]).map((gt,yt)=>n.jsx("div",{style:{padding:"8px 12px",cursor:je&&ye&&Bt?"pointer":"default",fontSize:R.props.fontSize||12,wordWrap:"break-word",whiteSpace:"pre-wrap",borderBottom:yt<(R.props.options||[]).length-1?"1px solid #eee":"none",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},onClick:async bt=>{if(bt.stopPropagation(),!(!je||!ye||!Bt)){if(d){const $t=R.props.dropdownNumber?`dropdown_${R.props.dropdownNumber}`:R.props.variableName,xe=Ct(R);$t&&await St($t,xe,gt)}oe(null)}},onMouseEnter:bt=>bt.currentTarget.style.background="#e8ecf8",onMouseLeave:bt=>bt.currentTarget.style.background="#fff",children:n.jsx("span",{children:gt})},yt))]})]})})(),R.type==="dropdown_reference"&&(()=>{var ut;const Me=R.props.dropdownNumber||1,rt=(ut=d==null?void 0:d.data)==null?void 0:ut[`dropdown_${Me}`],wt=typeof rt=="string"?rt.trim():rt;return wt?n.jsx("div",{style:{color:R.props.color||"#333",fontSize:R.props.fontSize||12,width:R.props.width||200,minHeight:R.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:String(wt)}):null})(),R.type==="promotion_info"&&n.jsx("div",{style:{width:R.props.width||(R.props.field?150:300),height:R.props.height||(R.props.field?30:100),border:R.props.field?"none":"1px solid #6c5ce7",padding:R.props.field?0:10,borderRadius:8,fontSize:R.props.fontSize||12,color:R.props.color||"#2d3436",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:(()=>{var Bt,gt;const Me=((Bt=d==null?void 0:d.data)==null?void 0:Bt.promotions)||[],rt=Ct(R),wt=R.props.targetLevel;let ut=null;if(wt&&(ut=Me.find(yt=>yt.to===wt)),!ut&&rt&&(ut=Me.find(yt=>yt.from===rt)),!ut&&!wt&&!rt&&Me.length===1&&(ut={...Me[0]}),!ut&&rt){const yt=((gt=d==null?void 0:d.data)==null?void 0:gt.signatures)||[],bt=R.props.period==="mid-year",$t=R.props.period==="end-year",pt=yt.filter(at=>{if($t){if(at.type!=="end_of_year")return!1}else if(bt&&at.type&&at.type!=="standard")return!1;return!(at.level&&at.level!==rt)}).sort((at,fr)=>{const Dn=new Date(at.signedAt||0).getTime();return new Date(fr.signedAt||0).getTime()-Dn})[0];if(pt){let at=pt.schoolYearName;if(!at&&pt.signedAt){const sn=new Date(pt.signedAt),gn=sn.getFullYear(),kr=sn.getMonth()>=8?gn:gn-1;at=`${kr}/${kr+1}`}if(!at){const gn=new Date().getFullYear();at=`${gn}/${gn+1}`}const fr=rt,Dn=wt||Wt(fr||"")||"";ut={year:at,from:fr,to:Dn||"?",class:(c==null?void 0:c.className)||""}}}if(ut)!ut.class&&(c!=null&&c.className)&&(ut.class=c.className),ut.from||(rt?ut.from=rt:c!=null&&c.level&&(ut.from=c.level));else{const yt=!!rt&&!!(c!=null&&c.level)&&rt===c.level;if(!(R.props.period==="mid-year"?!!h&&(yt||!rt&&Me.length===0):!!g&&(yt||!rt&&Me.length===0)))return null;let at=0;if(Q&&Q.name){const gn=Q.name.match(/(\d{4})/);gn&&(at=parseInt(gn[1],10))}if(!at)return null;const fr=rt||(c==null?void 0:c.level)||"",Dn=wt||Wt(fr||"")||"";ut={year:`${at}/${at+1}`,from:fr,to:Dn||"?",class:(c==null?void 0:c.className)||""}}if(ut)if(R.props.field){if(R.props.field==="level")return n.jsx("div",{style:{fontWeight:"bold"},children:ut.to});if(R.props.field==="student")return n.jsxs("div",{children:[c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]});if(R.props.field==="studentFirstName")return n.jsx("div",{children:c==null?void 0:c.firstName});if(R.props.field==="studentLastName")return n.jsx("div",{children:c==null?void 0:c.lastName});if(R.props.field==="year")return n.jsx("div",{children:ft(ut,rt)});if(R.props.field==="currentYear"){const yt=vt(ut,rt,R.props.period)||(Q==null?void 0:Q.name)||"";return n.jsx("div",{children:String(yt)})}else if(R.props.field==="class"){const yt=ut.class||"",bt=yt.split(/\s*[-\s]\s*/),$t=bt.length?bt[bt.length-1]:yt;return n.jsx("div",{children:$t})}else if(R.props.field==="currentLevel")return n.jsx("div",{children:ut.from||""})}else return n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",ut.to]}),n.jsxs("div",{children:[c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]}),n.jsxs("div",{style:{fontSize:(R.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Next Year ",ft(ut,rt)]})]});return null})()}),R.type==="teacher_text"&&n.jsxs("div",{style:{width:R.props.width||300,height:R.props.height||60,border:"1px solid #ddd",borderRadius:4,padding:8,fontSize:R.props.fontSize||12,color:R.props.color||"#2d3436",background:"#f9f9f9",position:"relative",whiteSpace:"pre-wrap"},children:[(()=>{var wt;if(R.props.level&&(c!=null&&c.level)&&R.props.level!==c.level)return null;const Me=R.id||`teacher_text_${Ge}_${_e}`,rt=((wt=d==null?void 0:d.data)==null?void 0:wt[Me])||"";return n.jsx("div",{style:{width:"100%",height:"100%",color:rt?"inherit":"#999"},children:rt||R.props.placeholder||"Texte ditable par le prof polyvalent..."})})(),R.props.label&&n.jsx("div",{style:{position:"absolute",top:-10,left:8,background:"#fff",padding:"2px 6px",fontSize:10,color:"#e17055",fontWeight:"bold"},children:R.props.label})]}),R.type==="table"&&(()=>{const Me=Or=>{const kr=typeof Or=="number"?Or:parseFloat(String(Or||"0"));return isNaN(kr)?0:kr},rt=(R.props.columnWidths||[]).map(Me),wt=(R.props.rowHeights||[]).map(Me),ut=R.props.cells||[],Bt=Me(R.props.colGap),gt=Me(R.props.rowGap),yt=R.props.expandedRows||!1,bt=Me(R.props.expandedRowHeight||34),$t=Me(R.props.expandedDividerWidth||.5),xe=R.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",pt=4,at=6,fr=R.props.expandedLanguages||[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}],Dn=R.props.expandedToggleStyle||"v2";let sn=0;for(let Or=0;Or<rt.length;Or++)sn+=rt[Or]||0,sn+=Bt;rt.length>0&&(sn-=Bt);let gn=0;for(let Or=0;Or<wt.length;Or++)gn+=wt[Or]||0,yt&&(gn+=bt+pt),gn+=gt;return wt.length>0&&(gn-=gt),n.jsx("div",{style:{position:"relative",width:sn,height:gn,display:yt?"flex":"grid",flexDirection:"column",gap:`${gt}px ${Bt}px`,gridTemplateColumns:yt?void 0:rt.map(Or=>`${Math.max(1,Math.round(Or))}px`).join(" "),gridTemplateRows:yt?void 0:wt.map(Or=>`${Math.max(1,Math.round(Or))}px`).join(" "),overflow:"visible",background:gt>0||Bt>0?"transparent":R.props.backgroundColor||"transparent",borderRadius:gt>0||Bt>0?0:R.props.borderRadius||0},children:yt?ut.map((Or,kr)=>{var jr;const Ye=R.props.borderRadius||0,qt=kr===0,zs=kr===wt.length-1,ys=gt>0,mi=((jr=Or[0])==null?void 0:jr.fill)||R.props.backgroundColor||"#f8f9fa",_r=wt[kr]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",marginBottom:yt&&!zs?gt:0},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:rt.map(Jt=>`${Math.max(1,Math.round(Jt))}px`).join(" "),columnGap:Bt,height:_r},children:Or.map((Jt,Mn)=>{var yi,vi,tl,rl;const vs=(yi=Jt==null?void 0:Jt.borders)==null?void 0:yi.l,is=(vi=Jt==null?void 0:Jt.borders)==null?void 0:vi.r,mn=(tl=Jt==null?void 0:Jt.borders)==null?void 0:tl.t;(rl=Jt==null?void 0:Jt.borders)==null||rl.b;const da=Mn===0,eo=Mn===rt.length-1,xi={background:(Jt==null?void 0:Jt.fill)||(ys&&R.props.backgroundColor?R.props.backgroundColor:"transparent"),borderLeft:vs!=null&&vs.width?`${vs.width}px solid ${vs.color||"#000"}`:"none",borderRight:is!=null&&is.width?`${is.width}px solid ${is.color||"#000"}`:"none",borderTop:mn!=null&&mn.width?`${mn.width}px solid ${mn.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:da&&(ys||qt)?Ye:0,borderTopRightRadius:eo&&(ys||qt)?Ye:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:xi,children:(Jt==null?void 0:Jt.text)&&n.jsx("div",{style:{fontSize:Jt.fontSize||12,color:Jt.color||"#000",whiteSpace:"pre-wrap"},children:Jt.text})},`cell-${kr}-${Mn}`)})}),n.jsxs("div",{style:{background:mi,borderBottomLeftRadius:ys||zs?Ye:0,borderBottomRightRadius:ys||zs?Ye:0,height:bt,position:"relative",paddingBottom:pt},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:$t,background:xe,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:at,gap:8},children:(()=>{var vi,tl,rl;const Jt=typeof((vi=R==null?void 0:R.props)==null?void 0:vi.blockId)=="string"&&R.props.blockId.trim()?R.props.blockId.trim():null,Mn=Array.isArray((tl=R==null?void 0:R.props)==null?void 0:tl.rowIds)?R.props.rowIds:[],vs=typeof(Mn==null?void 0:Mn[kr])=="string"&&Mn[kr].trim()?Mn[kr].trim():null,is=Jt&&vs?`table_${Jt}_row_${vs}`:null,mn=`table_${Ge}_${_e}_row_${kr}`,da=is||mn,eo=((rl=R.props.rowLanguages)==null?void 0:rl[kr])||fr,xi=Ct(R),yi=(is?Mt(is,xi):null)||Mt(mn,xi)||eo;return yi.map((bi,Fi)=>{const Qp=we(bi.level,bi.levels,c==null?void 0:c.level),zd=de.length===0||!bi.level||de.includes(bi.level),to=je&&ye&&(Qp&&zd),pa=Math.max(12,Math.min(bt-12,20)),fa=bi.active;if(Dn==="v1"){const ha=bi.logo||(()=>{const xn=(bi.code||"").toLowerCase();return xn==="en"||xn==="uk"||xn==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":xn==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":xn==="ar"||xn==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:pa,height:pa,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:fa?"0 0 0 2px #6c5ce7":"none",opacity:fa?1:to?.6:.5,cursor:to?"pointer":"default"},onClick:async xn=>{if(xn.stopPropagation(),!to)return;const Kn=[...yi];Kn[Fi]={...Kn[Fi],active:!Kn[Fi].active},d&&await St(da,xi,Kn)},children:ha?n.jsx("img",{src:ha,style:{width:"100%",height:"100%",objectFit:"cover",filter:fa?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},Fi)}const gx=`https://emojicdn.elk.sh/${(ha=>{const xn=ha.emoji;if(xn&&xn.length>=2)return xn;const Kn=(ha.code||"").toLowerCase();return Kn==="lb"||Kn==="ar"?"":Kn==="fr"?"":Kn==="en"||Kn==="uk"||Kn==="gb"?"":""})(bi)}?style=apple`;return n.jsx("div",{title:bi.label,style:{width:pa,height:pa,minWidth:pa,borderRadius:"50%",background:fa?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:fa?"scale(1.1)":"scale(1)",boxShadow:"none",opacity:fa?1:to?.6:.5,cursor:to?"pointer":"default"},onClick:async ha=>{if(ha.stopPropagation(),!to)return;const xn=[...yi];xn[Fi]={...xn[Fi],active:!xn[Fi].active},d&&await St(da,xi,xn)},children:n.jsx("img",{src:gx,style:{width:pa*.9,height:pa*.9,objectFit:"contain"},alt:""})},Fi)})})()})]})]},`row-unit-${kr}`)}):ut.flatMap((Or,kr)=>Or.map((Ye,qt)=>{var eo,xi,yi,vi;const zs=(eo=Ye==null?void 0:Ye.borders)==null?void 0:eo.l,ys=(xi=Ye==null?void 0:Ye.borders)==null?void 0:xi.r,mi=(yi=Ye==null?void 0:Ye.borders)==null?void 0:yi.t,_r=(vi=Ye==null?void 0:Ye.borders)==null?void 0:vi.b,jr=R.props.borderRadius||0,Jt=qt===0,Mn=qt===rt.length-1,vs=kr===0,is=kr===wt.length-1,mn=gt>0,da={background:(Ye==null?void 0:Ye.fill)||(mn&&R.props.backgroundColor?R.props.backgroundColor:"transparent"),borderLeft:zs!=null&&zs.width?`${zs.width}px solid ${zs.color||"#000"}`:"none",borderRight:ys!=null&&ys.width?`${ys.width}px solid ${ys.color||"#000"}`:"none",borderTop:mi!=null&&mi.width?`${mi.width}px solid ${mi.color||"#000"}`:"none",borderBottom:_r!=null&&_r.width?`${_r.width}px solid ${_r.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Jt&&(mn||vs)?jr:0,borderBottomLeftRadius:Jt&&(mn||is)?jr:0,borderTopRightRadius:Mn&&(mn||vs)?jr:0,borderBottomRightRadius:Mn&&(mn||is)?jr:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:da,children:(Ye==null?void 0:Ye.text)&&n.jsx("div",{style:{fontSize:Ye.fontSize||12,color:Ye.color||"#000",whiteSpace:"pre-wrap"},children:Ye.text})},`${kr}-${qt}`)}))})})(),R.type==="qr"&&n.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=${R.props.width||120}x${R.props.height||120}&data=${encodeURIComponent(R.props.url||"")}`,style:{width:R.props.width||120,height:R.props.height||120},alt:"QR Code"}),R.type==="signature"&&n.jsx("div",{style:{fontSize:R.props.fontSize},children:(R.props.labels||[]).join(" / ")}),R.type==="signature_date"&&(()=>{var pt,at;const Me=String(((pt=R.props)==null?void 0:pt.level)||Ct(R)||"").trim()||null,rt=Ot(R),wt=et({level:Me,semester:rt});if(!wt)return null;const ut=am(wt.signedAt),Bt=((at=R.props)==null?void 0:at.showMeta)!==!1,gt="Sign le:",yt=rt?`S${rt}`:"",bt=Me||"",$t=`${bt}${bt&&yt?" ":""}${yt}`,xe=Bt?`${gt}${$t?` ${$t}`:""} ${ut}`:`${gt} ${ut}`;return n.jsx("div",{style:{width:R.props.width||220,height:R.props.height||34,display:"flex",alignItems:"center",justifyContent:R.props.align||"flex-start",fontSize:R.props.fontSize||12,color:R.props.color||"#111",overflow:"hidden",whiteSpace:"nowrap"},children:xe})})(),R.type==="final_signature_box"&&n.jsx("div",{style:{width:R.props.width||200,height:R.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(()=>{var ut,Bt;if(g)return" Sign Fin Anne";const Me=((ut=d==null?void 0:d.data)==null?void 0:ut.signatures)||[],rt=((Bt=d==null?void 0:d.data)==null?void 0:Bt.promotions)||[],wt=Ct(R);if(wt){const gt=Me.find(yt=>{if(yt.type!=="end_of_year")return!1;if(yt.schoolYearName){const bt=rt.find($t=>$t.year===yt.schoolYearName);if(bt&&bt.from===wt)return!0}return!1});if(gt)return` Sign (${gt.schoolYearName||"Ancien"})`}return null})()}),R.type==="final_signature_info"&&n.jsx("div",{style:{width:R.props.width||150,height:R.props.height||30,fontSize:R.props.fontSize||12,color:R.props.color||"#333",display:"flex",alignItems:"center",justifyContent:R.props.align||"flex-start"},children:(()=>{var bt,$t;const rt=(((bt=d==null?void 0:d.data)==null?void 0:bt.signatures)||[]).filter(xe=>(xe==null?void 0:xe.type)==="end_of_year").sort((xe,pt)=>{const at=new Date(xe.signedAt||0).getTime();return new Date(pt.signedAt||0).getTime()-at})[0];if(!(!!rt||!!g))return n.jsx("span",{style:{color:"#ccc"},children:R.props.placeholder||"..."});const ut=rt&&(rt.schoolYearName||"")||new Date().getFullYear(),Bt=(($t=d==null?void 0:d.data)==null?void 0:$t.promotions)||[],gt=rt?Bt.find(xe=>String(xe.year)===String(rt.schoolYearName)):null,yt=gt?gt.to:Wt((c==null?void 0:c.level)||"");return R.props.field==="year"?n.jsx("span",{children:String(ut)}):R.props.field==="student"?n.jsxs("span",{children:[c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]}):R.props.field==="studentFirstName"?n.jsx("span",{children:c==null?void 0:c.firstName}):R.props.field==="studentLastName"?n.jsx("span",{children:c==null?void 0:c.lastName}):R.props.field==="nextLevel"?n.jsx("span",{children:yt||""}):null})()}),R.type==="signature_box"&&n.jsx("div",{style:{width:R.props.width||200,height:R.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:(()=>{var gt,yt;const Me=Ct(R),rt=h==null?void 0:h.level,wt=g==null?void 0:g.level;if(Me){if(R.props.period==="end-year"){if(g&&(wt&&wt===Me||!wt&&(c==null?void 0:c.level)===Me)){const bt=g.signatureData||g.signatureUrl;return bt?n.jsx("img",{src:bt,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(h&&(rt&&rt===Me||!rt&&(c==null?void 0:c.level)===Me)){const bt=h.signatureData||h.signatureUrl;return bt?n.jsx("img",{src:bt,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}}else if(R.props.period==="end-year"){if(g){const bt=g.signatureData||g.signatureUrl;return bt?n.jsx("img",{src:bt,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(h){const bt=h.signatureData||h.signatureUrl;return bt?n.jsx("img",{src:bt,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}const ut=((gt=d==null?void 0:d.data)==null?void 0:gt.signatures)||[],Bt=((yt=d==null?void 0:d.data)==null?void 0:yt.promotions)||[];if(Me){const bt=ut.find($t=>{if(R.props.period==="end-year"&&$t.type!=="end_of_year"||(!R.props.period||R.props.period==="mid-year")&&$t.type==="end_of_year")return!1;if($t.level&&$t.level===Me)return!0;if($t.schoolYearName){const xe=Bt.find(pt=>pt.year===$t.schoolYearName);if(xe&&xe.from===Me)return!0}return!1});if(bt){const $t=bt.signatureData||bt.signatureUrl;return $t?n.jsx("img",{src:$t,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${bt.schoolYearName||"Ancien"})`}}return null})()})]},_e):null})]})},Ge)})})]})]})}function Lne(){const e=Sn(),r=wn().pathname.includes("/aefe"),s=r?"/aefe":"/subadmin",i=r?"/aefe/dashboard":"/subadmin/dashboard",[a,o]=p.useState(null),[l,c]=p.useState(!1),[u,d]=p.useState(""),[f,h]=p.useState(""),m=v=>{for(let S=1;S<=3;S++)if(!confirm(`${v}

Confirmation ${S}/3`))return!1;return!0};p.useEffect(()=>{g()},[]);const g=async()=>{var v;try{const S=await K.get(`${s}/signature`);o(S.data.signatureUrl)}catch(S){((v=S.response)==null?void 0:v.status)!==404&&console.error(S)}},x=async v=>{var k;const S=(k=v.target.files)==null?void 0:k[0];if(S){if(!S.type.startsWith("image/")){d("Veuillez slectionner une image");return}try{c(!0),d(""),h("");const j=new FormData;j.append("file",S);const _=await K.post(`${s}/signature/upload`,j,{headers:{"Content-Type":"multipart/form-data"}});o(_.data.signatureUrl),h("Signature enregistre avec succs")}catch(j){d("chec de l'upload de la signature"),console.error(j)}finally{c(!1)}}},y=async()=>{if(m("tes-vous sr de vouloir supprimer votre signature ?"))try{d(""),await K.delete(`${s}/signature`),o(null),h("Signature supprime")}catch(v){d("chec de la suppression"),console.error(v)}};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("button",{className:"btn secondary",onClick:()=>e(i),style:{marginBottom:20,display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0"},children:" Retour au tableau de bord"}),n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:" Ma signature"}),n.jsx("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:"Tlchargez une image de votre signature. Elle sera automatiquement insre dans les carnets lorsque vous les signerez."}),u&&n.jsxs("div",{className:"note",style:{marginTop:16,padding:14,background:"#fef2f2",color:"#dc2626",borderRadius:8,border:"1px solid #fecaca",fontWeight:500},children:[" ",u]}),f&&n.jsxs("div",{className:"note",style:{marginTop:16,padding:14,background:"#d1fae5",color:"#065f46",borderRadius:8,border:"1px solid #6ee7b7",fontWeight:500},children:[" ",f]}),n.jsx("div",{style:{marginTop:28},children:a?n.jsxs("div",{children:[n.jsx("div",{className:"note",style:{marginBottom:14,fontSize:15,fontWeight:600,color:"#475569"},children:" Signature actuelle :"}),n.jsx("div",{style:{padding:24,background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",border:"2px solid #e2e8f0",borderRadius:12,display:"inline-block",maxWidth:"100%",boxShadow:"0 4px 16px rgba(0,0,0,0.08)"},children:n.jsx("img",{src:a,alt:"Signature",style:{maxWidth:400,maxHeight:200,display:"block"}})}),n.jsxs("div",{style:{marginTop:20,display:"flex",gap:12},children:[n.jsxs("label",{className:"btn",style:{background:"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(108, 92, 231, 0.3)",cursor:l?"not-allowed":"pointer",opacity:l?.7:1},children:[l?" Upload...":" Remplacer la signature",n.jsx("input",{type:"file",accept:"image/*",onChange:x,disabled:l,style:{display:"none"}})]}),n.jsx("button",{className:"btn secondary",onClick:y,style:{background:"#fee2e2",color:"#dc2626",border:"1px solid #fecaca",fontWeight:500,padding:"12px 20px"},children:" Supprimer"})]})]}):n.jsxs("div",{children:[n.jsx("div",{className:"note",style:{marginBottom:14,fontSize:15,fontWeight:600,color:"#475569"},children:" Aucune signature enregistre"}),n.jsxs("label",{className:"btn",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(16, 185, 129, 0.3)",cursor:l?"not-allowed":"pointer",opacity:l?.7:1,display:"inline-flex",alignItems:"center",gap:8},children:[l?" Upload...":" Tlcharger une signature",n.jsx("input",{type:"file",accept:"image/*",onChange:x,disabled:l,style:{display:"none"}})]})]})}),n.jsxs("div",{className:"card",style:{marginTop:28,background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",border:"1px solid #e2e8f0"},children:[n.jsx("h3",{style:{fontSize:16,marginBottom:12,color:"#1e293b",fontWeight:600},children:" Conseils"}),n.jsxs("ul",{style:{fontSize:13,color:"#475569",lineHeight:1.8,paddingLeft:20},children:[n.jsx("li",{children:"Utilisez une image sur fond transparent (PNG) pour un meilleur rsultat"}),n.jsx("li",{children:"La signature doit tre claire et lisible"}),n.jsx("li",{children:"Taille recommande : 300-500 pixels de largeur"}),n.jsx("li",{children:"Formats accepts : PNG, JPG, JPEG, GIF"})]})]})]})})}function $ne(){const[e,t]=p.useState([]),[r,s]=p.useState([]),[i,a]=p.useState(!0),[o,l]=p.useState(""),[c,u]=p.useState(null),[d,f]=p.useState(!1),[h,m]=p.useState(!1),[g,x]=p.useState(null),[y,v]=p.useState(""),[S,k]=p.useState(""),[j,_]=p.useState("");p.useEffect(()=>{b()},[]);const b=async()=>{try{a(!0);const[L,O]=await Promise.all([K.get("/subadmin/students"),K.get("/subadmin/classes")]);t(L.data),s(O.data)}catch(L){console.error(L),u({type:"error",text:"Erreur lors du chargement des donnes"})}finally{a(!1)}},A=async()=>{if(!(!g||!y))try{await K.post("/subadmin/assign-student",{studentId:g._id,classId:y}),u({type:"success",text:"lve assign avec succs"}),f(!1),x(null),v(""),b()}catch(L){console.error(L),u({type:"error",text:"Erreur lors de l'assignation"})}},z=L=>{x(L),v(L.classId||""),f(!0)},D=L=>{v(L),k(""),_(""),x(null),m(!0)},w=async()=>{if(!(!y||!S.trim()||!j.trim()))try{await K.post("/students",{firstName:S.trim(),lastName:j.trim(),classId:y}),u({type:"success",text:"lve ajout  la classe avec succs"}),m(!1),x(null),v(""),b()}catch(L){console.error(L),u({type:"error",text:"Erreur lors de l'ajout"})}},N=[],$=new Set;r.forEach(L=>$.add(L.level)),e.forEach(L=>{L.level&&$.add(L.level)}),Array.from($).sort().forEach(L=>{const O=r.filter(W=>W.level===L),B=e.filter(W=>W.level===L),I={};O.forEach(W=>{I[W._id]=B.filter(re=>re.classId===W._id)});const T=B.filter(W=>!W.classId);N.push({level:L,classes:O,unassignedStudents:T,studentsByClass:I})});const q=L=>{if(!o)return L;const O=o.toLowerCase();return L.filter(B=>B.firstName.toLowerCase().includes(O)||B.lastName.toLowerCase().includes(O))};return n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"title",children:"Gestion des lves"}),c&&n.jsx(ca,{message:c.text,type:c.type,onClose:()=>u(null)}),n.jsx("div",{style:{marginBottom:20},children:n.jsx("input",{placeholder:"Rechercher un lve...",value:o,onChange:L=>l(L.target.value),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #ddd"}})}),i?n.jsx("div",{children:"Chargement..."}):n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:30},children:N.map(L=>n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,padding:20,background:"#f8fafc"},children:[n.jsxs("h3",{style:{fontSize:"1.2rem",color:"#334155",marginBottom:15,borderBottom:"2px solid #cbd5e1",paddingBottom:5},children:["Niveau ",L.level]}),q(L.unassignedStudents).length>0&&n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("h4",{style:{fontSize:"1rem",color:"#64748b",marginBottom:10},children:" lves non assigns"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:10},children:q(L.unassignedStudents).map(O=>n.jsxs("div",{style:{background:"white",padding:10,borderRadius:6,border:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("span",{style:{fontWeight:500},children:[O.firstName," ",O.lastName]}),n.jsx("button",{onClick:()=>z(O),style:{background:"none",border:"none",cursor:"pointer",color:"#3b82f6",fontSize:"1.2rem"},title:"Assigner  une classe",children:""})]},O._id))})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:20},children:L.classes.map(O=>n.jsxs("div",{style:{background:"white",borderRadius:8,border:"1px solid #e2e8f0",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"10px 15px",background:"#f1f5f9",borderBottom:"1px solid #e2e8f0",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{children:O.name}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[n.jsxs("span",{style:{fontSize:"0.8em",color:"#64748b",background:"#e2e8f0",padding:"2px 6px",borderRadius:4},children:[q(L.studentsByClass[O._id]||[]).length," lves"]}),n.jsx("button",{onClick:()=>D(O._id),style:{background:"#3b82f6",color:"white",border:"none",borderRadius:"50%",width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.2rem",lineHeight:1},title:"Ajouter un lve",children:"+"})]})]}),n.jsx("div",{style:{padding:10,maxHeight:300,overflowY:"auto"},children:q(L.studentsByClass[O._id]||[]).length===0?n.jsx("div",{style:{color:"#94a3b8",fontStyle:"italic",fontSize:"0.9em",textAlign:"center",padding:10},children:"Aucun lve"}):n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:q(L.studentsByClass[O._id]||[]).map(B=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid #f1f5f9"},children:[n.jsxs("span",{style:{fontSize:"0.95em"},children:[B.firstName," ",B.lastName]}),n.jsx("button",{onClick:()=>z(B),style:{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",fontSize:"1rem"},title:"Changer de classe",children:""})]},B._id))})})]},O._id))})]},L.level))})]}),n.jsx(pd,{isOpen:d&&!!g,onClose:()=>f(!1),title:g?`Assigner ${g.firstName} ${g.lastName}`:"Assigner",width:400,footer:n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[n.jsx("button",{className:"btn secondary",onClick:()=>f(!1),style:{background:"#f1f5f9",color:"#475569"},children:"Annuler"}),n.jsx("button",{className:"btn",onClick:A,disabled:!y||(g==null?void 0:g.classId)===y,children:"Enregistrer"})]}),children:g&&n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:500},children:"Choisir une classe"}),n.jsxs("select",{value:y,onChange:L=>v(L.target.value),style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #cbd5e1"},children:[n.jsx("option",{value:"",children:"Slectionner..."}),r.filter(L=>L.level===g.level).sort((L,O)=>L.level.localeCompare(O.level)).map(L=>n.jsxs("option",{value:L._id,children:[L.name," (",L.level,")"]},L._id))]}),n.jsx("div",{style:{marginTop:5,fontSize:"0.85em",color:"#64748b"},children:"Note: Changer de niveau mettra  jour le niveau de l'lve."})]})}),n.jsx(pd,{isOpen:h,onClose:()=>m(!1),title:"Ajouter un lve  la classe",width:500,footer:n.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[n.jsx("button",{className:"btn secondary",onClick:()=>m(!1),style:{background:"#f1f5f9",color:"#475569"},children:"Annuler"}),n.jsx("button",{className:"btn",onClick:w,disabled:!S.trim()||!j.trim()||!y,children:"Ajouter"})]}),children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",marginBottom:6,fontWeight:500},children:"Prnom"}),n.jsx("input",{placeholder:"Prnom",value:S,onChange:L=>k(L.target.value),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #ddd"},autoFocus:!0})]}),n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",marginBottom:6,fontWeight:500},children:"Nom"}),n.jsx("input",{placeholder:"Nom",value:j,onChange:L=>_(L.target.value),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #ddd"}})]})]})})]})}const xa=e=>e>=80?"high":e>=50?"medium":"low",g_=(e,t)=>`${e.charAt(0)}${t.charAt(0)}`.toUpperCase(),m_=({percentage:e,size:t=56})=>{const r=(t-8)/2,s=2*Math.PI*r,i=s-e/100*s;return n.jsxs("div",{className:"progress-ring-container",style:{width:t,height:t},children:[n.jsxs("svg",{className:"progress-ring",width:t,height:t,children:[n.jsx("circle",{className:"progress-ring-bg",cx:t/2,cy:t/2,r}),n.jsx("circle",{className:`progress-ring-progress ${xa(e)}`,cx:t/2,cy:t/2,r,strokeDasharray:s,strokeDashoffset:i})]}),n.jsxs("span",{className:"progress-ring-text",children:[e,"%"]})]})};function x_(){const[e,t]=p.useState([]),[r,s]=p.useState(!0),[i,a]=p.useState(""),[o,l]=p.useState(""),[c,u]=p.useState("all"),[d,f]=p.useState("table"),[h,m]=p.useState(new Set),[g,x]=p.useState(new Set);p.useEffect(()=>{(async()=>{try{s(!0);const w=await K.get("/subadmin-assignments/progress"),N=Array.isArray(w.data)?w.data:[];t(N);const $=new Set(N.map(E=>E.currentLevel||"Sans niveau"));m($)}catch(w){a("Impossible de charger les donnes de progression"),console.error(w)}finally{s(!1)}})()},[]);const y=p.useMemo(()=>e.filter(D=>{var $;const w=o===""||`${D.firstName} ${D.lastName}`.toLowerCase().includes(o.toLowerCase())||(($=D.className)==null?void 0:$.toLowerCase().includes(o.toLowerCase())),N=c==="all"||D.currentLevel===c;return w&&N}),[e,o,c]),v=p.useMemo(()=>y.reduce((D,w)=>{const N=w.currentLevel||"Sans niveau",$=w.className||"Sans classe";return D[N]||(D[N]={}),D[N][$]||(D[N][$]=[]),D[N][$].push(w),D},{}),[y]),S=Object.keys(v).sort(),k=[...new Set(e.map(D=>D.currentLevel||"Sans niveau"))].sort(),j=p.useMemo(()=>{const D=e.length,w=new Set(e.map(L=>L.currentLevel)).size;let N=0,$=0;e.forEach(L=>{(Array.isArray(L.levelsData)?L.levelsData:[]).forEach(B=>{N+=B.percentage||0,$++})});const E=$>0?Math.round(N/$):0,q=e.filter(L=>(Array.isArray(L.levelsData)?L.levelsData:[]).every(B=>B.percentage===100)).length;return{totalStudents:D,totalLevels:w,avgProgress:E,completeCount:q}},[e]),_=(D,w)=>{if(!D.length)return 0;const N=D.reduce(($,E)=>{const L=(Array.isArray(E.levelsData)?E.levelsData:[]).find(O=>O.level===w);return $+((L==null?void 0:L.percentage)||0)},0);return Math.round(N/D.length)},b=(D,w)=>{const N={};return D.forEach($=>{const q=(Array.isArray($.levelsData)?$.levelsData:[]).find(L=>L.level===w);q&&Array.isArray(q.byCategory)&&q.byCategory.forEach(L=>{N[L.name]||(N[L.name]={sum:0,count:0}),N[L.name].sum+=L.percentage,N[L.name].count++})}),Object.entries(N).map(([$,E])=>({name:$,average:E.count>0?Math.round(E.sum/E.count):0})).sort(($,E)=>$.name.localeCompare(E.name))},A=D=>{m(w=>{const N=new Set(w);return N.has(D)?N.delete(D):N.add(D),N})},z=D=>{x(w=>{const N=new Set(w);return N.has(D)?N.delete(D):N.add(D),N})};return n.jsxs("div",{className:"progress-page",children:[n.jsx("header",{className:"progress-header",children:n.jsxs("div",{className:"progress-header-left",children:[n.jsx("div",{className:"progress-header-icon",children:""}),n.jsxs("div",{className:"progress-header-text",children:[n.jsx("h1",{children:"Progression des lves"}),n.jsx("p",{children:"Suivez la progression dtaille de chaque lve par niveau et catgorie"})]})]})}),!r&&!i&&e.length>0&&n.jsxs("div",{className:"progress-stats-grid",children:[n.jsxs("div",{className:"progress-stat-card",children:[n.jsx("div",{className:"progress-stat-icon students",children:""}),n.jsxs("div",{className:"progress-stat-content",children:[n.jsx("div",{className:"progress-stat-value",children:j.totalStudents}),n.jsx("div",{className:"progress-stat-label",children:"lves suivis"})]})]}),n.jsxs("div",{className:"progress-stat-card",children:[n.jsx("div",{className:"progress-stat-icon levels",children:""}),n.jsxs("div",{className:"progress-stat-content",children:[n.jsx("div",{className:"progress-stat-value",children:j.totalLevels}),n.jsx("div",{className:"progress-stat-label",children:"Niveaux"})]})]}),n.jsxs("div",{className:"progress-stat-card",children:[n.jsx("div",{className:"progress-stat-icon complete",children:""}),n.jsxs("div",{className:"progress-stat-content",children:[n.jsx("div",{className:"progress-stat-value",children:j.completeCount}),n.jsx("div",{className:"progress-stat-label",children:"Carnets complets"})]})]}),n.jsxs("div",{className:"progress-stat-card",children:[n.jsx("div",{className:"progress-stat-icon pending",children:""}),n.jsxs("div",{className:"progress-stat-content",children:[n.jsxs("div",{className:"progress-stat-value",children:[j.avgProgress,"%"]}),n.jsx("div",{className:"progress-stat-label",children:"Progression moyenne"})]})]})]}),!r&&!i&&e.length>0&&n.jsxs("div",{className:"progress-filter-bar",children:[n.jsxs("div",{className:"progress-search-wrapper",children:[n.jsx("span",{className:"progress-search-icon",children:""}),n.jsx("input",{type:"text",className:"progress-search-input",placeholder:"Rechercher un lve ou une classe...",value:o,onChange:D=>l(D.target.value)})]}),n.jsxs("select",{className:"progress-filter-select",value:c,onChange:D=>u(D.target.value),children:[n.jsx("option",{value:"all",children:"Tous les niveaux"}),k.map(D=>n.jsx("option",{value:D,children:D},D))]}),n.jsxs("div",{className:"progress-view-toggle",children:[n.jsx("button",{className:`progress-view-btn ${d==="table"?"active":""}`,onClick:()=>f("table"),children:" Tableau"}),n.jsx("button",{className:`progress-view-btn ${d==="grid"?"active":""}`,onClick:()=>f("grid"),children:" Cartes"})]})]}),r&&n.jsxs("div",{className:"progress-loading",children:[n.jsx("div",{className:"progress-loading-spinner"}),n.jsx("div",{className:"progress-loading-text",children:"Chargement des donnes..."}),n.jsx("div",{className:"progress-loading-subtext",children:"Veuillez patienter"})]}),i&&n.jsxs("div",{className:"progress-error",children:[n.jsx("div",{className:"progress-error-icon",children:""}),n.jsxs("div",{className:"progress-error-content",children:[n.jsx("h4",{children:"Erreur de chargement"}),n.jsx("p",{children:i})]})]}),!r&&!i&&e.length===0&&n.jsxs("div",{className:"progress-empty",children:[n.jsx("div",{className:"progress-empty-icon",children:""}),n.jsx("h3",{children:"Aucune donne disponible"}),n.jsx("p",{children:"Aucun lve trouv avec un carnet termin pour vos niveaux assigns."})]}),!r&&!i&&y.length>0&&d==="table"&&n.jsx("div",{className:"progress-content",children:S.map(D=>{const w=Object.values(v[D]).flat(),N=_(w,D),$=b(w,D),E=h.has(D);return n.jsxs("div",{className:"progress-level-section",children:[n.jsxs("div",{className:"progress-level-header",onClick:()=>A(D),children:[n.jsxs("div",{className:"progress-level-header-left",children:[n.jsx("span",{className:"progress-level-badge",children:D}),n.jsx("div",{className:"progress-level-info",children:n.jsxs("span",{className:"progress-level-student-count",children:[n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"9",cy:"7",r:"4"}),n.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),n.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),w.length," lves"]})})]}),n.jsxs("div",{className:"progress-level-header-right",children:[n.jsx(m_,{percentage:N}),n.jsx("div",{className:"progress-category-pills",children:$.map(q=>n.jsxs("div",{className:"progress-category-pill",children:[n.jsx("span",{className:"progress-category-name",children:q.name}),n.jsxs("span",{className:`progress-category-value ${xa(q.average)}`,children:[q.average,"%"]})]},q.name))}),n.jsx("div",{className:`progress-collapse-icon ${E?"expanded":""}`,children:n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"6 9 12 15 18 9"})})})]})]}),E&&n.jsx("div",{className:"progress-level-content",children:Object.keys(v[D]).sort().map(q=>{const L=v[D][q],O=_(L,D),B=b(L,D),I=`${D}-${q}`,T=g.has(I)||g.size===0;return n.jsxs("div",{className:"progress-class-section",children:[n.jsxs("div",{className:"progress-class-header",onClick:()=>z(I),children:[n.jsxs("div",{className:"progress-class-header-left",children:[n.jsx("span",{className:"progress-class-badge",children:q}),n.jsxs("span",{className:"progress-class-count",children:[L.length," lves"]})]}),n.jsxs("div",{className:"progress-class-header-right",children:[n.jsxs("span",{className:`progress-class-avg ${xa(O)}`,children:["Moyenne: ",O,"%"]}),B.slice(0,3).map(W=>n.jsxs("div",{className:"progress-category-pill",style:{padding:"4px 10px",fontSize:"12px"},children:[n.jsx("span",{className:"progress-category-name",children:W.name}),n.jsxs("span",{className:`progress-category-value ${xa(W.average)}`,children:[W.average,"%"]})]},W.name))]})]}),(T||!g.has(I))&&n.jsx("div",{className:"progress-student-table-wrapper",children:n.jsxs("table",{className:"progress-student-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"22%"},children:"lve"}),n.jsx("th",{style:{width:"10%",textAlign:"center"},children:"Niveau"}),n.jsx("th",{style:{width:"18%",textAlign:"center"},children:"Progression Globale"}),n.jsx("th",{style:{width:"50%"},children:"Par Langue / Catgorie"})]})}),n.jsx("tbody",{children:L.map(W=>{const re=Array.isArray(W.levelsData)?W.levelsData:[],ae=re.length>0?re:[{level:"-",activeCount:0,totalAvailable:0,percentage:0,byCategory:[]}];return ae.map((Y,J)=>n.jsxs("tr",{children:[J===0&&n.jsx("td",{rowSpan:ae.length,children:n.jsxs("div",{className:"progress-student-cell",children:[n.jsx("div",{className:"progress-student-avatar",children:g_(W.firstName,W.lastName)}),n.jsxs("span",{className:"progress-student-name",children:[W.firstName," ",W.lastName]})]})}),n.jsx("td",{style:{textAlign:"center"},children:n.jsx("span",{className:"progress-level-indicator",children:Y.level})}),n.jsx("td",{children:n.jsxs("div",{className:"progress-global-cell",children:[n.jsxs("div",{className:"progress-fraction",children:[n.jsx("span",{children:Y.activeCount}),n.jsx("span",{className:"progress-fraction-divider",children:"/"}),n.jsx("span",{children:Y.totalAvailable})]}),n.jsxs("span",{className:`progress-percentage-badge ${xa(Y.percentage)}`,children:[Y.percentage,"%"]})]})}),n.jsx("td",{children:n.jsx("div",{className:"progress-categories-cell",children:(Array.isArray(Y.byCategory)?Y.byCategory:[]).map(P=>n.jsxs("div",{className:"progress-category-tag",children:[n.jsx("span",{className:"progress-category-tag-name",children:P.name}),n.jsxs("div",{className:"progress-category-tag-stats",children:[n.jsxs("span",{className:"progress-category-tag-fraction",children:[P.filled,"/",P.total]}),n.jsxs("span",{className:`progress-category-tag-percentage ${xa(P.percentage)}`,children:[P.percentage,"%"]})]}),n.jsx("div",{className:"progress-mini-bar",children:n.jsx("div",{className:`progress-mini-bar-fill ${xa(P.percentage)}`,style:{width:`${P.percentage}%`}})})]},P.name))})})]},`${W._id}-${Y.level??J}`))})})]})})]},q)})})]},D)})}),!r&&!i&&y.length>0&&d==="grid"&&n.jsx("div",{className:"progress-grid-view",children:y.map(D=>{const w=Array.isArray(D.levelsData)?D.levelsData:[],N=w.find($=>$.level===D.currentLevel)||w[0];return n.jsxs("div",{className:"progress-student-card",children:[n.jsxs("div",{className:"progress-student-card-header",children:[n.jsx("div",{className:"progress-student-card-avatar",children:g_(D.firstName,D.lastName)}),n.jsxs("div",{className:"progress-student-card-info",children:[n.jsxs("div",{className:"progress-student-card-name",children:[D.firstName," ",D.lastName]}),n.jsxs("div",{className:"progress-student-card-meta",children:[n.jsx("span",{className:"progress-student-card-level-badge",children:D.currentLevel}),n.jsx("span",{children:""}),n.jsx("span",{children:D.className})]})]}),N&&n.jsx(m_,{percentage:N.percentage,size:48})]}),n.jsx("div",{className:"progress-student-card-body",children:N&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"progress-student-card-overall",children:[n.jsx("span",{className:"progress-student-card-overall-label",children:"Progression globale"}),n.jsxs("div",{className:"progress-student-card-overall-value",children:[n.jsxs("span",{className:"progress-fraction",children:[N.activeCount,"/",N.totalAvailable]}),n.jsxs("span",{className:`progress-percentage-badge ${xa(N.percentage)}`,children:[N.percentage,"%"]})]})]}),n.jsx("div",{className:"progress-student-card-categories",children:(Array.isArray(N.byCategory)?N.byCategory:[]).map($=>n.jsxs("div",{className:"progress-student-card-category",children:[n.jsx("span",{className:"progress-student-card-category-name",children:$.name}),n.jsx("div",{className:"progress-student-card-category-bar",children:n.jsx("div",{className:`progress-student-card-category-bar-fill ${xa($.percentage)}`,style:{width:`${$.percentage}%`}})}),n.jsxs("span",{className:"progress-student-card-category-value",style:{color:$.percentage>=80?"#059669":$.percentage>=50?"#d97706":"#dc2626"},children:[$.percentage,"%"]})]},$.name))})]})})]},D._id)})}),!r&&!i&&e.length>0&&y.length===0&&n.jsxs("div",{className:"progress-empty",children:[n.jsx("div",{className:"progress-empty-icon",children:""}),n.jsx("h3",{children:"Aucun rsultat"}),n.jsx("p",{children:"Aucun lve ne correspond  vos critres de recherche. Essayez de modifier vos filtres."})]})]})}const y_=["purple","blue","green","amber","rose","cyan"],Dne=({percentage:e,size:t=80,strokeWidth:r=8})=>{const s=(t-r)/2,i=s*2*Math.PI,a=i-e/100*i;return n.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[n.jsxs("svg",{width:t,height:t,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",stopColor:"#6366f1"}),n.jsx("stop",{offset:"50%",stopColor:"#8b5cf6"}),n.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]})}),n.jsx("circle",{className:"circular-progress-bg",cx:t/2,cy:t/2,r:s,strokeWidth:r}),n.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:s,strokeWidth:r,strokeDasharray:i,strokeDashoffset:a,style:{transition:"stroke-dashoffset 1s ease-out"}})]}),n.jsx("div",{className:"circular-progress-text",children:n.jsxs("span",{className:"circular-progress-percentage",children:[e,"%"]})})]})},Mne=({title:e,subtitle:t,progress:r,byCategory:s})=>n.jsx("div",{className:"level-summary-card compact",children:n.jsxs("div",{className:"summary-content-compact",children:[n.jsxs("div",{className:"circular-progress-section",children:[n.jsx(Dne,{percentage:r.percentage}),n.jsxs("div",{className:"progress-meta",children:[n.jsx("span",{className:"progress-meta-title",children:e}),n.jsx("span",{className:"progress-meta-subtitle",children:t})]})]}),n.jsx("div",{className:"category-progress-compact",children:s.map((i,a)=>n.jsxs("div",{className:"category-item-compact",children:[n.jsxs("div",{className:"category-compact-header",children:[n.jsx("span",{className:"category-name-compact",children:i.name}),n.jsxs("span",{className:"category-percentage-compact",children:[i.percentage,"%"]})]}),n.jsx("div",{className:"category-bar-compact",children:n.jsx("div",{className:`category-bar-fill ${y_[a%y_.length]}`,style:{width:`${i.percentage}%`}})}),i.teachers&&i.teachers.length>0&&n.jsxs("span",{className:"category-teachers-compact",children:[i.teachers.slice(0,2).join(", "),i.teachers.length>2&&` +${i.teachers.length-2}`]})]},a))})]})}),Bne=({cls:e,index:t})=>{const r=i=>i===100?"complete":i>=75?"high":i>=50?"medium":"low",s=i=>i===100?"":i>=75?"":i>=50?"":"";return n.jsxs("div",{className:"class-card",style:{animationDelay:`${t*.05}s`},children:[n.jsxs("div",{className:"class-card-header",children:[n.jsxs("div",{className:"class-info",children:[n.jsx("h4",{className:"class-name",children:e.className}),n.jsxs("p",{className:"class-details",children:[n.jsx("span",{children:e.teachers.join(", ")||"Aucun enseignant"}),n.jsx("span",{className:"separator"}),n.jsxs("span",{children:[e.studentCount," lves"]})]})]}),n.jsxs("div",{className:`class-percentage-badge ${r(e.progress.percentage)}`,children:[n.jsx("span",{children:s(e.progress.percentage)}),n.jsxs("span",{children:[e.progress.percentage,"%"]})]})]}),n.jsx("div",{className:"class-categories",children:e.byCategory.map((i,a)=>n.jsxs("div",{className:"mini-category",children:[n.jsxs("div",{className:"mini-category-header",children:[n.jsx("span",{className:"mini-category-name",children:i.name}),n.jsxs("span",{className:"mini-category-percentage",children:[i.percentage,"%"]})]}),n.jsx("div",{className:"mini-category-bar",children:n.jsx("div",{className:"mini-category-fill",style:{width:`${i.percentage}%`,background:`linear-gradient(90deg, ${Fne(a)})`}})}),i.teachers&&i.teachers.length>0&&n.jsx("div",{className:"mini-category-teachers",children:i.teachers.join(", ")})]},a))})]})},Fne=e=>{const t=["#6366f1, #8b5cf6","#3b82f6, #60a5fa","#22c55e, #4ade80","#f59e0b, #fbbf24","#f43f5e, #fb7185","#06b6d4, #22d3ee"];return t[e%t.length]},Wne=({cls:e})=>n.jsxs("div",{className:"class-detailed-card",children:[n.jsx("div",{className:"class-detailed-header",children:n.jsx("h4",{className:"class-detailed-title",children:e.className})}),n.jsx("div",{className:"student-table-container",children:n.jsxs("table",{className:"student-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"lve"}),n.jsx("th",{children:"Prof. Polyvalent"}),n.jsx("th",{children:"Arabe"}),n.jsx("th",{children:"Anglais"})]})}),n.jsx("tbody",{children:e.students.map(t=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsxs("span",{className:"student-name",children:[t.lastName," ",t.firstName]})}),n.jsx("td",{children:t.hasPolyvalent?t.polyvalent?n.jsx("span",{className:"status-icon complete",children:""}):n.jsx("span",{className:"status-icon pending",children:""}):n.jsx("span",{className:"status-icon na",children:"N/A"})}),n.jsx("td",{children:t.hasArabic?t.arabic?n.jsx("span",{className:"status-icon complete",children:""}):n.jsx("span",{className:"status-icon pending",children:""}):n.jsx("span",{className:"status-icon na",children:"N/A"})}),n.jsx("td",{children:t.hasEnglish?t.english?n.jsx("span",{className:"status-icon complete",children:""}):n.jsx("span",{className:"status-icon pending",children:""}):n.jsx("span",{className:"status-icon na",children:"N/A"})})]},t.studentId))})]})})]});function v_(){const[e,t]=p.useState("summary"),[r,s]=p.useState([]),[i,a]=p.useState([]),[o,l]=p.useState(!0),[c,u]=p.useState(""),{activeYearId:d,isLoading:f}=Yn();p.useEffect(()=>{(async()=>{if(!f){if(!d){l(!1);return}try{if(l(!0),e==="summary"){const k=await K.get(`/subadmin-assignments/teacher-progress?schoolYearId=${d}`);s(k.data)}else{const k=await K.get(`/subadmin-assignments/teacher-progress-detailed?schoolYearId=${d}`);a(k.data)}}catch(k){u("Impossible de charger les donnes"),console.error(k)}finally{l(!1)}}})()},[e,d,f]);const h=p.useMemo(()=>r.reduce((S,k)=>(S[k.level]||(S[k.level]=[]),S[k.level].push(k),S),{}),[r]),m=Object.keys(h).sort(),g=p.useMemo(()=>i.reduce((S,k)=>(S[k.level]||(S[k.level]=[]),S[k.level].push(k),S),{}),[i]),x=Object.keys(g).sort(),y=S=>{const k={studentCount:0,classCount:S.length,progress:{total:0,filled:0,percentage:0},byCategory:{}};S.forEach(_=>{k.studentCount+=_.studentCount,k.progress.total+=_.progress.total,k.progress.filled+=_.progress.filled,_.byCategory.forEach(b=>{k.byCategory[b.name]||(k.byCategory[b.name]={total:0,filled:0,name:b.name,teachers:new Set}),k.byCategory[b.name].total+=b.total,k.byCategory[b.name].filled+=b.filled,b.teachers&&Array.isArray(b.teachers)&&b.teachers.forEach(A=>k.byCategory[b.name].teachers.add(A))})}),k.progress.percentage=k.progress.total>0?Math.round(k.progress.filled/k.progress.total*100):0;const j=Object.values(k.byCategory).map(_=>({..._,teachers:Array.from(_.teachers),percentage:_.total>0?Math.round(_.filled/_.total*100):0}));return{...k,byCategory:j}},v=p.useMemo(()=>{const S=r.reduce((z,D)=>z+D.studentCount,0),k=r.length,j=r.reduce((z,D)=>z+D.progress.filled,0),_=r.reduce((z,D)=>z+D.progress.total,0),b=_>0?Math.round(j/_*100):0,A=r.filter(z=>z.progress.percentage===100).length;return{totalStudents:S,totalClasses:k,avgProgress:b,completedClasses:A}},[r]);return n.jsx("div",{className:"teacher-progress-page",children:n.jsxs("div",{className:"teacher-progress-wrapper",children:[n.jsx("div",{className:"teacher-progress-header",children:n.jsxs("div",{className:"header-content",children:[n.jsxs("div",{className:"header-text",children:[n.jsx("div",{className:"header-icon",children:""}),n.jsx("h1",{className:"header-title",children:"Suivi des Enseignants"}),n.jsx("p",{className:"header-subtitle",children:"Suivez la progression du remplissage des livrets par classe et par enseignant"})]}),n.jsxs("div",{className:"view-toggle-container",children:[n.jsxs("button",{onClick:()=>t("summary"),className:`view-toggle-btn ${e==="summary"?"active":""}`,children:[n.jsx("span",{className:"icon",children:""}),"Vue Globale"]}),n.jsxs("button",{onClick:()=>t("detailed"),className:`view-toggle-btn ${e==="detailed"?"active":""}`,children:[n.jsx("span",{className:"icon",children:""}),"Vue Dtaille"]})]})]})}),!o&&!f&&!c&&d&&e==="summary"&&r.length>0&&n.jsxs("div",{className:"stats-overview",children:[n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-icon purple",children:""}),n.jsxs("div",{className:"stat-info",children:[n.jsx("p",{className:"stat-label",children:"Total lves"}),n.jsx("h3",{className:"stat-value",children:v.totalStudents})]})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-icon blue",children:""}),n.jsxs("div",{className:"stat-info",children:[n.jsx("p",{className:"stat-label",children:"Classes"}),n.jsx("h3",{className:"stat-value",children:v.totalClasses})]})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-icon green",children:""}),n.jsxs("div",{className:"stat-info",children:[n.jsx("p",{className:"stat-label",children:"Progression Moyenne"}),n.jsxs("h3",{className:"stat-value",children:[v.avgProgress,"%"]})]})]}),n.jsxs("div",{className:"stat-card",children:[n.jsx("div",{className:"stat-icon amber",children:""}),n.jsxs("div",{className:"stat-info",children:[n.jsx("p",{className:"stat-label",children:"Classes Compltes"}),n.jsx("h3",{className:"stat-value",children:v.completedClasses})]})]})]}),(o||f)&&n.jsxs("div",{className:"loading-container",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{className:"loading-text",children:"Chargement des donnes..."})]}),c&&n.jsxs("div",{className:"error-container",children:[n.jsx("div",{className:"error-icon",children:""}),n.jsx("p",{className:"error-text",children:c})]}),!o&&!f&&!d&&n.jsxs("div",{className:"warning-container",children:[n.jsx("div",{className:"warning-icon",children:""}),n.jsx("p",{className:"warning-text",children:"Aucune anne scolaire active trouve. Veuillez slectionner une anne scolaire."})]}),!o&&!f&&!c&&d&&e==="summary"&&r.length===0&&n.jsxs("div",{className:"empty-container",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("h3",{className:"empty-title",children:"Aucune classe trouve"}),n.jsx("p",{className:"empty-text",children:"Aucune classe n'a t trouve pour vos niveaux assigns."})]}),!o&&!f&&!c&&d&&e==="summary"&&r.length>0&&n.jsx("div",{children:m.map((S,k)=>{const j=h[S],_=y(j);return n.jsxs("div",{className:"level-section",style:{animationDelay:`${k*.1}s`},children:[n.jsxs("div",{className:"level-header",children:[n.jsxs("div",{className:"level-badge",children:[n.jsx("span",{className:"emoji",children:""}),S]}),n.jsxs("div",{className:"level-stats",children:[n.jsxs("div",{className:"level-stat",children:[n.jsx("strong",{children:_.classCount})," classes"]}),n.jsxs("div",{className:"level-stat",children:[n.jsx("strong",{children:_.studentCount})," lves"]}),n.jsxs("div",{className:"level-stat",children:[n.jsxs("strong",{children:[_.progress.percentage,"%"]})," complt"]})]})]}),n.jsx(Mne,{title:`Rsum ${S}`,subtitle:`${_.studentCount} lves rpartis dans ${_.classCount} classes`,progress:_.progress,byCategory:_.byCategory}),n.jsx("div",{className:"classes-grid",children:j.map((b,A)=>n.jsx(Bne,{cls:b,index:A},b.classId))})]},S)})}),!o&&!f&&!c&&d&&e==="detailed"&&i.length===0&&n.jsxs("div",{className:"empty-container",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("h3",{className:"empty-title",children:"Aucune donne dtaille"}),n.jsx("p",{className:"empty-text",children:"Aucune classe n'a t trouve pour vos niveaux assigns."})]}),!o&&!f&&!c&&d&&e==="detailed"&&i.length>0&&n.jsx("div",{className:"detailed-section",children:x.map((S,k)=>n.jsxs("div",{className:"level-section",style:{animationDelay:`${k*.1}s`},children:[n.jsx("div",{className:"level-header",children:n.jsxs("div",{className:"level-badge",children:[n.jsx("span",{className:"emoji",children:""}),S]})}),g[S].map(j=>n.jsx(Wne,{cls:j},j.classId))]},S))})]})})}const Une=800,Hne=1120;function Yne({template:e,student:t,assignment:r,signature:s,finalSignature:i,activeSemester:a}){const{levels:o}=la(),{activeYear:l}=Yn(),[c,u]=p.useState(0),[d,f]=p.useState(!0),[h,m]=p.useState(null),g=(w,N,$)=>{if(!$)return!0;const E={};o.forEach(L=>{E[L.name.toUpperCase()]=L.order});const q=E[$.toUpperCase()];if(q===void 0)return!0;if(w){const L=E[w.toUpperCase()];return L===void 0?!0:L<=q}return N&&N.length>0?N.some(L=>{const O=E[L.toUpperCase()];return O===void 0?!0:O<=q}):!0},x=a||(i||r!=null&&r.isCompletedSem2?2:1);p.useEffect(()=>{const w=()=>m(null);if(h)return document.addEventListener("click",w),()=>document.removeEventListener("click",w)},[h]);const y=w=>{if(!w)return null;if(o&&o.length>0){const $=o.find(E=>E.name===w);if($){const E=o.find(q=>q.order===$.order+1);if(E)return E.name}}const N=(w||"").toUpperCase();return N==="TPS"?"PS":N==="PS"?"MS":N==="MS"?"GS":N==="GS"?"EB1":N==="KG1"?"KG2":N==="KG2"?"KG3":N==="KG3"?"EB1":null},v=w=>{if(w.props.level)return w.props.level;const N=(w.props.label||"").toUpperCase();return/\bPS\b/.test(N)?"PS":/\bMS\b/.test(N)?"MS":/\bGS\b/.test(N)?"GS":/\bEB1\b/.test(N)?"EB1":/\bKG1\b/.test(N)?"KG1":/\bKG2\b/.test(N)?"KG2":/\bKG3\b/.test(N)?"KG3":null},S=w=>{var E,q,L;const N=((E=w.props)==null?void 0:E.semester)??((q=w.props)==null?void 0:q.semestre)??null;if(N===1||N==="1")return 1;if(N===2||N==="2")return 2;const $=String(((L=w.props)==null?void 0:L.period)||"");return $==="mid-year"?1:$==="end-year"?2:null},k=w=>{var re,ae;const{level:N,semester:$}=w,E=[],q=(re=r==null?void 0:r.data)==null?void 0:re.signatures;Array.isArray(q)&&E.push(...q),s&&E.push(s),i&&E.push(i);const L=Array.isArray((ae=r==null?void 0:r.data)==null?void 0:ae.promotions)?r.data.promotions:[],O=Y=>String(Y||"").trim().toLowerCase(),B=O(N),I=Y=>{const J=String((Y==null?void 0:Y.signaturePeriodId)||""),P=String((Y==null?void 0:Y.type)||"standard");return $===1?J.endsWith("_sem1")||P==="standard":$===2?J.endsWith("_sem2")||J.endsWith("_end_of_year")||P==="end_of_year":!0},T=Y=>{if(!B)return!0;const J=O(Y==null?void 0:Y.level);if(J)return J===B;if(Y!=null&&Y.schoolYearName){const ce=L.find(ye=>String((ye==null?void 0:ye.year)||"")===String(Y.schoolYearName)),pe=O((ce==null?void 0:ce.from)||(ce==null?void 0:ce.fromLevel));if(pe&&pe===B)return!0}if(Y!=null&&Y.schoolYearId){const ce=L.find(ye=>String((ye==null?void 0:ye.schoolYearId)||"")===String(Y.schoolYearId)),pe=O((ce==null?void 0:ce.from)||(ce==null?void 0:ce.fromLevel));if(pe&&pe===B)return!0}const P=O(t==null?void 0:t.level);return!!P&&P===B};return E.filter(Y=>Y&&(Y==null?void 0:Y.signedAt)).filter(I).filter(T).sort((Y,J)=>new Date(J.signedAt).getTime()-new Date(Y.signedAt).getTime())[0]||null},j=w=>{if(!w)return"";const N=w.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!N)return"";const $=parseInt(N[1],10),E=N[2],q=parseInt(N[3],10);return Number.isNaN($)||Number.isNaN(q)?"":`${$+1}${E}${q+1}`},_=(w,N)=>{var I;const $=String((w==null?void 0:w.year)||"");if($){const T=j($);if(T)return T}const E=j(l==null?void 0:l.name);if(E)return E;if(!$)return"";const q=((I=r==null?void 0:r.data)==null?void 0:I.signatures)||[],L=String((w==null?void 0:w.from)||N||""),O=Array.isArray(q)?q.filter(T=>(T==null?void 0:T.type)==="end_of_year"&&(T==null?void 0:T.schoolYearName)).find(T=>L?T!=null&&T.level?String(T.level)===L:!1:!0):null;return O!=null&&O.schoolYearName?String(O.schoolYearName):j($)||$},b=(w,N,$)=>{var I;const E=((I=r==null?void 0:r.data)==null?void 0:I.signatures)||[],q=$==="end-year",L=$==="mid-year",B=E.filter(T=>{if(q){if(T.type!=="end_of_year")return!1}else if(L&&T.type&&T.type!=="standard")return!1;return!(T.level&&N&&T.level!==N)}).sort((T,W)=>{const re=new Date(T.signedAt||0).getTime();return new Date(W.signedAt||0).getTime()-re})[0];if(B){let T=String(B.schoolYearName||"").trim();if(!T&&B.signedAt){const W=new Date(B.signedAt),re=W.getFullYear(),Y=W.getMonth()>=8?re:re-1;T=`${Y}/${Y+1}`}if(T)return T}return String((w==null?void 0:w.year)||"")},A=w=>{var q,L,O,B,I,T;const N=v(w);if(!N)return!(w.props.period==="mid-year"&&!s&&!((q=w.props.field)!=null&&q.includes("signature"))||w.props.period==="end-year"&&!i&&!((L=w.props.field)!=null&&L.includes("signature")));let $=!1,E=!1;if((t==null?void 0:t.level)===N&&(s&&($=!0),i&&(E=!0)),!$||!E){const W=((O=r==null?void 0:r.data)==null?void 0:O.signatures)||[],re=((B=r==null?void 0:r.data)==null?void 0:B.promotions)||[];W.forEach(ae=>{if(ae.schoolYearName){const Y=re.find(J=>J.year===ae.schoolYearName);Y&&Y.from===N&&((ae.type==="standard"||!ae.type)&&($=!0),ae.type==="end_of_year"&&(E=!0))}})}return!(w.props.period==="mid-year"&&!$&&!((I=w.props.field)!=null&&I.includes("signature"))&&w.type!=="signature_box"&&w.type!=="final_signature_box"||w.props.period==="end-year"&&!E&&!((T=w.props.field)!=null&&T.includes("signature"))&&w.type!=="signature_box"&&w.type!=="final_signature_box")},z=(w,N)=>{if(!(r!=null&&r.data))return;if(N){const L=`${w}_${N}`;if(r.data[L]!==void 0)return r.data[L]}let $=null;const E=r.data.promotions||[];if(E.length>0&&($=[...E].sort((O,B)=>{const I=new Date(O.date||0).getTime(),T=new Date(B.date||0).getTime();return I-T})[0].from),!$||N===$||!N)return r.data[w]},D=(w,N)=>{const $=Array.isArray(w)?w:[],E=Array.isArray(N)?N:null;if(!$.length)return E||[];if(!E||!E.length)return $;const q=$.map(B=>typeof(B==null?void 0:B.code)=="string"&&B.code.trim()?B.code.trim():"").filter(Boolean),L=q.map(B=>B.toLowerCase());if(q.length===$.length&&new Set(L).size===L.length){const B=new Map;return E.forEach(I=>{typeof(I==null?void 0:I.code)=="string"&&I.code.trim()&&B.set(I.code.trim().toLowerCase(),I)}),$.map(I=>{const T=typeof(I==null?void 0:I.code)=="string"?I.code.trim().toLowerCase():"",W=T?B.get(T):void 0,re=typeof(W==null?void 0:W.active)=="boolean"?W.active:I.active;return{...I,active:re}})}return $.map((B,I)=>{const T=E[I],W=typeof(T==null?void 0:T.active)=="boolean"?T.active:B.active;return{...B,active:W}})};return e?n.jsxs("div",{children:[n.jsxs("div",{style:{marginTop:20,marginBottom:16,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",padding:16,background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>f(!d),style:{background:d?"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)":"#f1f5f9",color:d?"white":"#475569",fontWeight:500,border:"1px solid #cbd5e1",padding:"10px 16px"},children:d?" Vue page par page":" Vue continue"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>u(Math.max(0,c-1)),disabled:c===0||d,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:c===0||d?.5:1},children:" Prcdent"}),n.jsx("select",{value:c,onChange:w=>{const N=Number(w.target.value);u(N),d&&setTimeout(()=>{const $=document.getElementById(`page-${N}`);$&&$.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white"},children:e.pages.map((w,N)=>n.jsx("option",{value:N,children:w.title||`Page ${N+1}`},N))}),n.jsx("button",{className:"btn secondary",onClick:()=>u(Math.min(e.pages.length-1,c+1)),disabled:c===e.pages.length-1||d,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:c===e.pages.length-1||d?.5:1},children:"Suivant "})]})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center"},children:(d?e.pages:[e.pages[c]]).map((w,N)=>{const $=d?N:c;return n.jsxs("div",{id:`page-${$}`,className:"card page-canvas",style:{height:Hne,width:Une,background:w.bgColor||"#fff",overflow:"hidden",position:"relative"},children:[d&&n.jsxs("div",{style:{position:"absolute",top:-30,left:0,color:"#888",fontSize:14,fontWeight:600},children:["Page ",$+1]}),n.jsx("div",{className:"page-margins"}),w.blocks.map((E,q)=>!E||!E.props?null:n.jsxs("div",{style:{position:"absolute",left:E.props.x||0,top:E.props.y||0,zIndex:E.props.z??q,padding:6},children:[E.type==="text"&&n.jsx("div",{style:{position:"relative"},children:n.jsx("div",{style:{color:E.props.color,fontSize:E.props.fontSize,fontWeight:E.props.bold?700:400,textDecoration:E.props.underline?"underline":"none"},children:Array.isArray(E.props.runs)&&E.props.runs.length?E.props.runs.map((L,O)=>n.jsx("span",{style:{color:L&&typeof L=="object"&&typeof L.color=="string"&&L.color?L.color:E.props.color||void 0,fontWeight:L&&typeof L=="object"&&typeof L.bold=="boolean"?L.bold?700:400:E.props.bold?700:400,textDecoration:L&&typeof L=="object"&&typeof L.underline=="boolean"?L.underline?"underline":"none":E.props.underline?"underline":"none"},children:(L==null?void 0:L.text)||""},O)):E.props.text})}),E.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:E.props.direction||"row",alignItems:"center",justifyContent:"center",gap:E.props.spacing||12,background:E.props.backgroundColor||"transparent",borderRadius:E.props.borderRadius||12,padding:E.props.padding||8,width:E.props.width,height:E.props.height,boxSizing:"border-box",...A(E)?{}:{display:"none"}},children:(()=>{var ae;const L=`language_toggle_${$}_${q}`,O=typeof((ae=E==null?void 0:E.props)==null?void 0:ae.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null,B=O?`language_toggle_${O}`:null,I=v(E),T=(B?z(B,I):null)||z(L,I),W=Array.isArray(E.props.items)?E.props.items:[];return D(W,T).map((Y,J)=>{const P=g(void 0,Y.levels,t==null?void 0:t.level),ce=40,pe=je=>{const ve=je.emoji;if(ve&&ve.length>=2)return ve;const le=(je.code||"").toLowerCase();return le==="lb"||le==="ar"?"":le==="fr"?"":le==="en"||le==="uk"||le==="gb"?"":""},ye=pe(Y),se=`https://emojicdn.elk.sh/${ye}?style=apple`;return n.jsx("div",{title:Y.label,style:{width:ce,height:ce,minWidth:ce,borderRadius:"50%",background:Y.active?"#fff":"rgba(255, 255, 255, 0.5)",border:Y.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:"default",boxShadow:Y.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",transform:Y.active?"scale(1.1)":"scale(1)",opacity:P?Y.active?1:.9:.5,filter:"none"},children:ye?n.jsx("img",{src:se,style:{width:ce*.9,height:ce*.9,objectFit:"contain"},alt:""}):Y.logo?n.jsx("img",{src:Y.logo,style:{width:ce*.9,height:ce*.9,objectFit:"contain"},alt:""}):n.jsx("span",{style:{fontSize:20,lineHeight:1},children:pe(Y)})},J)})})()}),E.type==="image"&&n.jsx(Fo,{src:E.props.url,displayWidth:E.props.width||120,displayHeight:E.props.height||120,cropData:E.props.cropData,borderRadius:8}),E.type==="student_photo"&&(t!=null&&t.avatarUrl?n.jsx("img",{src:t.avatarUrl,style:{width:E.props.width||100,height:E.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:E.props.width||100,height:E.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),E.type==="rect"&&n.jsx("div",{style:{width:E.props.width,height:E.props.height,background:E.props.color,borderRadius:E.props.radius||8,border:E.props.stroke?`${E.props.strokeWidth||1}px solid ${E.props.stroke}`:"none"}}),E.type==="circle"&&n.jsx("div",{style:{width:(E.props.radius||60)*2,height:(E.props.radius||60)*2,background:E.props.color,borderRadius:"50%",border:E.props.stroke?`${E.props.strokeWidth||1}px solid ${E.props.stroke}`:"none"}}),E.type==="gradebook_pocket"&&n.jsx(nc,{number:E.props.number||"1",width:E.props.width||120,fontSize:E.props.fontSize}),E.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:E.props.spacing||12},children:(()=>{var ae;const L=`language_toggle_${$}_${q}`,O=typeof((ae=E==null?void 0:E.props)==null?void 0:ae.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null,B=O?`language_toggle_${O}`:null,I=v(E),T=(B?z(B,I):null)||z(L,I),W=Array.isArray(E.props.items)?E.props.items:[];return D(W,T).map((Y,J)=>{const P=g(void 0,Y.levels,t==null?void 0:t.level),pe=(E.props.radius||40)*2;return n.jsx("div",{style:{width:pe,height:pe,borderRadius:"50%",overflow:"hidden",position:"relative",cursor:"default",boxShadow:Y.active?"0 0 0 3px #6c5ce7":"0 0 0 1px #ddd",opacity:P?Y.active?1:.9:.5},children:Y.logo?n.jsx("img",{src:Y.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:Y.active?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},J)})})()}),E.type==="line"&&n.jsx("div",{style:{width:E.props.x2||100,height:E.props.strokeWidth||2,background:E.props.stroke||"#b2bec3"}}),E.type==="arrow"&&n.jsx("div",{style:{width:E.props.x2||100,height:E.props.strokeWidth||2,background:E.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${E.props.stroke||"#6c5ce7"}`}})}),E.type==="dynamic_text"&&n.jsx("div",{style:{color:E.props.color,fontSize:E.props.fontSize,width:E.props.width,height:E.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let L=E.props.text||"";if(t){const O=String((t==null?void 0:t.fatherName)||(t==null?void 0:t.parentName)||"").trim(),B=O?O.charAt(0).toUpperCase():"",I=B?`${B}.`:"",T=[t.firstName,I,t.lastName].filter(Boolean).join(" "),W=new Date(t.dateOfBirth),re=isNaN(W.getTime())?"":`${String(W.getUTCDate()).padStart(2,"0")}/${String(W.getUTCMonth()+1).padStart(2,"0")}/${String(W.getUTCFullYear())}`;L=L.replace(/{student.firstName}/g,t.firstName).replace(/{student.lastName}/g,t.lastName).replace(/{student.dob}/g,t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString():"").replace(/{student.fatherInitial}/g,I).replace(/{student.fullNameFatherInitial}/g,T).replace(/{student.dob_ddmmyyyy}/g,re)}return r!=null&&r.data&&Object.entries(r.data).forEach(([O,B])=>{L=L.replace(new RegExp(`{${O}}`,"g"),String(B))}),L})()}),E.type==="student_info"&&n.jsx("div",{style:{color:E.props.color,fontSize:E.props.fontSize,width:E.props.width,height:E.props.height,overflow:"hidden"},children:"Nom, Classe, Naissance"}),E.type==="category_title"&&n.jsx("div",{style:{color:E.props.color,fontSize:E.props.fontSize,width:E.props.width,height:E.props.height,overflow:"hidden"},children:"Titre catgorie"}),E.type==="competency_list"&&n.jsx("div",{style:{color:E.props.color,fontSize:E.props.fontSize,width:E.props.width,height:E.props.height,overflow:"hidden"},children:"Liste des comptences"}),E.type==="dropdown"&&(()=>{if(!A(E))return null;const L=g(void 0,E.props.levels,t==null?void 0:t.level),B=(E.props.semesters||[1,2]).includes(x),I=L&&B;return n.jsxs("div",{style:{width:E.props.width||200,position:"relative",opacity:I?1:.5,pointerEvents:I?"auto":"none"},children:[n.jsxs("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:["Dropdown #",E.props.dropdownNumber||"?"]}),E.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:E.props.label}),n.jsxs("div",{style:{width:"100%",minHeight:E.props.height||32,fontSize:E.props.fontSize||12,color:E.props.color||"#333",padding:"4px 24px 4px 8px",borderRadius:4,border:"1px solid #ccc",background:"#f9f9f9",cursor:"default",position:"relative",display:"flex",alignItems:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:[(()=>{var J;const T=typeof((J=E==null?void 0:E.props)==null?void 0:J.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null,W=T?`dropdown_${T}`:null,re=E.props.dropdownNumber?`dropdown_${E.props.dropdownNumber}`:E.props.variableName,ae=v(E);return((W?z(W,ae):void 0)??(re?z(re,ae):void 0)??"")||"Slectionner..."})(),n.jsx("div",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:""})]})]})})(),E.type==="dropdown_reference"&&(()=>{var re,ae,Y;const L=E.props.dropdownNumber||1,O=typeof((re=E==null?void 0:E.props)==null?void 0:re.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null,B=O?`dropdown_${O}`:null,I=`dropdown_${L}`,T=(B?(ae=r==null?void 0:r.data)==null?void 0:ae[B]:void 0)??(I?(Y=r==null?void 0:r.data)==null?void 0:Y[I]:void 0),W=typeof T=="string"?T.trim():T;return W?n.jsx("div",{style:{color:E.props.color||"#333",fontSize:E.props.fontSize||12,width:E.props.width||200,minHeight:E.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:String(W)}):null})(),E.type==="promotion_info"&&n.jsx("div",{style:{width:E.props.width||(E.props.field?150:300),height:E.props.height||(E.props.field?30:100),border:E.props.field?"none":"1px solid #6c5ce7",padding:E.props.field?0:10,borderRadius:8,fontSize:E.props.fontSize||12,color:E.props.color||"#2d3436",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:(()=>{var T,W;const L=((T=r==null?void 0:r.data)==null?void 0:T.promotions)||[],O=v(E),B=E.props.targetLevel;let I=null;if(B&&(I=L.find(re=>re.to===B)),!I&&O&&(I=L.find(re=>re.from===O)),!I&&!B&&!O&&L.length===1&&(I={...L[0]}),!I&&O){const re=((W=r==null?void 0:r.data)==null?void 0:W.signatures)||[],ae=E.props.period==="mid-year",Y=E.props.period==="end-year",P=re.filter(ce=>{if(Y){if(ce.type!=="end_of_year")return!1}else if(ae&&ce.type&&ce.type!=="standard")return!1;return!(ce.level&&ce.level!==O)}).sort((ce,pe)=>{const ye=new Date(ce.signedAt||0).getTime();return new Date(pe.signedAt||0).getTime()-ye})[0];if(P){let ce=P.schoolYearName;if(!ce&&P.signedAt){const se=new Date(P.signedAt),je=se.getFullYear(),le=se.getMonth()>=8?je:je-1;ce=`${le}/${le+1}`}if(!ce){const je=new Date().getFullYear();ce=`${je}/${je+1}`}const pe=O,ye=B||y(pe||"")||"";I={year:ce,from:pe,to:ye||"?",class:(t==null?void 0:t.className)||""}}}if(!I){const ae=E.props.period==="end-year"&&i||s,Y=String((ae==null?void 0:ae.level)||"").trim(),J=!O||!Y||Y===O;if(ae&&ae.signedAt&&J){let P=String(ae.schoolYearName||"").trim();if(!P){const ye=new Date(ae.signedAt),se=ye.getFullYear(),ve=ye.getMonth()>=8?se:se-1;P=`${ve}/${ve+1}`}const ce=O||Y||(t==null?void 0:t.level)||"",pe=B||y(ce||"")||"";I={year:P,from:ce,to:pe||"?",class:(t==null?void 0:t.className)||""}}}if(I)!I.class&&(t!=null&&t.className)&&(I.class=t.className),I.from||(O?I.from=O:t!=null&&t.level&&(I.from=t.level));else{const re=!!O&&!!(t!=null&&t.level)&&O===t.level;if(!(E.props.period==="mid-year"?!!s&&(re||!O&&L.length===0):!!i&&(re||!O&&L.length===0)))return null;let ce=0;if(l&&l.name){const je=l.name.match(/(\d{4})/);je&&(ce=parseInt(je[1],10))}if(!ce)return null;const pe=O||(t==null?void 0:t.level)||"",ye=B||y(pe||"")||"";I={year:`${ce}/${ce+1}`,from:pe,to:ye||"?",class:(t==null?void 0:t.className)||""}}if(I)if(E.props.field){if(E.props.field==="level")return n.jsx("div",{style:{fontWeight:"bold"},children:I.to});if(E.props.field==="student")return n.jsxs("div",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]});if(E.props.field==="studentFirstName")return n.jsx("div",{children:t==null?void 0:t.firstName});if(E.props.field==="studentLastName")return n.jsx("div",{children:t==null?void 0:t.lastName});if(E.props.field==="year")return n.jsx("div",{children:_(I,O)});if(E.props.field==="currentYear"){const re=b(I,O,E.props.period)||(l==null?void 0:l.name)||"";return n.jsx("div",{children:String(re)})}else if(E.props.field==="class"){const re=I.class||"",ae=re.split(/\s*[-\s]\s*/),Y=ae.length?ae[ae.length-1]:re;return n.jsx("div",{children:Y})}else if(E.props.field==="currentLevel")return n.jsx("div",{children:I.from||""})}else return n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",I.to]}),n.jsxs("div",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),n.jsxs("div",{style:{fontSize:(E.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Next Year ",_(I,O)]})]});return null})()}),E.type==="teacher_text"&&n.jsxs("div",{style:{width:E.props.width||300,height:E.props.height||60,border:"1px solid #ddd",borderRadius:4,padding:8,fontSize:E.props.fontSize||12,color:E.props.color||"#2d3436",background:"#fff",position:"relative",whiteSpace:"pre-wrap"},children:[(()=>{var I,T;if(E.props.level&&(t!=null&&t.level)&&E.props.level!==t.level)return null;const O=(typeof((I=E==null?void 0:E.props)==null?void 0:I.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null)||`teacher_text_${$}_${q}`,B=((T=r==null?void 0:r.data)==null?void 0:T[O])||"";return n.jsx("div",{style:{width:"100%",height:"100%",color:B?"inherit":"#999"},children:B||E.props.placeholder||"Texte ditable par le prof polyvalent..."})})(),E.props.label&&n.jsx("div",{style:{position:"absolute",top:-10,left:8,background:"#fff",padding:"2px 6px",fontSize:10,color:"#e17055",fontWeight:"bold"},children:E.props.label})]}),E.type==="table"&&(()=>{const L=ve=>{const le=typeof ve=="number"?ve:parseFloat(String(ve||"0"));return isNaN(le)?0:le},O=(E.props.columnWidths||[]).map(L),B=(E.props.rowHeights||[]).map(L),I=E.props.cells||[],T=L(E.props.colGap),W=L(E.props.rowGap),re=E.props.expandedRows||!1,ae=L(E.props.expandedRowHeight||34),Y=L(E.props.expandedDividerWidth||.5),J=E.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",P=4,ce=6,pe=E.props.expandedLanguages||[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}],ye=E.props.expandedToggleStyle||"v2";let se=0;for(let ve=0;ve<O.length;ve++)se+=O[ve]||0,se+=T;O.length>0&&(se-=T);let je=0;for(let ve=0;ve<B.length;ve++)je+=B[ve]||0,re&&(je+=ae+P),je+=W;return B.length>0&&(je-=W),n.jsx("div",{style:{position:"relative",width:se,height:je,display:re?"flex":"grid",flexDirection:"column",gap:`${W}px ${T}px`,gridTemplateColumns:re?void 0:O.map(ve=>`${Math.max(1,Math.round(ve))}px`).join(" "),gridTemplateRows:re?void 0:B.map(ve=>`${Math.max(1,Math.round(ve))}px`).join(" "),overflow:"visible",background:W>0||T>0?"transparent":E.props.backgroundColor||"transparent",borderRadius:W>0||T>0?0:E.props.borderRadius||0},children:re?I.map((ve,le)=>{var te;const oe=E.props.borderRadius||0,de=le===0,Pe=le===B.length-1,Z=W>0,ne=((te=ve[0])==null?void 0:te.fill)||E.props.backgroundColor||"#f8f9fa",ee=B[le]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column",marginBottom:re&&!Pe?W:0},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:O.map(G=>`${Math.max(1,Math.round(G))}px`).join(" "),columnGap:T,height:ee},children:ve.map((G,H)=>{var Qe,Ze,ge,Ae;const ie=(Qe=G==null?void 0:G.borders)==null?void 0:Qe.l,me=(Ze=G==null?void 0:G.borders)==null?void 0:Ze.r,ke=(ge=G==null?void 0:G.borders)==null?void 0:ge.t;(Ae=G==null?void 0:G.borders)==null||Ae.b;const Be=H===0,Te=H===O.length-1,qe={background:(G==null?void 0:G.fill)||(Z&&E.props.backgroundColor?E.props.backgroundColor:"transparent"),borderLeft:ie!=null&&ie.width?`${ie.width}px solid ${ie.color||"#000"}`:"none",borderRight:me!=null&&me.width?`${me.width}px solid ${me.color||"#000"}`:"none",borderTop:ke!=null&&ke.width?`${ke.width}px solid ${ke.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Be&&(Z||de)?oe:0,borderTopRightRadius:Te&&(Z||de)?oe:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:qe,children:(G==null?void 0:G.text)&&n.jsx("div",{style:{fontSize:G.fontSize||12,color:G.color||"#000",whiteSpace:"pre-wrap"},children:G.text})},`cell-${le}-${H}`)})}),n.jsxs("div",{style:{background:ne,borderBottomLeftRadius:Z||Pe?oe:0,borderBottomRightRadius:Z||Pe?oe:0,height:ae,position:"relative",paddingBottom:P},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:Y,background:J,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:ce,gap:8},children:(()=>{var ge,Ae,Le;const G=typeof((ge=E==null?void 0:E.props)==null?void 0:ge.blockId)=="string"&&E.props.blockId.trim()?E.props.blockId.trim():null,H=Array.isArray((Ae=E==null?void 0:E.props)==null?void 0:Ae.rowIds)?E.props.rowIds:[],ie=typeof(H==null?void 0:H[le])=="string"&&H[le].trim()?H[le].trim():null,me=G&&ie?`table_${G}_row_${ie}`:null,ke=`table_${$}_${q}_row_${le}`,Be=((Le=E.props.rowLanguages)==null?void 0:Le[le])||pe,Te=v(E),qe=(me?z(me,Te):null)||z(ke,Te),Qe=Array.isArray(Be)?Be:[];return D(Qe,qe).map((Q,be)=>{g(Q.level,Q.levels,t==null?void 0:t.level);const we=Math.max(12,Math.min(ae-12,20)),Ne=Q.active;if(ye==="v1"){const Fe=Q.logo||(()=>{const Ve=(Q.code||"").toLowerCase();return Ve==="en"||Ve==="uk"||Ve==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":Ve==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":Ve==="ar"||Ve==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:we,height:we,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:Ne?"0 0 0 2px #6c5ce7":"none",opacity:Ne?1:.5,cursor:"default"},onClick:async Ve=>{Ve.stopPropagation()},children:Fe?n.jsx("img",{src:Fe,style:{width:"100%",height:"100%",objectFit:"cover",filter:Ne?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},be)}const Oe=`https://emojicdn.elk.sh/${(Fe=>{const Ve=Fe.emoji;if(Ve&&Ve.length>=2)return Ve;const tt=(Fe.code||"").toLowerCase();return tt==="lb"||tt==="ar"?"":tt==="fr"?"":tt==="en"||tt==="uk"||tt==="gb"?"":""})(Q)}?style=apple`;return n.jsx("div",{title:Q.label,style:{width:we,height:we,minWidth:we,borderRadius:"50%",background:Ne?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:Ne?"scale(1.1)":"scale(1)",boxShadow:"none",opacity:Ne?1:.5,cursor:"default"},onClick:async Fe=>{Fe.stopPropagation()},children:n.jsx("img",{src:Oe,style:{width:we*.9,height:we*.9,objectFit:"contain"},alt:""})},be)})})()})]})]},`row-unit-${le}`)}):I.flatMap((ve,le)=>ve.map((oe,de)=>{var Te,qe,Qe,Ze;const Pe=(Te=oe==null?void 0:oe.borders)==null?void 0:Te.l,Z=(qe=oe==null?void 0:oe.borders)==null?void 0:qe.r,ne=(Qe=oe==null?void 0:oe.borders)==null?void 0:Qe.t,ee=(Ze=oe==null?void 0:oe.borders)==null?void 0:Ze.b,te=E.props.borderRadius||0,G=de===0,H=de===O.length-1,ie=le===0,me=le===B.length-1,ke=W>0,Be={background:(oe==null?void 0:oe.fill)||(ke&&E.props.backgroundColor?E.props.backgroundColor:"transparent"),borderLeft:Pe!=null&&Pe.width?`${Pe.width}px solid ${Pe.color||"#000"}`:"none",borderRight:Z!=null&&Z.width?`${Z.width}px solid ${Z.color||"#000"}`:"none",borderTop:ne!=null&&ne.width?`${ne.width}px solid ${ne.color||"#000"}`:"none",borderBottom:ee!=null&&ee.width?`${ee.width}px solid ${ee.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:G&&(ke||ie)?te:0,borderBottomLeftRadius:G&&(ke||me)?te:0,borderTopRightRadius:H&&(ke||ie)?te:0,borderBottomRightRadius:H&&(ke||me)?te:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:Be,children:(oe==null?void 0:oe.text)&&n.jsx("div",{style:{fontSize:oe.fontSize||12,color:oe.color||"#000",whiteSpace:"pre-wrap"},children:oe.text})},`${le}-${de}`)}))})})(),E.type==="qr"&&n.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=${E.props.width||120}x${E.props.height||120}&data=${encodeURIComponent(E.props.url||"")}`,style:{width:E.props.width||120,height:E.props.height||120},alt:"QR Code"}),E.type==="signature"&&n.jsx("div",{style:{fontSize:E.props.fontSize},children:(E.props.labels||[]).join(" / ")}),E.type==="signature_date"&&(()=>{var P,ce;const L=String(((P=E.props)==null?void 0:P.level)||v(E)||"").trim()||null,O=S(E),B=k({level:L,semester:O});if(!B)return null;const I=am(B.signedAt),T=((ce=E.props)==null?void 0:ce.showMeta)!==!1,W="Sign le:",re=O?`S${O}`:"",ae=L||"",Y=`${ae}${ae&&re?" ":""}${re}`,J=T?`${W}${Y?` ${Y}`:""} ${I}`:`${W} ${I}`;return n.jsx("div",{style:{width:E.props.width||220,height:E.props.height||34,display:"flex",alignItems:"center",justifyContent:E.props.align||"flex-start",fontSize:E.props.fontSize||12,color:E.props.color||"#111",overflow:"hidden",whiteSpace:"nowrap"},children:J})})(),E.type==="final_signature_box"&&n.jsx("div",{style:{width:E.props.width||200,height:E.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999",...A(E)?{}:{display:"none"},...!i&&!A({...E,props:{...E.props,period:"end-year"}})?{display:"none"}:{}},children:(()=>{var I,T;if(i)return" Sign Fin Anne";const L=((I=r==null?void 0:r.data)==null?void 0:I.signatures)||[],O=((T=r==null?void 0:r.data)==null?void 0:T.promotions)||[],B=v(E);if(B){const W=L.find(re=>{if(re.type!=="end_of_year")return!1;if(re.schoolYearName){const ae=O.find(Y=>Y.year===re.schoolYearName);if(ae&&ae.from===B)return!0}return!1});if(W)return` Sign (${W.schoolYearName||"Ancien"})`}return null})()}),E.type==="final_signature_info"&&n.jsx("div",{style:{width:E.props.width||150,height:E.props.height||30,fontSize:E.props.fontSize||12,color:E.props.color||"#333",display:"flex",alignItems:"center",justifyContent:E.props.align||"flex-start"},children:(()=>{var ae,Y;const O=(((ae=r==null?void 0:r.data)==null?void 0:ae.signatures)||[]).filter(J=>(J==null?void 0:J.type)==="end_of_year").sort((J,P)=>{const ce=new Date(J.signedAt||0).getTime();return new Date(P.signedAt||0).getTime()-ce})[0];if(!(!!O||!!i))return n.jsx("span",{style:{color:"#ccc"},children:E.props.placeholder||"..."});const I=O&&(O.schoolYearName||"")||new Date().getFullYear(),T=((Y=r==null?void 0:r.data)==null?void 0:Y.promotions)||[],W=O?T.find(J=>String(J.year)===String(O.schoolYearName)):null,re=W?W.to:y((t==null?void 0:t.level)||"");return E.props.field==="year"?n.jsx("span",{children:String(I)}):E.props.field==="student"?n.jsxs("span",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}):E.props.field==="studentFirstName"?n.jsx("span",{children:t==null?void 0:t.firstName}):E.props.field==="studentLastName"?n.jsx("span",{children:t==null?void 0:t.lastName}):E.props.field==="nextLevel"?n.jsx("span",{children:re||""}):null})()}),E.type==="signature_box"&&n.jsx("div",{style:{width:E.props.width||200,height:E.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999",...A(E)?{}:{display:"none"}},children:(()=>{var W,re;const L=v(E),O=s==null?void 0:s.level,B=i==null?void 0:i.level;if(L){if(E.props.period==="end-year"){if(i&&(B&&B===L||!B&&(t==null?void 0:t.level)===L)){const ae=i.signatureData||i.signatureUrl;return ae?n.jsx("img",{src:ae,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(s&&(O&&O===L||!O&&(t==null?void 0:t.level)===L)){const ae=s.signatureData||s.signatureUrl;return ae?n.jsx("img",{src:ae,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}}else if(E.props.period==="end-year"){if(i){const ae=i.signatureData||i.signatureUrl;return ae?n.jsx("img",{src:ae,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(s){const ae=s.signatureData||s.signatureUrl;return ae?n.jsx("img",{src:ae,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}const I=((W=r==null?void 0:r.data)==null?void 0:W.signatures)||[],T=((re=r==null?void 0:r.data)==null?void 0:re.promotions)||[];if(L){const ae=I.find(Y=>{if(E.props.period==="end-year"&&Y.type!=="end_of_year"||(!E.props.period||E.props.period==="mid-year")&&Y.type==="end_of_year")return!1;if(Y.level&&Y.level===L)return!0;if(Y.schoolYearName){const J=T.find(P=>P.year===Y.schoolYearName);if(J&&J.from===L)return!0}return!1});if(ae){const Y=ae.signatureData||ae.signatureUrl;return Y?n.jsx("img",{src:Y,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${ae.schoolYearName||"Ancien"})`}}return null})()})]},q))]},$)})})]}):null}function b_({options:e,value:t,onChange:r,placeholder:s="Slectionner...",disabled:i=!1,className:a}){const[o,l]=p.useState(!1),[c,u]=p.useState(""),d=p.useRef(null),f=p.useRef(null),h=e.find(g=>g.value===t);p.useEffect(()=>{const g=x=>{d.current&&!d.current.contains(x.target)&&l(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]),p.useEffect(()=>{o&&f.current&&f.current.focus(),o||u("")},[o]);const m=p.useMemo(()=>{if(!c)return e;const g=c.toLowerCase();return e.filter(x=>x.label.toLowerCase().includes(g)||x.subLabel&&x.subLabel.toLowerCase().includes(g))},[e,c]);return n.jsxs("div",{ref:d,className:`searchable-select-container ${a||""}`,style:{position:"relative",width:"100%"},children:[n.jsxs("div",{onClick:()=>!i&&l(!o),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",background:i?"#f1f5f9":"white",color:i?"#94a3b8":"#1e293b",cursor:i?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14,minHeight:42,boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[n.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginRight:8},children:h?h.label:n.jsx("span",{style:{color:"#94a3b8"},children:s})}),n.jsx(ub,{size:16,color:"#64748b"})]}),o&&!i&&n.jsxs("div",{style:{position:"absolute",top:"calc(100% + 4px)",left:0,right:0,background:"white",border:"1px solid #cbd5e1",borderRadius:8,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",zIndex:9999,maxHeight:300,display:"flex",flexDirection:"column",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:8,borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:8},children:[n.jsx(No,{size:14,color:"#94a3b8"}),n.jsx("input",{ref:f,value:c,onChange:g=>u(g.target.value),placeholder:"Rechercher...",style:{border:"none",outline:"none",width:"100%",fontSize:13,background:"transparent"},onClick:g=>g.stopPropagation()}),c&&n.jsx(Ai,{size:14,color:"#94a3b8",style:{cursor:"pointer"},onClick:g=>{g.stopPropagation(),u("")}})]}),n.jsx("div",{style:{overflowY:"auto",flex:1},children:m.length===0?n.jsx("div",{style:{padding:"12px",fontSize:13,color:"#94a3b8",textAlign:"center"},children:"Aucun rsultat"}):m.map(g=>n.jsxs("div",{onClick:()=>{r(g.value),l(!1)},style:{padding:"8px 12px",cursor:"pointer",fontSize:14,color:"#334155",background:g.value===t?"#f1f5f9":"white",display:"flex",flexDirection:"column",transition:"background 0.15s"},onMouseEnter:x=>x.currentTarget.style.background="#e8ecf8",onMouseLeave:x=>x.currentTarget.style.background=g.value===t?"#f1f5f9":"white",children:[n.jsx("span",{children:g.label}),g.subLabel&&n.jsx("span",{style:{fontSize:12,color:"#64748b"},children:g.subLabel})]},g.value))})]})]})}function j_(){var B,I,T,W,re,ae,Y,J;const[e,t]=p.useState("saved"),[r,s]=p.useState([]),[i,a]=p.useState(""),[o,l]=p.useState([]),[c,u]=p.useState(""),[d,f]=p.useState([]),[h,m]=p.useState(""),[g,x]=p.useState([]),[y,v]=p.useState(""),[S,k]=p.useState([]),[j,_]=p.useState(""),[b,A]=p.useState([]),[z,D]=p.useState(""),[w,N]=p.useState(null),[$,E]=p.useState(null),[q,L]=p.useState(!1),O=async P=>{var ce,pe,ye;L(!0);try{const se=await K.get(`/saved-gradebooks/${P}`);if(N(se.data),(ce=se.data.data)!=null&&ce.template)E(se.data.data.template);else if(se.data.templateId){let ve=(await K.get(`/templates/${se.data.templateId}`)).data;const le=(pe=se.data.data)==null?void 0:pe.assignment,oe=(le==null?void 0:le.templateVersion)??((ye=se.data.meta)==null?void 0:ye.templateVersion);if(oe&&ve.versionHistory){const de=ve.versionHistory.find(Pe=>Pe.version===oe);de&&(ve={...ve,pages:de.pages,variables:de.variables||{},watermark:de.watermark})}E(ve)}else E(null)}catch{N(null),E(null)}finally{L(!1)}};return p.useEffect(()=>{e==="saved"?K.get("/saved-gradebooks/years").then(P=>s(P.data)):K.get("/saved-gradebooks/exited/years").then(P=>x(P.data))},[e]),p.useEffect(()=>{a(""),l([]),u(""),f([]),m(""),v(""),k([]),_(""),A([]),D(""),N(null),E(null)},[e]),p.useEffect(()=>{e==="saved"&&i&&(K.get(`/saved-gradebooks/years/${i}/levels`).then(P=>l(P.data)),u(""),f([]),N(null),E(null))},[e,i]),p.useEffect(()=>{e==="saved"&&i&&c&&(K.get(`/saved-gradebooks/years/${i}/levels/${c}/students`).then(P=>f(P.data)),m(""),N(null),E(null))},[e,i,c]),p.useEffect(()=>{e==="saved"&&h&&O(h)},[e,h]),p.useEffect(()=>{e==="exited"&&y&&(K.get(`/saved-gradebooks/exited/years/${y}/students`).then(P=>k(P.data)),_(""),A([]),D(""),N(null),E(null))},[e,y]),p.useEffect(()=>{e==="exited"&&j&&K.get(`/saved-gradebooks/student/${j}`).then(P=>{const ce=Array.isArray(P.data)?P.data:[];A(ce);const ye=(y?ce.find(se=>String(se.schoolYearId)===String(y)):null)||ce[0];D(ye!=null&&ye._id?String(ye._id):"")})},[e,j,y]),p.useEffect(()=>{e==="exited"&&z&&O(z)},[e,z]),n.jsxs("div",{className:"subadmin-gradebooks-container",children:[n.jsx(jd,{}),n.jsx("div",{className:"subadmin-header",children:n.jsx("h1",{className:"subadmin-title",children:"Consultation des Carnets"})}),n.jsxs("div",{className:"filters-card",children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"Type"}),n.jsxs("select",{className:"filter-select",value:e,onChange:P=>t(P.target.value),children:[n.jsx("option",{value:"saved",children:"En cours"}),n.jsx("option",{value:"exited",children:"Archives"})]})]}),e==="saved"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"Anne Scolaire"}),n.jsxs("select",{className:"filter-select",value:i,onChange:P=>a(P.target.value),children:[n.jsx("option",{value:"",children:"Slectionner une anne..."}),r.map(P=>n.jsx("option",{value:P._id,children:P.name},P._id))]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"Niveau"}),n.jsxs("select",{className:"filter-select",value:c,onChange:P=>u(P.target.value),disabled:!i,children:[n.jsx("option",{value:"",children:"Slectionner un niveau..."}),o.map(P=>n.jsx("option",{value:P,children:P},P))]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"lve"}),n.jsx(b_,{options:d.map(P=>({value:P._id,label:`${P.firstName} ${P.lastName}`})),value:h,onChange:P=>m(P),disabled:!c,placeholder:"Slectionner un lve..."})]})]}),e==="exited"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"Anne de sortie"}),n.jsxs("select",{className:"filter-select",value:y,onChange:P=>v(P.target.value),children:[n.jsx("option",{value:"",children:"Slectionner une anne..."}),g.map(P=>n.jsxs("option",{value:P._id,children:[P.name,typeof P.count=="number"?` (${P.count})`:""]},P._id))]})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"lve"}),n.jsx(b_,{options:S.map(P=>({value:P.studentId,label:`${P.firstName} ${P.lastName}`,subLabel:P.exitLevel?`(${P.exitLevel})`:void 0})),value:j,onChange:P=>_(P),disabled:!y,placeholder:"Slectionner un lve..."})]}),n.jsxs("div",{className:"filter-group",children:[n.jsx("label",{className:"filter-label",children:"Carnet"}),n.jsxs("select",{className:"filter-select",value:z,onChange:P=>D(P.target.value),disabled:!j,children:[n.jsx("option",{value:"",children:"Slectionner un carnet..."}),b.filter(P=>!y||String(P.schoolYearId)===String(y)).map(P=>n.jsxs("option",{value:P._id,children:[P.yearName||P.schoolYearId,P.level?` - ${P.level}`:""]},P._id))]})]})]})]}),q&&n.jsx("div",{className:"loading-state",children:"Chargement du carnet en cours..."}),w&&$&&n.jsxs("div",{className:"preview-card",children:[n.jsxs("div",{className:"preview-header",children:[n.jsxs("h3",{className:"preview-title",children:["Carnet de ",w.data.student.firstName," ",w.data.student.lastName]}),n.jsxs("button",{className:"download-btn",onClick:()=>{const P=(K.defaults.baseURL||"").replace(/\/$/,""),ce=iP(P,w._id),pe=`${w.data.student.firstName} ${w.data.student.lastName}`;wd(ce,pe,"single",1)},children:[n.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Tlcharger PDF"]})]}),n.jsx("div",{className:"renderer-wrapper",children:n.jsx(Yne,{template:$,student:w.data.student,assignment:w.data.assignment,signature:((B=w.data.signatures)==null?void 0:B.find(P=>P.type==="standard"))||((W=(T=(I=w.data.assignment)==null?void 0:I.data)==null?void 0:T.signatures)==null?void 0:W.find(P=>P.type==="standard"))||w.data.signature,finalSignature:((re=w.data.signatures)==null?void 0:re.find(P=>P.type==="end_of_year"))||((J=(Y=(ae=w.data.assignment)==null?void 0:ae.data)==null?void 0:Y.signatures)==null?void 0:J.find(P=>P.type==="end_of_year"))||w.data.finalSignature})})]})]})}const w_={teacher:{icon:Ts,label:"Enseignants",color:"#3b82f6",bg:"#eff6ff"},subadmin:{icon:bd,label:"Sous-admins",color:"#8b5cf6",bg:"#f5f3ff"},aefe:{icon:vp,label:"AEFE",color:"#f59e0b",bg:"#fffbeb"},template:{icon:Wh,label:"Carnets",color:"#10b981",bg:"#ecfdf5"}};function Kne(){const{levels:e}=la(),{activeYearId:t,years:r}=Yn(),[s,i]=p.useState([]),[a,o]=p.useState([]),[l,c]=p.useState([]),[u,d]=p.useState([]),[f,h]=p.useState([]),[m,g]=p.useState([]),[x,y]=p.useState([]),[v,S]=p.useState([]),[k,j]=p.useState([]),[_,b]=p.useState([]),[A,z]=p.useState(""),[D,w]=p.useState([]),[N,$]=p.useState([]),[E,q]=p.useState(!1),[L,O]=p.useState(""),[B,I]=p.useState(""),[T,W]=p.useState(""),[re,ae]=p.useState(""),[Y,J]=p.useState(""),[P,ce]=p.useState(""),[pe,ye]=p.useState(""),[se,je]=p.useState(!1),[ve,le]=p.useState(null),[oe,de]=p.useState(null),[Pe,Z]=p.useState("teacher"),[ne,ee]=p.useState(""),[te,G]=p.useState(""),[H,ie]=p.useState(""),[me,ke]=p.useState(""),[Be,Te]=p.useState(null),[qe,Qe]=p.useState(""),[Ze,ge]=p.useState(!1),[Ae,Le]=p.useState(""),[Q,be]=p.useState([]),[we,Ne]=p.useState(new Set),V=async()=>{if(t)try{je(!0),le(null);const[R,_e,We,jt,Ht,Yt,_t,mr]=await Promise.all([K.get("/users"),K.get(`/classes?schoolYearId=${t}`),K.get("/students"),K.get("/templates"),K.get(`/teacher-assignments?schoolYearId=${t}`),K.get("/subadmin-assignments"),K.get(`/template-assignments?schoolYearId=${t}`),K.get("/subadmin-assignments/levels")]),yr=R.data;i(yr.filter(Kt=>Kt.role==="TEACHER")),o(yr.filter(Kt=>Kt.role==="SUBADMIN")),c(yr.filter(Kt=>Kt.role==="AEFE")),d(_e.data),h(We.data),g(jt.data),y(Ht.data),S(Yt.data),b(_t.data),j(mr.data)}catch{le("Impossible de charger les donnes. Ressayez dans quelques instants.")}finally{je(!1)}};p.useEffect(()=>{t&&V()},[t]);const fe=async()=>{if(!(!A||D.length===0))try{de("assign-teacher"),await Promise.all(D.map(R=>K.post("/teacher-assignments",{teacherId:A,classId:R,languages:N,isProfPolyvalent:E}))),ye(` ${D.length} classes assignes`),w([]),setTimeout(()=>ye(""),3e3),V()}catch{ye(" chec de l'assignation")}finally{de(null)}},Oe=(R,_e)=>{Qe(""),Te({type:"teacher-assignment",assignmentId:R,label:_e})},Fe=async()=>{try{de("assign-subadmin-level");const R=await K.post("/subadmin-assignments/bulk-level",{subAdminId:B,level:L,schoolYearId:t});ye(` ${R.data.message}`),setTimeout(()=>ye(""),3e3),V()}catch{ye(" chec de l'assignation")}finally{de(null)}},Ve=async()=>{try{de("assign-aefe-level");const R=await K.post("/subadmin-assignments/bulk-level",{subAdminId:re,level:T,schoolYearId:t});ye(` ${R.data.message}`),setTimeout(()=>ye(""),3e3),V()}catch{ye(" chec de l'assignation")}finally{de(null)}},tt=async()=>{try{de("assign-template-level");const R=await K.post("/template-assignments/bulk-level",{templateId:P,level:Y,schoolYearId:t});ye(` ${R.data.message}`),setTimeout(()=>ye(""),3e3),V()}catch{ye(" chec de l'assignation")}finally{de(null)}},Wt=async R=>{try{const _e=await K.get(`/teacher-assignments?schoolYearId=${R}`);be(_e.data),Le(R);const We=new Set(_e.data.map((jt,Ht)=>Ht));Ne(We)}catch(_e){console.error(_e)}},Ct=()=>{const R=[...r].sort((jt,Ht)=>new Date(Ht.startDate).getTime()-new Date(jt.startDate).getTime()),_e=R.findIndex(jt=>jt._id===t);let We=R[_e+1];!We&&R.length>1&&(We=R.find(jt=>jt._id!==t)),We?(Wt(We._id),ge(!0)):alert("Aucune autre anne scolaire trouve pour l'importation.")},Ot=async()=>{const R=Q.filter((_e,We)=>we.has(We));if(R.length!==0)try{de("import");const _e=await K.post("/teacher-assignments/import",{sourceAssignments:R,targetYearId:t});ye(` ${_e.data.importedCount} assignations importes`),_e.data.errors&&_e.data.errors.length>0&&alert(`Import avec des erreurs:
${_e.data.errors.join(`
`)}`),ge(!1),V(),setTimeout(()=>ye(""),3e3)}catch{ye(" chec de l'import")}finally{de(null)}},et=(R,_e,We)=>{Qe(""),Te({type:"subadmin-level",subAdminId:R,level:_e,label:We})},nt=(R,_e,We)=>{Qe(""),Te({type:"template-level",templateId:R,level:_e,label:We})},ft=async()=>{if(Be&&qe.trim().toUpperCase()==="SUPPRIMER")try{de("delete"),Be.type==="teacher-assignment"&&(await K.delete(`/teacher-assignments/${Be.assignmentId}`),ye(" Assignation supprime")),Be.type==="subadmin-level"&&(await K.delete(`/subadmin-assignments/levels/${Be.subAdminId}/${Be.level}`),ye(" Assignation supprime")),Be.type==="template-level"&&(await K.delete(`/template-assignments/bulk-level/${Be.templateId}/${Be.level}?schoolYearId=${t}`),ye(" Assignations supprimes")),setTimeout(()=>ye(""),3e3),Te(null),Qe(""),V()}catch{ye(" chec de la suppression")}finally{de(null)}},vt=p.useMemo(()=>{var R;return((R=r.find(_e=>_e._id===t))==null?void 0:R.name)??""},[r,t]),Zt=p.useMemo(()=>{const R=ne.trim().toLowerCase();return R?s.filter(_e=>`${_e.displayName} ${_e.email}`.toLowerCase().includes(R)):s},[s,ne]),Se=p.useMemo(()=>x.filter(R=>R.teacherId===A),[x,A]),Ie=p.useMemo(()=>{const R=H.trim().toLowerCase();return R?Se.filter(_e=>(_e.className??"").toLowerCase().includes(R)):Se},[Se,H]),Re=p.useMemo(()=>new Set(Se.map(R=>R.classId)),[Se]),ht=p.useMemo(()=>u.filter(R=>!Re.has(R._id)),[u,Re]),Et=p.useMemo(()=>{const R=te.trim().toLowerCase();return R?ht.filter(_e=>_e.name.toLowerCase().includes(R)):ht},[ht,te]),Mt=p.useMemo(()=>k.filter(R=>a.some(_e=>_e._id===R.subAdminId)).map(R=>({...R,levels:[...R.levels].sort()})).sort((R,_e)=>R.subAdminName.localeCompare(_e.subAdminName)),[k,a]),St=p.useMemo(()=>k.filter(R=>l.some(_e=>_e._id===R.subAdminId)).map(R=>({...R,levels:[...R.levels].sort()})).sort((R,_e)=>R.subAdminName.localeCompare(_e.subAdminName)),[k,l]),ir=p.useMemo(()=>{const R=new Map;return _.forEach(_e=>{var jt;const We=_e.templateName||"Unknown";if(R.has(We)||R.set(We,{templateId:_e.templateId,levels:new Set}),_e.classId){const Ht=u.find(Yt=>Yt._id===_e.classId);Ht!=null&&Ht.level&&((jt=R.get(We))==null||jt.levels.add(Ht.level))}}),Array.from(R.entries()).map(([_e,We])=>({name:_e,templateId:We.templateId,levels:Array.from(We.levels).sort()})).sort((_e,We)=>_e.name.localeCompare(We.name))},[_,u]),$e=p.useMemo(()=>{const R=me.trim().toLowerCase();return Q.map((_e,We)=>({ta:_e,idx:We})).filter(({ta:_e})=>R?`${_e.teacherName??""} ${_e.className??""} ${(_e.languages??[]).join(",")}`.toLowerCase().includes(R):!0)},[Q,me]),He=p.useMemo(()=>$e.length===0?!1:$e.every(R=>we.has(R.idx)),[$e,we]),Ge=p.useMemo(()=>({teacher:x.length,subadmin:Mt.reduce((R,_e)=>R+_e.levels.length,0),aefe:St.reduce((R,_e)=>R+_e.levels.length,0),template:ir.reduce((R,_e)=>R+_e.levels.length,0)}),[x,Mt,St,ir]);return n.jsxs("div",{className:"aa-page",children:[n.jsx("header",{className:"aa-header",children:n.jsxs("div",{className:"aa-header-content",children:[n.jsxs("div",{className:"aa-header-left",children:[n.jsx("div",{className:"aa-header-icon",children:n.jsx(Ts,{size:24})}),n.jsxs("div",{children:[n.jsx("h1",{className:"aa-title",children:"Gestion des assignations"}),n.jsxs("p",{className:"aa-subtitle",children:[n.jsx("span",{className:"aa-year-badge",children:vt}),"Grez les assignations des enseignants, carnets et sous-administrateurs"]})]})]}),n.jsxs("div",{className:"aa-header-actions",children:[n.jsxs(rr,{to:"/admin/assignment-list",className:"aa-btn aa-btn-secondary",children:[n.jsx(pb,{size:16}),"Voir toutes"]}),n.jsx(rr,{to:"/admin",className:"aa-btn aa-btn-ghost",children:"Retour"})]})]})}),pe&&n.jsxs("div",{className:`aa-toast ${pe.includes("")?"aa-toast-success":"aa-toast-error"}`,children:[pe.includes("")?n.jsx(fb,{size:18}):n.jsx(Lo,{size:18}),n.jsx("span",{children:pe})]}),ve&&n.jsxs("div",{className:"aa-error-banner",children:[n.jsx(Lo,{size:18}),n.jsx("span",{children:ve}),n.jsx("button",{onClick:V,className:"aa-btn aa-btn-sm",children:"Ressayer"})]}),n.jsxs("nav",{className:"aa-tabs",children:[Object.keys(w_).map(R=>{const _e=w_[R],We=_e.icon,jt=Pe===R;return n.jsxs("button",{className:`aa-tab ${jt?"aa-tab-active":""}`,onClick:()=>Z(R),style:{"--tab-color":_e.color,"--tab-bg":_e.bg},children:[n.jsx(We,{size:18}),n.jsx("span",{className:"aa-tab-label",children:_e.label}),n.jsx("span",{className:"aa-tab-count",children:Ge[R]})]},R)}),se&&n.jsxs("div",{className:"aa-loading-indicator",children:[n.jsx(io,{size:16,className:"aa-spin"}),n.jsx("span",{children:"Chargement"})]})]}),Pe==="teacher"&&n.jsx("div",{className:"aa-content",children:n.jsxs("div",{className:"aa-panel",children:[n.jsxs("div",{className:"aa-panel-header",children:[n.jsxs("div",{className:"aa-panel-title",children:[n.jsx(Ts,{size:20,style:{color:"#3b82f6"}}),n.jsx("span",{children:"Enseignant  Classe"})]}),n.jsxs("button",{className:"aa-btn aa-btn-outline",onClick:Ct,disabled:oe!==null||se,children:[n.jsx(mb,{size:16}),"Importer N-1"]})]}),n.jsxs("div",{className:"aa-search-row",children:[n.jsxs("div",{className:"aa-search-field",children:[n.jsx(No,{size:16,className:"aa-search-icon"}),n.jsx("input",{type:"text",className:"aa-input",value:ne,onChange:R=>ee(R.target.value),placeholder:"Rechercher un enseignant",disabled:se})]}),n.jsxs("select",{className:"aa-select",value:A,disabled:se,onChange:R=>{z(R.target.value),w([]),G(""),ie("")},children:[n.jsx("option",{value:"",children:"Slectionner un enseignant"}),Zt.map(R=>n.jsxs("option",{value:R._id,children:[R.displayName," (",R.email,")"]},R._id))]})]}),!A&&n.jsxs("div",{className:"aa-empty-state",children:[n.jsx(Ts,{size:48,strokeWidth:1}),n.jsx("p",{children:"Slectionnez un enseignant pour grer ses assignations"})]}),A&&n.jsxs("div",{className:"aa-split-view",children:[n.jsxs("div",{className:"aa-split-panel aa-split-panel-new",children:[n.jsxs("h4",{className:"aa-split-title",children:[n.jsx(Fs,{size:16}),"Nouvelle assignation",D.length>0&&n.jsx("span",{className:"aa-badge",children:D.length})]}),n.jsxs("div",{className:"aa-search-field aa-search-field-sm",children:[n.jsx(No,{size:14,className:"aa-search-icon"}),n.jsx("input",{type:"text",className:"aa-input aa-input-sm",value:te,onChange:R=>G(R.target.value),placeholder:"Filtrer les classes",disabled:se||oe!==null})]}),n.jsxs("div",{className:"aa-list-actions",children:[n.jsxs("span",{className:"aa-list-count",children:[Et.length," disponible(s)"]}),n.jsxs("div",{className:"aa-list-btns",children:[n.jsx("button",{type:"button",className:"aa-btn aa-btn-xs",disabled:Et.length===0||se||oe!==null,onClick:()=>w(Array.from(new Set([...D,...Et.map(R=>R._id)]))),children:"Tout"}),n.jsx("button",{type:"button",className:"aa-btn aa-btn-xs",disabled:D.length===0||se||oe!==null,onClick:()=>w([]),children:"Aucun"})]})]}),n.jsx("div",{className:"aa-checkbox-list",children:ht.length===0?n.jsx("div",{className:"aa-list-empty",children:"Toutes les classes sont assignes"}):Et.length===0?n.jsx("div",{className:"aa-list-empty",children:"Aucune classe ne correspond"}):Et.map(R=>n.jsxs("label",{className:`aa-checkbox-item ${D.includes(R._id)?"aa-checkbox-item-selected":""}`,children:[n.jsx("input",{type:"checkbox",checked:D.includes(R._id),onChange:_e=>{_e.target.checked?w([...D,R._id]):w(D.filter(We=>We!==R._id))},disabled:oe!==null||se}),n.jsx("span",{children:R.name})]},R._id))}),n.jsxs("div",{className:"aa-options-section",children:[n.jsx("label",{className:"aa-option-label",children:"Langues autorises"}),n.jsxs("div",{className:"aa-lang-chips",children:[["ar","en"].map(R=>n.jsx("button",{type:"button",className:`aa-lang-chip ${N.includes(R)?"aa-lang-chip-active":""}`,disabled:E||se||oe!==null,onClick:()=>{N.includes(R)?$(N.filter(_e=>_e!==R)):$([...N,R])},children:R.toUpperCase()},R)),N.length===0&&!E&&n.jsx("span",{className:"aa-lang-hint",children:"Toutes langues"})]})]}),n.jsxs("label",{className:"aa-toggle",children:[n.jsx("input",{type:"checkbox",checked:E,onChange:R=>{const _e=R.target.checked;q(_e),_e&&$([])},disabled:se||oe!==null}),n.jsx("span",{className:"aa-toggle-slider"}),n.jsx("span",{className:"aa-toggle-label",children:"Prof Polyvalent"})]}),n.jsxs("button",{className:"aa-btn aa-btn-primary aa-btn-full",onClick:fe,disabled:D.length===0||se||oe!==null,children:[oe==="assign-teacher"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx(Fs,{size:16}),"Assigner ",D.length>0?`(${D.length})`:""]})]}),n.jsxs("div",{className:"aa-split-panel aa-split-panel-current",children:[n.jsxs("h4",{className:"aa-split-title",children:[n.jsx($a,{size:16}),"Assignations actuelles",n.jsx("span",{className:"aa-badge aa-badge-muted",children:Se.length})]}),n.jsxs("div",{className:"aa-search-field aa-search-field-sm",children:[n.jsx(No,{size:14,className:"aa-search-icon"}),n.jsx("input",{type:"text",className:"aa-input aa-input-sm",value:H,onChange:R=>ie(R.target.value),placeholder:"Filtrer",disabled:se})]}),n.jsx("div",{className:"aa-assignment-list",children:Ie.length===0?n.jsx("div",{className:"aa-list-empty",children:"Aucune assignation"}):Ie.map(R=>n.jsxs("div",{className:"aa-assignment-card",children:[n.jsxs("div",{className:"aa-assignment-info",children:[n.jsx("span",{className:"aa-assignment-name",children:R.className}),n.jsx("div",{className:"aa-assignment-meta",children:R.isProfPolyvalent?n.jsx("span",{className:"aa-tag aa-tag-purple",children:"Polyvalent"}):R.languages&&R.languages.length>0?n.jsx("span",{className:"aa-tag",children:R.languages.join(", ").toUpperCase()}):n.jsx("span",{className:"aa-tag aa-tag-muted",children:"Toutes langues"})})]}),n.jsx("button",{type:"button",className:"aa-btn-icon aa-btn-icon-danger",onClick:()=>Oe(R._id,`${R.className??"classe"}`),title:"Supprimer",disabled:oe!==null||se,children:n.jsx(Pa,{size:16})})]},R._id))})]})]})]})}),Pe==="subadmin"&&n.jsx("div",{className:"aa-content",children:n.jsxs("div",{className:"aa-panel",children:[n.jsx("div",{className:"aa-panel-header",children:n.jsxs("div",{className:"aa-panel-title",children:[n.jsx(bd,{size:20,style:{color:"#8b5cf6"}}),n.jsx("span",{children:"Sous-admin  Niveau"})]})}),n.jsxs("div",{className:"aa-form-row",children:[n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Sous-administrateur"}),n.jsxs("select",{className:"aa-select",value:B,onChange:R=>I(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner sous-admin"}),a.map(R=>n.jsxs("option",{value:R._id,children:[R.displayName," (",R.email,")"]},R._id))]})]}),n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Niveau"}),n.jsxs("select",{className:"aa-select",value:L,onChange:R=>O(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner niveau"}),e.map(R=>n.jsx("option",{value:R.name,children:R.name},R._id))]})]}),n.jsxs("button",{className:"aa-btn aa-btn-primary",onClick:Fe,disabled:!B||!L||se||oe!==null,children:[oe==="assign-subadmin-level"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx(Fs,{size:16}),"Assigner"]})]}),n.jsxs("div",{className:"aa-summary-section",children:[n.jsxs("div",{className:"aa-summary-header",children:[n.jsx("span",{children:"Assignations existantes"}),n.jsxs("span",{className:"aa-summary-count",children:[Mt.reduce((R,_e)=>R+_e.levels.length,0)," niveau(x)"]})]}),n.jsx("div",{className:"aa-summary-list",children:Mt.length===0?n.jsx("div",{className:"aa-list-empty",children:"Aucune assignation"}):Mt.map(R=>n.jsxs("div",{className:"aa-summary-row",children:[n.jsx("span",{className:"aa-summary-name",children:R.subAdminName}),n.jsx("div",{className:"aa-summary-tags",children:R.levels.map(_e=>n.jsxs("span",{className:"aa-tag aa-tag-removable",children:[_e,n.jsx("button",{type:"button",onClick:()=>et(R.subAdminId,_e,`${R.subAdminName}  ${_e}`),disabled:oe!==null||se,children:n.jsx(Ai,{size:12})})]},_e))})]},R.subAdminId))})]})]})}),Pe==="aefe"&&n.jsx("div",{className:"aa-content",children:n.jsxs("div",{className:"aa-panel",children:[n.jsx("div",{className:"aa-panel-header",children:n.jsxs("div",{className:"aa-panel-title",children:[n.jsx(vp,{size:20,style:{color:"#f59e0b"}}),n.jsx("span",{children:"AEFE  Niveau"})]})}),n.jsxs("div",{className:"aa-form-row",children:[n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Utilisateur AEFE"}),n.jsxs("select",{className:"aa-select",value:re,onChange:R=>ae(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner AEFE"}),l.map(R=>n.jsxs("option",{value:R._id,children:[R.displayName," (",R.email,")"]},R._id))]})]}),n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Niveau"}),n.jsxs("select",{className:"aa-select",value:T,onChange:R=>W(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner niveau"}),e.map(R=>n.jsx("option",{value:R.name,children:R.name},R._id))]})]}),n.jsxs("button",{className:"aa-btn aa-btn-primary",onClick:Ve,disabled:!re||!T||se||oe!==null,children:[oe==="assign-aefe-level"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx(Fs,{size:16}),"Assigner"]})]}),n.jsxs("div",{className:"aa-summary-section",children:[n.jsxs("div",{className:"aa-summary-header",children:[n.jsx("span",{children:"Assignations existantes"}),n.jsxs("span",{className:"aa-summary-count",children:[St.reduce((R,_e)=>R+_e.levels.length,0)," niveau(x)"]})]}),n.jsx("div",{className:"aa-summary-list",children:St.length===0?n.jsx("div",{className:"aa-list-empty",children:"Aucune assignation"}):St.map(R=>n.jsxs("div",{className:"aa-summary-row",children:[n.jsx("span",{className:"aa-summary-name",children:R.subAdminName}),n.jsx("div",{className:"aa-summary-tags",children:R.levels.map(_e=>n.jsxs("span",{className:"aa-tag aa-tag-removable",children:[_e,n.jsx("button",{type:"button",onClick:()=>et(R.subAdminId,_e,`${R.subAdminName}  ${_e}`),disabled:oe!==null||se,children:n.jsx(Ai,{size:12})})]},_e))})]},R.subAdminId))})]})]})}),Pe==="template"&&n.jsx("div",{className:"aa-content",children:n.jsxs("div",{className:"aa-panel",children:[n.jsx("div",{className:"aa-panel-header",children:n.jsxs("div",{className:"aa-panel-title",children:[n.jsx(Wh,{size:20,style:{color:"#10b981"}}),n.jsx("span",{children:"Carnet  Niveau"})]})}),n.jsxs("div",{className:"aa-form-row",children:[n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Carnet"}),n.jsxs("select",{className:"aa-select",value:P,onChange:R=>ce(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner carnet"}),m.map(R=>n.jsx("option",{value:R._id,children:R.name},R._id))]})]}),n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Niveau"}),n.jsxs("select",{className:"aa-select",value:Y,onChange:R=>J(R.target.value),disabled:se||oe!==null,children:[n.jsx("option",{value:"",children:"Slectionner niveau"}),e.map(R=>n.jsx("option",{value:R.name,children:R.name},R._id))]})]}),n.jsxs("button",{className:"aa-btn aa-btn-primary",onClick:tt,disabled:!P||!Y||se||oe!==null,children:[oe==="assign-template-level"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx(Fs,{size:16}),"Assigner"]})]}),n.jsxs("div",{className:"aa-summary-section",children:[n.jsxs("div",{className:"aa-summary-header",children:[n.jsx("span",{children:"Assignations existantes"}),n.jsxs("span",{className:"aa-summary-count",children:[ir.reduce((R,_e)=>R+_e.levels.length,0)," niveau(x)"]})]}),n.jsx("div",{className:"aa-summary-list",children:ir.length===0?n.jsx("div",{className:"aa-list-empty",children:"Aucune assignation"}):ir.map(R=>n.jsxs("div",{className:"aa-summary-row",children:[n.jsx("span",{className:"aa-summary-name",children:R.name}),n.jsx("div",{className:"aa-summary-tags",children:R.levels.length===0?n.jsx("span",{className:"aa-tag aa-tag-muted",children:"Aucun niveau"}):R.levels.map(_e=>n.jsxs("span",{className:"aa-tag aa-tag-removable",children:[_e,n.jsx("button",{type:"button",onClick:()=>nt(R.templateId,_e,`${R.name}  ${_e}`),disabled:oe!==null||se,children:n.jsx(Ai,{size:12})})]},_e))})]},R.name))})]})]})}),Ze&&n.jsx("div",{className:"aa-modal-overlay",onClick:()=>ge(!1),children:n.jsxs("div",{className:"aa-modal",onClick:R=>R.stopPropagation(),children:[n.jsxs("div",{className:"aa-modal-header",children:[n.jsx("h3",{children:"Importer les assignations"}),n.jsx("button",{type:"button",className:"aa-btn-icon",onClick:()=>ge(!1),children:n.jsx(Ai,{size:20})})]}),n.jsxs("div",{className:"aa-modal-body",children:[n.jsxs("div",{className:"aa-form-row",children:[n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Depuis l'anne scolaire"}),n.jsx("select",{className:"aa-select",value:Ae,onChange:R=>Wt(R.target.value),disabled:oe!==null,children:r.filter(R=>R._id!==t).map(R=>n.jsx("option",{value:R._id,children:R.name},R._id))})]}),n.jsxs("div",{className:"aa-form-group",children:[n.jsx("label",{className:"aa-label",children:"Rechercher"}),n.jsxs("div",{className:"aa-search-field",children:[n.jsx(No,{size:14,className:"aa-search-icon"}),n.jsx("input",{className:"aa-input",value:me,onChange:R=>ke(R.target.value),placeholder:"Enseignant, classe"})]})]})]}),n.jsxs("div",{className:"aa-list-actions",children:[n.jsxs("span",{className:"aa-list-count",children:[we.size," slectionne(s)"]}),n.jsxs("div",{className:"aa-list-btns",children:[n.jsx("button",{type:"button",className:"aa-btn aa-btn-xs",disabled:$e.length===0||oe!==null,onClick:()=>{const R=new Set(we);$e.forEach(_e=>R.add(_e.idx)),Ne(R)},children:"Tout"}),n.jsx("button",{type:"button",className:"aa-btn aa-btn-xs",disabled:we.size===0||oe!==null,onClick:()=>{const R=new Set(we);$e.forEach(_e=>R.delete(_e.idx)),Ne(R)},children:"Aucun"})]})]}),n.jsx("div",{className:"aa-import-table-wrapper",children:n.jsxs("table",{className:"aa-import-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:40},children:n.jsx("input",{type:"checkbox",checked:He,disabled:$e.length===0||oe!==null,onChange:R=>{if(R.target.checked){const _e=new Set(we);$e.forEach(We=>_e.add(We.idx)),Ne(_e)}else{const _e=new Set(we);$e.forEach(We=>_e.delete(We.idx)),Ne(_e)}}})}),n.jsx("th",{children:"Enseignant"}),n.jsx("th",{children:"Classe"}),n.jsx("th",{children:"Langues"})]})}),n.jsx("tbody",{children:$e.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"aa-table-empty",children:"Aucune assignation trouve"})}):$e.map(({ta:R,idx:_e})=>n.jsxs("tr",{className:we.has(_e)?"aa-row-selected":"",children:[n.jsx("td",{children:n.jsx("input",{type:"checkbox",checked:we.has(_e),disabled:oe!==null,onChange:We=>{const jt=new Set(we);We.target.checked?jt.add(_e):jt.delete(_e),Ne(jt)}})}),n.jsx("td",{children:R.teacherName}),n.jsx("td",{children:R.className}),n.jsx("td",{children:R.isProfPolyvalent?n.jsx("span",{className:"aa-tag aa-tag-purple",children:"Polyvalent"}):R.languages&&R.languages.length>0?n.jsx("span",{className:"aa-tag",children:R.languages.join(", ").toUpperCase()}):n.jsx("span",{className:"aa-tag aa-tag-muted",children:"Toutes"})})]},_e))})]})})]}),n.jsxs("div",{className:"aa-modal-footer",children:[n.jsx("button",{className:"aa-btn aa-btn-ghost",onClick:()=>ge(!1),disabled:oe!==null,children:"Annuler"}),n.jsxs("button",{className:"aa-btn aa-btn-primary",onClick:Ot,disabled:we.size===0||oe!==null,children:[oe==="import"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx($a,{size:16}),"Importer (",we.size,")"]})]})]})}),Be&&n.jsx("div",{className:"aa-modal-overlay",onClick:()=>{Te(null),Qe("")},children:n.jsxs("div",{className:"aa-modal aa-modal-sm",onClick:R=>R.stopPropagation(),children:[n.jsxs("div",{className:"aa-modal-header aa-modal-header-danger",children:[n.jsx("h3",{children:"Supprimer l'assignation"}),n.jsx("button",{type:"button",className:"aa-btn-icon",onClick:()=>{Te(null),Qe("")},children:n.jsx(Ai,{size:20})})]}),n.jsxs("div",{className:"aa-modal-body",children:[n.jsxs("div",{className:"aa-delete-warning",children:[n.jsx(Lo,{size:24}),n.jsxs("div",{children:[n.jsx("p",{className:"aa-delete-label",children:Be.label}),n.jsxs("p",{className:"aa-delete-hint",children:["Tapez ",n.jsx("strong",{children:"SUPPRIMER"})," pour confirmer"]})]})]}),n.jsx("input",{className:"aa-input",value:qe,onChange:R=>Qe(R.target.value),placeholder:"SUPPRIMER",autoFocus:!0})]}),n.jsxs("div",{className:"aa-modal-footer",children:[n.jsx("button",{className:"aa-btn aa-btn-ghost",onClick:()=>{Te(null),Qe("")},disabled:oe!==null,children:"Annuler"}),n.jsxs("button",{className:"aa-btn aa-btn-danger",onClick:ft,disabled:qe.trim().toUpperCase()!=="SUPPRIMER"||oe!==null,children:[oe==="delete"?n.jsx(io,{size:16,className:"aa-spin"}):n.jsx(Pa,{size:16}),"Supprimer"]})]})]})})]})}function Vne(){const[e,t]=p.useState([]),[r,s]=p.useState([]),[i,a]=p.useState([]),[o,l]=p.useState(!0),[c,u]=p.useState(""),d=v=>{for(let S=1;S<=3;S++)if(!confirm(`${v}

Confirmation ${S}/3`))return!1;return!0};p.useEffect(()=>{f()},[]);const f=async()=>{try{l(!0);const[v,S,k]=await Promise.all([K.get("/teacher-assignments"),K.get("/template-assignments"),K.get("/subadmin-assignments/levels")]);t(v.data),s(S.data);const j=[];k.data.forEach(_=>{_.levels.forEach(b=>{j.push({subAdminId:_.subAdminId,subAdminName:_.subAdminName,level:b})})}),a(j)}catch(v){console.error("Failed to load assignments",v)}finally{l(!1)}},h=async v=>{if(d("Supprimer cette assignation enseignant-classe ?"))try{await K.delete(`/teacher-assignments/${v}`),u(" Assignation supprime"),setTimeout(()=>u(""),3e3),f()}catch{u(" chec de la suppression")}},m=async(v,S)=>{if(d(`Supprimer l'assignation ${S} ?`))try{await K.delete(`/subadmin-assignments/levels/${v}/${S}`),u(" Assignation supprime"),setTimeout(()=>u(""),3e3),f()}catch{u(" chec de la suppression")}},g=async v=>{if(d(`Supprimer ces ${v.length} assignations ?`))try{await Promise.all(v.map(S=>K.delete(`/template-assignments/${S}`))),u(" Assignations supprimes"),setTimeout(()=>u(""),3e3),f()}catch{u(" chec de la suppression")}},x=r.reduce((v,S)=>{if(!S.level)return v;const k=`${S.templateId}-${S.level}`;return v[k]||(v[k]={key:k,templateId:S.templateId,level:S.level,templateName:S.templateName||"",count:0,ids:[]}),v[k].count++,v[k].ids.push(S._id),v},{}),y=Object.values(x);return o?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",style:{display:"flex",justifyContent:"center",padding:48},children:n.jsx("div",{className:"note",children:"Chargement des donnes..."})})}):n.jsxs("div",{className:"container",children:[n.jsxs("div",{style:{marginBottom:32},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:16},children:[n.jsxs("div",{children:[n.jsx("h2",{className:"title",style:{fontSize:"2rem",marginBottom:8},children:"Liste des assignations"}),n.jsx("p",{className:"note",children:"Vue d'ensemble de toutes les relations configures"})]}),n.jsxs("div",{className:"toolbar",children:[n.jsxs(rr,{to:"/admin/assignments",className:"btn",style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{children:"+"})," Nouvelle assignation"]}),n.jsx(rr,{to:"/admin",className:"btn secondary",children:"Retour"})]})]}),c&&n.jsx("div",{style:{marginTop:16,padding:"12px 16px",background:c.includes("")?"#f6ffed":"#fff1f0",border:`1px solid ${c.includes("")?"#b7eb8f":"#ffa39e"}`,color:c.includes("")?"#389e0d":"#cf1322",borderRadius:8,display:"flex",alignItems:"center",gap:8},children:c})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:32},children:[n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20,paddingBottom:16,borderBottom:"1px solid #f0f0f0"},children:[n.jsx("div",{style:{background:"#e6f7ff",padding:8,borderRadius:8,fontSize:20},children:""}),n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0},children:"Enseignant  Classe"}),n.jsxs("div",{className:"note",children:[e.length," assignation(s) active(s)"]})]})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"0 8px"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Enseignant"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Classe"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Langues"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Date"}),n.jsx("th",{style:{textAlign:"right",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Actions"})]})}),n.jsxs("tbody",{children:[e.map(v=>n.jsxs("tr",{style:{background:"#fff",transition:"background 0.2s"},children:[n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderLeft:"1px solid #f0f0f0",borderTopLeftRadius:8,borderBottomLeftRadius:8},children:n.jsx("div",{style:{fontWeight:500},children:v.teacherName||v.teacherId})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:n.jsx("div",{className:"pill",style:{background:"#f0f5ff",color:"#2f54eb",display:"inline-block"},children:v.className||v.classId})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:v.languages&&v.languages.length>0?n.jsx("div",{style:{display:"flex",gap:4},children:v.languages.map(S=>n.jsx("span",{style:{fontSize:"0.75rem",background:"#e6f7ff",padding:"2px 6px",borderRadius:4,color:"#1890ff",textTransform:"uppercase"},children:S},S))}):n.jsx("span",{style:{color:"#ccc",fontSize:"0.85rem"},children:"Toutes"})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",color:"#8c8c8c",fontSize:"0.9rem"},children:new Date(v.assignedAt).toLocaleDateString()}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderRight:"1px solid #f0f0f0",borderTopRightRadius:8,borderBottomRightRadius:8,textAlign:"right"},children:n.jsx("button",{className:"btn secondary",style:{padding:"6px 12px",fontSize:"0.85rem",background:"#fff1f0",color:"#cf1322",border:"1px solid #ffa39e"},onClick:()=>h(v._id),children:"Supprimer"})})]},v._id)),e.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,style:{padding:32,textAlign:"center",color:"#8c8c8c",background:"#fafafa",borderRadius:8},children:"Aucune assignation trouve"})})]})]})})]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20,paddingBottom:16,borderBottom:"1px solid #f0f0f0"},children:[n.jsx("div",{style:{background:"#fff7e6",padding:8,borderRadius:8,fontSize:20},children:""}),n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0},children:"Carnet  Niveau"}),n.jsxs("div",{className:"note",children:[y.length," assignation(s) de groupe"]})]})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"0 8px"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Template"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Niveau"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"lves concerns"}),n.jsx("th",{style:{textAlign:"right",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Actions"})]})}),n.jsxs("tbody",{children:[y.map(v=>n.jsxs("tr",{style:{background:"#fff"},children:[n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderLeft:"1px solid #f0f0f0",borderTopLeftRadius:8,borderBottomLeftRadius:8},children:n.jsx("div",{style:{fontWeight:500},children:v.templateName||v.templateId})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:n.jsx("div",{className:"pill",style:{background:"#fff7e6",color:"#fa8c16",display:"inline-block"},children:v.level})}),n.jsxs("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[v.count," lve(s)"]}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderRight:"1px solid #f0f0f0",borderTopRightRadius:8,borderBottomRightRadius:8,textAlign:"right"},children:n.jsx("button",{className:"btn secondary",style:{padding:"6px 12px",fontSize:"0.85rem",background:"#fff1f0",color:"#cf1322",border:"1px solid #ffa39e"},onClick:()=>g(v.ids),children:"Tout supprimer"})})]},v.key)),y.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,style:{padding:32,textAlign:"center",color:"#8c8c8c",background:"#fafafa",borderRadius:8},children:"Aucune assignation de groupe trouve"})})]})]})})]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20,paddingBottom:16,borderBottom:"1px solid #f0f0f0"},children:[n.jsx("div",{style:{background:"#fff0f6",padding:8,borderRadius:8,fontSize:20},children:""}),n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0},children:"Sous-Admin  levels"}),n.jsxs("div",{className:"note",children:[i.length," assignation(s) active(s)"]})]})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"0 8px"},children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Sous-Admin"}),n.jsx("th",{style:{textAlign:"left",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Niveau"}),n.jsx("th",{style:{textAlign:"right",padding:"0 16px",color:"#8c8c8c",fontWeight:500,fontSize:"0.9rem"},children:"Actions"})]})}),n.jsxs("tbody",{children:[i.map((v,S)=>n.jsxs("tr",{style:{background:"#fff"},children:[n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderLeft:"1px solid #f0f0f0",borderTopLeftRadius:8,borderBottomLeftRadius:8},children:n.jsx("div",{style:{fontWeight:500},children:v.subAdminName||v.subAdminId})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:n.jsx("div",{className:"pill",style:{background:"#fff0f6",color:"#eb2f96",display:"inline-block"},children:v.level})}),n.jsx("td",{style:{padding:"12px 16px",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0",borderRight:"1px solid #f0f0f0",borderTopRightRadius:8,borderBottomRightRadius:8,textAlign:"right"},children:n.jsx("button",{className:"btn secondary",style:{padding:"6px 12px",fontSize:"0.85rem",background:"#fff1f0",color:"#cf1322",border:"1px solid #ffa39e"},onClick:()=>m(v.subAdminId,v.level),children:"Supprimer"})})]},`${v.subAdminId}-${v.level}-${S}`)),i.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,style:{padding:32,textAlign:"center",color:"#8c8c8c",background:"#fafafa",borderRadius:8},children:"Aucune assignation trouve"})})]})]})})]})]})]})}const qne={LOGIN:"auth",LOGOUT:"auth",LOGIN_MICROSOFT:"auth",EDIT_TEMPLATE:"template",UPDATE_TEMPLATE_DATA:"template",SIGN_TEMPLATE:"signature",UNSIGN_TEMPLATE:"signature",UPLOAD_SIGNATURE:"signature",DELETE_SIGNATURE:"signature",CREATE_ASSIGNMENT:"assignment",DELETE_ASSIGNMENT:"assignment",MARK_ASSIGNMENT_DONE:"assignment",UNMARK_ASSIGNMENT_DONE:"assignment",EXPORT_PDF:"export",CREATE_OUTLOOK_USER:"user",UPDATE_OUTLOOK_USER:"user",DELETE_OUTLOOK_USER:"user",CREATE_USER:"user",UPDATE_USER:"user",DELETE_USER:"user",REACTIVATE_USER:"user",START_IMPERSONATION:"impersonation",STOP_IMPERSONATION:"impersonation",PROMOTE_STUDENT:"student",CREATE_STUDENT:"student",UPDATE_STUDENT:"student",DELETE_STUDENT:"student",CREATE_BACKUP:"system",RESTORE_BACKUP:"system",EMPTY_DATABASE:"danger",UPDATE_SCHOOL_YEAR:"system",UPDATE_SETTINGS:"system",RESET_PASSWORD:"user"},al={LOGIN:"Connexion",LOGOUT:"Dconnexion",LOGIN_MICROSOFT:"Connexion Microsoft",EDIT_TEMPLATE:"dition template",UPDATE_TEMPLATE_DATA:"Mise  jour donnes",SIGN_TEMPLATE:"Signature template",UNSIGN_TEMPLATE:"Annulation signature",UPLOAD_SIGNATURE:"Upload signature",DELETE_SIGNATURE:"Suppression signature",CREATE_ASSIGNMENT:"Cration assignation",DELETE_ASSIGNMENT:"Suppression assignation",MARK_ASSIGNMENT_DONE:"Assignation termine",UNMARK_ASSIGNMENT_DONE:"Assignation non termine",EXPORT_PDF:"Export PDF",CREATE_OUTLOOK_USER:"Cration utilisateur Outlook",UPDATE_OUTLOOK_USER:"Mise  jour utilisateur Outlook",DELETE_OUTLOOK_USER:"Suppression utilisateur Outlook",CREATE_USER:"Cration utilisateur",UPDATE_USER:"Modification utilisateur",DELETE_USER:"Suppression utilisateur",REACTIVATE_USER:"Ractivation utilisateur",RESET_PASSWORD:"Rinitialisation mot de passe",START_IMPERSONATION:"Dbut impersonnation",STOP_IMPERSONATION:"Fin impersonnation",PROMOTE_STUDENT:"Promotion lve",CREATE_STUDENT:"Cration lve",UPDATE_STUDENT:"Modification lve",DELETE_STUDENT:"Suppression lve",CREATE_BACKUP:"Cration sauvegarde",RESTORE_BACKUP:"Restauration sauvegarde",EMPTY_DATABASE:"Vidage base de donnes",UPDATE_SCHOOL_YEAR:"Changement anne scolaire",UPDATE_SETTINGS:"Modification paramtres"},Py={ADMIN:"Administrateur",SUBADMIN:"Sous-Admin",TEACHER:"Enseignant"},os={activity:n.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),refresh:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("polyline",{points:"23 4 23 10 17 10"}),n.jsx("polyline",{points:"1 20 1 14 7 14"}),n.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),download:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n.jsx("polyline",{points:"7 10 12 15 17 10"}),n.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),chevronLeft:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"15 18 9 12 15 6"})}),chevronRight:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"9 18 15 12 9 6"})}),inbox:n.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12"}),n.jsx("path",{d:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"})]}),close:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),crown:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M2 8l4 10h12l4-10-6 4-4-8-4 8-6-4z"})}),shield:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),book:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),n.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),users:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"9",cy:"7",r:"4"}),n.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),n.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),eye:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),n.jsx("circle",{cx:"12",cy:"12",r:"3"})]})};function Gne(){const[e,t]=p.useState([]),[r,s]=p.useState(null),[i,a]=p.useState(!0),[o,l]=p.useState("ALL"),[c,u]=p.useState(""),[d,f]=p.useState(""),[h,m]=p.useState(""),[g,x]=p.useState(""),[y,v]=p.useState(0),[S,k]=p.useState(0),[j,_]=p.useState(null),b=50;p.useEffect(()=>{A()},[y,c,d,h,g,o]),p.useEffect(()=>{z()},[]);const A=async()=>{try{a(!0);const I={limit:b,skip:y*b};c&&(I.action=c),d&&(I.userId=d),h&&(I.startDate=h),g&&(I.endDate=g),o!=="ALL"&&(I.userRole=o);const T=await K.get("/audit-logs",{params:I});t(T.data.logs),k(T.data.total)}catch(I){console.error("Failed to load audit logs",I)}finally{a(!1)}},z=async()=>{try{const I=await K.get("/audit-logs/stats");s(I.data)}catch(I){console.error("Failed to load stats",I)}},D=p.useMemo(()=>{if(!(r!=null&&r.roleCounts))return{ADMIN:0,SUBADMIN:0,TEACHER:0};const I={ADMIN:0,SUBADMIN:0,TEACHER:0};return r.roleCounts.forEach(T=>{I[T._id]=T.count}),I},[r]),w=()=>{u(""),f(""),m(""),x(""),l("ALL"),v(0)},N=async()=>{try{const I={limit:1e4};c&&(I.action=c),d&&(I.userId=d),h&&(I.startDate=h),g&&(I.endDate=g),o!=="ALL"&&(I.userRole=o);const W=(await K.get("/audit-logs",{params:I})).data.logs,re=["Date","Utilisateur","Rle","Action","Dtails","IP"],ae=W.map(pe=>[new Date(pe.timestamp).toLocaleString("fr-FR"),pe.userName,Py[pe.userRole]||pe.userRole,al[pe.action]||pe.action,JSON.stringify(pe.details||{}),pe.ipAddress]),Y=[re,...ae].map(pe=>pe.map(ye=>`"${String(ye).replace(/"/g,'""')}"`).join(",")).join(`
`),J=new Blob(["\uFEFF"+Y],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(J),ce=document.createElement("a");ce.href=P,ce.download=`audit-logs-${new Date().toISOString().split("T")[0]}.csv`,ce.click(),URL.revokeObjectURL(P)}catch(I){console.error("Failed to export logs",I)}},$=I=>{const T=new Date(I);return{date:T.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),time:T.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}},E=I=>!I||Object.keys(I).length===0?null:Object.entries(I).filter(([T])=>!["passwordHash","_id","__v"].includes(T)).slice(0,4).map(([T,W])=>({key:T==="email"?"Email":T==="role"?"Rle":T==="targetUserEmail"?"Cible":T==="studentName"?"lve":T==="className"?"Classe":T==="templateName"?"Template":T,value:String(W).substring(0,50)})),q=I=>{switch(I){case"ADMIN":return os.crown;case"SUBADMIN":return os.shield;case"TEACHER":return os.book;default:return null}},L=I=>qne[I]||"auth",O=Math.ceil(S/b),B=p.useMemo(()=>Object.keys(al).sort((T,W)=>(al[T]||T).localeCompare(al[W]||W)),[]);return n.jsxs("div",{className:"audit-logs-page",children:[n.jsxs("div",{className:"audit-header",children:[n.jsxs("h1",{children:[os.activity,"Journal d'activit"]}),n.jsx("p",{className:"audit-subtitle",children:"Suivi de toutes les actions des utilisateurs du systme"})]}),r&&n.jsxs("div",{className:"audit-stats-grid",children:[n.jsxs("div",{className:"audit-stat-card total",children:[n.jsx("div",{className:"audit-stat-label",children:"Total des logs"}),n.jsx("div",{className:"audit-stat-value",children:r.totalLogs.toLocaleString()})]}),n.jsxs("div",{className:"audit-stat-card recent",children:[n.jsx("div",{className:"audit-stat-label",children:"Dernires 24h"}),n.jsx("div",{className:"audit-stat-value",children:r.recentLogs.toLocaleString()})]}),n.jsxs("div",{className:"audit-stat-card admin",children:[n.jsx("div",{className:"audit-stat-label",children:"Admin"}),n.jsx("div",{className:"audit-stat-value",children:D.ADMIN.toLocaleString()})]}),n.jsxs("div",{className:"audit-stat-card subadmin",children:[n.jsx("div",{className:"audit-stat-label",children:"Sous-Admin"}),n.jsx("div",{className:"audit-stat-value",children:D.SUBADMIN.toLocaleString()})]}),n.jsxs("div",{className:"audit-stat-card teacher",children:[n.jsx("div",{className:"audit-stat-label",children:"Enseignants"}),n.jsx("div",{className:"audit-stat-value",children:D.TEACHER.toLocaleString()})]})]}),n.jsxs("div",{className:"audit-role-tabs",children:[n.jsxs("button",{className:`audit-role-tab ${o==="ALL"?"active":""}`,onClick:()=>{l("ALL"),v(0)},children:[os.users,"Tous",n.jsx("span",{className:"audit-role-tab-count",children:(r==null?void 0:r.totalLogs)||0})]}),n.jsxs("button",{className:`audit-role-tab admin-tab ${o==="ADMIN"?"active":""}`,onClick:()=>{l("ADMIN"),v(0)},children:[os.crown,"Administrateurs",n.jsx("span",{className:"audit-role-tab-count",children:D.ADMIN})]}),n.jsxs("button",{className:`audit-role-tab subadmin-tab ${o==="SUBADMIN"?"active":""}`,onClick:()=>{l("SUBADMIN"),v(0)},children:[os.shield,"Sous-Admins",n.jsx("span",{className:"audit-role-tab-count",children:D.SUBADMIN})]}),n.jsxs("button",{className:`audit-role-tab teacher-tab ${o==="TEACHER"?"active":""}`,onClick:()=>{l("TEACHER"),v(0)},children:[os.book,"Enseignants",n.jsx("span",{className:"audit-role-tab-count",children:D.TEACHER})]})]}),n.jsxs("div",{className:"audit-filters",children:[n.jsxs("div",{className:"audit-filters-row",children:[n.jsxs("div",{className:"audit-filter-group",children:[n.jsx("label",{className:"audit-filter-label",children:"Action"}),n.jsxs("select",{className:"audit-filter-select",value:c,onChange:I=>{u(I.target.value),v(0)},children:[n.jsx("option",{value:"",children:"Toutes les actions"}),B.map(I=>n.jsx("option",{value:I,children:al[I]||I},I))]})]}),n.jsxs("div",{className:"audit-filter-group",children:[n.jsx("label",{className:"audit-filter-label",children:"Utilisateur (ID ou nom)"}),n.jsx("input",{type:"text",className:"audit-filter-input",placeholder:"Rechercher...",value:d,onChange:I=>{f(I.target.value),v(0)}})]}),n.jsxs("div",{className:"audit-filter-group",style:{minWidth:140},children:[n.jsx("label",{className:"audit-filter-label",children:"Date dbut"}),n.jsx("input",{type:"date",className:"audit-filter-input",value:h,onChange:I=>{m(I.target.value),v(0)}})]}),n.jsxs("div",{className:"audit-filter-group",style:{minWidth:140},children:[n.jsx("label",{className:"audit-filter-label",children:"Date fin"}),n.jsx("input",{type:"date",className:"audit-filter-input",value:g,onChange:I=>{x(I.target.value),v(0)}})]}),n.jsxs("button",{className:"audit-filter-btn reset",onClick:w,children:[os.refresh,"Rinitialiser"]}),n.jsxs("button",{className:"audit-filter-btn export",onClick:N,children:[os.download,"Exporter CSV"]})]}),n.jsxs("div",{className:"audit-quick-filters",children:[n.jsx("button",{className:`audit-quick-filter ${c==="LOGIN"||c==="LOGIN_MICROSOFT"?"active":""}`,onClick:()=>u(c==="LOGIN"?"":"LOGIN"),children:"Connexions"}),n.jsx("button",{className:`audit-quick-filter ${c==="SIGN_TEMPLATE"?"active":""}`,onClick:()=>u(c==="SIGN_TEMPLATE"?"":"SIGN_TEMPLATE"),children:"Signatures"}),n.jsx("button",{className:`audit-quick-filter ${c==="EXPORT_PDF"?"active":""}`,onClick:()=>u(c==="EXPORT_PDF"?"":"EXPORT_PDF"),children:"Exports PDF"}),n.jsx("button",{className:`audit-quick-filter ${c==="PROMOTE_STUDENT"?"active":""}`,onClick:()=>u(c==="PROMOTE_STUDENT"?"":"PROMOTE_STUDENT"),children:"Promotions"}),n.jsx("button",{className:`audit-quick-filter ${c==="START_IMPERSONATION"?"active":""}`,onClick:()=>u(c==="START_IMPERSONATION"?"":"START_IMPERSONATION"),children:"Impersonnations"})]})]}),n.jsx("div",{className:"audit-logs-container",children:i?n.jsxs("div",{className:"audit-loading",children:[n.jsx("div",{className:"audit-loading-spinner"}),n.jsx("span",{className:"audit-loading-text",children:"Chargement des logs..."})]}):e.length===0?n.jsxs("div",{className:"audit-empty-state",children:[os.inbox,n.jsx("h3",{children:"Aucun log trouv"}),n.jsx("p",{children:"Modifiez vos filtres pour voir plus de rsultats"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"audit-logs-table-wrapper",children:n.jsxs("table",{className:"audit-logs-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date/Heure"}),n.jsx("th",{children:"Utilisateur"}),n.jsx("th",{children:"Rle"}),n.jsx("th",{children:"Action"}),n.jsx("th",{children:"Dtails"}),n.jsx("th",{children:"IP"}),n.jsx("th",{})]})}),n.jsx("tbody",{children:e.map(I=>{const T=$(I.timestamp),W=E(I.details),re=L(I.action);return n.jsxs("tr",{children:[n.jsx("td",{children:n.jsxs("div",{className:"audit-timestamp",children:[n.jsx("span",{className:"audit-timestamp-date",children:T.date}),n.jsx("span",{className:"audit-timestamp-time",children:T.time})]})}),n.jsx("td",{children:n.jsxs("div",{className:"audit-user-cell",children:[n.jsx("span",{className:"audit-user-name",children:I.userName||"Inconnu"}),n.jsxs("span",{className:"audit-user-id",children:[I.userId.substring(0,12),"..."]})]})}),n.jsx("td",{children:n.jsxs("span",{className:`audit-role-badge ${I.userRole.toLowerCase()}`,children:[q(I.userRole),Py[I.userRole]||I.userRole]})}),n.jsx("td",{children:n.jsx("span",{className:`audit-action-badge ${re}`,children:al[I.action]||I.action})}),n.jsx("td",{className:"audit-details-cell",children:W&&W.length>0?n.jsx("div",{className:"audit-details-content",children:W.map((ae,Y)=>n.jsxs("span",{className:"audit-detail-chip",children:[n.jsxs("span",{className:"label",children:[ae.key,":"]})," ",ae.value]},Y))}):n.jsx("span",{style:{color:"#94a3b8",fontSize:12},children:""})}),n.jsx("td",{children:n.jsx("span",{className:"audit-ip",children:I.ipAddress||"N/A"})}),n.jsx("td",{children:n.jsx("button",{className:"icon-btn",onClick:()=>_(I),title:"Voir les dtails",children:os.eye})})]},I._id)})})]})}),O>1&&n.jsxs("div",{className:"audit-pagination",children:[n.jsxs("div",{className:"audit-pagination-info",children:["Affichage de ",n.jsx("strong",{children:y*b+1}),"  ",n.jsx("strong",{children:Math.min((y+1)*b,S)})," sur ",n.jsx("strong",{children:S})," logs"]}),n.jsxs("div",{className:"audit-pagination-buttons",children:[n.jsxs("button",{className:"audit-page-btn",onClick:()=>v(I=>Math.max(0,I-1)),disabled:y===0,children:[os.chevronLeft,"Prcdent"]}),n.jsxs("button",{className:"audit-page-btn active",disabled:!0,children:[y+1," / ",O]}),n.jsxs("button",{className:"audit-page-btn",onClick:()=>v(I=>Math.min(O-1,I+1)),disabled:y>=O-1,children:["Suivant",os.chevronRight]})]})]})]})}),j&&n.jsx("div",{className:"audit-detail-modal",onClick:()=>_(null),children:n.jsxs("div",{className:"audit-detail-modal-content",onClick:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"audit-detail-modal-header",children:[n.jsx("h2",{children:"Dtails du log"}),n.jsx("button",{className:"audit-detail-modal-close",onClick:()=>_(null),children:os.close})]}),n.jsxs("div",{className:"audit-detail-modal-body",children:[n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"ID"}),n.jsx("div",{className:"audit-detail-value",style:{fontFamily:"monospace"},children:j._id})]}),n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"Date/Heure"}),n.jsx("div",{className:"audit-detail-value",children:new Date(j.timestamp).toLocaleString("fr-FR",{dateStyle:"full",timeStyle:"medium"})})]}),n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"Utilisateur"}),n.jsxs("div",{className:"audit-detail-value",children:[n.jsx("strong",{children:j.userName}),n.jsx("br",{}),n.jsx("span",{style:{fontSize:12,color:"#64748b"},children:j.userId})]})]}),n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"Rle"}),n.jsx("div",{className:"audit-detail-value",children:n.jsxs("span",{className:`audit-role-badge ${j.userRole.toLowerCase()}`,children:[q(j.userRole),Py[j.userRole]||j.userRole]})})]}),n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"Action"}),n.jsx("div",{className:"audit-detail-value",children:n.jsx("span",{className:`audit-action-badge ${L(j.action)}`,children:al[j.action]||j.action})})]}),n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"IP"}),n.jsx("div",{className:"audit-detail-value",children:n.jsx("span",{className:"audit-ip",children:j.ipAddress||"N/A"})})]}),j.details&&Object.keys(j.details).length>0&&n.jsxs("div",{className:"audit-detail-row",children:[n.jsx("div",{className:"audit-detail-label",children:"Dtails"}),n.jsx("div",{className:"audit-detail-value",children:n.jsx("pre",{children:JSON.stringify(j.details,null,2)})})]})]})]})})]})}function Xne(){const[e,t]=p.useState([]),[r,s]=p.useState(!0),[i,a]=p.useState(""),[o,l]=p.useState(null),[c,u]=p.useState(null);p.useEffect(()=>{d()},[]);const d=async()=>{try{s(!0);const h=await K.get("/suggestions");t(h.data);try{const m=await K.get("/admin-extras/subadmins");u(Array.isArray(m.data)?m.data.length:null)}catch{u(null)}}catch(h){a("Impossible de charger les suggestions"),console.error(h)}finally{s(!1)}},f=async(h,m)=>{try{l(h),await K.patch(`/suggestions/${h}`,{status:m}),t(g=>g.map(x=>x._id===h?{...x,status:m}:x))}catch{alert("Erreur lors de la mise  jour")}finally{l(null)}};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:" Suggestions et Requtes"}),n.jsx("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:"Examinez les suggestions de modifications et les demandes de semestre des sous-admins"}),n.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"center"},children:[n.jsxs("div",{style:{padding:12,borderRadius:10,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Total Sous-admins"}),n.jsx("div",{style:{fontWeight:700,color:"#1e293b",fontSize:20},children:c!==null?c:""})]}),n.jsxs("div",{style:{padding:12,borderRadius:10,background:"#eff6ff",border:"1px solid #bfdbfe"},children:[n.jsx("div",{style:{fontSize:12,color:"#2563eb"},children:"Passage Semestre 2"}),n.jsx("div",{style:{fontWeight:700,color:"#1e40af",fontSize:20},children:e.filter(h=>h.type==="semester_request"&&h.status==="pending").length})]}),n.jsxs("div",{style:{padding:12,borderRadius:10,background:"#f5f3ff",border:"1px solid #ddd6fe"},children:[n.jsx("div",{style:{fontSize:12,color:"#7c3aed"},children:"Passage Anne Suivante"}),n.jsx("div",{style:{fontWeight:700,color:"#6d28d9",fontSize:20},children:e.filter(h=>h.type==="next_year_request"&&h.status==="pending").length})]})]}),r&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Chargement..."}),i&&n.jsx("div",{className:"note",style:{color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca",marginTop:16},children:i}),n.jsxs("div",{style:{marginTop:20,display:"flex",flexDirection:"column",gap:16},children:[e.length===0&&!r&&n.jsx("div",{style:{textAlign:"center",padding:40,color:"#94a3b8"},children:"Aucune demande en attente"}),e.map(h=>{var m,g,x;return n.jsxs("div",{style:{padding:20,border:"1px solid #e2e8f0",borderRadius:12,background:h.status==="pending"?"white":h.status==="approved"?"#f0fdf4":"#fef2f2",opacity:h.status==="pending"?1:.8},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:h.type==="semester_request"?n.jsx("span",{style:{color:"#3b82f6"},children:" Passage au Semestre 2"}):h.type==="next_year_request"?n.jsx("span",{style:{color:"#8b5cf6"},children:" Passage  l'Anne Suivante"}):n.jsxs(n.Fragment,{children:[((m=h.template)==null?void 0:m.name)||"Template inconnu",h.pageIndex!==void 0&&n.jsxs("span",{style:{fontWeight:400,color:"#64748b",marginLeft:8,fontSize:"0.9em"},children:[" Page ",h.pageIndex+1]})]})}),n.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:["Par ",((g=h.subAdmin)==null?void 0:g.displayName)||((x=h.subAdmin)==null?void 0:x.email)||"Sous-admin","  ",new Date(h.createdAt).toLocaleDateString()]})]}),n.jsx("div",{style:{padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600,background:h.status==="pending"?"#fef3c7":h.status==="approved"?"#dcfce7":"#fee2e2",color:h.status==="pending"?"#d97706":h.status==="approved"?"#166534":"#991b1b"},children:h.status==="pending"?"En attente":h.status==="approved"?"Approuv":"Rejet"})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[n.jsxs("div",{style:{padding:12,background:"#f8fafc",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#64748b",marginBottom:4,textTransform:"uppercase"},children:h.type==="semester_request"||h.type==="next_year_request"?"Sujet":"Original"}),n.jsx("div",{style:{fontSize:14,color:"#334155",whiteSpace:"pre-wrap"},children:h.originalText})]}),n.jsxs("div",{style:{padding:12,background:h.type==="semester_request"?"#eff6ff":h.type==="next_year_request"?"#f5f3ff":"#f0fdfa",borderRadius:8,border:`1px solid ${h.type==="semester_request"?"#bfdbfe":h.type==="next_year_request"?"#ddd6fe":"#ccfbf1"}`},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,color:h.type==="semester_request"?"#2563eb":h.type==="next_year_request"?"#7c3aed":"#0d9488",marginBottom:4,textTransform:"uppercase"},children:h.type==="semester_request"||h.type==="next_year_request"?"Dtails":"Suggestion"}),n.jsx("div",{style:{fontSize:14,color:h.type==="semester_request"?"#1e40af":h.type==="next_year_request"?"#6d28d9":"#115e59",whiteSpace:"pre-wrap"},children:h.suggestedText})]})]}),h.status==="pending"&&n.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>f(h._id,"rejected"),disabled:!!o,style:{background:"#fff",border:"1px solid #ef4444",color:"#ef4444"},children:o===h._id?"...":"Rejeter"}),n.jsx("button",{className:"btn primary",onClick:()=>f(h._id,"approved"),disabled:!!o,style:{background:"#10b981",border:"none"},children:o===h._id?"...":"Approuver et Appliquer"})]})]},h._id)})]})]})})}function Qne(){const[e,t]=p.useState([]),[r,s]=p.useState("KG1 A"),[i,a]=p.useState("KG1"),[o,l]=p.useState(""),c=async()=>{const d=await K.get("/classes");t(d.data)};p.useEffect(()=>{c()},[]);const u=async()=>{await K.post("/classes",{name:r,level:i,schoolYearId:o}),s(""),a(""),l(""),await c()};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"title",children:"Classes"}),n.jsxs("div",{className:"grid2",children:[n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Ajouter une classe"}),n.jsx("input",{placeholder:"Nom",value:r,onChange:d=>s(d.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Niveau",value:i,onChange:d=>a(d.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"ID Anne scolaire",value:o,onChange:d=>l(d.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("button",{className:"btn",onClick:u,children:"Crer"})]}),n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Liste des classes"}),e.map(d=>n.jsx("div",{className:"competency",children:n.jsxs("div",{children:[d.name,"  ",d.level,"  Year: ",d.schoolYearId]})},d._id))]})]})]})})}function Jne(){const[e,t]=p.useState([]),[r,s]=p.useState("2025/2026"),[i,a]=p.useState("2025-09-01"),[o,l]=p.useState("2026-06-30"),[c,u]=p.useState(!0),d=async()=>{const h=await K.get("/school-years");t(h.data)};p.useEffect(()=>{d()},[]);const f=async()=>{await K.post("/school-years",{name:r,startDate:i,endDate:o,active:c}),s(""),a(""),l(""),u(!0),await d()};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"title",children:"Annes scolaires"}),n.jsxs("div",{className:"grid2",children:[n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Ajouter"}),n.jsx("input",{placeholder:"Nom",value:r,onChange:h=>s(h.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Dbut",value:i,onChange:h=>a(h.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsx("input",{placeholder:"Fin",value:o,onChange:h=>l(h.target.value),style:{padding:8,borderRadius:8,border:"1px solid #ddd"}}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"checkbox",checked:c,onChange:h=>u(h.target.checked)})," Active"]}),n.jsx("button",{className:"btn",onClick:f,children:"Crer"})]}),n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Liste"}),e.map(h=>n.jsxs("div",{className:"competency",children:[n.jsxs("div",{children:[h.name,"  ",new Date(h.startDate).toLocaleDateString(),"  ",new Date(h.endDate).toLocaleDateString()]}),n.jsx("div",{className:"pill",children:h.active?"Active":"Inactif"})]},h._id))]})]})]})})}function Zne({years:e,selectedYearId:t,onYearChange:r,groupedStudents:s,expandedLevels:i,onToggleLevel:a,selectedClass:o,viewUnassigned:l,onSelectClass:c,onViewUnassigned:u}){return n.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",height:"100%",padding:0,overflow:"hidden"},children:[n.jsxs("div",{style:{padding:16,borderBottom:"1px solid #f0f0f0",background:"#fafafa"},children:[n.jsx("label",{style:{display:"block",fontSize:12,color:"#666",marginBottom:4,fontWeight:600},children:"Anne Scolaire"}),n.jsx("select",{value:t,onChange:d=>r(d.target.value),style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e2e8f0",background:"white"},children:e.map(d=>n.jsxs("option",{value:d._id,children:[d.name," ",d.active?"(Active)":""]},d._id))})]}),n.jsxs("div",{style:{flex:1,overflowY:"auto",padding:12},children:[n.jsxs("div",{onClick:u,style:{padding:"10px 12px",borderRadius:8,cursor:"pointer",background:l?"#eff6ff":"transparent",color:l?"#3b82f6":"#475569",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,transition:"all 0.2s",fontWeight:l?600:500},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx(nh,{size:16}),n.jsx("span",{children:"Non assigns"})]}),n.jsx("span",{className:"pill",style:{background:l?"#dbeafe":"#f1f5f9",color:l?"#1e40af":"#64748b",fontSize:11,padding:"2px 8px"},children:s.unassigned.length})]}),Object.entries(s.grouped).map(([d,f])=>{const h=Object.keys(f).sort();if(h.length===0)return null;const m=i.has(d);return n.jsxs("div",{style:{marginBottom:4},children:[n.jsxs("div",{onClick:()=>a(d),style:{padding:"8px 12px",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",gap:8,color:"#334155",userSelect:"none"},children:[m?n.jsx(ub,{size:14}):n.jsx(pb,{size:14}),n.jsx("span",{style:{fontSize:13},children:d})]}),m&&n.jsx("div",{style:{paddingLeft:16,marginTop:4},children:h.map(g=>n.jsxs("div",{onClick:()=>c(g),style:{padding:"8px 12px 8px 34px",borderRadius:6,cursor:"pointer",background:o===g&&!l?"#eff6ff":"transparent",color:o===g&&!l?"#3b82f6":"#64748b",fontSize:13,display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2,fontWeight:o===g&&!l?600:400},children:[n.jsx("span",{children:g}),n.jsx("span",{style:{fontSize:11,opacity:.6,background:"#f1f5f9",padding:"1px 6px",borderRadius:4},children:f[g].length})]},g))})]},d)})]})]})}function ese({students:e,loading:t,viewUnassigned:r,selectedClass:s,search:i,onSearchChange:a,selectedStudentId:o,onSelectStudent:l}){const c=r?" lves non assigns":s?` ${s}`:"Slectionnez une classe";return n.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",height:"100%",padding:0,overflow:"hidden"},children:[n.jsxs("div",{style:{padding:16,borderBottom:"1px solid #f0f0f0",display:"flex",alignItems:"center",gap:16,background:"white",zIndex:10},children:[n.jsx("div",{style:{fontSize:18,fontWeight:600,color:"#1e293b"},children:c}),n.jsx("div",{style:{flex:1}}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx(No,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),n.jsx("input",{placeholder:"Rechercher...",value:i,onChange:u=>a(u.target.value),style:{padding:"8px 12px 8px 36px",borderRadius:20,border:"1px solid #e2e8f0",width:240,fontSize:14,outline:"none",transition:"all 0.2s"},onFocus:u=>u.target.style.borderColor="#6c5ce7",onBlur:u=>u.target.style.borderColor="#e2e8f0"})]})]}),n.jsx("div",{style:{flex:1,overflowY:"auto",padding:24,background:"#f8fafc"},children:t?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[n.jsx("div",{className:"spinner",style:{marginBottom:16}}),"Chargement..."]}):!r&&!s?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8",textAlign:"center"},children:[n.jsx("div",{style:{background:"#e2e8f0",borderRadius:"50%",padding:24,marginBottom:20},children:n.jsx("span",{style:{fontSize:40},children:""})}),n.jsx("h3",{style:{margin:"0 0 8px 0",color:"#475569"},children:"Aucune classe slectionne"}),n.jsx("p",{style:{margin:0,maxWidth:300},children:"Veuillez choisir une classe ou un niveau dans le menu de gauche pour afficher les lves."})]}):e.length===0?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8",textAlign:"center"},children:[n.jsx("div",{style:{background:"#e2e8f0",borderRadius:"50%",padding:24,marginBottom:20},children:n.jsx(Bu,{size:40})}),n.jsx("h3",{style:{margin:"0 0 8px 0",color:"#475569"},children:"Aucun lve trouv"}),n.jsx("p",{style:{margin:0},children:"Il n'y a pas d'lves dans cette catgorie."})]}):n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:20},children:e.map(u=>n.jsxs("div",{onClick:()=>l(u),style:{background:"white",borderRadius:16,padding:20,boxShadow:o===u._id?"0 0 0 2px #6c5ce7, 0 10px 20px rgba(108, 92, 231, 0.1)":"0 2px 4px rgba(0,0,0,0.02), 0 1px 2px rgba(0,0,0,0.04)",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",transition:"all 0.2s ease",transform:o===u._id?"translateY(-4px)":"none",border:"1px solid transparent",borderColor:o===u._id?"transparent":"#f1f5f9"},onMouseEnter:d=>{o!==u._id&&(d.currentTarget.style.transform="translateY(-4px)",d.currentTarget.style.boxShadow="0 10px 15px -3px rgba(0, 0, 0, 0.1)")},onMouseLeave:d=>{o!==u._id&&(d.currentTarget.style.transform="none",d.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.02), 0 1px 2px rgba(0,0,0,0.04)")},children:[n.jsx("div",{style:{width:80,height:80,borderRadius:"50%",marginBottom:12,background:"#f1f5f9",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",border:"3px solid white",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:u.avatarUrl?n.jsx("img",{src:u.avatarUrl,style:{width:"100%",height:"100%",objectFit:"cover"}}):n.jsx(Bu,{size:32,color:"#cbd5e1"})}),n.jsx("div",{style:{fontWeight:600,fontSize:15,marginBottom:2,color:"#1e293b"},children:u.firstName}),n.jsx("div",{style:{fontWeight:600,fontSize:15,color:"#64748b"},children:u.lastName}),n.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:8,background:"#f8fafc",padding:"2px 8px",borderRadius:4},children:u.logicalKey})]},u._id))})})]})}function tse({student:e,history:t,onPhotoUpload:r,onDelete:s}){const i=p.useRef(null),[a,o]=p.useState(!1),[l,c]=p.useState(!1);if(!e)return n.jsx("div",{className:"card",style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8",textAlign:"center"},children:n.jsxs("div",{children:[n.jsx("div",{style:{background:"#f1f5f9",borderRadius:"50%",padding:24,marginBottom:16,display:"inline-flex"},children:n.jsx(Bu,{size:48})}),n.jsx("p",{style:{fontSize:16,fontWeight:500},children:"Slectionnez un lve pour voir les dtails"})]})});const u=async()=>{if(s){c(!0);try{await s(e._id),o(!1)}catch(d){console.error("Delete failed:",d)}finally{c(!1)}}};return n.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto",display:"flex",flexDirection:"column",padding:0},children:[n.jsxs("div",{style:{padding:"32px 20px",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",textAlign:"center",position:"relative"},children:[n.jsxs("div",{style:{width:120,height:120,borderRadius:"50%",margin:"0 auto 16px",background:"white",overflow:"hidden",position:"relative",cursor:"pointer",border:"4px solid white",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)"},onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},children:[e.avatarUrl?n.jsx("img",{src:e.avatarUrl,style:{width:"100%",height:"100%",objectFit:"cover"}}):n.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(Bu,{size:48,color:"#cbd5e1"})}),n.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.6)",color:"white",fontSize:10,padding:6,backdropFilter:"blur(4px)",fontWeight:500},children:"MODIFIER"})]}),n.jsxs("h2",{style:{margin:"0 0 4px",fontSize:20,color:"#1e293b"},children:[e.firstName," ",e.lastName]}),n.jsx("div",{style:{color:"#64748b",fontWeight:500},children:e.className||"Non assign"}),n.jsx("input",{type:"file",ref:i,style:{display:"none"},accept:"image/*",onChange:r})]}),n.jsxs("div",{style:{padding:20,display:"flex",flexDirection:"column",gap:20},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#94a3b8",textTransform:"uppercase",marginBottom:12,letterSpacing:"0.05em"},children:"Informations"}),n.jsx("div",{style:{background:"#f8fafc",borderRadius:12,padding:16,border:"1px solid #e2e8f0"},children:n.jsxs("div",{style:{display:"grid",gap:16},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx("div",{style:{background:"white",padding:8,borderRadius:8,boxShadow:"0 1px 2px 0 rgba(0,0,0,0.05)"},children:n.jsx(Yl,{size:16,color:"#6c5ce7"})}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Date de naissance"}),n.jsx("div",{style:{fontSize:14,fontWeight:500,color:"#1e293b"},children:new Date(e.dateOfBirth).toLocaleDateString()})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx("div",{style:{background:"white",padding:8,borderRadius:8,boxShadow:"0 1px 2px 0 rgba(0,0,0,0.05)"},children:n.jsx(OD,{size:16,color:"#6c5ce7"})}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Identifiant (ID)"}),n.jsx("div",{style:{fontSize:14,fontWeight:500,color:"#1e293b",fontFamily:"monospace"},children:e.logicalKey})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx("div",{style:{background:"white",padding:8,borderRadius:8,boxShadow:"0 1px 2px 0 rgba(0,0,0,0.05)"},children:n.jsx(tM,{size:16,color:"#6c5ce7"})}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Parent / Contact"}),n.jsxs("div",{style:{fontSize:14,fontWeight:500,color:"#1e293b"},children:[e.fatherName||e.parentName||"Non renseign",e.parentPhone&&n.jsxs("span",{style:{color:"#64748b",fontWeight:400,marginLeft:4},children:["(",e.parentPhone,")"]})]})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx("div",{style:{background:"white",padding:8,borderRadius:8,boxShadow:"0 1px 2px 0 rgba(0,0,0,0.05)"},children:n.jsx(sm,{size:16,color:"#6c5ce7"})}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Emails"}),n.jsxs("div",{style:{fontSize:13,fontWeight:500,color:"#1e293b",display:"flex",flexDirection:"column",gap:2},children:[n.jsxs("div",{children:["Pre: ",e.fatherEmail||""]}),n.jsxs("div",{children:["Mre: ",e.motherEmail||""]}),n.jsxs("div",{children:["lve: ",e.studentEmail||""]})]})]})]})]})})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#94a3b8",textTransform:"uppercase",marginBottom:12,letterSpacing:"0.05em"},children:"Historique Scolaire"}),n.jsx("div",{style:{background:"#f8fafc",borderRadius:12,padding:4,border:"1px solid #e2e8f0"},children:t.length>0?n.jsx("div",{style:{display:"flex",flexDirection:"column"},children:t.map((d,f)=>n.jsxs("div",{style:{padding:12,borderBottom:f===t.length-1?"none":"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("div",{style:{background:"white",padding:6,borderRadius:6},children:n.jsx(hb,{size:14,color:"#94a3b8"})}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,fontWeight:600,color:"#1e293b"},children:d.year}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:d.className})]})]}),n.jsx("div",{className:`pill ${d.promotionStatus==="promoted"?"green":d.promotionStatus==="retained"?"red":"grey"}`,style:{fontSize:10,height:"fit-content",padding:"4px 8px"},children:d.promotionStatus==="promoted"?"Promu":d.promotionStatus==="retained"?"Retenu":d.promotionStatus})]},f))}):n.jsx("div",{style:{padding:20,textAlign:"center",color:"#94a3b8",fontStyle:"italic",fontSize:13},children:"Aucun historique disponible"})})]}),s&&n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#94a3b8",textTransform:"uppercase",marginBottom:12,letterSpacing:"0.05em"},children:"Actions"}),n.jsxs("div",{style:{background:"#fef2f2",borderRadius:12,padding:16,border:"1px solid #fecaca"},children:[n.jsxs("button",{onClick:()=>o(!0),style:{width:"100%",padding:"12px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,fontWeight:600,fontSize:14,transition:"all 0.2s"},onMouseEnter:d=>d.currentTarget.style.background="#dc2626",onMouseLeave:d=>d.currentTarget.style.background="#ef4444",children:[n.jsx(Pa,{size:16}),"Supprimer l'lve"]}),n.jsx("p",{style:{fontSize:11,color:"#991b1b",marginTop:8,marginBottom:0,textAlign:"center"},children:"Cette action est irrversible et supprimera toutes les donnes de l'lve."})]})]})]}),a&&n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:n.jsxs("div",{style:{background:"white",borderRadius:16,padding:24,maxWidth:400,width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[n.jsx("h3",{style:{margin:"0 0 12px",color:"#1e293b"},children:"Confirmer la suppression"}),n.jsxs("p",{style:{color:"#64748b",marginBottom:24},children:["tes-vous sr de vouloir supprimer ",n.jsxs("strong",{children:[e.firstName," ",e.lastName]}),"?",n.jsx("br",{}),n.jsx("br",{}),"Cette action supprimera dfinitivement:"]}),n.jsxs("ul",{style:{color:"#64748b",marginBottom:24,paddingLeft:20},children:[n.jsx("li",{children:"Les informations de l'lve"}),n.jsx("li",{children:"Toutes les inscriptions"}),n.jsx("li",{children:"Les comptences acquises"}),n.jsx("li",{children:"Les carnets et signatures"})]}),n.jsxs("div",{style:{display:"flex",gap:12},children:[n.jsx("button",{onClick:()=>o(!1),style:{flex:1,padding:"12px 16px",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:"Annuler"}),n.jsx("button",{onClick:u,disabled:l,style:{flex:1,padding:"12px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:8,cursor:l?"not-allowed":"pointer",fontWeight:600,opacity:l?.7:1},children:l?"Suppression...":"Supprimer"})]})]})})]})}function rse({onFileSelect:e,isDragActive:t,onDragEnter:r,onDragLeave:s,onDragOver:i,onDrop:a,loading:o,importReport:l,onUpdateReport:c,onClose:u}){const d=p.useRef(null);return n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 23, 42, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)"},onClick:u,children:n.jsxs("div",{style:{background:"#fff",borderRadius:24,padding:0,width:600,maxWidth:"90vw",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:f=>f.stopPropagation(),children:[n.jsxs("div",{style:{padding:"24px 32px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("h2",{style:{margin:0,fontSize:20,color:"#1e293b"},children:"Importation de photos en masse"}),n.jsx("button",{onClick:u,style:{background:"none",border:"none",cursor:"pointer",color:"#64748b"},children:n.jsx(xD,{size:24})})]}),n.jsx("div",{style:{padding:32},children:l?n.jsxs("div",{style:{animation:"fadeIn 0.3s ease"},children:[n.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[n.jsx("div",{style:{width:60,height:60,background:"#dcfce7",borderRadius:"50%",color:"#16a34a",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:n.jsx(Xv,{size:32})}),n.jsx("h3",{style:{margin:0,fontSize:20,color:"#1e293b"},children:"Importation termine"}),n.jsx("p",{style:{margin:"4px 0 0",color:"#64748b"},children:"Voici le rsum de l'opration"})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[n.jsxs("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:12,padding:16,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#16a34a"},children:l.success}),n.jsx("div",{style:{fontSize:13,color:"#15803d",fontWeight:500},children:"Photos importes"})]}),n.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:12,padding:16,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#dc2626"},children:l.failed}),n.jsx("div",{style:{fontSize:13,color:"#b91c1c",fontWeight:500},children:"checs"})]})]}),l.report.length>0&&n.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:12,overflow:"hidden"},children:[n.jsx("div",{style:{background:"#f8fafc",padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:13,fontWeight:600,color:"#475569"},children:"Dtails des fichiers"}),n.jsx("div",{style:{maxHeight:300,overflowY:"auto",background:"#fff"},children:l.report.map((f,h)=>n.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #f1f5f9",fontSize:13},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[n.jsx(ND,{size:14,color:"#94a3b8"}),n.jsx("span",{style:{color:"#334155"},children:f.filename})]}),f.status==="matched"?n.jsxs("span",{className:"pill green",style:{fontSize:11,padding:"2px 8px"},children:[" ",f.student]}):f.status==="needs_review"&&f.reason==="multiple_matches"?n.jsx("span",{className:"pill orange",style:{fontSize:11,padding:"2px 8px",background:"#fef3c7",color:"#b45309"},children:"Plusieurs lves"}):f.status==="needs_review"?n.jsx("span",{className:"pill orange",style:{fontSize:11,padding:"2px 8px",background:"#ffedd5",color:"#9a3412"},children:" valider"}):f.status==="invalid_class"?n.jsx("span",{className:"pill red",style:{fontSize:11,padding:"2px 8px"},children:"Classe introuvable"}):n.jsx("span",{className:"pill red",style:{fontSize:11,padding:"2px 8px"},children:"Introuvable"})]}),(f.className||f.level||f.reason||f.expectedClass||f.foundClass)&&n.jsxs("div",{style:{marginTop:6,marginLeft:24,fontSize:12,color:"#64748b"},children:[f.level&&n.jsxs("div",{children:["Niveau: ",n.jsx("strong",{children:f.level})]}),f.className&&n.jsxs("div",{children:["Classe: ",n.jsx("strong",{children:f.className})]}),f.reason&&n.jsxs("div",{children:["Raison: ",n.jsx("strong",{children:f.reason})]}),f.expectedClass&&n.jsxs("div",{children:["Classe attendue: ",n.jsx("strong",{children:f.expectedClass})]}),f.foundClass&&n.jsxs("div",{children:["Classe trouve: ",n.jsx("strong",{children:f.foundClass})]})]}),(f.status==="no_match"||f.status==="needs_review")&&f.similarStudents&&f.similarStudents.length>0&&n.jsxs("div",{style:{marginTop:8,marginLeft:24,padding:"8px 12px",background:"#fef3c7",borderRadius:6,fontSize:12},children:[n.jsx("div",{style:{color:"#92400e",fontWeight:500,marginBottom:4},children:"lves similaires :"}),f.similarStudents.map((m,g)=>n.jsx("div",{style:{color:"#78350f",padding:"2px 0"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsxs("span",{children:[" ",m.name,m.birthYear?` (${m.birthYear})`:"",m.className?`  ${m.className}`:""]}),f.pendingId&&n.jsx("button",{onClick:async()=>{try{await K.post("/media/confirm-photo",{pendingId:f.pendingId,studentId:m._id}),c==null||c(x=>{if(!(x!=null&&x.report))return x;const y=[...x.report],v={...y[h]};return v.status="matched",v.student=m.name,v.similarStudents=[],y[h]=v,{...x,report:y}})}catch{alert("Erreur lors de la validation")}},style:{padding:"2px 8px",borderRadius:6,border:"1px solid #f59e0b",background:"#fff7ed",color:"#9a3412",fontSize:11,cursor:"pointer"},children:"Utiliser"})]})},g))]})]},h))})]}),n.jsx("div",{style:{marginTop:24,display:"flex",gap:12},children:n.jsx("button",{className:"btn secondary",style:{flex:1},onClick:u,children:"Fermer"})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{marginBottom:24,background:"#f0f9ff",padding:20,borderRadius:12,border:"1px solid #bae6fd"},children:[n.jsxs("h4",{style:{margin:"0 0 12px 0",color:"#0369a1",display:"flex",alignItems:"center",gap:8},children:[n.jsx("div",{style:{background:"#0ea5e9",color:"white",width:20,height:20,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:"i"}),"Instructions"]}),n.jsxs("ol",{style:{margin:0,paddingLeft:20,fontSize:14,color:"#334155",lineHeight:1.6},children:[n.jsxs("li",{children:["Prparez vos photos au format ",n.jsx("strong",{children:".jpg"})," ou ",n.jsx("strong",{children:".png"}),"."]}),n.jsxs("li",{children:["Placez-les dans des dossiers ",n.jsx("strong",{children:"niveau"})," puis ",n.jsx("strong",{children:"classe"})," (ex: ",n.jsx("code",{children:"Photos Maternelles/Maternelles/MS/MS A"}),")."]}),n.jsxs("li",{children:["Nommez chaque fichier selon l'un de ces formats :",n.jsxs("ul",{style:{marginTop:4,marginBottom:4,color:"#475569"},children:[n.jsx("li",{children:n.jsx("code",{children:"Prnom Nom.jpg"})}),n.jsx("li",{children:n.jsx("code",{children:"Prnom_Nom.jpg"})}),n.jsx("li",{children:n.jsx("code",{children:"ID_Unique.jpg"})})]})]}),n.jsxs("li",{children:["Compressez les fichiers dans une archive ",n.jsx("strong",{children:"ZIP"})," ou ",n.jsx("strong",{children:"RAR"}),"."]})]})]}),n.jsxs("div",{onDragEnter:r,onDragLeave:s,onDragOver:i,onDrop:a,onClick:()=>{var f;return!o&&((f=d.current)==null?void 0:f.click())},style:{border:`2px dashed ${t?"#6c5ce7":"#cbd5e1"}`,borderRadius:16,padding:48,textAlign:"center",background:t?"#f5f3ff":"#f8fafc",cursor:o?"default":"pointer",transition:"all 0.2s",marginBottom:0,position:"relative"},children:[o?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx("div",{className:"spinner",style:{marginBottom:16}}),n.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#1e293b"},children:"Traitement en cours..."}),n.jsx("div",{style:{fontSize:14,color:"#64748b"},children:"Cela peut prendre quelques instants"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{width:64,height:64,background:t?"#ede9fe":"#e2e8f0",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",color:t?"#6c5ce7":"#64748b",transition:"all 0.2s"},children:n.jsx(bD,{size:32})}),n.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:8,color:"#1e293b"},children:"Glissez-dposez votre fichier ZIP/RAR"}),n.jsx("div",{style:{color:"#64748b",fontSize:14},children:"ou cliquez pour parcourir vos fichiers"})]}),n.jsx("input",{type:"file",accept:".zip,.rar",ref:d,style:{display:"none"},disabled:o,onChange:f=>{f.target.files&&f.target.files[0]&&e(f.target.files[0])}})]})]})})]})})}function nse(){const[e,t]=p.useState([]),[r,s]=p.useState(""),[i,a]=p.useState([]),[o,l]=p.useState([]),[c,u]=p.useState([]),d=p.useMemo(()=>{const Se=e.find(Ie=>Ie.active);return(Se==null?void 0:Se._id)||""},[e]),[f,h]=p.useState(""),[m,g]=p.useState(null),[x,y]=p.useState([]),[v,S]=p.useState(!1),[k,j]=p.useState(null),[_,b]=p.useState(!1),[A,z]=p.useState(!1),[D,w]=p.useState(!1),[N,$]=p.useState(null),[E,q]=p.useState([]),[L,O]=p.useState(!1),[B,I]=p.useState(null),[T,W]=p.useState(!1),[re,ae]=p.useState(!1),[Y,J]=p.useState(null),[P,ce]=p.useState(new Set),[pe,ye]=p.useState(!1),[se,je]=p.useState(!1),[ve,le]=p.useState(null),[oe,de]=p.useState(!1),[Pe,Z]=p.useState(1),[ne,ee]=p.useState(!1),[te,G]=p.useState(null),[H,ie]=p.useState(new Set),[me,ke]=p.useState(null),[Be,Te]=p.useState(!1);p.useEffect(()=>{qe(),Qe()},[]),p.useEffect(()=>{r&&(ge(r),Ze(r))},[r]);const qe=async()=>{const Se=await K.get("/school-years");t(Se.data);const Ie=Se.data.find(Re=>Re.active);Ie?s(Ie._id):Se.data.length>0&&s(Se.data[0]._id)},Qe=async()=>{const Se=await K.get("/levels");l(Se.data.map(Ie=>Ie.name))},Ze=async Se=>{const Ie=await K.get("/classes",{params:{schoolYearId:Se}});u(Ie.data)},ge=async Se=>{z(!0);const Ie=await K.get("/students",{params:{schoolYearId:Se,enrolledOnly:!0}});a(Ie.data),z(!1)},Ae=async Se=>{const Ie=await Se.arrayBuffer(),Re=await crypto.subtle.digest("SHA-256",Ie);return Array.from(new Uint8Array(Re)).map(ht=>ht.toString(16).padStart(2,"0")).join("")},Le=Se=>{const Ie=new Map,Re=[];for(const Et of Se)if(!Et.avatarUrl)Re.push(Et);else{const Mt=Et.avatarUrl.split("?")[0],St=Et.avatarHash?`hash:${Et.avatarHash}`:`url:${Mt}`;Ie.has(St)||Ie.set(St,[]),Ie.get(St).push(Et)}const ht=[];for(const[Et,Mt]of Ie.entries())Mt.length>1&&ht.push({avatarUrl:Et,students:Mt});return{duplicates:ht,missing:Re}},Q=()=>d||(alert("Aucune anne active. Activez une anne avant de vrifier les photos."),""),be=async()=>{const Se=Q();if(Se){O(!0),w(!0),$(null),I(null);try{const Ie=await K.get("/students",{params:{schoolYearId:Se,enrolledOnly:!0}});q(Ie.data);const Re=Le(Ie.data);$(Re)}finally{O(!1)}}},we=async()=>{const Se=Q();if(!Se)return;const Ie=await K.get("/students",{params:{schoolYearId:Se,enrolledOnly:!0}});q(Ie.data);const Re=Le(Ie.data);$(Re)},Ne=async()=>{try{ae(!0),J(null);const Se=await K.post("/media/backfill-avatar-hashes");J(Se.data),await we()}catch{J({total:0,updated:0,missingFile:0,skipped:0})}finally{ae(!1)}},V=async Se=>{if(Se){ce(Ie=>new Set(Ie).add(Se));try{await K.patch(`/students/${Se}`,{avatarUrl:"",avatarHash:""}),a(Ie=>Ie.map(Re=>Re._id===Se?{...Re,avatarUrl:"",avatarHash:""}:Re)),q(Ie=>Ie.map(Re=>Re._id===Se?{...Re,avatarUrl:"",avatarHash:""}:Re)),g(Ie=>(Ie==null?void 0:Ie._id)===Se?{...Ie,avatarUrl:"",avatarHash:""}:Ie),await we()}catch(Ie){console.error("Remove photo failed",Ie)}finally{ce(Ie=>{const Re=new Set(Ie);return Re.delete(Se),Re})}}},fe=async(Se,Ie)=>{var Et,Mt;if(!Se||Ie.length===0)return;const Re=Se.name.toLowerCase().split(".").pop();if(!["zip","rar"].includes(Re||"")){alert("Format non support. Utilisez un fichier ZIP ou RAR.");return}W(!0),I(null);const ht=new FormData;ht.append("file",Se),ht.append("targetStudentIds",JSON.stringify(Ie));try{const St=await K.post("/media/import-photos",ht,{headers:{"Content-Type":"multipart/form-data"}});I(St.data),St.data.success>0&&await we()}catch(St){I({error:((Mt=(Et=St.response)==null?void 0:Et.data)==null?void 0:Mt.error)||"Import failed"})}finally{W(!1)}},Oe=Se=>{const Ie=c.find(Re=>Re.name===Se);return Ie==null?void 0:Ie._id},Fe=p.useMemo(()=>{const Se={},Ie=[];return o.forEach(Re=>Se[Re]={}),i.forEach(Re=>{if(f&&!`${Re.firstName} ${Re.lastName}`.toLowerCase().includes(f.toLowerCase()))return;if(!Re.className){Ie.push(Re);return}const ht=Re.level||"Unknown",Et=Re.className;Se[ht]||(Se[ht]={}),Se[ht][Et]||(Se[ht][Et]=[]),Se[ht][Et].push(Re)}),{grouped:Se,unassigned:Ie}},[i,f,o]),Ve=Se=>{Se.preventDefault(),Se.stopPropagation(),Se.type==="dragenter"||Se.type==="dragover"?b(!0):Se.type==="dragleave"&&b(!1)},tt=async Se=>{Se.preventDefault(),Se.stopPropagation(),b(!1),Se.dataTransfer.files&&Se.dataTransfer.files[0]&&await Wt(Se.dataTransfer.files[0])},Wt=async Se=>{const Ie=Se.name.toLowerCase();if(!Ie.endsWith(".zip")&&!Ie.endsWith(".rar")){alert("Veuillez tlcharger un fichier ZIP ou RAR");return}const Re=new FormData;Re.append("file",Se);try{z(!0);const ht=await K.post("/media/import-photos",Re);j(ht.data),ge(r)}catch{alert("Erreur lors de l'import")}finally{z(!1)}},Ct=async Se=>{var ht;if(!((ht=Se.target.files)!=null&&ht.length)||!m)return;const Ie=Se.target.files[0],Re=new FormData;Re.append("file",Ie);try{const Mt=(await K.post("/media/upload?folder=students",Re)).data.url,St=await Ae(Ie);await K.patch(`/students/${m._id}`,{avatarUrl:Mt,avatarHash:St});const ir={...m,avatarUrl:Mt,avatarHash:St};g(ir),a(i.map($e=>$e._id===m._id?{...$e,avatarUrl:Mt,avatarHash:St}:$e))}catch{alert("Erreur lors du tlchargement de la photo")}},Ot=async Se=>{g(Se);const Ie=await K.get(`/students/${Se._id}`);if(g(Ie.data),Ie.data.enrollments){const Re=new Map(e.map(Et=>[Et._id,Et])),ht=Ie.data.enrollments.map(Et=>{var Mt;return{year:((Mt=Re.get(Et.schoolYearId))==null?void 0:Mt.name)||"Unknown Year",status:Et.status,promotionStatus:Et.promotionStatus||"N/A",className:Et.className||Et.classId||"-"}});y(ht)}},et=async Se=>{var Ie,Re;try{await K.delete(`/students/${Se}`),a(i.filter(ht=>ht._id!==Se)),g(null),y([])}catch(ht){throw alert("Erreur lors de la suppression: "+(((Re=(Ie=ht.response)==null?void 0:Ie.data)==null?void 0:Re.message)||ht.message)),ht}},nt=async()=>{var Ie,Re;if(!me)return;const Se=Oe(me);if(!Se){alert("Impossible de trouver l'ID de la classe");return}je(!0);try{const ht=await K.post(`/students/complete-class/${Se}`);le(ht.data)}catch(ht){alert("Erreur: "+(((Re=(Ie=ht.response)==null?void 0:Ie.data)==null?void 0:Re.message)||ht.message))}finally{je(!1)}},ft=async()=>{var Ie,Re;if(!me)return;const Se=Oe(me);if(!Se){alert("Impossible de trouver l'ID de la classe");return}ee(!0);try{const ht=await K.delete(`/classes/${Se}/with-students`);G(ht.data),ge(r),Ze(r),ke(null)}catch(ht){alert("Erreur: "+(((Re=(Ie=ht.response)==null?void 0:Ie.data)==null?void 0:Re.message)||ht.message))}finally{ee(!1)}},vt=()=>{de(!0),Z(1),G(null)},Zt=Be?Fe.unassigned:me?Object.values(Fe.grouped).flatMap(Se=>Se[me]||[]):[];return n.jsxs("div",{className:"container",style:{maxWidth:1600,padding:24,height:"calc(100vh - 80px)",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[n.jsxs("div",{children:[n.jsx("h2",{className:"title",style:{margin:"0 0 4px 0",fontSize:24},children:"Gestion des lves"}),n.jsx("p",{style:{margin:0,color:"#64748b",fontSize:14},children:"Grez les inscriptions, photos et informations des lves."})]}),n.jsxs("div",{style:{display:"flex",gap:12},children:[me&&!Be&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:"btn",onClick:()=>{ye(!0),le(null)},style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:"#10b981",borderColor:"#10b981"},children:[n.jsx(Xv,{size:18}),n.jsx("span",{children:"Complter la classe"})]}),n.jsxs("button",{className:"btn",onClick:vt,style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:"#ef4444",borderColor:"#ef4444"},children:[n.jsx(Pa,{size:18}),n.jsx("span",{children:"Supprimer la classe"})]})]}),n.jsxs("button",{className:"btn",onClick:()=>{S(!0),j(null)},style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px"},children:[n.jsx(Rl,{size:18}),n.jsx("span",{children:"Import Photos (Batch)"})]}),n.jsxs("button",{className:"btn",onClick:be,style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:"#8b5cf6",borderColor:"#8b5cf6"},children:[n.jsx(No,{size:18}),n.jsx("span",{children:"Vrifier Photos"})]})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"280px minmax(0, 1fr) 380px",gap:24,flex:1,minHeight:0},children:[n.jsx(Zne,{years:e,selectedYearId:r,onYearChange:s,groupedStudents:Fe,expandedLevels:H,onToggleLevel:Se=>{const Ie=new Set(H);Ie.has(Se)?Ie.delete(Se):Ie.add(Se),ie(Ie)},selectedClass:me,viewUnassigned:Be,onSelectClass:Se=>{ke(Se),Te(!1)},onViewUnassigned:()=>{Te(!0),ke(null)}}),n.jsx(ese,{students:Zt,loading:A,viewUnassigned:Be,selectedClass:me,search:f,onSearchChange:h,selectedStudentId:m==null?void 0:m._id,onSelectStudent:Ot}),n.jsx(tse,{student:m,history:x,onPhotoUpload:Ct,onDelete:et})]}),D&&n.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsxs("div",{style:{background:"#fff",borderRadius:12,width:"90%",maxWidth:700,maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px rgba(0,0,0,0.25)"},children:[n.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:600},children:"Vrification des Photos"}),n.jsx("button",{onClick:()=>w(!1),style:{background:"none",border:"none",cursor:"pointer",padding:4},children:n.jsx(Ai,{size:20,color:"#64748b"})})]}),n.jsx("div",{style:{padding:24,overflowY:"auto",flex:1},children:L?n.jsx("div",{style:{textAlign:"center",padding:40,color:"#64748b"},children:"Vrification en cours..."}):N?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",gap:16,marginBottom:16},children:[n.jsxs("div",{style:{flex:1,padding:16,background:N.duplicates.length>0?"#fef3c7":"#d1fae5",borderRadius:8},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[n.jsx(gb,{size:18,color:N.duplicates.length>0?"#b45309":"#059669"}),n.jsxs("span",{style:{fontWeight:600,color:N.duplicates.length>0?"#92400e":"#065f46"},children:[N.duplicates.length," photo(s) en double"]})]}),n.jsxs("div",{style:{fontSize:12,color:N.duplicates.length>0?"#a16207":"#047857"},children:[N.duplicates.reduce((Se,Ie)=>Se+Ie.students.length,0)," lves concerns"]})]}),n.jsx("div",{style:{flex:1,padding:16,background:N.missing.length>0?"#fee2e2":"#d1fae5",borderRadius:8},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[n.jsx($2,{size:18,color:N.missing.length>0?"#dc2626":"#059669"}),n.jsxs("span",{style:{fontWeight:600,color:N.missing.length>0?"#991b1b":"#065f46"},children:[N.missing.length," lve(s) sans photo"]})]})})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[n.jsx("button",{onClick:Ne,className:"btn",disabled:re,style:{padding:"8px 12px",opacity:re?.7:1},children:re?"Calcul des empreintes...":"Calculer empreintes des photos existantes"}),Y&&n.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[Y.updated," / ",Y.total," mises  jour",Y.missingFile>0?`, ${Y.missingFile} fichier(s) manquant(s)`:"",Y.skipped>0?`, ${Y.skipped} ignors`:""]})]}),N.duplicates.length>0&&n.jsxs("div",{style:{marginBottom:24},children:[n.jsxs("h3",{style:{fontSize:14,fontWeight:600,marginBottom:12,display:"flex",alignItems:"center",gap:8},children:[n.jsx(yb,{size:16,color:"#b45309"})," Photos en double"]}),N.duplicates.map((Se,Ie)=>n.jsx("div",{style:{background:"#fffbeb",border:"1px solid #fde68a",borderRadius:8,padding:12,marginBottom:8},children:n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[n.jsx("img",{src:Se.avatarUrl,alt:"",style:{width:48,height:48,borderRadius:8,objectFit:"cover",border:"2px solid #fbbf24"},onError:Re=>{Re.target.style.display="none"}}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{fontSize:12,color:"#92400e",marginBottom:6},children:["Cette photo est utilise par ",Se.students.length," lves :"]}),Se.students.map(Re=>n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#78350f",padding:"2px 0"},children:[n.jsxs("span",{children:[" ",Re.firstName," ",Re.lastName," ",Re.className?`(${Re.className})`:""]}),n.jsx("button",{onClick:()=>V(Re._id),disabled:P.has(Re._id),style:{padding:"2px 6px",fontSize:10,background:"#ef4444",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",opacity:P.has(Re._id)?.7:1},children:P.has(Re._id)?"Suppression...":"Retirer photo"})]},Re._id))]})]})},Ie))]}),N.missing.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{style:{fontSize:14,fontWeight:600,marginBottom:12,display:"flex",alignItems:"center",gap:8},children:[n.jsx($2,{size:16,color:"#dc2626"})," lves sans photo (",N.missing.length,")"]}),n.jsxs("div",{style:{background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:8,padding:12,marginBottom:12},children:[n.jsx("div",{style:{fontSize:13,color:"#1e40af",marginBottom:8,fontWeight:500},children:"Importer les photos pour ces lves :"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("input",{type:"file",accept:".zip,.rar",id:"targeted-import-input",style:{display:"none"},onChange:Se=>{var Re;const Ie=(Re=Se.target.files)==null?void 0:Re[0];Ie&&fe(Ie,N.missing.map(ht=>ht._id)),Se.target.value=""}}),n.jsxs("label",{htmlFor:"targeted-import-input",className:"btn",style:{display:"flex",alignItems:"center",gap:6,padding:"8px 14px",cursor:T?"wait":"pointer",opacity:T?.7:1},children:[n.jsx(Rl,{size:16}),T?"Import en cours...":"Choisir fichier ZIP/RAR"]})]}),n.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:6},children:"Seuls les lves sans photo seront mis  jour."})]}),B&&!B.error&&n.jsxs("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:8,padding:12,marginBottom:12},children:[n.jsxs("div",{style:{color:"#166534",fontSize:13,fontWeight:500,marginBottom:8},children:[" ",B.success," photo(s) importe(s), ",B.failed," chec(s)"]}),B.report&&(()=>{const Se=new Set(((N==null?void 0:N.missing)||[]).map(Re=>String(Re._id))),Ie=B.report.filter(Re=>!(Re.status==="matched"||(Re.similarStudents||[]).filter(Et=>Se.has(String(Et._id))).length===0));return Ie.length===0?null:n.jsx("div",{style:{maxHeight:250,overflowY:"auto",background:"#fff",borderRadius:6,border:"1px solid #e2e8f0"},children:Ie.map((Re,ht)=>{var Et;return n.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid #f1f5f9",fontSize:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{style:{color:"#334155"},children:Re.filename}),Re.status==="needs_review"?n.jsx("span",{style:{fontSize:11,padding:"2px 8px",background:"#fef3c7",color:"#92400e",borderRadius:4},children:" valider"}):n.jsx("span",{style:{fontSize:11,padding:"2px 8px",background:"#fee2e2",color:"#991b1b",borderRadius:4},children:"Non trouv"})]}),Re.reason&&n.jsxs("div",{style:{marginTop:4,fontSize:11,color:"#64748b"},children:["Raison: ",Re.reason==="no_match_in_class"?"Non trouv dans la classe":Re.reason==="class_mismatch"?"Classe diffrente":Re.reason==="multiple_matches"?"Plusieurs lves possibles":Re.reason]}),((Et=Re.similarStudents)==null?void 0:Et.length)>0&&n.jsxs("div",{style:{marginTop:8,padding:"8px 10px",background:"#fef3c7",borderRadius:6},children:[n.jsx("div",{style:{color:"#92400e",fontWeight:500,marginBottom:6,fontSize:11},children:"lves similaires :"}),Re.similarStudents.filter(Mt=>Se.has(String(Mt._id))).map((Mt,St)=>n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"3px 0"},children:[n.jsxs("span",{style:{color:"#78350f",fontSize:11},children:[" ",Mt.name,Mt.birthYear?` (${Mt.birthYear})`:"",Mt.className?`  ${Mt.className}`:""]}),Re.pendingId&&n.jsx("button",{onClick:async()=>{try{await K.post("/media/confirm-photo",{pendingId:Re.pendingId,studentId:Mt._id}),I(ir=>{if(!(ir!=null&&ir.report))return ir;const $e=ir.report.map(He=>He.pendingId===Re.pendingId?{...He,status:"matched",student:Mt.name}:He);return{...ir,success:ir.success+1,failed:ir.failed-1,report:$e}}),await we()}catch(ir){console.error("Confirm failed",ir)}},style:{padding:"2px 8px",fontSize:10,background:"#3b82f6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Confirmer"})]},St))]})]},ht)})})})()]}),(B==null?void 0:B.error)&&n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,padding:12,marginBottom:12},children:n.jsxs("div",{style:{color:"#dc2626",fontSize:13},children:["Erreur: ",B.error]})}),n.jsx("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,padding:12},children:n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:N.missing.map(Se=>n.jsxs("span",{style:{background:"#fee2e2",padding:"4px 10px",borderRadius:6,fontSize:12,color:"#991b1b",border:"1px solid #fca5a5"},children:[Se.firstName," ",Se.lastName," ",Se.className?`(${Se.className})`:""]},Se._id))})})]}),N.duplicates.length===0&&N.missing.length===0&&n.jsxs("div",{style:{textAlign:"center",padding:40,color:"#059669"},children:[n.jsx(Xv,{size:48,style:{marginBottom:16}}),n.jsx("div",{style:{fontSize:16,fontWeight:500},children:"Toutes les photos sont correctes !"}),n.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:8},children:"Aucun doublon et tous les lves ont une photo."})]})]}):null}),n.jsx("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end"},children:n.jsx("button",{className:"btn",onClick:()=>w(!1),children:"Fermer"})})]})}),v&&n.jsx(rse,{onFileSelect:Wt,isDragActive:_,onDragEnter:Ve,onDragLeave:Ve,onDragOver:Ve,onDrop:tt,loading:A,importReport:k,onUpdateReport:j,onClose:()=>S(!1)}),pe&&n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:n.jsx("div",{style:{background:"white",borderRadius:16,padding:24,maxWidth:500,width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:ve?n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 12px",color:"#1e293b"},children:ve.errors.length===0?" Termin!":" Termin avec des erreurs"}),n.jsxs("div",{style:{background:"#f0fdf4",borderRadius:8,padding:16,marginBottom:16},children:[n.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#059669"},children:ve.success}),n.jsx("div",{style:{color:"#064e3b",fontSize:14},children:"lves traits avec succs"})]}),ve.errors.length>0&&n.jsxs("div",{style:{background:"#fef2f2",borderRadius:8,padding:16,marginBottom:16},children:[n.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#dc2626"},children:ve.errors.length}),n.jsx("div",{style:{color:"#991b1b",fontSize:14},children:"erreurs"}),n.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#7f1d1d",maxHeight:100,overflowY:"auto"},children:[ve.errors.slice(0,5).map((Se,Ie)=>n.jsxs("div",{children:[Se.studentId,": ",Se.error]},Ie)),ve.errors.length>5&&n.jsxs("div",{children:["... et ",ve.errors.length-5," autres"]})]})]}),n.jsx("button",{onClick:()=>ye(!1),style:{width:"100%",padding:"12px 16px",background:"#6c5ce7",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:"Fermer"})]}):n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 12px",color:"#1e293b"},children:"Complter la classe"}),n.jsxs("p",{style:{color:"#64748b",marginBottom:24},children:["Vous tes sur le point de crer un snapshot (sauvegarde) des carnets de tous les lves de la classe ",n.jsx("strong",{children:me}),".",n.jsx("br",{}),n.jsx("br",{}),"Cette action va:"]}),n.jsxs("ul",{style:{color:"#64748b",marginBottom:24,paddingLeft:20},children:[n.jsx("li",{children:"Sauvegarder l'tat actuel de chaque carnet"}),n.jsx("li",{children:"Conserver les signatures existantes"}),n.jsx("li",{children:"Permettre de retrouver ces donnes plus tard"})]}),n.jsx("p",{style:{color:"#059669",marginBottom:24,fontWeight:500},children:" Cette action n'est pas destructive et peut tre effectue plusieurs fois."}),n.jsxs("div",{style:{display:"flex",gap:12},children:[n.jsx("button",{onClick:()=>ye(!1),style:{flex:1,padding:"12px 16px",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:"Annuler"}),n.jsx("button",{onClick:nt,disabled:se,style:{flex:1,padding:"12px 16px",background:"#10b981",color:"white",border:"none",borderRadius:8,cursor:se?"not-allowed":"pointer",fontWeight:600,opacity:se?.7:1},children:se?"En cours...":"Complter"})]})]})})}),oe&&n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:n.jsx("div",{style:{background:"white",borderRadius:16,padding:24,maxWidth:500,width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:te?n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 12px",color:"#1e293b",textAlign:"center"},children:" Classe supprime"}),n.jsxs("div",{style:{background:"#f0fdf4",borderRadius:8,padding:16,marginBottom:16},children:[n.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#059669",textAlign:"center"},children:te.studentsDeleted}),n.jsx("div",{style:{color:"#064e3b",fontSize:14,textAlign:"center"},children:"lves supprims"})]}),te.errors.length>0&&n.jsxs("div",{style:{background:"#fef2f2",borderRadius:8,padding:16,marginBottom:16},children:[n.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#dc2626"},children:te.errors.length}),n.jsx("div",{style:{color:"#991b1b",fontSize:14},children:"erreurs"})]}),n.jsx("button",{onClick:()=>de(!1),style:{width:"100%",padding:"12px 16px",background:"#6c5ce7",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:"Fermer"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{display:"flex",justifyContent:"center",gap:8,marginBottom:20},children:[1,2,3].map(Se=>n.jsx("div",{style:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:14,background:Pe>=Se?"#ef4444":"#f1f5f9",color:Pe>=Se?"white":"#94a3b8",transition:"all 0.3s"},children:Se},Se))}),Pe===1&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 16px",color:"#dc2626",textAlign:"center"},children:" Attention - Suppression de classe"}),n.jsxs("p",{style:{color:"#64748b",marginBottom:16,textAlign:"center"},children:["Vous allez supprimer la classe ",n.jsx("strong",{style:{color:"#dc2626"},children:me})," et ",n.jsx("strong",{children:"TOUS les lves"})," qui y sont inscrits."]}),n.jsxs("div",{style:{background:"#fef2f2",borderRadius:8,padding:16,marginBottom:20,border:"1px solid #fecaca"},children:[n.jsx("div",{style:{fontWeight:700,color:"#991b1b",marginBottom:8},children:"Cette action supprimera :"}),n.jsxs("ul",{style:{color:"#991b1b",paddingLeft:20,margin:0},children:[n.jsx("li",{children:"Tous les lves de la classe"}),n.jsx("li",{children:"Leurs carnets et comptences"}),n.jsx("li",{children:"Leurs signatures et historiques"})]})]}),n.jsx("p",{style:{color:"#dc2626",fontWeight:700,textAlign:"center",marginBottom:20},children:" Cette action est IRRVERSIBLE"})]}),Pe===2&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 16px",color:"#dc2626",textAlign:"center"},children:" Confirmation requise (2/3)"}),n.jsxs("p",{style:{color:"#64748b",marginBottom:16,textAlign:"center",fontSize:18},children:["tes-vous ",n.jsx("strong",{children:"ABSOLUMENT CERTAIN"})," de vouloir supprimer :"]}),n.jsxs("div",{style:{background:"#fef2f2",borderRadius:12,padding:20,marginBottom:20,textAlign:"center",border:"2px solid #ef4444"},children:[n.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#dc2626"},children:me}),n.jsxs("div",{style:{fontSize:14,color:"#991b1b",marginTop:8},children:[Zt.length," lve(s) seront supprims"]})]}),n.jsx("p",{style:{color:"#64748b",textAlign:"center",marginBottom:20},children:"Encore une confirmation sera ncessaire  l'tape suivante."})]}),Pe===3&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{margin:"0 0 16px",color:"#dc2626",textAlign:"center"},children:" Dernire confirmation (3/3)"}),n.jsxs("div",{style:{background:"#7f1d1d",color:"white",borderRadius:12,padding:24,marginBottom:20,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:16,marginBottom:12},children:"Vous tes sur le point de supprimer dfinitivement :"}),n.jsx("div",{style:{fontSize:28,fontWeight:700,marginBottom:8},children:me}),n.jsxs("div",{style:{fontSize:18,opacity:.9},children:[Zt.length," lve(s)  Toutes les donnes"]})]}),n.jsx("p",{style:{color:"#dc2626",fontWeight:700,textAlign:"center",marginBottom:20,fontSize:16},children:'Cliquez sur "SUPPRIMER DFINITIVEMENT" pour confirmer'})]}),n.jsxs("div",{style:{display:"flex",gap:12},children:[n.jsx("button",{onClick:()=>{Pe===1?de(!1):Z(Pe-1)},style:{flex:1,padding:"14px 16px",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:Pe===1?"Annuler":" Retour"}),n.jsx("button",{onClick:()=>{Pe<3?Z(Pe+1):ft()},disabled:ne,style:{flex:1,padding:"14px 16px",background:Pe===3?"#7f1d1d":"#ef4444",color:"white",border:"none",borderRadius:8,cursor:ne?"not-allowed":"pointer",fontWeight:700,opacity:ne?.7:1},children:ne?"Suppression...":Pe===3?" SUPPRIMER DFINITIVEMENT":"Continuer "})]})]})})})]})}const S_=["#0088FE","#00C49F","#FFBB28","#FF8042"],sse={LOGIN:"Connexion",CREATE_OUTLOOK_USER:"Cration utilisateur Outlook",UPDATE_OUTLOOK_USER:"Mise  jour utilisateur Outlook",DELETE_OUTLOOK_USER:"Suppression utilisateur Outlook",START_IMPERSONATION:"Dbut impersonnation",STOP_IMPERSONATION:"Fin impersonnation"},ise=e=>e?Object.entries(e).filter(([t])=>!["passwordHash","_id","__v"].includes(t)).map(([t,r])=>`${t==="email"?"Email":t==="role"?"Rle":t==="targetUserEmail"?"Cible":t}: ${r}`).join(" | "):null;function ase(){const[e,t]=p.useState(null),[r,s]=p.useState(!0);if(p.useEffect(()=>{(async()=>{try{const c=await K.get("/analytics");t(c.data)}catch(c){console.error("Failed to load stats",c)}finally{s(!1)}})()},[]),r)return n.jsx("div",{className:"container",style:{textAlign:"center",padding:"40px"},children:"Chargement..."});if(!e)return n.jsx("div",{className:"container",style:{textAlign:"center",padding:"40px",color:"red"},children:"Erreur de chargement"});const i=Object.entries(e.distribution.assignmentsByStatus||{}).map(([l,c])=>({name:l==="draft"?"Brouillon":l==="in_progress"?"En cours":l==="completed"?"Termin":l==="signed"?"Sign":l,value:c})),a=Object.entries(e.distribution.usersByRole||{}).map(([l,c])=>({name:l==="ADMIN"?"Admin":l==="SUBADMIN"?"Coordinateur":l==="TEACHER"?"Enseignant":l,value:c})),o=({title:l,value:c,icon:u,color:d})=>n.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:"16px"},children:[n.jsx("div",{style:{padding:"12px",borderRadius:"12px",background:`${d}20`,color:d,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(u,{size:32})}),n.jsxs("div",{children:[n.jsx("p",{className:"note",style:{fontSize:"14px",margin:0},children:l}),n.jsx("h3",{style:{fontSize:"24px",fontWeight:"bold",margin:"4px 0 0 0",color:"#2d3436"},children:c})]})]});return n.jsxs("div",{className:"container",children:[n.jsxs("div",{style:{marginBottom:"32px"},children:[n.jsx("h1",{style:{fontSize:"28px",fontWeight:"600",margin:"0 0 8px 0",color:"#2d3436"},children:"Tableau de bord analytique"}),n.jsx("p",{className:"note",style:{fontSize:"16px"},children:"Vue d'ensemble de l'activit de l'cole"})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"24px",marginBottom:"32px"},children:[n.jsx(o,{title:"Utilisateurs",value:e.counts.users,icon:Ts,color:"#2563eb"}),n.jsx(o,{title:"Classes",value:e.counts.classes,icon:Tl,color:"#059669"}),n.jsx(o,{title:"lves",value:e.counts.students,icon:Kl,color:"#7c3aed"}),n.jsx(o,{title:"Livrets (Total)",value:Object.values(e.distribution.assignmentsByStatus||{}).reduce((l,c)=>l+c,0),icon:yp,color:"#d97706"})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"32px",marginBottom:"32px"},children:[n.jsxs("div",{className:"card",children:[n.jsx("h3",{className:"title",style:{marginBottom:"24px",fontSize:"18px"},children:"tat des Livrets"}),n.jsx("div",{style:{height:"320px"},children:n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(zw,{children:[n.jsx(dx,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,fill:"#8884d8",paddingAngle:5,dataKey:"value",children:i.map((l,c)=>n.jsx(zi,{fill:S_[c%S_.length]},`cell-${c}`))}),n.jsx(ud,{}),n.jsx(o6,{})]})})})]}),n.jsxs("div",{className:"card",children:[n.jsx("h3",{className:"title",style:{marginBottom:"24px",fontSize:"18px"},children:"Rpartition des Rles"}),n.jsx("div",{style:{height:"320px"},children:n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(Ow,{data:a,children:[n.jsx(qp,{strokeDasharray:"3 3"}),n.jsx(Gp,{dataKey:"name"}),n.jsx(Xp,{}),n.jsx(ud,{}),n.jsx(tp,{dataKey:"value",fill:"#6c5ce7",radius:[4,4,0,0]})]})})})]})]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px"},children:[n.jsx(X4,{size:24,color:"#2d3436"}),n.jsx("h3",{className:"title",style:{fontSize:"18px",margin:0},children:"Activit Rcente"})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.recentActivity.map(l=>n.jsxs("div",{style:{padding:"16px",background:"#f8fafc",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[n.jsx("span",{style:{fontWeight:"600",color:"#1e293b"},children:sse[l.action]||l.action}),n.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:new Date(l.timestamp).toLocaleString()})]}),n.jsxs("div",{style:{fontSize:"14px",color:"#475569"},children:[n.jsx("span",{style:{fontWeight:"500"},children:l.userEmail}),l.details&&n.jsxs("span",{style:{marginLeft:"8px",color:"#94a3b8"},children:[" ",ise(l.details)]})]})]},l._id)),e.recentActivity.length===0&&n.jsx("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"Aucune activit rcente"})]})]})]})}const Ds={Settings:()=>n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"3"}),n.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),Activity:()=>n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),Lock:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),n.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Users:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"9",cy:"7",r:"4"}),n.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),n.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Mail:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),n.jsx("polyline",{points:"22,6 12,13 2,6"})]}),FileText:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),n.jsx("polyline",{points:"14 2 14 8 20 8"}),n.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),n.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),Database:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),n.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),n.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),Tool:()=>n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),Calendar:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),n.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),n.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),Box:()=>n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"})}),ChevronDown:()=>n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"6 9 12 15 18 9"})}),Check:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),n.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),AlertTriangle:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),n.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),n.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),Grid:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),n.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),n.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),n.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),Search:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"11",cy:"11",r:"8"}),n.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),Menu:()=>n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),n.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),n.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),Clock:()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("polyline",{points:"12 6 12 12 16 14"})]}),Save:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),n.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),n.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Folder:()=>n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),Bell:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),n.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),Monitor:()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),n.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),n.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]})},k_=[{id:"sandbox",label:"Simulation Lab",icon:"Grid",color:"#00b894",description:"Environnement de test"},{id:"status",label:"tat du Systme",icon:"Activity",color:"#00b894",description:"Statut des services"},{id:"monitoring",label:"Diagnostics",icon:"Box",color:"#ff7675",description:"Surveillance & logs"},{id:"errors",label:"Erreurs Utilisateurs",icon:"AlertTriangle",color:"#ef4444",description:"Suivi des erreurs"},{id:"year",label:"Anne Scolaire",icon:"Calendar",color:"#6c5ce7",description:"Session admin"},{id:"access",label:"Accs & Scurit",icon:"Lock",color:"#6c5ce7",description:"Connexions utilisateurs"},{id:"device",label:"Appareils",icon:"Monitor",color:"#e17055",description:"Restrictions cran"},{id:"teacher",label:"Options Enseignants",icon:"Users",color:"#9b59b6",description:"Affichage & vues"},{id:"smtp",label:"Email (SMTP)",icon:"Mail",color:"#3498db",description:"Configuration email"},{id:"signature",label:"Restrictions Signature",icon:"FileText",color:"#ff9f43",description:"Rgles sous-admin"},{id:"database",label:"Base de Donnes",icon:"Database",color:"#3498db",description:"Sauvegardes"},{id:"maintenance",label:"Maintenance",icon:"Tool",color:"#fd79a8",description:"Outils systme"},{id:"notiftest",label:"Test Notification",icon:"Bell",color:"#f59e0b",description:"Tester le popup session"}];function ose(){const e=Sn(),{years:t,activeYearId:r,setActiveYearId:s}=Yn(),[i,a]=p.useState("status"),[o,l]=p.useState(new Set),[c,u]=p.useState(!1),[d,f]=p.useState(""),h=p.useRef({}),[m,g]=p.useState(!0),[x,y]=p.useState(!0),[v,S]=p.useState(!0),[k,j]=p.useState(!0),[_,b]=p.useState(!1),[A,z]=p.useState(!1),[D,w]=p.useState(!0),[N,$]=p.useState(""),[E,q]=p.useState(!0),[L,O]=p.useState(!0),[B,I]=p.useState(""),[T,W]=p.useState("success"),[re,ae]=p.useState(!1),[Y,J]=p.useState(!1),[P,ce]=p.useState(60),[pe,ye]=p.useState(null),[se,je]=p.useState(null),[ve,le]=p.useState(null),[oe,de]=p.useState([]),[Pe,Z]=p.useState(0),[ne,ee]=p.useState(null),[te,G]=p.useState(!1),[H,ie]=p.useState(""),[me,ke]=p.useState("587"),[Be,Te]=p.useState(""),[qe,Qe]=p.useState(""),[Ze,ge]=p.useState(!1),[Ae,Le]=p.useState(""),[Q,be]=p.useState(!1),[we,Ne]=p.useState(null),[V,fe]=p.useState(!1),[Oe,Fe]=p.useState(1024),[Ve,tt]=p.useState([]),[Wt,Ct]=p.useState(!1),[Ot,et]=p.useState([]),[nt,ft]=p.useState(!1),[vt,Zt]=p.useState("open"),[Se,Ie]=p.useState(!1),[Re,ht]=p.useState(!1),[Et,Mt]=p.useState(!1),St=(xe,pt="success")=>{I(xe),W(pt)},ir=xe=>{l(pt=>{const at=new Set(pt);return at.has(xe)?at.delete(xe):at.add(xe),at})},$e=xe=>{var pt;a(xe),u(!1),l(at=>{const fr=new Set(at);return fr.delete(xe),fr}),(pt=h.current[xe])==null||pt.scrollIntoView({behavior:"smooth",block:"start"})};p.useEffect(()=>{R(),Ge(),He(),jt()},[]),p.useEffect(()=>{Yt(vt)},[vt]),p.useEffect(()=>{if(B){const xe=setTimeout(()=>I(""),4e3);return()=>clearTimeout(xe)}},[B]);const He=async()=>{try{const xe=await K.get("/backup/list");de(xe.data)}catch(xe){console.error(xe)}},Ge=async()=>{try{const xe=await K.get("/settings/status");le(xe.data)}catch{le({backend:"offline",database:"unknown",uptime:0})}},R=async()=>{try{const xe=await K.get("/settings");g(xe.data.login_enabled_teacher!==!1),y(xe.data.login_enabled_subadmin!==!1),S(xe.data.login_enabled_microsoft!==!1),j(xe.data.subadmin_restriction_enabled!==!1),b(xe.data.subadmin_restriction_exempt_standard===!0),z(xe.data.subadmin_restriction_exempt_final===!0),w(xe.data.teacher_quick_grading_enabled!==!1),$(Array.isArray(xe.data.assignment_long_term_keys)?xe.data.assignment_long_term_keys.join(", "):"longTermNotes, permanentNotes, medicalInfo, iep, edPlan, chronicNotes, comments, variables, personalHistory"),q(xe.data.assignment_long_term_auto_infer!==!1),ie(xe.data.smtp_host||""),ke(xe.data.smtp_port||"587"),Te(xe.data.smtp_user||""),Qe(xe.data.smtp_pass||""),ge(xe.data.smtp_secure===!0),fe(xe.data.mobile_block_enabled===!0),Fe(xe.data.mobile_min_width||1024),Ie(xe.data.previous_year_dropdown_editable_PS===!0),ht(xe.data.previous_year_dropdown_editable_MS===!0),Mt(xe.data.previous_year_dropdown_editable_GS===!0)}catch(xe){console.error(xe)}finally{O(!1)}},_e=async(xe,pt)=>{try{return await K.post("/settings",{key:xe,value:pt}),St("Paramtres mis  jour"),!0}catch{return St("Erreur lors de la mise  jour","error"),!1}},We=async(xe,pt,at)=>{const fr=!pt;at(fr),await _e(xe,fr)||at(pt)},jt=async()=>{Ct(!0);try{const xe=await K.get("/settings/mobile-access-logs?limit=50");tt(xe.data)}catch(xe){console.error("Failed to load mobile access logs:",xe),St("Erreur lors du chargement des journaux","error")}finally{Ct(!1)}},Ht=async()=>{if(confirm("Voulez-vous vraiment supprimer tous les journaux d'accs mobile ?"))try{await K.delete("/settings/mobile-access-logs"),tt([]),St("Journaux supprims")}catch(xe){console.error("Failed to clear mobile access logs:",xe),St("Erreur lors de la suppression","error")}},Yt=async xe=>{ft(!0);try{const pt=await K.get(`/error-logs?status=${xe}&limit=200`);et(pt.data.logs||[])}catch(pt){console.error("Failed to load error logs:",pt),St("Erreur lors du chargement des erreurs","error")}finally{ft(!1)}},_t=async xe=>{try{await K.patch(`/error-logs/${xe}/resolve`),et(pt=>vt==="open"?pt.filter(at=>at._id!==xe):pt.map(at=>at._id===xe?{...at,resolved:!0,resolvedAt:new Date().toISOString()}:at)),St("Erreur marque comme rsolue")}catch(pt){console.error("Failed to resolve error log:",pt),St("Erreur lors de la mise  jour","error")}},mr=async()=>{if(confirm("Marquer toutes les erreurs comme rsolues ?"))try{await K.patch("/error-logs/resolve-all"),et(xe=>vt==="open"?[]:xe.map(pt=>({...pt,resolved:!0,resolvedAt:new Date().toISOString()}))),St("Toutes les erreurs sont rsolues")}catch(xe){console.error("Failed to resolve all error logs:",xe),St("Erreur lors de la mise  jour","error")}},yr=async()=>{ae(!0);try{await K.post("/backup/create"),St("Sauvegarde cre"),await He()}catch{St("Erreur lors de la cration","error")}finally{ae(!1)}},Kt=async xe=>{if(confirm(`Restaurer "${xe}" ? La BDD actuelle sera crase !`)){ae(!0);try{await K.post(`/backup/restore/${xe}`),St("Restauration effectue"),setTimeout(()=>window.location.reload(),2e3)}catch{St("Erreur lors de la restauration","error")}finally{ae(!1)}}},Sr=async xe=>{if(confirm(`Supprimer "${xe}" ?`))try{await K.delete(`/backup/${xe}`),St("Sauvegarde supprime"),He()}catch{St("Erreur lors de la suppression","error")}},Me=async xe=>{if(xe.preventDefault(),Pe<4){Z(at=>at+1);return}if(prompt('Tapez "CONFIRMER" pour vider la BDD.')!=="CONFIRMER"){Z(0);return}ae(!0);try{await K.post("/backup/empty"),St("BDD vide - Dconnexion..."),setTimeout(()=>{sessionStorage.removeItem("token"),sessionStorage.removeItem("role"),sessionStorage.removeItem("displayName"),localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("displayName"),e("/login")},1500)}catch{St("Erreur","error"),ae(!1),Z(0)}},rt=async()=>{for(let xe=1;xe<=5;xe++)if(!confirm(`CONFIRMATION ${xe}/5 : Tlcharger backup complet ?`))return;ae(!0);try{const xe=await K.get("/backup/full",{responseType:"blob"}),pt=window.URL.createObjectURL(new Blob([xe.data])),at=document.createElement("a");at.href=pt,at.setAttribute("download",`nvcar-full-backup-${new Date().toISOString().split("T")[0]}.zip`),document.body.appendChild(at),at.click(),at.remove(),St("Sauvegarde tlcharge")}catch{St("Erreur","error")}finally{ae(!1)}},wt=async()=>{(await Promise.all([_e("smtp_host",H),_e("smtp_port",me),_e("smtp_user",Be),_e("smtp_pass",qe),_e("smtp_secure",Ze)])).every(pt=>pt)&&St("Configuration SMTP sauvegarde")},ut=async(xe=!1)=>{var pt,at;be(!0),Ne(null);try{const fr=await K.post("/settings/smtp/test",{host:H,port:me,user:Be,pass:qe,secure:Ze,testEmail:xe?Ae:void 0});Ne({success:!0,message:fr.data.message})}catch(fr){Ne({success:!1,message:((at=(pt=fr.response)==null?void 0:pt.data)==null?void 0:at.error)||"Erreur SMTP"})}finally{be(!1)}};p.useEffect(()=>{if(!Y||!pe){je(null);return}je(new Date(Date.now()+P*6e4));const xe=setInterval(async()=>{try{const pt=await K.get("/backup/full",{responseType:"blob"}),at=`nvcar-auto-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.zip`,Dn=await(await pe.getFileHandle(at,{create:!0})).createWritable();await Dn.write(new Blob([pt.data])),await Dn.close(),St(`Sauvegarde auto: ${at}`),je(new Date(Date.now()+P*6e4))}catch{St("chec sauvegarde auto","error")}},P*6e4);return()=>clearInterval(xe)},[Y,pe,P]);const Bt=async()=>{try{const xe=await window.showDirectoryPicker();ye(xe),St("Dossier slectionn")}catch{St("Erreur slection dossier","error")}},gt=()=>{const xe=sessionStorage.getItem("token")||localStorage.getItem("token");window.open(xe?`/simulation-lab?token=${encodeURIComponent(xe)}`:"/simulation-lab","_blank","noopener,noreferrer")};if(L)return n.jsx("div",{className:"admin-settings",children:n.jsxs("div",{className:"settings-loading",style:{gridColumn:"1 / -1"},children:[n.jsx("div",{className:"settings-loading-spinner"}),n.jsx("p",{style:{color:"var(--muted)"},children:"Chargement des paramtres..."})]})});const yt=({active:xe,activeText:pt="Activ",inactiveText:at="Dsactiv"})=>n.jsxs("div",{className:"status-indicator",children:[n.jsx("span",{className:`status-dot ${xe?"active":"inactive"}`}),n.jsx("span",{style:{color:xe?"var(--success)":"#f87171"},children:xe?pt:at})]}),bt=({checked:xe,onChange:pt})=>n.jsxs("label",{className:"switch",children:[n.jsx("input",{type:"checkbox",checked:xe,onChange:pt}),n.jsx("span",{className:"slider"})]}),$t=({id:xe,children:pt})=>{const at=k_.find(sn=>sn.id===xe),fr=Ds[at.icon],Dn=o.has(xe);return n.jsxs("div",{ref:sn=>h.current[xe]=sn,className:`settings-section ${Dn?"collapsed":""}`,id:xe,children:[n.jsxs("div",{className:"section-header",onClick:()=>ir(xe),children:[n.jsx("div",{className:"section-icon-wrapper",style:{background:`${at.color}15`,color:at.color},children:n.jsx(fr,{})}),n.jsxs("div",{className:"section-title-wrapper",children:[n.jsx("h2",{className:"section-title",children:at.label}),n.jsx("p",{className:"section-description",children:at.description})]}),n.jsx("div",{className:"section-collapse-icon",children:n.jsx(Ds.ChevronDown,{})})]}),!Dn&&n.jsx("div",{className:"settings-section-content",children:pt})]})};return n.jsxs("div",{className:"admin-settings",children:[n.jsx("div",{className:`mobile-menu-backdrop ${c?"visible":""}`,onClick:()=>u(!1)}),n.jsxs("aside",{className:`settings-sidebar ${c?"open":""}`,children:[n.jsx("div",{className:"settings-sidebar-header",children:n.jsxs("h1",{className:"settings-sidebar-title",children:[n.jsx(Ds.Settings,{})," Paramtres"]})}),k_.map(xe=>{const pt=Ds[xe.icon];return n.jsxs("button",{type:"button",className:`settings-nav-item ${i===xe.id?"active":""}`,onClick:()=>$e(xe.id),children:[n.jsx("span",{className:"settings-nav-icon",children:n.jsx(pt,{})}),xe.label]},xe.id)})]}),n.jsxs("main",{className:"settings-main",children:[n.jsx("div",{className:"settings-header",children:n.jsxs("div",{className:"settings-header-top",children:[n.jsxs("div",{children:[n.jsxs("button",{type:"button",className:"mobile-menu-btn",onClick:()=>u(!0),style:{display:"none"},children:[n.jsx(Ds.Menu,{})," Menu"]}),n.jsx("h1",{className:"settings-title",children:"Paramtres Globaux"}),n.jsx("p",{className:"settings-subtitle",children:"Grez les configurations et accs de l'application"})]}),n.jsxs("div",{className:"settings-search-wrapper",children:[n.jsx(Ds.Search,{}),n.jsx("input",{type:"text",className:"settings-search",placeholder:"Rechercher un paramtre...",value:d,onChange:xe=>f(xe.target.value),style:{paddingLeft:44}})]})]})}),n.jsxs("div",{className:"settings-grid",children:[n.jsx($t,{id:"sandbox",children:n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Ouvrir Simulation Lab"}),n.jsx("p",{children:"Environnement isol pour tester les fonctionnalits sans affecter les donnes relles."})]}),n.jsx("button",{type:"button",className:"settings-btn primary",onClick:gt,children:"Ouvrir dans un nouvel onglet"})]})}),n.jsx($t,{id:"status",children:n.jsx("div",{className:"status-cards",children:[{label:"Frontend",value:"En ligne",active:!0,color:"#00b894"},{label:"Backend",value:(ve==null?void 0:ve.backend)==="online"?"En ligne":"Hors ligne",active:(ve==null?void 0:ve.backend)==="online",color:"#3498db"},{label:"Base de donnes",value:(ve==null?void 0:ve.database)==="connected"?"Connecte":"Dconnecte",active:(ve==null?void 0:ve.database)==="connected",color:"#9b59b6"}].map((xe,pt)=>n.jsxs("div",{className:"status-card",children:[n.jsx("div",{className:"status-card-icon",style:{background:`${xe.color}15`,color:xe.color},children:n.jsx(Ds.Activity,{})}),n.jsxs("div",{className:"status-card-info",children:[n.jsx("h4",{children:xe.label}),n.jsxs("div",{className:"status-card-value",children:[n.jsx("span",{className:`status-dot ${xe.active?"active":"inactive"}`}),xe.value]})]})]},pt))})}),n.jsx($t,{id:"monitoring",children:n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" tat de Surveillance"}),n.jsx("p",{children:"Consulter le bilan des fonctionnalits de monitoring et de scurit."})]}),n.jsx("button",{type:"button",className:"settings-btn",style:{background:"#ff7675",color:"white"},onClick:()=>e("/admin/monitoring"),children:"Ouvrir les Diagnostics"})]})}),n.jsxs($t,{id:"errors",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsxs("h3",{children:[" Erreurs utilisateurs (",Ot.filter(xe=>!xe.resolved).length,")"]}),n.jsx("p",{children:"Liste des erreurs rencontres par les utilisateurs (enseignants, prfets, AEFE, admin)."})]}),n.jsxs("div",{className:"settings-btn-group",children:[n.jsxs("select",{className:"settings-select",value:vt,onChange:xe=>Zt(xe.target.value),children:[n.jsx("option",{value:"open",children:"Non rsolues"}),n.jsx("option",{value:"resolved",children:"Rsolues"}),n.jsx("option",{value:"all",children:"Toutes"})]}),n.jsxs("button",{type:"button",className:"settings-btn secondary",onClick:()=>Yt(vt),disabled:nt,children:[nt?"":""," Rafrachir"]}),Ot.some(xe=>!xe.resolved)&&n.jsx("button",{type:"button",className:"settings-btn danger",onClick:mr,children:" Tout rsoudre"})]})]}),nt&&Ot.length===0&&n.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#64748b"},children:" Chargement des erreurs..."}),!nt&&Ot.length===0&&n.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#64748b",background:"#f8fafc",borderRadius:12,marginTop:"1rem"},children:" Aucune erreur enregistre"}),Ot.length>0&&n.jsx("div",{className:"backup-table-wrapper",style:{marginTop:"1rem"},children:n.jsxs("table",{className:"backup-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Utilisateur"}),n.jsx("th",{children:"Rle"}),n.jsx("th",{children:"Endpoint"}),n.jsx("th",{children:"Message"}),n.jsx("th",{children:"Statut"}),n.jsx("th",{style:{textAlign:"right"},children:"Action"})]})}),n.jsx("tbody",{children:Ot.map(xe=>{var pt;return n.jsxs("tr",{children:[n.jsxs("td",{children:[n.jsx("div",{style:{fontSize:13,fontWeight:500},children:xe.createdAt?new Date(xe.createdAt).toLocaleDateString("fr-FR"):"-"}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:xe.createdAt?new Date(xe.createdAt).toLocaleTimeString("fr-FR"):""})]}),n.jsxs("td",{children:[n.jsx("div",{style:{fontSize:13,fontWeight:500},children:xe.displayName||"Utilisateur"}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:xe.email||xe.userId})]}),n.jsx("td",{children:n.jsx("span",{className:`error-log-badge ${((pt=xe.role)==null?void 0:pt.toLowerCase())||"role"}`,children:xe.role||"-"})}),n.jsxs("td",{style:{fontSize:12},children:[n.jsx("div",{style:{fontWeight:600},children:xe.method||"GET"}),n.jsx("div",{style:{color:"#64748b"},children:xe.url||"-"})]}),n.jsxs("td",{style:{fontSize:12,color:"#0f172a"},children:[xe.message||"-",xe.status?n.jsxs("div",{style:{color:"#64748b"},children:["HTTP ",xe.status]}):null]}),n.jsx("td",{children:n.jsx("span",{className:`error-log-status ${xe.resolved?"resolved":"open"}`,children:xe.resolved?"Rsolue":"Ouverte"})}),n.jsxs("td",{style:{textAlign:"right"},children:[!xe.resolved&&n.jsx("button",{type:"button",className:"settings-btn success",style:{padding:"6px 10px",fontSize:12},onClick:()=>_t(xe._id),children:" Rsoudre"}),xe.resolved&&n.jsx("span",{style:{fontSize:12,color:"#64748b"},children:""})]})]},xe._id)})})]})})]}),n.jsx($t,{id:"year",children:n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Anne active pour cette session"}),n.jsx("p",{children:"Changez l'anne visible uniquement pour vous (n'affecte pas les autres utilisateurs)"})]}),n.jsx("select",{className:"settings-select",value:r,onChange:xe=>s(xe.target.value),children:t.map(xe=>n.jsxs("option",{value:xe._id,children:[xe.name," ",xe.active?"(Active par dfaut)":""]},xe._id))})]})}),n.jsx($t,{id:"access",children:[{label:"Connexion Enseignants",desc:"Autoriser les enseignants  accder  leur espace",value:m,key:"login_enabled_teacher",setter:g},{label:"Connexion Prfets",desc:"Autoriser les prfets  accder au panneau de gestion",value:x,key:"login_enabled_subadmin",setter:y},{label:"Connexion Microsoft",desc:"Afficher le bouton de connexion Microsoft",value:v,key:"login_enabled_microsoft",setter:S}].map((xe,pt)=>n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:xe.label}),n.jsx("p",{children:xe.desc})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:xe.value}),n.jsx(bt,{checked:xe.value,onChange:()=>We(xe.key,xe.value,xe.setter)})]})]},pt))}),n.jsxs($t,{id:"device",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Bloquer les appareils mobiles"}),n.jsx("p",{children:"Empcher l'accs  l'application depuis les tlphones et tablettes. Un message invite  utiliser un ordinateur."})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:V,activeText:"Bloqu",inactiveText:"Autoris"}),n.jsx(bt,{checked:V,onChange:()=>We("mobile_block_enabled",V,fe)})]})]}),V&&n.jsxs("div",{className:"conditional-settings",children:[n.jsxs("div",{className:"setting-item conditional-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Largeur d'cran minimale"}),n.jsx("p",{children:"Les appareils avec une largeur infrieure  cette valeur seront bloqus. Recommand : 1024px (ancien laptops compatibles) ou 1280px (tablettes bloques)."})]}),n.jsx("div",{className:"settings-form-group",style:{marginLeft:"auto",minWidth:140},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"number",min:"768",max:"1920",className:"settings-input",value:Oe,onChange:xe=>Fe(parseInt(xe.target.value)||1024),style:{width:80,textAlign:"center"}}),n.jsx("span",{style:{color:"#64748b"},children:"px"}),n.jsx("button",{type:"button",className:"settings-btn primary",onClick:()=>_e("mobile_min_width",Oe),style:{padding:"8px 12px",fontSize:13},children:""})]})})]}),n.jsx("div",{className:"setting-item",style:{background:"#fef3c7",borderColor:"#fcd34d"},children:n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{style:{color:"#b45309"},children:" Valeurs recommandes"}),n.jsxs("p",{style:{color:"#92400e"},children:[n.jsx("strong",{children:"1024px"})," : Supporte les anciens laptops, bloque la plupart des tablettes",n.jsx("br",{}),n.jsx("strong",{children:"1280px"})," : Bloque presque toutes les tablettes",n.jsx("br",{}),n.jsx("strong",{children:"1366px"})," : Bloque toutes les tablettes (peut bloquer les trs petits laptops)"]})]})})]}),n.jsxs("div",{className:"setting-item",style:{marginTop:"1.5rem"},children:[n.jsxs("div",{className:"setting-info",children:[n.jsxs("h3",{children:[" Journaux d'accs mobile (",Ve.length,")"]}),n.jsx("p",{children:"Historique des tentatives d'accs depuis des appareils bloqus (IP, appareil, heure)."})]}),n.jsxs("div",{className:"settings-btn-group",children:[n.jsxs("button",{type:"button",className:"settings-btn secondary",onClick:jt,disabled:Wt,children:[Wt?"":""," Rafrachir"]}),Ve.length>0&&n.jsx("button",{type:"button",className:"settings-btn danger",onClick:Ht,children:" Vider"})]})]}),Wt&&Ve.length===0&&n.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#64748b"},children:" Chargement des journaux..."}),!Wt&&Ve.length===0&&n.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#64748b",background:"#f8fafc",borderRadius:12,marginTop:"1rem"},children:" Aucune tentative d'accs mobile enregistre"}),Ve.length>0&&n.jsxs("div",{className:"backup-table-wrapper",style:{marginTop:"1rem"},children:[n.jsxs("table",{className:"backup-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date/Heure"}),n.jsx("th",{children:"Adresse IP"}),n.jsx("th",{children:"Appareil"}),n.jsx("th",{children:"cran"}),n.jsx("th",{children:"Navigateur"}),n.jsx("th",{children:"OS"})]})}),n.jsx("tbody",{children:Ve.map((xe,pt)=>n.jsxs("tr",{children:[n.jsxs("td",{children:[n.jsx("div",{style:{fontSize:13,fontWeight:500},children:new Date(xe.timestamp).toLocaleDateString("fr-FR")}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:new Date(xe.timestamp).toLocaleTimeString("fr-FR")})]}),n.jsx("td",{children:n.jsx("code",{style:{background:"#f1f5f9",padding:"4px 8px",borderRadius:4,fontSize:12,fontFamily:"monospace"},children:xe.ipAddress})}),n.jsx("td",{children:n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:12,fontSize:12,fontWeight:500,background:xe.deviceType==="phone"?"#fef2f2":xe.deviceType==="tablet"?"#fef3c7":"#f0fdf4",color:xe.deviceType==="phone"?"#dc2626":xe.deviceType==="tablet"?"#d97706":"#16a34a"},children:[xe.deviceType==="phone"||xe.deviceType==="tablet"?"":"",xe.deviceType==="phone"?"Tlphone":xe.deviceType==="tablet"?"Tablette":xe.deviceType]})}),n.jsxs("td",{style:{fontSize:12,color:"#64748b"},children:[xe.screenWidth,"",xe.screenHeight]}),n.jsx("td",{style:{fontSize:12},children:xe.browser||"-"}),n.jsx("td",{style:{fontSize:12},children:xe.os||"-"})]},xe._id||pt))})]}),n.jsxs("div",{style:{padding:"12px 16px",background:"#f8fafc",borderTop:"1px solid #e2e8f0",fontSize:12,color:"#64748b",textAlign:"center"},children:["Affichage des ",Ve.length," dernires tentatives"]})]})]}),n.jsxs($t,{id:"teacher",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Notation rapide"}),n.jsx("p",{children:`Afficher l'option "Notation rapide" en plus de la vue normale pour les enseignants.`})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:D,activeText:"Les deux vues",inactiveText:"Vue normale uniquement"}),n.jsx(bt,{checked:D,onChange:()=>We("teacher_quick_grading_enabled",D,w)})]})]}),n.jsxs("div",{className:"setting-item",style:{marginTop:16,paddingTop:16,borderTop:"1px solid #e2e8f0"},children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Dropdowns PS - Anne Prcdente"}),n.jsx("p",{children:"Permettre la modification des menus droulants pour les donnes PS des annes prcdentes"})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:Se}),n.jsx(bt,{checked:Se,onChange:()=>We("previous_year_dropdown_editable_PS",Se,Ie)})]})]}),n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Dropdowns MS - Anne Prcdente"}),n.jsx("p",{children:"Permettre la modification des menus droulants pour les donnes MS des annes prcdentes"})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:Re}),n.jsx(bt,{checked:Re,onChange:()=>We("previous_year_dropdown_editable_MS",Re,ht)})]})]}),n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Dropdowns GS - Anne Prcdente"}),n.jsx("p",{children:"Permettre la modification des menus droulants pour les donnes GS des annes prcdentes"})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:Et}),n.jsx(bt,{checked:Et,onChange:()=>We("previous_year_dropdown_editable_GS",Et,Mt)})]})]})]}),n.jsxs($t,{id:"smtp",children:[n.jsxs("div",{className:"settings-form-row",children:[n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Serveur SMTP"}),n.jsx("input",{type:"text",className:"settings-input",value:H,onChange:xe=>ie(xe.target.value),placeholder:"smtp.gmail.com"})]}),n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Port"}),n.jsx("input",{type:"text",className:"settings-input",value:me,onChange:xe=>ke(xe.target.value),placeholder:"587"})]})]}),n.jsxs("div",{className:"settings-form-row",children:[n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Email / Utilisateur"}),n.jsx("input",{type:"email",className:"settings-input",value:Be,onChange:xe=>Te(xe.target.value),placeholder:"votre@email.com"})]}),n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Mot de passe"}),n.jsx("input",{type:"password",className:"settings-input",value:qe,onChange:xe=>Qe(xe.target.value),placeholder:""})]})]}),n.jsxs("div",{className:"setting-item",style:{marginTop:"1rem"},children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Connexion scurise (SSL/TLS)"}),n.jsx("p",{children:"Activer pour le port 465, dsactiver pour le port 587 avec STARTTLS"})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:Ze,activeText:"SSL/TLS",inactiveText:"STARTTLS"}),n.jsx(bt,{checked:Ze,onChange:()=>ge(!Ze)})]})]}),n.jsxs("div",{className:"settings-btn-group",style:{marginTop:"1rem"},children:[n.jsx("button",{type:"button",className:"settings-btn primary",onClick:wt,children:" Sauvegarder"}),n.jsx("button",{type:"button",className:"settings-btn secondary",onClick:()=>ut(!1),disabled:Q||!H||!Be||!qe,children:Q?" Test...":" Tester la connexion"})]}),n.jsxs("div",{className:"email-test-section",children:[n.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:500,color:"#475569"},children:"Envoyer un email de test"}),n.jsxs("div",{className:"email-test-row",children:[n.jsx("input",{type:"email",className:"settings-input",value:Ae,onChange:xe=>Le(xe.target.value),placeholder:"destinataire@email.com"}),n.jsxs("button",{type:"button",className:"settings-btn success",onClick:()=>ut(!0),disabled:Q||!H||!Be||!qe||!Ae,children:[Q?"":""," Envoyer"]})]})]}),we&&n.jsxs("div",{className:`test-result ${we.success?"success":"error"}`,children:[we.success?"":""," ",we.message]})]}),n.jsxs($t,{id:"signature",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Activer les restrictions"}),n.jsx("p",{children:"Si dsactiv, les sous-admins peuvent signer n'importe quel carnet sans contrainte."})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:k}),n.jsx(bt,{checked:k,onChange:()=>We("subadmin_restriction_enabled",k,j)})]})]}),k&&n.jsx("div",{className:"conditional-settings",children:[{label:"Exempter 1re Signature (Standard)",desc:"Autoriser la signature standard mme si le carnet n'est pas termin.",value:_,key:"subadmin_restriction_exempt_standard",setter:b},{label:"Exempter Fin d'Anne / Promotion",desc:"Autoriser la signature de fin d'anne et la promotion sans contraintes strictes.",value:A,key:"subadmin_restriction_exempt_final",setter:z}].map((xe,pt)=>n.jsxs("div",{className:"setting-item conditional-item warning",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:xe.label}),n.jsx("p",{children:xe.desc})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:xe.value,activeText:"Exempt",inactiveText:"Restreint"}),n.jsx(bt,{checked:xe.value,onChange:()=>We(xe.key,xe.value,xe.setter)})]})]},pt))})]}),n.jsxs($t,{id:"database",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Crer une sauvegarde"}),n.jsx("p",{children:"Sauvegarder l'tat actuel de la base de donnes sur le serveur."})]}),n.jsx("button",{type:"button",className:"settings-btn primary",onClick:yr,disabled:re,children:re?"Cration...":" Crer Sauvegarde"})]}),oe.length>0&&n.jsx("div",{className:"backup-table-wrapper",children:n.jsxs("table",{className:"backup-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Nom / Date"}),n.jsx("th",{style:{textAlign:"right"},children:"Taille"}),n.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),n.jsx("tbody",{children:oe.map(xe=>n.jsxs("tr",{children:[n.jsxs("td",{children:[n.jsx("div",{className:"backup-name",children:new Date(xe.date).toLocaleString()}),n.jsx("div",{className:"backup-filename",children:xe.name})]}),n.jsxs("td",{className:"backup-size",children:[(xe.size/1024/1024).toFixed(2)," MB"]}),n.jsx("td",{children:n.jsxs("div",{className:"backup-actions",children:[n.jsx("button",{type:"button",className:"settings-btn secondary",onClick:()=>Kt(xe.name),disabled:re,children:"Restaurer"}),n.jsx("button",{type:"button",className:"settings-btn danger",onClick:()=>Sr(xe.name),disabled:re,children:""})]})})]},xe.name))})]})}),n.jsxs("div",{className:"danger-zone",children:[n.jsxs("div",{className:"danger-zone-header",children:[n.jsx(Ds.AlertTriangle,{}),n.jsx("h3",{children:"Zone de Danger"})]}),n.jsxs("div",{className:"setting-item",style:{background:"#fef2f2"},children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{style:{color:"#ef4444"},children:"Vider la base de donnes"}),n.jsx("p",{children:"Action irrversible. Supprime toutes les donnes sauf admin et niveaux par dfaut."})]}),n.jsx("button",{type:"button",className:"settings-btn danger",onClick:Me,disabled:re,style:{background:Pe>0?"#b91c1c":void 0},children:Pe>0?Pe===4?" DERNIRE CHANCE !":` Confirmer (${Pe}/5)`:" Vider la BDD"})]})]})]}),n.jsxs($t,{id:"maintenance",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Sauvegarde complte"}),n.jsx("p",{children:"Tlcharger une archive ZIP contenant tout le code source et la base de donnes"})]}),n.jsx("button",{type:"button",className:"settings-btn secondary",onClick:rt,disabled:re,children:re?"Cration...":" Tlcharger Backup Complet"})]}),n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Redmarrer le serveur"}),n.jsx("p",{children:"Redmarrer le backend pour appliquer les nouvelles fonctionnalits"})]}),n.jsx("button",{type:"button",className:"settings-btn danger",onClick:async()=>{if(confirm("Redmarrer le serveur ?"))try{await K.post("/settings/restart"),St("Redmarrage en cours...")}catch{St("Erreur","error")}},children:" Redmarrer"})]}),n.jsxs("div",{className:"auto-backup-card",children:[n.jsxs("div",{className:"auto-backup-header",children:[n.jsxs("div",{className:"setting-info",children:[n.jsxs("h3",{children:[n.jsx(Ds.Save,{})," Sauvegarde Automatique"]}),n.jsx("p",{style:{marginTop:4},children:"Sauvegarder automatiquement dans un dossier local (ncessite que l'onglet reste ouvert)"})]}),n.jsxs("div",{className:"setting-actions",children:[n.jsx(yt,{active:Y}),n.jsx(bt,{checked:Y,onChange:()=>{if(!Y&&!pe){alert("Choisissez d'abord un dossier.");return}J(!Y)}})]})]}),n.jsxs("div",{className:"auto-backup-grid",children:[n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Frquence"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"number",min:"1",className:"settings-input",value:P,onChange:xe=>ce(parseInt(xe.target.value)||60),disabled:Y,style:{width:80}}),n.jsx("span",{style:{color:"#64748b"},children:"minutes"})]})]}),n.jsxs("div",{className:"settings-form-group",children:[n.jsx("label",{children:"Destination"}),n.jsxs("button",{type:"button",className:"settings-btn secondary",onClick:Bt,style:{background:pe?"#e0f2fe":"white",borderColor:pe?"#7dd3fc":"#e2e8f0",color:pe?"#0284c7":"#475569"},children:[n.jsx(Ds.Folder,{})," ",pe?"Dossier slectionn":"Choisir le dossier"]})]})]}),se&&Y&&n.jsxs("div",{className:"next-backup-indicator",children:[n.jsx(Ds.Clock,{})," Prochaine sauvegarde  ",n.jsx("strong",{children:se.toLocaleTimeString()})]})]})]}),n.jsxs($t,{id:"notiftest",children:[n.jsxs("div",{className:"setting-item",children:[n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{children:" Tester la Notification de Session"}),n.jsx("p",{children:`Simulez la notification d'expiration de session qui apparat 5 minutes avant la fin. Cela vous permet de voir l'apparence et de tester le bouton "+30 min".`})]}),n.jsx("button",{type:"button",className:"settings-btn primary",onClick:()=>{ee({message:"Votre session expirera dans 5 minutes.",type:"info",actionLabel:"Prolonger +30 min",onAction:()=>{G(!0),setTimeout(()=>{ee({message:"Session prolonge de 30 minutes ! (Simulation)",type:"success"}),G(!1),setTimeout(()=>ee(null),4e3)},1e3)}})},children:" Afficher la Notification Test"})]}),n.jsx("div",{className:"setting-item",style:{background:"#fef3c7",borderColor:"#fcd34d"},children:n.jsxs("div",{className:"setting-info",children:[n.jsx("h3",{style:{color:"#b45309"},children:"  propos de cette notification"}),n.jsxs("p",{style:{color:"#92400e"},children:["La notification apparat maintenant en ",n.jsx("strong",{children:"haut  droite"})," de l'cran et est plus grande et visible. Elle s'affiche automatiquement 5 minutes avant l'expiration de votre session relle."]})]})})]})]})]}),B&&n.jsxs("div",{className:`toast-message ${T==="error"?"error":""}`,children:[T==="success"?n.jsx(Ds.Check,{}):n.jsx(Ds.AlertTriangle,{}),n.jsx("span",{children:B})]}),ne&&n.jsx(ca,{message:ne.message,type:ne.type,duration:59e3,onClose:()=>ee(null),actionLabel:ne.actionLabel,onAction:ne.onAction,actionDisabled:te})]})}const Df=800,N_=1120;function Iy({mode:e}){const{assignmentId:t,savedId:r,templateId:s,studentId:i}=oa(),[a]=f4(),o=a.get("token"),l=a.get("hideSignatures")==="true",[c,u]=p.useState(null),[d,f]=p.useState(null),[h,m]=p.useState(null),[g,x]=p.useState(null),[y,v]=p.useState(null),[S,k]=p.useState(!0),[j,_]=p.useState(""),[b,A]=p.useState(null),[z,D]=p.useState({}),{levels:w}=la(),N=Y=>{if(!Y)return"";if(w&&w.length>0){const P=w.find(ce=>ce.name===Y);if(P){const ce=w.find(pe=>pe.order===P.order+1);if(ce)return ce.name}}const J=(Y||"").toUpperCase();return J==="TPS"?"PS":J==="PS"?"MS":J==="MS"?"GS":J==="GS"?"EB1":J==="KG1"?"KG2":J==="KG2"?"KG3":J==="KG3"?"EB1":""},$=Y=>{if(Y.props.level)return Y.props.level;const J=(Y.props.label||"").toUpperCase();return/\bTPS\b/.test(J)?"TPS":/\bPS\b/.test(J)?"PS":/\bMS\b/.test(J)?"MS":/\bGS\b/.test(J)?"GS":/\bEB1\b/.test(J)?"EB1":/\bKG1\b/.test(J)?"KG1":/\bKG2\b/.test(J)?"KG2":/\bKG3\b/.test(J)?"KG3":null},E={TPS:0,PS:1,MS:2,GS:3,EB1:4,KG1:1,KG2:2,KG3:3},q=Y=>{if(!Y)return!1;const J=((d==null?void 0:d.level)||"").toUpperCase(),P=Y.toUpperCase(),ce=E[J]??99;return(E[P]??99)>ce},L=Y=>{var se,je,ve;if(!Y)return{hasSem1:!!g,hasSem2:!!y};const J=Y.toUpperCase(),P=((se=h==null?void 0:h.data)==null?void 0:se.signatures)||[],ce=((je=h==null?void 0:h.data)==null?void 0:je.promotions)||[];let pe=!1,ye=!1;return((ve=d==null?void 0:d.level)==null?void 0:ve.toUpperCase())===J&&(pe=!!g,ye=!!y),P.forEach(le=>{var oe,de;if(le.schoolYearName){const Pe=ce.find(Z=>Z.year===le.schoolYearName);Pe&&((oe=Pe.from)==null?void 0:oe.toUpperCase())===J&&((le.type==="standard"||!le.type)&&(pe=!0),le.type==="end_of_year"&&(ye=!0))}((de=le.level)==null?void 0:de.toUpperCase())===J&&((le.type==="standard"||!le.type)&&(pe=!0),le.type==="end_of_year"&&(ye=!0))}),{hasSem1:pe,hasSem2:ye}},O=Y=>{if(!Y)return"";const J=Y.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!J)return"";const P=parseInt(J[1],10),ce=J[2],pe=parseInt(J[3],10);return Number.isNaN(P)||Number.isNaN(pe)?"":`${P+1}${ce}${pe+1}`},B=(Y,J)=>{var je;const P=String((Y==null?void 0:Y.year)||"");if(P){const ve=O(P);if(ve)return ve}if(!P)return"";const ce=((je=h==null?void 0:h.data)==null?void 0:je.signatures)||[],pe=String((Y==null?void 0:Y.from)||J||""),ye=Array.isArray(ce)?ce.filter(ve=>(ve==null?void 0:ve.type)==="end_of_year"&&(ve==null?void 0:ve.schoolYearName)).find(ve=>pe?ve!=null&&ve.level?String(ve.level)===pe:!1:!0):null;return ye!=null&&ye.schoolYearName?String(ye.schoolYearName):O(P)||P},I=(Y,J,P)=>{var ve;const ce=((ve=h==null?void 0:h.data)==null?void 0:ve.signatures)||[],pe=P==="end-year",ye=P==="mid-year",je=ce.filter(le=>{if(pe){if(le.type!=="end_of_year")return!1}else if(ye&&le.type&&le.type!=="standard")return!1;return!(le.level&&J&&le.level!==J)}).sort((le,oe)=>{const de=new Date(le.signedAt||0).getTime();return new Date(oe.signedAt||0).getTime()-de})[0];if(je){let le=String(je.schoolYearName||"").trim();if(!le&&je.signedAt){const oe=new Date(je.signedAt),de=oe.getFullYear(),Z=oe.getMonth()>=8?de:de-1;le=`${Z}/${Z+1}`}if(le)return le}return String((Y==null?void 0:Y.year)||"")},T=Y=>l&&(Y.type==="signature_block"||Y.type==="signature_date"),W=Y=>{var ce,pe,ye;const J=((ce=Y.props)==null?void 0:ce.semester)??((pe=Y.props)==null?void 0:pe.semestre)??null;if(J===1||J==="1")return 1;if(J===2||J==="2")return 2;const P=String(((ye=Y.props)==null?void 0:ye.period)||"");return P==="mid-year"?1:P==="end-year"?2:null},re=Y=>{var de,Pe,Z;const{level:J,semester:P}=Y,ce=[],pe=(de=h==null?void 0:h.data)==null?void 0:de.signatures;Array.isArray(pe)&&ce.push(...pe),g&&ce.push(g),y&&ce.push(y);const ye=Array.isArray((Pe=h==null?void 0:h.data)==null?void 0:Pe.promotions)?(Z=h==null?void 0:h.data)==null?void 0:Z.promotions:[],se=ne=>String(ne||"").trim().toLowerCase(),je=se(J),ve=ne=>{const ee=String((ne==null?void 0:ne.signaturePeriodId)||""),te=String((ne==null?void 0:ne.type)||"standard");return P===1?ee.endsWith("_sem1")||te==="standard":P===2?ee.endsWith("_sem2")||ee.endsWith("_end_of_year")||te==="end_of_year":!0},le=ne=>{if(!je)return!0;const ee=se(ne==null?void 0:ne.level);if(ee)return ee===je;if(ne!=null&&ne.schoolYearName){const G=ye.find(ie=>String((ie==null?void 0:ie.year)||"")===String(ne.schoolYearName)),H=se((G==null?void 0:G.from)||(G==null?void 0:G.fromLevel));if(H&&H===je)return!0}if(ne!=null&&ne.schoolYearId){const G=ye.find(ie=>String((ie==null?void 0:ie.schoolYearId)||"")===String(ne.schoolYearId)),H=se((G==null?void 0:G.from)||(G==null?void 0:G.fromLevel));if(H&&H===je)return!0}const te=se(d==null?void 0:d.level);return!!te&&te===je};return ce.filter(ne=>ne&&(ne==null?void 0:ne.signedAt)).filter(ve).filter(le).sort((ne,ee)=>new Date(ee.signedAt).getTime()-new Date(ne.signedAt).getTime())[0]||null},ae=(Y,J,P,ce)=>ce?`block:${ce}`:`tpl:${Y||""}:p:${J}:b:${P}`;return p.useEffect(()=>{window.__READY_FOR_PDF__=!1;const Y=P=>{try{if(!P)return"";const ce=P.split(".");if(ce.length<2)return"";const ye=ce[1].replace(/-/g,"+").replace(/_/g,"/"),se=ye+"=".repeat((4-(ye.length%4||4))%4),je=JSON.parse(atob(se)),ve=je.impersonateRole||je.role;return String(ve||"")}catch{return""}};(async()=>{var P,ce,pe;try{k(!0),o&&localStorage.setItem("token",o);try{const ye=await K.get("/school-years"),je=(Array.isArray(ye.data)?ye.data:[]).find(ve=>ve==null?void 0:ve.active);je&&A(je)}catch{}try{const ye=await K.get("/settings/public");D(ye.data.block_visibility_settings||{})}catch{}if(e==="saved"&&r){console.log("[CarnetPrint] Loading saved gradebook:",r);const se=(await K.get(`/saved-gradebooks/${r}`)).data;if(f({...se.data.student,className:se.data.className||se.data.student.className}),m(se.data.assignment),x(se.data.signature),v(se.data.finalSignature||null),se.templateId){let ve=(await K.get(`/templates/${se.templateId}`)).data;const le=se.data.assignment;if(le!=null&&le.templateVersion&&ve.versionHistory){const oe=ve.versionHistory.find(de=>de.version===le.templateVersion);oe&&(ve={...ve,pages:oe.pages,variables:oe.variables||{},watermark:oe.watermark})}le&&le.data&&ve.pages.forEach((oe,de)=>{oe.blocks.forEach((Pe,Z)=>{var ne;if(["language_toggle","language_toggle_v2"].includes(Pe.type)){const ee=typeof((ne=Pe==null?void 0:Pe.props)==null?void 0:ne.blockId)=="string"&&Pe.props.blockId.trim()?Pe.props.blockId.trim():null,te=ee?`language_toggle_${ee}`:null,G=`language_toggle_${de}_${Z}`,H=(te?le.data[te]:null)||le.data[G];H&&(Pe.props.items=H)}})}),u(ve)}}else if(e==="preview"&&s&&i){const se=(await K.get(`/students/${i}`)).data;let je="";Array.isArray(se.enrollments)&&se.enrollments.length>0&&(je=((P=se.enrollments.find(oe=>oe.status==="active")||se.enrollments[se.enrollments.length-1])==null?void 0:P.className)||""),f({_id:se._id,firstName:se.firstName,lastName:se.lastName,level:se.level,className:je,dateOfBirth:se.dateOfBirth,avatarUrl:se.avatarUrl});const ve=await K.get(`/templates/${s}`);u(ve.data)}else if(t){console.log("[CarnetPrint] Loading data for assignment:",t);let ye=localStorage.getItem("role")||"";ye||(ye=Y(o));const se=ye==="TEACHER",ve=se?`/teacher/template-assignments/${t}`:ye==="ADMIN"?`/admin-extras/templates/${t}/review`:`/subadmin/templates/${t}/review`,le=await K.get(ve);let oe=le.data.template;const de=le.data.assignment,Pe=le.data.student;if(f(Pe),m(de),se||(x(le.data.signature),v(le.data.finalSignature||null)),de!=null&&de.templateVersion&&(oe!=null&&oe.versionHistory)){const Z=oe.versionHistory.find(ne=>ne.version===de.templateVersion);Z&&(oe={...oe,pages:Z.pages,variables:Z.variables||{},watermark:Z.watermark})}de&&de.data&&(oe!=null&&oe.pages)&&oe.pages.forEach((Z,ne)=>{Z.blocks.forEach((ee,te)=>{var G;if(["language_toggle","language_toggle_v2"].includes(ee.type)){const H=typeof((G=ee==null?void 0:ee.props)==null?void 0:G.blockId)=="string"&&ee.props.blockId.trim()?ee.props.blockId.trim():null,ie=H?`language_toggle_${H}`:null,me=`language_toggle_${ne}_${te}`,ke=(ie?de.data[ie]:null)||de.data[me];ke&&(ee.props.items=ke)}})}),u(oe)}console.log("[CarnetPrint] Data loaded successfully")}catch(ye){_(((pe=(ce=ye.response)==null?void 0:ce.data)==null?void 0:pe.error)||"Erreur de chargement"),console.error("[CarnetPrint] Error loading data:",ye)}finally{k(!1)}})()},[t,r,o,e]),p.useEffect(()=>{S||(console.log("[CarnetPrint] Rendering/Loading complete, signaling ready for PDF"),setTimeout(()=>{window.__READY_FOR_PDF__=!0,console.log("[CarnetPrint] Ready for PDF generation")},500))},[S,c,d,j]),S?n.jsx("div",{style:{padding:20},children:"Chargement..."}):j?n.jsx("div",{style:{padding:20,color:"red"},children:j}):!c||!d?n.jsx("div",{style:{padding:20},children:"Donnes introuvables"}):n.jsxs("div",{style:{margin:0,padding:0},children:[n.jsx("style",{children:`
                @page {
                    size: ${Df}px ${N_}px;
                    margin: 0;
                }
                @media print {
                    html, body {
                        width: ${Df}px;
                        margin: 0;
                        padding: 0;
                    }
                    body {
                        background: transparent;
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    #root {
                        width: ${Df}px;
                        margin: 0;
                        padding: 0;
                    }
                    .page-canvas {
                        page-break-after: always;
                        page-break-inside: avoid;
                    }
                }
            `}),c.pages.map((Y,J)=>({page:Y,actualPageIndex:J})).filter(({page:Y})=>!Y.excludeFromPdf).map(({page:Y,actualPageIndex:J})=>n.jsx("div",{className:"page-canvas",style:{height:N_,width:Df,background:Y.bgColor||"#fff",overflow:"hidden",position:"relative",pageBreakAfter:"always",pageBreakInside:"avoid",margin:0},children:Y.blocks.map((P,ce)=>{var ve,le,oe,de,Pe;if(!P||!P.props)return null;const pe=$(P);if(q(pe)||T(P))return null;const ye=typeof((ve=P==null?void 0:P.props)==null?void 0:ve.blockId)=="string"&&P.props.blockId.trim()?P.props.blockId.trim():null,se=ae(c==null?void 0:c._id,J,ce,ye);let je=!0;if(pe){const Z=(oe=(le=z==null?void 0:z[pe.toUpperCase()])==null?void 0:le.pdf)==null?void 0:oe[se],{hasSem1:ne,hasSem2:ee}=L(pe);Z&&(Z==="never"||Z==="after_sem1"&&!ne&&!ee||Z==="after_sem2"&&!ee)&&(je=!1)}else{const Z=((d==null?void 0:d.level)||"PS").toUpperCase(),ne=E[Z]??99,ee=Object.keys(E).filter(H=>E[H]<=ne);let te=!1,G=!1;for(const H of ee){const ie=(Pe=(de=z==null?void 0:z[H])==null?void 0:de.pdf)==null?void 0:Pe[se];if(ie){te=!0;const{hasSem1:me,hasSem2:ke}=L(H);if(ie==="always"){G=!0;break}else if(ie==="after_sem1"&&(me||ke)){G=!0;break}else if(ie==="after_sem2"&&ke){G=!0;break}}}je=!te||G}return je?n.jsxs("div",{style:{position:"absolute",left:P.props.x||0,top:P.props.y||0,zIndex:P.props.z??ce},children:[P.type==="text"&&n.jsx("div",{style:{color:P.props.color,fontSize:P.props.fontSize,fontWeight:P.props.bold?700:400,textDecoration:P.props.underline?"underline":"none",width:P.props.width,height:P.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(P.props.runs)&&P.props.runs.length?P.props.runs.map((Z,ne)=>n.jsx("span",{style:{color:Z&&typeof Z=="object"&&typeof Z.color=="string"&&Z.color?Z.color:P.props.color||void 0,fontWeight:Z&&typeof Z=="object"&&typeof Z.bold=="boolean"?Z.bold?700:400:P.props.bold?700:400,textDecoration:Z&&typeof Z=="object"&&typeof Z.underline=="boolean"?Z.underline?"underline":"none":P.props.underline?"underline":"none"},children:(Z==null?void 0:Z.text)||""},ne)):P.props.text}),P.type==="dynamic_text"&&(()=>{const Z=String((d==null?void 0:d.fatherName)||(d==null?void 0:d.parentName)||"").trim(),ne=Z?Z.charAt(0).toUpperCase():"",ee=ne?`${ne}.`:"",te=[d.firstName,ee,d.lastName].filter(Boolean).join(" "),G=d.dateOfBirth?new Date(d.dateOfBirth):new Date(NaN),H=isNaN(G.getTime())?"":`${String(G.getUTCDate()).padStart(2,"0")}/${String(G.getUTCMonth()+1).padStart(2,"0")}/${String(G.getUTCFullYear())}`;let ie=(P.props.text||"").replace(/\{student\.firstName\}/g,d.firstName).replace(/\{student\.lastName\}/g,d.lastName).replace(/\{student\.className\}/g,d.className||"").replace(/\{student\.level\}/g,d.level||"").replace(/\{student\.dob\}/g,d.dateOfBirth?new Date(d.dateOfBirth).toLocaleDateString():"").replace(/\{student\.fatherInitial\}/g,ee).replace(/\{student\.fullNameFatherInitial\}/g,te).replace(/\{student\.dob_ddmmyyyy\}/g,H);return h!=null&&h.data&&Object.entries(h.data).forEach(([me,ke])=>{(typeof ke=="string"||typeof ke=="number")&&(ie=ie.replace(new RegExp(`\\{${me}\\}`,"g"),String(ke)))}),n.jsx("div",{style:{color:P.props.color,fontSize:P.props.fontSize,fontWeight:P.props.bold?700:400,textDecoration:P.props.underline?"underline":"none",width:P.props.width,height:P.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:ie})})(),P.type==="image"&&n.jsx(Fo,{src:P.props.url,displayWidth:P.props.width||120,displayHeight:P.props.height||120,cropData:P.props.cropData,borderRadius:8}),P.type==="student_photo"&&(d!=null&&d.avatarUrl?n.jsx("img",{src:d.avatarUrl,style:{width:P.props.width||100,height:P.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:P.props.width||100,height:P.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),P.type==="student_info"&&n.jsx("div",{style:{color:P.props.color,fontSize:P.props.fontSize,width:P.props.width,height:P.props.height,overflow:"hidden"},children:`${d.firstName} ${d.lastName}, ${d.className||"Classe"}, ${d.dateOfBirth?new Date(d.dateOfBirth).toLocaleDateString():""}`}),P.type==="category_title"&&n.jsx("div",{style:{color:P.props.color,fontSize:P.props.fontSize,width:P.props.width,height:P.props.height,overflow:"hidden"},children:P.props.text||"Titre catgorie"}),P.type==="rect"&&n.jsx("div",{style:{width:P.props.width,height:P.props.height,background:P.props.color,border:P.props.stroke?`${P.props.strokeWidth||1}px solid ${P.props.stroke}`:"none",borderRadius:P.props.radius||8}}),P.type==="circle"&&n.jsx("div",{style:{width:(P.props.radius||60)*2,height:(P.props.radius||60)*2,background:P.props.color,border:P.props.stroke?`${P.props.strokeWidth||1}px solid ${P.props.stroke}`:"none",borderRadius:"50%"}}),P.type==="line"&&n.jsx("div",{style:{width:P.props.x2||100,height:P.props.strokeWidth||2,background:P.props.stroke||"#b2bec3"}}),P.type==="arrow"&&n.jsx("div",{style:{width:P.props.x2||100,height:P.props.strokeWidth||2,background:P.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${P.props.stroke||"#6c5ce7"}`}})}),P.type==="gradebook_pocket"&&n.jsx(nc,{number:P.props.number||"1",width:P.props.width||120,fontSize:P.props.fontSize}),P.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:P.props.direction||"column",alignItems:"center",justifyContent:"center",gap:P.props.spacing||12,background:P.props.backgroundColor||"transparent",borderRadius:P.props.borderRadius||12,padding:P.props.padding||8,width:P.props.width,height:P.props.height,boxSizing:"border-box"},children:(P.props.items||[]).map((Z,ne)=>{const ee=!(Z.levels&&Z.levels.length>0&&(d!=null&&d.level)&&!Z.levels.includes(d.level)),G=(P.props.radius||40)*2;return n.jsx("div",{style:{width:G,height:G,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:Z.active?"0 0 0 2px #6c5ce7":"none",opacity:ee?.9:.5},children:Z.logo?n.jsx("img",{src:Z.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:Z.active?"brightness(1.1)":"brightness(0.6)"}}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},ne)})}),P.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:P.props.direction||"row",alignItems:"center",justifyContent:"center",gap:P.props.spacing||12,background:P.props.backgroundColor||"transparent",borderRadius:P.props.borderRadius||12,padding:P.props.padding||8,width:P.props.width,height:P.props.height,boxSizing:"border-box"},children:(P.props.items||[]).map((Z,ne)=>{const H=`https://emojicdn.elk.sh/${(Z.emoji||"").toLowerCase()?Z.emoji:(Z.code||"").toLowerCase()==="fr"?"":(Z.code||"").toLowerCase()==="en"||(Z.code||"").toLowerCase()==="gb"||(Z.code||"").toLowerCase()==="uk"?"":(Z.code||"").toLowerCase()==="lb"||(Z.code||"").toLowerCase()==="ar"?"":""}?style=apple`;return n.jsx("div",{title:Z.label,style:{width:40,height:40,minWidth:40,borderRadius:"50%",background:Z.active?"#fff":"rgba(255, 255, 255, 0.5)",border:Z.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Z.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",opacity:Z.active?1:.5},children:n.jsx("img",{src:H,style:{width:40*.9,height:40*.9,objectFit:"contain"},alt:""})},ne)})}),P.type==="table"&&(()=>{const Z=Ae=>{const Le=typeof Ae=="number"?Ae:parseFloat(String(Ae||"0"));return isNaN(Le)?0:Le},ne=(P.props.columnWidths||[]).map(Z),ee=(P.props.rowHeights||[]).map(Z),te=P.props.cells||[],G=Z(P.props.colGap),H=Z(P.props.rowGap),ie=P.props.expandedRows||!1,me=Z(P.props.expandedRowHeight||34),ke=Z(P.props.expandedDividerWidth||.5),Be=P.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",Te=4,qe=6,Qe=P.props.expandedLanguages||[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}];let Ze=0;for(let Ae=0;Ae<ne.length;Ae++)Ze+=ne[Ae]||0,Ze+=G;ne.length>0&&(Ze-=G);let ge=0;for(let Ae=0;Ae<ee.length;Ae++)ge+=ee[Ae]||0,ie&&(ge+=me+Te+qe),ge+=H;return ee.length>0&&(ge-=H),n.jsx("div",{style:{position:"relative",width:Ze,height:ge,display:ie?"flex":"grid",flexDirection:"column",gap:`${H}px ${G}px`,gridTemplateColumns:ie?void 0:ne.map(Ae=>`${Math.max(1,Math.round(Ae))}px`).join(" "),gridTemplateRows:ie?void 0:ee.map(Ae=>`${Math.max(1,Math.round(Ae))}px`).join(" "),overflow:"visible",background:H>0||G>0?"transparent":P.props.backgroundColor||"transparent",borderRadius:H>0||G>0?0:P.props.borderRadius||0},children:ie?te.map((Ae,Le)=>{var fe;const Q=P.props.borderRadius||0,be=Le===ee.length-1,we=H>0,Ne=((fe=Ae[0])==null?void 0:fe.fill)||P.props.backgroundColor||"#f8f9fa",V=ee[Le]||40;return n.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:ne.map(Oe=>`${Math.max(1,Math.round(Oe))}px`).join(" "),columnGap:G,height:V},children:Ae.map((Oe,Fe)=>{var nt,ft,vt;const Ve=(nt=Oe==null?void 0:Oe.borders)==null?void 0:nt.l,tt=(ft=Oe==null?void 0:Oe.borders)==null?void 0:ft.r,Wt=(vt=Oe==null?void 0:Oe.borders)==null?void 0:vt.t,Ct=Fe===0,Ot=Fe===ne.length-1,et={background:(Oe==null?void 0:Oe.fill)||(we&&P.props.backgroundColor?P.props.backgroundColor:"transparent"),borderLeft:Ve!=null&&Ve.width?`${Ve.width}px solid ${Ve.color||"#000"}`:"none",borderRight:tt!=null&&tt.width?`${tt.width}px solid ${tt.color||"#000"}`:"none",borderTop:Wt!=null&&Wt.width?`${Wt.width}px solid ${Wt.color||"#000"}`:"none",borderBottom:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Ct?Q:0,borderTopRightRadius:Ot?Q:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:et,children:(Oe==null?void 0:Oe.text)&&n.jsx("div",{style:{fontSize:Oe.fontSize||12,color:Oe.color||"#000",whiteSpace:"pre-wrap"},children:Oe.text})},`cell-${Le}-${Fe}`)})}),n.jsxs("div",{style:{background:Ne,borderBottomLeftRadius:we||be?Q:0,borderBottomRightRadius:we||be?Q:0,height:me,position:"relative",paddingBottom:Te},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:ke,background:Be,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-start",paddingLeft:15,paddingTop:qe,gap:8},children:(()=>{var Wt,Ct;const Oe=((Wt=P.props.rowLanguages)==null?void 0:Wt[Le])||Qe,Fe=P.props.expandedToggleStyle||"v2",Ve=`table_${ce}_row_${Le}`;return(((Ct=h==null?void 0:h.data)==null?void 0:Ct[Ve])||Oe).map((Ot,et)=>{const nt=Math.max(12,Math.min(me-12,20)),ft=!!Ot.active;if(Fe==="v1"){const Ie=Ot.logo||(()=>{const Re=(Ot.code||"").toLowerCase();return Re==="en"||Re==="uk"||Re==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":Re==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":Re==="ar"||Re==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{title:Ot.label,style:{width:nt,height:nt,minWidth:nt,borderRadius:"50%",overflow:"hidden",background:ft?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",opacity:ft?1:.6},children:Ie?n.jsx("img",{src:Ie,style:{width:"100%",height:"100%",objectFit:"cover",filter:ft?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},et)}const vt=Ot.emoji,Se=`https://emojicdn.elk.sh/${vt&&vt.length>=2?vt:(()=>{const Ie=(Ot.code||"").toLowerCase();return Ie==="lb"||Ie==="ar"?"":Ie==="fr"?"":Ie==="en"||Ie==="uk"||Ie==="gb"?"":""})()}?style=apple`;return n.jsx("div",{title:Ot.label,style:{width:nt,height:nt,minWidth:nt,borderRadius:"50%",background:ft?"#fff":"rgba(255, 255, 255, 0.5)",border:"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",opacity:ft?1:.6},children:n.jsx("img",{src:Se,style:{width:nt*.9,height:nt*.9,objectFit:"contain"},alt:""})},et)})})()})]})]},`row-unit-${Le}`)}):te.flatMap((Ae,Le)=>Ae.map((Q,be)=>{var et,nt,ft,vt;const we=(et=Q==null?void 0:Q.borders)==null?void 0:et.l,Ne=(nt=Q==null?void 0:Q.borders)==null?void 0:nt.r,V=(ft=Q==null?void 0:Q.borders)==null?void 0:ft.t,fe=(vt=Q==null?void 0:Q.borders)==null?void 0:vt.b,Oe=P.props.borderRadius||0,Fe=be===0,Ve=be===ne.length-1,tt=Le===0,Wt=Le===ee.length-1,Ct=H>0,Ot={background:(Q==null?void 0:Q.fill)||(Ct&&P.props.backgroundColor?P.props.backgroundColor:"transparent"),borderLeft:we!=null&&we.width?`${we.width}px solid ${we.color||"#000"}`:"none",borderRight:Ne!=null&&Ne.width?`${Ne.width}px solid ${Ne.color||"#000"}`:"none",borderTop:V!=null&&V.width?`${V.width}px solid ${V.color||"#000"}`:"none",borderBottom:fe!=null&&fe.width?`${fe.width}px solid ${fe.color||"#000"}`:"none",padding:15,boxSizing:"border-box",borderTopLeftRadius:Fe&&(Ct||tt)?Oe:0,borderBottomLeftRadius:Fe&&(Ct||Wt)?Oe:0,borderTopRightRadius:Ve&&(Ct||tt)?Oe:0,borderBottomRightRadius:Ve&&(Ct||Wt)?Oe:0,display:"flex",alignItems:"center",overflow:"hidden"};return n.jsx("div",{style:Ot,children:(Q==null?void 0:Q.text)&&n.jsx("div",{style:{fontSize:Q.fontSize||12,color:Q.color||"#000",whiteSpace:"pre-wrap"},children:Q.text})},`${Le}-${be}`)}))})})(),P.type==="signature"&&n.jsx("div",{style:{fontSize:P.props.fontSize,width:P.props.width,height:P.props.height,overflow:"hidden"},children:(P.props.labels||[]).join(" / ")}),P.type==="signature_date"&&(()=>{var Te,qe;const Z=String(((Te=P.props)==null?void 0:Te.level)||$(P)||"").trim()||null,ne=W(P),ee=re({level:Z,semester:ne});if(!ee)return null;const te=am(ee.signedAt),G=((qe=P.props)==null?void 0:qe.showMeta)!==!1,H="Sign le:",ie=ne?`S${ne}`:"",me=Z||"",ke=`${me}${me&&ie?" ":""}${ie}`,Be=G?`${H}${ke?` ${ke}`:""} ${te}`:`${H} ${te}`;return n.jsx("div",{style:{width:P.props.width||220,height:P.props.height||34,display:"flex",alignItems:"center",justifyContent:P.props.align||"flex-start",fontSize:P.props.fontSize||12,color:P.props.color||"#111",overflow:"hidden",whiteSpace:"nowrap"},children:Be})})(),P.type==="signature_box"&&(()=>{var te,G;const Z=$(P),ne=((te=h==null?void 0:h.data)==null?void 0:te.signatures)||[],ee=((G=h==null?void 0:h.data)==null?void 0:G.promotions)||[];if(Z){const H=g==null?void 0:g.level;if(g&&(H&&H===Z||!H&&(d==null?void 0:d.level)===Z)){const ie=g.signatureData||g.signatureUrl;return n.jsx("div",{style:{width:P.props.width||200,height:P.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:ie?n.jsx("img",{src:ie,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"})}}else if(g){const H=g.signatureData||g.signatureUrl;return n.jsx("div",{style:{width:P.props.width||200,height:P.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:H?n.jsx("img",{src:H,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"})}if(Z){const H=ne.find(ie=>{if(P.props.period==="end-year"&&ie.type!=="end_of_year"||(!P.props.period||P.props.period==="mid-year")&&ie.type==="end_of_year")return!1;if(ie.level&&ie.level===Z)return!0;if(ie.schoolYearName){const me=ee.find(ke=>ke.year===ie.schoolYearName);if(me&&me.from===Z)return!0}return!1});if(H){const ie=H.signatureData||H.signatureUrl;return n.jsx("div",{style:{width:P.props.width||200,height:P.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999"},children:ie?n.jsx("img",{src:ie,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${H.schoolYearName||"Ancien"})`})}}return null})(),P.type==="dropdown"&&(()=>{var ne,ee;const Z=P.props.dropdownNumber?(ne=h==null?void 0:h.data)==null?void 0:ne[`dropdown_${P.props.dropdownNumber}`]:P.props.variableName?(ee=h==null?void 0:h.data)==null?void 0:ee[P.props.variableName]:"";return Z?n.jsxs("div",{style:{width:P.props.width||200},children:[P.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:P.props.label}),n.jsx("div",{style:{width:"100%",minHeight:P.props.height||32,fontSize:P.props.fontSize||12,color:P.props.color||"#333",padding:"4px 8px",borderRadius:4,border:"1px solid #ccc",background:"#fff",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:Z})]}):null})(),P.type==="dropdown_reference"&&(()=>{var ee;const Z=P.props.dropdownNumber||1,ne=(ee=h==null?void 0:h.data)==null?void 0:ee[`dropdown_${Z}`];return ne?n.jsx("div",{style:{color:P.props.color||"#333",fontSize:P.props.fontSize||12,width:P.props.width||200,minHeight:P.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:ne}):null})(),P.type==="promotion_info"&&n.jsx("div",{style:{width:P.props.width||(P.props.field?150:300),height:P.props.height||(P.props.field?30:100),border:P.props.field?"none":"1px solid #6c5ce7",padding:P.props.field?0:10,borderRadius:8,fontSize:P.props.fontSize||12,color:P.props.color||"#2d3436",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:(()=>{var H,ie;const Z=((H=h==null?void 0:h.data)==null?void 0:H.promotions)||[],ne=$(P),ee=P.props.targetLevel;let te=null;if(ee&&(te=Z.find(me=>me.to===ee)),!te&&ne&&(te=Z.find(me=>me.from===ne)),!te&&!ee&&!ne&&Z.length===1&&(te={...Z[0]}),!te&&ne){const me=((ie=h==null?void 0:h.data)==null?void 0:ie.signatures)||[],ke=P.props.period==="mid-year",Be=P.props.period==="end-year",qe=me.filter(Qe=>{if(Be){if(Qe.type!=="end_of_year")return!1}else if(ke&&Qe.type&&Qe.type!=="standard")return!1;return!(Qe.level&&Qe.level!==ne)}).sort((Qe,Ze)=>{const ge=new Date(Qe.signedAt||0).getTime();return new Date(Ze.signedAt||0).getTime()-ge})[0];if(qe){let Qe=qe.schoolYearName;if(!Qe&&qe.signedAt){const Ae=new Date(qe.signedAt),Le=Ae.getFullYear(),be=Ae.getMonth()>=8?Le:Le-1;Qe=`${be}/${be+1}`}if(!Qe){const Le=new Date().getFullYear();Qe=`${Le}/${Le+1}`}const Ze=ne,ge=ee||N(Ze||"")||"";te={year:Qe,from:Ze,to:ge||"?",class:(d==null?void 0:d.className)||""}}}if(te)!te.class&&(d!=null&&d.className)&&(te.class=d.className),te.from||(ne?te.from=ne:d!=null&&d.level&&(te.from=d.level));else{const me=!!ne&&!!(d!=null&&d.level)&&ne===d.level;if(!(P.props.period==="mid-year"?!!g&&(me||!ne&&Z.length===0):!!y&&(me||!ne&&Z.length===0)))return null;let Qe=0;if(b&&b.name){const Le=String(b.name).match(/(\d{4})/);Le&&(Qe=parseInt(Le[1],10))}if(!Qe)return null;const Ze=ne||(d==null?void 0:d.level)||"",ge=ee||N(Ze||"")||"";te={year:`${Qe}/${Qe+1}`,from:Ze,to:ge||"?",class:(d==null?void 0:d.className)||""}}if(!te)return null;const G=B(te,ne);if(P.props.field){if(P.props.field==="level")return n.jsx("div",{style:{fontWeight:"bold"},children:te.to});if(P.props.field==="student")return n.jsxs("div",{children:[d==null?void 0:d.firstName," ",d==null?void 0:d.lastName]});if(P.props.field==="studentFirstName")return n.jsx("div",{children:d==null?void 0:d.firstName});if(P.props.field==="studentLastName")return n.jsx("div",{children:d==null?void 0:d.lastName});if(P.props.field==="year")return n.jsx("div",{children:G});if(P.props.field==="currentYear"){const me=I(te,ne,P.props.period)||(b==null?void 0:b.name)||"";return n.jsx("div",{children:String(me)})}else if(P.props.field==="class"){const me=te.class||"",ke=me.split(/\s*[-\s]\s*/),Be=ke.length?ke[ke.length-1]:me;return n.jsx("div",{children:Be})}else if(P.props.field==="currentLevel")return n.jsx("div",{children:te.from||""})}else return n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",te.to]}),n.jsxs("div",{children:[d==null?void 0:d.firstName," ",d==null?void 0:d.lastName]}),n.jsxs("div",{style:{fontSize:(P.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Next Year ",G]})]});return null})()}),P.type==="teacher_text"&&n.jsxs("div",{style:{width:P.props.width||300,height:P.props.height||60,border:"1px solid #ddd",borderRadius:4,padding:8,fontSize:P.props.fontSize||12,color:P.props.color||"#2d3436",background:"#fff",position:"relative",whiteSpace:"pre-wrap"},children:[(()=>{var te,G;if(P.props.level&&(d!=null&&d.level)&&P.props.level!==d.level)return null;const ne=(typeof((te=P==null?void 0:P.props)==null?void 0:te.blockId)=="string"&&P.props.blockId.trim()?P.props.blockId.trim():null)||`teacher_text_${J}_${ce}`,ee=((G=h==null?void 0:h.data)==null?void 0:G[ne])||"";return n.jsx("div",{style:{width:"100%",height:"100%",color:ee?"inherit":"#999"},children:ee||P.props.placeholder||"Texte ditable par le prof polyvalent..."})})(),P.props.label&&n.jsx("div",{style:{position:"absolute",top:-10,left:8,background:"#fff",padding:"2px 6px",fontSize:10,color:"#e17055",fontWeight:"bold"},children:P.props.label})]}),P.type==="qr"&&n.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=${P.props.width||120}x${P.props.height||120}&data=${encodeURIComponent(P.props.url||"")}`,style:{width:P.props.width||120,height:P.props.height||120},alt:"QR Code"})]},ce):null})},J))]})}const Mf=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"];function C_({title:e,subtitle:t,progress:r,byCategory:s,color:i="#fff",compact:a=!1}){const o=`progress-section-${e.replace(/\s+/g,"-")}`,l=`${e}  ${r.percentage}% complt. ${r.filled} sur ${r.total} lments remplis.`;return n.jsxs("section",{className:"progress-section",role:"region","aria-labelledby":o,tabIndex:0,style:{background:i,borderRadius:a?10:12,border:"1px solid #e2e8f0",padding:a?16:24,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:a?12:24},children:n.jsxs("div",{children:[n.jsx("h4",{id:o,style:{fontSize:a?16:20,fontWeight:600,color:"#0f172a",margin:0},children:e}),t&&n.jsx("div",{style:{color:"#64748b",fontSize:a?13:15,marginTop:4},children:t})]})}),n.jsx("div",{"aria-hidden":!1,style:{position:"absolute",left:-1e4,top:"auto",width:1,height:1,overflow:"hidden"},children:l}),n.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:a?16:32},children:[n.jsxs("div",{style:{flex:a?"0 0 180px":"0 0 250px",display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx("h5",{style:{fontSize:a?13:16,fontWeight:600,color:"#475569",marginBottom:a?8:12},children:"Progression Globale"}),n.jsxs("div",{style:{width:a?140:200,height:a?140:200,position:"relative"},children:[n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(zw,{"aria-label":`Diagramme circulaire de progression: ${r.percentage}% complt`,children:[n.jsxs(dx,{data:[{name:"Rempli",value:r.filled},{name:"Restant",value:r.total-r.filled}],cx:"50%",cy:"50%",innerRadius:a?42:60,outerRadius:a?58:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",children:[n.jsx(zi,{fill:"#22c55e"},"filled"),n.jsx(zi,{fill:"#e2e8f0"},"remaining")]}),n.jsx(ud,{})]})}),n.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[n.jsxs("div",{style:{fontSize:a?18:24,fontWeight:700,color:"#0f172a"},children:[r.percentage,"%"]}),n.jsx("div",{style:{fontSize:a?11:12,color:"#64748b"},children:"complt"})]})]})]}),n.jsxs("div",{style:{flex:1,minWidth:a?260:300},children:[n.jsx("h5",{style:{fontSize:a?13:16,fontWeight:600,color:"#475569",marginBottom:a?8:12},children:"Par Domaine / Langue"}),n.jsx("div",{style:{width:"100%",height:a?160:250},children:n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(Ow,{data:s,layout:"vertical",margin:{top:5,right:18,left:a?18:40,bottom:5},children:[n.jsx(qp,{strokeDasharray:"3 3",horizontal:!1}),n.jsx(Gp,{type:"number",domain:[0,100],unit:"%"}),n.jsx(Xp,{dataKey:"name",type:"category",width:a?80:100,tick:{fontSize:a?11:12}}),n.jsx(ud,{formatter:(c,u,d)=>{const f=d.payload;return[`${f.filled}/${f.total} (${c}%)`,"Progression"]},contentStyle:{borderRadius:8,border:"none",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"}}),n.jsx(tp,{dataKey:"percentage",fill:"#3b82f6",radius:[0,4,4,0],barSize:a?12:20,"aria-label":"Barres de progression",children:s.map((c,u)=>n.jsx(zi,{fill:Mf[u%Mf.length]},`cell-${u}`))})]})})}),n.jsx("div",{role:"list","aria-label":`${e} lgende`,style:{marginTop:12},children:s.map((c,u)=>n.jsxs("div",{role:"listitem",style:{display:"flex",alignItems:"center",gap:8,marginTop:6},children:[n.jsx("span",{"aria-hidden":!0,style:{width:12,height:12,background:Mf[u%Mf.length],borderRadius:3,display:"inline-block"}}),n.jsxs("span",{style:{fontSize:13,color:"#334155"},children:[c.name,"  ",n.jsxs("span",{style:{color:"#64748b",fontSize:12},children:[c.percentage,"%"]})," ",n.jsxs("span",{style:{color:"#9aa4b2",fontSize:12},children:["(",c.filled,"/",c.total,")"]})]})]},c.name))})]})]})]})}function lse(){const[e,t]=p.useState([]),[r,s]=p.useState([]),[i,a]=p.useState(!0),[o,l]=p.useState(""),[c,u]=p.useState(""),[d,f]=p.useState("all"),[h,m]=p.useState("className"),g=e.filter(_=>(d==="all"||_.level===d)&&_.className.toLowerCase().includes(c.toLowerCase())).sort((_,b)=>h==="progress_desc"?b.progress.percentage-_.progress.percentage:h==="progress_asc"?_.progress.percentage-b.progress.percentage:_.className.localeCompare(b.className)),x=r.filter(_=>d==="all"||_.assignedLevels.includes(d));p.useEffect(()=>{(async()=>{try{a(!0);const b=await K.get("/admin-extras/progress");t(b.data.classes||[]),s(b.data.subAdmins||[])}catch(b){l("Impossible de charger les donnes"),console.error(b)}finally{a(!1)}})()},[]);const y=e.reduce((_,b)=>(_[b.level]||(_[b.level]=[]),_[b.level].push(b),_),{}),v=Object.keys(y).sort(),S=d==="all"?v:v.filter(_=>_===d),k=()=>{u(""),f("all"),m("className")},j=_=>{const b={studentCount:0,progress:{total:0,filled:0,percentage:0},byCategory:{}};_.forEach(z=>{b.studentCount+=z.studentCount,b.progress.total+=z.progress.total,b.progress.filled+=z.progress.filled,z.byCategory.forEach(D=>{b.byCategory[D.name]||(b.byCategory[D.name]={total:0,filled:0,name:D.name}),b.byCategory[D.name].total+=D.total,b.byCategory[D.name].filled+=D.filled})}),b.progress.percentage=b.progress.total>0?Math.round(b.progress.filled/b.progress.total*100):0;const A=Object.values(b.byCategory).map(z=>({...z,percentage:z.total>0?Math.round(z.filled/z.total*100):0}));return{...b,byCategory:A}};return n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",style:{maxWidth:1400,margin:"0 auto"},children:[n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:12,color:"#1e293b"},children:" Suivi Global des Classes"}),n.jsxs("div",{className:"filter-bar",style:{display:"flex",gap:12,alignItems:"center",marginBottom:8,flexWrap:"wrap"},children:[n.jsx("input",{className:"search-input","aria-label":"Rechercher une classe",placeholder:"Rechercher une classe...",value:c,onChange:_=>u(_.target.value),style:{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e8f0",minWidth:220}}),n.jsxs("select",{"aria-label":"Filtrer par niveau",value:d,onChange:_=>f(_.target.value),style:{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("option",{value:"all",children:"Tous niveaux"}),v.map(_=>n.jsx("option",{value:_,children:_},_))]}),n.jsxs("select",{"aria-label":"Trier",value:h,onChange:_=>m(_.target.value),style:{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e8f0"},children:[n.jsx("option",{value:"className",children:"Trier: Nom"}),n.jsx("option",{value:"progress_desc",children:"Trier: Progression desc."}),n.jsx("option",{value:"progress_asc",children:"Trier: Progression asc."})]}),n.jsx("button",{className:"btn-clear",onClick:k,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff"},children:"Rinitialiser"})]}),n.jsxs("div",{style:{marginBottom:12,color:"#475569",fontSize:13},children:[n.jsx("strong",{children:g.length})," classes affiches  ",n.jsx("strong",{children:x.length})," sous-admins"]}),i&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Chargement..."}),o&&n.jsx("div",{className:"note",style:{color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca"},children:o}),!i&&!o&&e.length===0&&n.jsx("div",{className:"note",style:{textAlign:"center",padding:24},children:"Aucune classe trouve."}),!i&&!o&&e.length>0&&n.jsxs("div",{style:{marginBottom:40},children:[n.jsx("h3",{style:{fontSize:20,color:"#334155",marginBottom:20},children:" Vrification des Enseignants"}),n.jsx("div",{style:{overflowX:"auto",background:"white",borderRadius:12,border:"1px solid #e2e8f0"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[n.jsx("th",{style:{padding:"12px 24px",textAlign:"left",fontSize:14,color:"#64748b"},children:"Classe"}),n.jsx("th",{style:{padding:"12px 24px",textAlign:"left",fontSize:14,color:"#64748b"},children:"Arabe"}),n.jsx("th",{style:{padding:"12px 24px",textAlign:"left",fontSize:14,color:"#64748b"},children:"Anglais"}),n.jsx("th",{style:{padding:"12px 24px",textAlign:"left",fontSize:14,color:"#64748b"},children:"Polyvalent"})]})}),n.jsx("tbody",{children:g.map(_=>{const b=_.teachersCheck||{polyvalent:[],english:[],arabic:[],hasPolyvalent:!1,hasEnglish:!1,hasArabic:!1},A=z=>z?{}:{background:"#fef2f2",color:"#dc2626"};return n.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[n.jsx("td",{style:{padding:"12px 24px",fontWeight:500},children:_.className}),n.jsx("td",{style:{padding:"12px 24px",...A(b.hasArabic)},children:b.arabic.join(", ")||"-"}),n.jsx("td",{style:{padding:"12px 24px",...A(b.hasEnglish)},children:b.english.join(", ")||"-"}),n.jsx("td",{style:{padding:"12px 24px",...A(b.hasPolyvalent)},children:b.polyvalent.join(", ")||"-"})]},_.classId)})})]})})]}),!i&&!o&&e.length>0&&n.jsx("div",{children:S.map(_=>{const b=y[_],A=j(b);return n.jsxs("div",{style:{marginBottom:40},children:[n.jsx("h3",{style:{fontSize:20,color:"#334155",marginBottom:20,borderBottom:"2px solid #e2e8f0",paddingBottom:8,display:"flex",alignItems:"center",gap:12},children:n.jsx("span",{style:{background:"#64748b",color:"white",padding:"4px 12px",borderRadius:6,fontSize:14},children:_})}),n.jsx("div",{style:{marginBottom:24},children:n.jsx(C_,{title:`Rsum ${_}`,subtitle:`${A.studentCount} lves au total`,progress:A.progress,byCategory:A.byCategory,color:"#f8fafc",compact:!0})}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:16},children:b.filter(z=>z.className.toLowerCase().includes(c.toLowerCase())).map(z=>n.jsx(C_,{title:z.className,subtitle:`${z.teachers.join(", ")||"Aucun enseignant"}  ${z.studentCount} lves`,progress:z.progress,byCategory:z.byCategory,compact:!0},z.classId))})]},_)})}),!i&&!o&&r.length>0&&n.jsxs("div",{style:{marginTop:60,borderTop:"2px solid #e2e8f0",paddingTop:40},children:[n.jsx("h2",{className:"title",style:{fontSize:24,marginBottom:20,color:"#1e293b"},children:" Suivi des Sous-Administrateurs"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16},children:x.map(_=>n.jsxs("div",{style:{background:"#fff",borderRadius:10,border:"1px solid #e2e8f0",padding:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[n.jsx("h4",{style:{fontSize:16,fontWeight:600,margin:0},children:_.displayName}),n.jsxs("span",{style:{background:"#f1f5f9",padding:"4px 8px",borderRadius:4,fontSize:12,color:"#64748b"},children:[_.percentage,"% Sign"]})]}),n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("div",{style:{fontSize:14,color:"#64748b",marginBottom:4},children:"Primtre:"}),n.jsxs("div",{style:{fontSize:14,color:"#334155"},children:[_.assignedLevels.length>0?_.assignedLevels.join(", "):"Aucun niveau",_.assignedTeacherCount>0&&`  ${_.assignedTeacherCount} Enseignants`]})]}),n.jsxs("div",{style:{marginBottom:16},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,marginBottom:4},children:[n.jsx("span",{style:{color:"#64748b"},children:"lves"}),n.jsx("span",{style:{fontWeight:600},children:_.totalStudents})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14},children:[n.jsx("span",{style:{color:"#64748b"},children:"Carnets Signs"}),n.jsxs("span",{style:{fontWeight:600},children:[_.signedAssignments," / ",_.totalAssignments]})]})]}),n.jsx("div",{style:{height:8,background:"#f1f5f9",borderRadius:4,overflow:"hidden"},children:n.jsx("div",{style:{height:"100%",width:`${_.percentage}%`,background:_.percentage===100?"#22c55e":"#3b82f6",transition:"width 0.5s ease"}})})]},_.subAdminId))})]})]})})}const cse=({message:e,type:t,onClose:r})=>(p.useEffect(()=>{const s=setTimeout(r,3e3);return()=>clearTimeout(s)},[r]),n.jsxs("div",{className:`permissions-toast ${t}`,children:[t==="success"?n.jsx($a,{size:18}):n.jsx(yb,{size:18}),n.jsx("span",{children:e})]})),dse=({scope:e,label:t,onRemove:r})=>{const s={ALL:n.jsx(vp,{size:12}),LEVEL:n.jsx(Kl,{size:12}),CLASS:n.jsx(oD,{size:12}),STUDENT:n.jsx(Bu,{size:12})};return n.jsxs("div",{className:`permission-badge type-${e.type}`,children:[n.jsx("span",{className:"permission-badge-icon",children:s[e.type]}),n.jsx("span",{children:t}),n.jsx("button",{className:"permission-badge-remove",onClick:r,title:"Supprimer cette permission",children:n.jsx(Ai,{size:12})})]})},use=({user:e,levels:t,classes:r,students:s,onAddScope:i,onRemoveScope:a})=>{var b,A;const[o,l]=p.useState(""),[c,u]=p.useState(""),[d,f]=p.useState(""),[h,m]=p.useState(!1);p.useEffect(()=>{u(""),f("")},[o]),p.useEffect(()=>{f("")},[c]);const g=p.useMemo(()=>o?r.filter(z=>z.level===o):[],[r,o]),x=p.useMemo(()=>c?s.filter(z=>z.classId===c):[],[s,c]),y=async()=>{m(!0);let z=null;d?z={type:"STUDENT",value:d}:c?z={type:"CLASS",value:c}:o&&(z={type:"LEVEL",value:o}),z&&await i(e._id,z)&&(l(""),u(""),f("")),m(!1)},v=async()=>{m(!0),await i(e._id,{type:"ALL"}),m(!1)},S=()=>{if(d){const z=s.find(D=>D._id===d);return z?`Autoriser ${z.firstName} ${z.lastName}`:"Autoriser l'lve"}if(c){const z=r.find(D=>D._id===c);return z?`Autoriser ${z.name}`:"Autoriser la classe"}return o?`Autoriser tout ${o}`:"Slectionnez d'abord..."},k=z=>{var D,w;if(z.type==="ALL")return"Accs Global";if(z.type==="LEVEL")return`Niveau ${z.value}`;if(z.type==="CLASS"){const N=r.find($=>$._id===z.value);return N?N.name:`Classe ${(D=z.value)==null?void 0:D.slice(-6)}`}if(z.type==="STUDENT"){const N=s.find($=>$._id===z.value);return N?`${N.firstName} ${N.lastName}`:`lve ${(w=z.value)==null?void 0:w.slice(-6)}`}return`${z.type}: ${z.value}`},j=(b=e.bypassScopes)==null?void 0:b.some(z=>z.type==="ALL"),_=(e.displayName||e.email||"??").split(" ").map(z=>z[0]).slice(0,2).join("").toUpperCase();return n.jsxs("div",{className:"subadmin-card",children:[n.jsxs("div",{className:"subadmin-card-header",children:[n.jsxs("div",{className:"subadmin-info",children:[n.jsx("div",{className:"subadmin-avatar",children:_}),n.jsxs("div",{className:"subadmin-details",children:[n.jsx("h3",{children:e.displayName||"Sans nom"}),n.jsx("span",{children:e.email})]})]}),n.jsx("button",{className:`global-access-btn ${j?"active":"inactive"}`,onClick:v,disabled:j||h,children:j?n.jsxs(n.Fragment,{children:[n.jsx($a,{size:16}),"Accs Global Actif"]}):n.jsxs(n.Fragment,{children:[n.jsx(vp,{size:16}),"Accorder Accs Global"]})})]}),n.jsxs("div",{className:"subadmin-card-body",children:[n.jsxs("div",{className:"active-permissions",children:[n.jsxs("p",{className:"section-label",children:[n.jsx(bd,{size:14}),"Permissions Actives",n.jsx("span",{className:"count",children:((A=e.bypassScopes)==null?void 0:A.length)||0})]}),!e.bypassScopes||e.bypassScopes.length===0?n.jsx("p",{className:"permissions-empty-state",children:`Aucune permission spciale  ce prfet ne peut signer que les carnets dont l'enseignant a marqu "termin"`}):n.jsx("div",{className:"permissions-list",children:e.bypassScopes.map((z,D)=>n.jsx(dse,{scope:z,label:k(z),onRemove:()=>a(e._id,D)},`${z.type}-${z.value||D}`))})]}),n.jsxs("div",{className:"add-permission-form",children:[n.jsxs("p",{className:"add-permission-form-title",children:[n.jsx(Fs,{size:16}),"Ajouter une exception (bypass)"]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("div",{className:"form-field",children:[n.jsxs("label",{children:[n.jsx("span",{className:"step",children:"1"}),"Niveau"]}),n.jsxs("select",{value:o,onChange:z=>l(z.target.value),disabled:h,children:[n.jsx("option",{value:"",children:"-- Slectionner --"}),t.map(z=>n.jsx("option",{value:z.name,children:z.name},z._id))]})]}),n.jsxs("div",{className:"form-field",children:[n.jsxs("label",{children:[n.jsx("span",{className:"step",children:"2"}),"Classe (optionnel)"]}),n.jsxs("select",{value:c,onChange:z=>u(z.target.value),disabled:!o||h,children:[n.jsx("option",{value:"",children:"-- Tout le niveau --"}),g.map(z=>n.jsx("option",{value:z._id,children:z.name},z._id))]})]}),n.jsxs("div",{className:"form-field",children:[n.jsxs("label",{children:[n.jsx("span",{className:"step",children:"3"}),"lve (optionnel)"]}),n.jsxs("select",{value:d,onChange:z=>f(z.target.value),disabled:!c||h,children:[n.jsx("option",{value:"",children:"-- Toute la classe --"}),x.map(z=>n.jsxs("option",{value:z._id,children:[z.firstName," ",z.lastName]},z._id))]})]}),n.jsx("button",{className:`add-permission-btn ${o?"enabled":"disabled"}`,onClick:y,disabled:!o||h,children:h?n.jsx(io,{size:16,className:"spinner"}):n.jsxs(n.Fragment,{children:[n.jsx(Fs,{size:16}),S()]})})]})]})]})]})};function pse(){const[e,t]=p.useState([]),[r,s]=p.useState(!0),[i,a]=p.useState(null),[o,l]=p.useState([]),[c,u]=p.useState([]),[d,f]=p.useState([]),h=async()=>{try{s(!0);const y=await K.get("/admin-extras/subadmins");t(y.data)}catch(y){console.error(y),a({message:"Erreur lors du chargement des prfets",type:"error"})}finally{s(!1)}},m=async()=>{try{const[y,v]=await Promise.all([K.get("/levels"),K.get("/school-years")]);l(y.data);const S=v.data.find(k=>k.active);if(S){const[k,j]=await Promise.all([K.get(`/classes?schoolYearId=${S._id}`),K.get(`/students?schoolYearId=${S._id}`)]);u(k.data),f(j.data)}}catch(y){console.error(y)}};p.useEffect(()=>{h(),m()},[]);const g=p.useCallback(async(y,v)=>{var _;const S=e.find(b=>b._id===y);if(!S)return!1;if((_=S.bypassScopes)==null?void 0:_.some(b=>b.type===v.type&&b.value===v.value))return a({message:"Cette permission existe dj",type:"error"}),!1;const j=[...S.bypassScopes||[],v];try{return await K.post("/admin-extras/permissions",{userId:y,bypassScopes:j}),t(A=>A.map(z=>z._id===y?{...z,bypassScopes:j}:z)),a({message:`${{ALL:"Accs global",LEVEL:"Niveau",CLASS:"Classe",STUDENT:"lve"}[v.type]} ajout avec succs`,type:"success"}),!0}catch{return a({message:"Erreur lors de la mise  jour",type:"error"}),!1}},[e]),x=p.useCallback(async(y,v)=>{var _;const S=e.find(b=>b._id===y);if(!S)return!1;const k=(_=S.bypassScopes)==null?void 0:_[v],j=[...S.bypassScopes||[]];j.splice(v,1);try{return await K.post("/admin-extras/permissions",{userId:y,bypassScopes:j}),t(A=>A.map(z=>z._id===y?{...z,bypassScopes:j}:z)),a({message:`${{ALL:"Accs global",LEVEL:"Niveau",CLASS:"Classe",STUDENT:"lve"}[(k==null?void 0:k.type)||"ALL"]} supprim`,type:"success"}),!0}catch{return a({message:"Erreur lors de la suppression",type:"error"}),!1}},[e]);return n.jsxs("div",{className:"admin-permissions",children:[n.jsx("header",{className:"permissions-header",children:n.jsxs("div",{className:"permissions-header-content",children:[n.jsxs("h1",{className:"permissions-title",children:[n.jsx(bd,{size:28}),"Permissions de Signature"]}),n.jsx("p",{className:"permissions-subtitle",children:"Configurez les exceptions aux rgles de signature pour les prfets. Ces permissions permettent de signer des carnets mme si l'enseignant n'a pas encore marqu son travail comme termin."})]})}),n.jsxs("div",{className:"permissions-info-banner",children:[n.jsx("div",{className:"permissions-info-banner-icon",children:n.jsx(MD,{size:20})}),n.jsxs("div",{className:"permissions-info-banner-content",children:[n.jsx("h3",{children:"Comment a fonctionne ?"}),n.jsxs("p",{children:["Par dfaut, un prfet ne peut signer un carnet que si ",n.jsx("strong",{children:"tous les enseignants concerns"}),' ont marqu leur partie comme "termine". Ces permissions crent des ',n.jsx("strong",{children:"exceptions (bypass)"}),"  cette rgle."]}),n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Accs Global :"})," Peut signer n'importe quel carnet sans restriction"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Par Niveau :"})," Peut signer les carnets du niveau spcifi (ex: tous les GS)"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Par Classe :"})," Peut signer les carnets d'une classe spcifique"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Par lve :"})," Peut signer le carnet d'un lve spcifique"]})]})]})]}),r?n.jsxs("div",{className:"permissions-loading",children:[n.jsx("div",{className:"permissions-spinner"}),n.jsx("span",{children:"Chargement des prfets..."})]}):e.length===0?n.jsxs("div",{className:"permissions-empty",children:[n.jsx("div",{className:"permissions-empty-icon",children:n.jsx(Ts,{size:32})}),n.jsx("h3",{children:"Aucun prfet trouv"}),n.jsx("p",{children:"Il n'y a pas encore de sous-administrateurs (prfets) dans le systme. Ajoutez-en depuis la page Utilisateurs."})]}):n.jsx("div",{className:"permissions-grid",children:e.map(y=>n.jsx(use,{user:y,levels:o,classes:c,students:d,onAddScope:g,onRemoveScope:x},y._id))}),i&&n.jsx(cse,{message:i.message,type:i.type,onClose:()=>a(null)})]})}function fse(){const[e,t]=p.useState([]),[r,s]=p.useState(""),[i,a]=p.useState(""),[o,l]=p.useState(!0),c=async()=>{try{const h=await K.get("/admin-extras/online-users");t(h.data)}catch(h){console.error(h)}finally{l(!1)}};p.useEffect(()=>{c();const h=setInterval(c,3e4);return()=>clearInterval(h)},[]);const u=async()=>{if(r.trim()&&confirm("Envoyer cette alerte  TOUS les utilisateurs connects ?"))try{await K.post("/admin-extras/alert",{message:r,duration:i?parseInt(i):void 0}),s(""),a(""),alert("Alerte envoye")}catch{alert("Erreur")}},d=async()=>{if(confirm("Arrter l'alerte en cours ?"))try{await K.post("/admin-extras/alert/stop"),alert("Alerte arrte")}catch{alert("Erreur")}},f=async()=>{if(confirm("tes-vous sr de vouloir dconnecter TOUS les utilisateurs (sauf admins) ?"))try{await K.post("/admin-extras/logout-all"),alert("Tous les utilisateurs ont t dconnects."),c()}catch{alert("Erreur")}};return n.jsxs("div",{className:"container",children:[n.jsx("h2",{className:"title",children:"Utilisateurs en Ligne & Alertes"}),n.jsxs("div",{className:"grid2",style:{gap:24},children:[n.jsxs("div",{className:"card",style:{gridRow:"span 2"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0},children:"Utilisateurs Actifs"}),n.jsx("p",{className:"note",style:{margin:0},children:"Dernires 5 minutes"})]}),n.jsx("button",{className:"btn secondary",onClick:c,style:{padding:"4px 12px",fontSize:14},children:"Actualiser"})]}),o?n.jsx("p",{children:"Chargement..."}):n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.map(h=>n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,background:"#f8fafc",borderRadius:8,borderLeft:"4px solid #22c55e"},children:[n.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600,color:"#475569"},children:h.displayName.charAt(0).toUpperCase()}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:h.displayName}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:h.email})]}),n.jsxs("div",{style:{textAlign:"right"},children:[n.jsx("div",{style:{fontSize:11,fontWeight:600,padding:"2px 6px",borderRadius:4,background:h.role==="ADMIN"?"#fef3c7":"#e0f2fe",color:h.role==="ADMIN"?"#d97706":"#0284c7",display:"inline-block",marginBottom:4},children:h.role}),n.jsxs("div",{style:{fontSize:12,color:"#22c55e",display:"flex",alignItems:"center",gap:4,justifyContent:"flex-end"},children:[n.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"#22c55e"}}),new Date(h.lastActive).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},h._id)),e.length===0&&n.jsx("div",{style:{textAlign:"center",padding:32,color:"#94a3b8"},children:"Aucun utilisateur actif rcemment."})]})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[n.jsxs("div",{className:"card",children:[n.jsx("h3",{children:"Envoyer une Alerte"}),n.jsx("p",{className:"note",children:"Affiche un message bloquant sur l'cran de tous les utilisateurs."}),n.jsx("textarea",{value:r,onChange:h=>s(h.target.value),placeholder:"Message d'alerte (ex: Maintenance dans 10 min...)",style:{width:"100%",height:100,padding:8,borderRadius:4,border:"1px solid #ccc",marginBottom:12}}),n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("label",{style:{fontSize:14,display:"block",marginBottom:4},children:"Dure (minutes, optionnel)"}),n.jsx("input",{type:"number",value:i,onChange:h=>a(h.target.value),placeholder:"Ex: 10",style:{padding:8,borderRadius:4,border:"1px solid #ccc",width:"100%"}})]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{className:"btn",onClick:u,disabled:!r,children:"Envoyer Alerte"}),n.jsx("button",{className:"btn secondary",onClick:d,style:{borderColor:"#dc2626",color:"#dc2626"},children:"Arrter Alerte"})]})]}),n.jsxs("div",{className:"card",style:{border:"1px solid #fecaca",background:"#fff5f5"},children:[n.jsx("h3",{style:{color:"#dc2626"},children:"Zone de Danger"}),n.jsx("p",{className:"note",children:"Dconnecter tous les utilisateurs non-admins immdiatement."}),n.jsx("button",{className:"btn",style:{background:"#dc2626",color:"white"},onClick:f,children:"Dconnecter Tout le Monde"})]})]})]})]})}function hse(){const[e,t]=p.useState([]),[r,s]=p.useState(!0),[i,a]=p.useState(""),[o,l]=p.useState("all"),[c,u]=p.useState(""),[d,f]=p.useState(""),[h,m]=p.useState("name"),[g,x]=p.useState({});p.useEffect(()=>{(async()=>{try{s(!0);const b=await K.get("/admin-extras/all-gradebooks");t(b.data)}catch(b){a("Impossible de charger les donnes"),console.error(b)}finally{s(!1)}})()},[]);const y=p.useMemo(()=>{const _=e.length,b=e.filter(z=>!!z.signature).length,A=_-b;return{total:_,signed:b,unsigned:A}},[e]),v=p.useMemo(()=>{const _=new Set;return e.forEach(b=>{b.level&&_.add(b.level)}),Array.from(_).sort()},[e]),k=p.useMemo(()=>{let _=e;if(o==="signed"&&(_=_.filter(b=>!!b.signature)),o==="unsigned"&&(_=_.filter(b=>!b.signature)),d&&(_=_.filter(b=>(b.level||"")===d)),c.trim()){const b=c.trim().toLowerCase();_=_.filter(A=>{var N,$,E;const z=`${((N=A.student)==null?void 0:N.firstName)||""} ${(($=A.student)==null?void 0:$.lastName)||""}`.toLowerCase(),D=(A.className||"").toLowerCase(),w=(((E=A.template)==null?void 0:E.name)||"").toLowerCase();return z.includes(b)||D.includes(b)||w.includes(b)})}return h==="name"?_=[..._].sort((b,A)=>{var w,N,$,E;const z=`${((w=b.student)==null?void 0:w.firstName)||""} ${((N=b.student)==null?void 0:N.lastName)||""}`.toLowerCase(),D=`${(($=A.student)==null?void 0:$.firstName)||""} ${((E=A.student)==null?void 0:E.lastName)||""}`.toLowerCase();return z.localeCompare(D)}):h==="signed_first"?_=[..._].sort((b,A)=>+!!A.signature-+!!b.signature):h==="unsigned_first"?_=[..._].sort((b,A)=>+!!b.signature-+!!A.signature):h==="date_desc"&&(_=[..._].sort((b,A)=>{const z=b.signature?new Date(b.signature.signedAt).getTime():0;return(A.signature?new Date(A.signature.signedAt).getTime():0)-z})),_},[e,o,d,c,h]).reduce((_,b)=>{const A=b.level||"Sans niveau",z=b.className||"Sans classe";return _[A]||(_[A]={}),_[A][z]||(_[A][z]=[]),_[A][z].push(b),_},{}),j=Object.keys(k).sort();return n.jsxs("div",{className:"all-gradebooks-container",children:[n.jsxs("div",{className:"header-bar",children:[n.jsxs("div",{className:"title-wrap",children:[n.jsx("h1",{className:"page-title",children:"Tous les carnets"}),n.jsx("div",{className:"subtitle",children:"Vue globale par niveau et classe"})]}),n.jsxs("div",{className:"stats-bar",children:[n.jsxs("div",{className:"stat-pill",children:[n.jsx("span",{className:"stat-label",children:"Total"}),n.jsx("span",{className:"stat-value",children:y.total})]}),n.jsxs("div",{className:"stat-pill success",children:[n.jsx("span",{className:"stat-label",children:"Signs"}),n.jsx("span",{className:"stat-value",children:y.signed})]}),n.jsxs("div",{className:"stat-pill warning",children:[n.jsx("span",{className:"stat-label",children:"Non signs"}),n.jsx("span",{className:"stat-value",children:y.unsigned})]})]})]}),n.jsxs("div",{className:"filters-toolbar",children:[n.jsxs("div",{className:"segmented",children:[n.jsx("button",{className:`segment ${o==="all"?"active":""}`,onClick:()=>l("all"),children:"Tous"}),n.jsx("button",{className:`segment ${o==="signed"?"active":""}`,onClick:()=>l("signed"),children:"Signs"}),n.jsx("button",{className:`segment ${o==="unsigned"?"active":""}`,onClick:()=>l("unsigned"),children:"Non signs"})]}),n.jsxs("div",{className:"filters-inline",children:[n.jsx("input",{className:"search-input",placeholder:"Rechercher lve, classe, modle",value:c,onChange:_=>u(_.target.value)}),n.jsxs("select",{className:"select",value:d,onChange:_=>f(_.target.value),children:[n.jsx("option",{value:"",children:"Tous les niveaux"}),v.map(_=>n.jsx("option",{value:_,children:_},_))]}),n.jsxs("select",{className:"select",value:h,onChange:_=>m(_.target.value),children:[n.jsx("option",{value:"name",children:"AZ"}),n.jsx("option",{value:"signed_first",children:"Signs d'abord"}),n.jsx("option",{value:"unsigned_first",children:"Non signs d'abord"}),n.jsx("option",{value:"date_desc",children:"Par date signature"})]})]})]}),r&&n.jsxs("div",{className:"loading-card",children:[n.jsx("div",{className:"skeleton-row"}),n.jsx("div",{className:"skeleton-row"}),n.jsxs("div",{className:"skeleton-grid",children:[n.jsx("div",{className:"skeleton-card"}),n.jsx("div",{className:"skeleton-card"}),n.jsx("div",{className:"skeleton-card"}),n.jsx("div",{className:"skeleton-card"})]})]}),i&&n.jsx("div",{className:"error-banner",children:i}),!r&&j.length===0&&n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("div",{children:"Aucun carnet trouv pour ces critres."})]}),!r&&j.map(_=>{const b=g[_]??!0,A=()=>x(D=>({...D,[_]:!(D[_]??!0)})),z=Object.keys(k[_]).sort();return n.jsxs("div",{className:"level-section",children:[n.jsxs("div",{className:"level-header",onClick:A,children:[n.jsxs("div",{className:"level-title",children:[n.jsx("span",{className:"level-badge",children:_}),n.jsxs("span",{className:"level-count",children:[z.length," classes"]})]}),n.jsx("button",{className:`collapse-btn ${b?"open":""}`,children:b?"Replier":"Dplier"})]}),b&&n.jsx("div",{className:"level-body",children:z.map(D=>n.jsxs("div",{className:"class-block",children:[n.jsxs("div",{className:"class-header",children:[n.jsx("h3",{className:"class-title",children:D}),n.jsxs("div",{className:"class-count",children:[k[_][D].length," carnets"]})]}),n.jsx("div",{className:"cards-grid",children:k[_][D].map(w=>{var q,L,O;const N=!!w.signature,$=N?new Date(w.signature.signedAt).toLocaleDateString():"",E=(()=>{var re,ae;const B=localStorage.getItem("token"),I=(K.defaults.baseURL||"").replace(/\/$/,""),T=(re=w.template)==null?void 0:re._id,W=(ae=w.student)==null?void 0:ae._id;return!T||!W?"":`${I}/pdf-v2/student/${W}?templateId=${T}&token=${B}`})();return n.jsxs("div",{className:`gradebook-card ${N?"signed":"unsigned"}`,children:[n.jsxs("div",{className:"card-main",children:[n.jsxs("div",{className:"card-title",children:[(q=w.student)==null?void 0:q.firstName," ",(L=w.student)==null?void 0:L.lastName]}),n.jsx("div",{className:"card-subtitle",children:(O=w.template)==null?void 0:O.name})]}),n.jsxs("div",{className:"card-meta",children:[N?n.jsxs("span",{className:"badge success",children:["Sign le ",$]}):n.jsx("span",{className:"badge warning",children:"Non sign"}),n.jsx("span",{className:"status-pill",children:w.status})]}),n.jsxs("div",{className:"card-actions",children:[n.jsx(rr,{to:`/admin/gradebooks/${w._id}/review`,className:"action-btn primary",children:"Voir"}),n.jsx("a",{className:`action-btn ${E?"secondary":"disabled"}`,href:E||void 0,target:"_blank",children:"PDF"})]})]},w._id)})})]},D))})]},_)})]})}const gse=800,mse=1120,xse=({template:e,student:t,assignment:r,signature:s,finalSignature:i,visiblePages:a,activeSchoolYearName:o,blockVisibilitySettings:l,viewType:c="pdf"})=>{const{levels:u}=la(),{activeYear:d}=Yn(),f=A=>{if(!A)return"";if(u&&u.length>0){const D=u.find(w=>w.name===A);if(D){const w=u.find(N=>N.order===D.order+1);if(w)return w.name}}const z=(A||"").toUpperCase();return z==="TPS"?"PS":z==="PS"?"MS":z==="MS"?"GS":z==="GS"?"EB1":z==="KG1"?"KG2":z==="KG2"?"KG3":z==="KG3"?"EB1":""},h=A=>{if(A.props.level)return A.props.level;const z=(A.props.label||"").toUpperCase();return/\bPS\b/.test(z)?"PS":/\bMS\b/.test(z)?"MS":/\bGS\b/.test(z)?"GS":/\bEB1\b/.test(z)?"EB1":/\bKG1\b/.test(z)?"KG1":/\bKG2\b/.test(z)?"KG2":/\bKG3\b/.test(z)?"KG3":null},m=(A,z)=>{const D=Array.isArray(A)?A:[],w=Array.isArray(z)?z:null;if(!D.length)return w||[];if(!w||!w.length)return D;const N=D.map(q=>typeof(q==null?void 0:q.code)=="string"&&q.code.trim()?q.code.trim():"").filter(Boolean),$=N.map(q=>q.toLowerCase());if(N.length===D.length&&new Set($).size===$.length){const q=new Map;return w.forEach(L=>{typeof(L==null?void 0:L.code)=="string"&&L.code.trim()&&q.set(L.code.trim().toLowerCase(),L)}),D.map(L=>{const O=typeof(L==null?void 0:L.code)=="string"?L.code.trim().toLowerCase():"",B=O?q.get(O):void 0,I=typeof(B==null?void 0:B.active)=="boolean"?B.active:L.active;return{...L,active:I}})}return D.map((q,L)=>{const O=w[L],B=typeof(O==null?void 0:O.active)=="boolean"?O.active:q.active;return{...q,active:B}})},g=A=>{if(!A)return"";const z=A.match(/(\d{4})\s*([/\-])\s*(\d{4})/);if(!z)return"";const D=parseInt(z[1],10),w=z[2],N=parseInt(z[3],10);return Number.isNaN(D)||Number.isNaN(N)?"":`${D+1}${w}${N+1}`},x=A=>A&&(A.signatureData||A.signatureUrl)||null,y=(A,z)=>{var q;const D=String((A==null?void 0:A.year)||"");if(D){const L=g(D);if(L)return L}if(o){const L=g(o);if(L)return L}if(!D)return"";const w=((q=r==null?void 0:r.data)==null?void 0:q.signatures)||[],N=String((A==null?void 0:A.from)||z||""),$=Array.isArray(w)?w.filter(L=>(L==null?void 0:L.type)==="end_of_year"&&(L==null?void 0:L.schoolYearName)).find(L=>N?L!=null&&L.level?String(L.level)===N:!1:!0):null;return $!=null&&$.schoolYearName?String($.schoolYearName):g(D)||D},v=(A,z,D)=>{var L;const w=((L=r==null?void 0:r.data)==null?void 0:L.signatures)||[],N=D==="end-year",$=D==="mid-year",q=w.filter(O=>{if(N){if(O.type!=="end_of_year")return!1}else if($&&O.type&&O.type!=="standard")return!1;return!(O.level&&z&&O.level!==z)}).sort((O,B)=>{const I=new Date(O.signedAt||0).getTime();return new Date(B.signedAt||0).getTime()-I})[0];if(q){let O=String(q.schoolYearName||"").trim();if(!O&&q.signedAt){const B=new Date(q.signedAt),I=B.getFullYear(),W=B.getMonth()>=8?I:I-1;O=`${W}/${W+1}`}if(O)return O}return String((A==null?void 0:A.year)||"")},S=(A,z,D,w)=>w?`block:${w}`:`tpl:${A||""}:p:${z}:b:${D}`,k={TPS:0,PS:1,MS:2,GS:3,EB1:4,KG1:1,KG2:2,KG3:3},j=A=>{if(!A)return!1;const z=((t==null?void 0:t.level)||"").toUpperCase(),D=A.toUpperCase(),w=k[z]??99;return(k[D]??99)>w},_=A=>{var E,q,L;if(!A)return{hasSem1:!!s,hasSem2:!!i};const z=A.toUpperCase(),D=((E=r==null?void 0:r.data)==null?void 0:E.signatures)||[],w=((q=r==null?void 0:r.data)==null?void 0:q.promotions)||[];let N=!1,$=!1;return((L=t==null?void 0:t.level)==null?void 0:L.toUpperCase())===z&&(N=!!s,$=!!i),D.forEach(O=>{var B,I;if(O.schoolYearName){const T=w.find(W=>W.year===O.schoolYearName);T&&((B=T.from)==null?void 0:B.toUpperCase())===z&&((O.type==="standard"||!O.type)&&(N=!0),O.type==="end_of_year"&&($=!0))}((I=O.level)==null?void 0:I.toUpperCase())===z&&((O.type==="standard"||!O.type)&&(N=!0),O.type==="end_of_year"&&($=!0))}),{hasSem1:N,hasSem2:$}},b=(A,z,D)=>{var E,q,L,O,B;const w=h(A);if(j(w))return!1;const N=typeof((E=A==null?void 0:A.props)==null?void 0:E.blockId)=="string"&&A.props.blockId.trim()?A.props.blockId.trim():null,$=S(e==null?void 0:e._id,z,D,N);if(w){const I=(L=(q=l==null?void 0:l[w.toUpperCase()])==null?void 0:q[c])==null?void 0:L[$],{hasSem1:T,hasSem2:W}=_(w);return!(I&&(I==="never"||I==="after_sem1"&&!T&&!W||I==="after_sem2"&&!W))}else{const I=((t==null?void 0:t.level)||"PS").toUpperCase(),T=k[I]??99,W=Object.keys(k).filter(Y=>k[Y]<=T);let re=!1,ae=!1;for(const Y of W){const J=(B=(O=l==null?void 0:l[Y])==null?void 0:O[c])==null?void 0:B[$];if(J){re=!0;const{hasSem1:P,hasSem2:ce}=_(Y);if(J==="always"){ae=!0;break}else if(J==="after_sem1"&&(P||ce)){ae=!0;break}else if(J==="after_sem2"&&ce){ae=!0;break}}}return!re||ae}};return n.jsxs("div",{style:{margin:0,padding:0},children:[n.jsx("style",{children:`
                @page {
                    size: A4;
                    margin: 0;
                }
                @media print {
                    body {
                        margin: 0;
                        padding: 0;
                    }
                    .page-canvas {
                        page-break-after: always;
                        page-break-inside: avoid;
                    }
                }
            `}),e.pages.map((A,z)=>({page:A,originalPageIdx:z})).filter(({page:A,originalPageIdx:z})=>!A.excludeFromPdf&&(!a||a.includes(z))).map(({page:A,originalPageIdx:z},D)=>n.jsx("div",{className:"page-canvas",style:{height:mse,width:gse,background:A.bgColor||"#fff",overflow:"hidden",position:"relative",pageBreakAfter:"always",pageBreakInside:"avoid",margin:"0 auto",marginBottom:20,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:A.blocks.map((w,N)=>!w||!w.props?null:n.jsxs("div",{style:{position:"absolute",left:w.props.x||0,top:w.props.y||0,zIndex:w.props.z??N},children:[w.type==="text"&&n.jsx("div",{style:{color:w.props.color,fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:Array.isArray(w.props.runs)&&w.props.runs.length?w.props.runs.map(($,E)=>n.jsx("span",{style:{color:$&&typeof $=="object"&&typeof $.color=="string"&&$.color?$.color:w.props.color||void 0,fontWeight:$&&typeof $=="object"&&typeof $.bold=="boolean"?$.bold?700:400:void 0,textDecoration:$&&typeof $=="object"&&typeof $.underline=="boolean"?$.underline?"underline":"none":void 0},children:($==null?void 0:$.text)||""},E)):w.props.text}),w.type==="dynamic_text"&&n.jsx("div",{style:{color:w.props.color,fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden",whiteSpace:"pre-wrap"},children:(()=>{let $=w.props.text||"";if(t){const E=String((t==null?void 0:t.fatherName)||(t==null?void 0:t.parentName)||"").trim(),q=E?E.charAt(0).toUpperCase():"",L=q?`${q}.`:"",O=[t.firstName,L,t.lastName].filter(Boolean).join(" "),B=t.dateOfBirth?new Date(t.dateOfBirth):new Date(NaN),I=isNaN(B.getTime())?"":`${String(B.getUTCDate()).padStart(2,"0")}/${String(B.getUTCMonth()+1).padStart(2,"0")}/${String(B.getUTCFullYear())}`;$=$.replace(/{student.firstName}/g,t.firstName).replace(/{student.lastName}/g,t.lastName).replace(/{student.dob}/g,t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString():"").replace(/{student.fatherInitial}/g,L).replace(/{student.fullNameFatherInitial}/g,O).replace(/{student.dob_ddmmyyyy}/g,I)}return r!=null&&r.data&&Object.entries(r.data).forEach(([E,q])=>{$=$.replace(new RegExp(`{${E}}`,"g"),String(q))}),$})()}),w.type==="language_toggle_v2"&&n.jsx("div",{style:{display:"flex",flexDirection:w.props.direction||"row",alignItems:"center",justifyContent:"center",gap:w.props.spacing||12,background:w.props.backgroundColor||"transparent",borderRadius:w.props.borderRadius||12,padding:w.props.padding||8,width:w.props.width,height:w.props.height,boxSizing:"border-box",...b(w,z,N)?{}:{display:"none"}},children:(()=>{var T,W,re,ae;const $=`language_toggle_${z}_${N}`,E=`language_toggle_${D}_${N}`,q=typeof((T=w==null?void 0:w.props)==null?void 0:T.blockId)=="string"&&w.props.blockId.trim()?w.props.blockId.trim():null,L=q?`language_toggle_${q}`:null,O=(L?(W=r==null?void 0:r.data)==null?void 0:W[L]:null)||((re=r==null?void 0:r.data)==null?void 0:re[$])||((ae=r==null?void 0:r.data)==null?void 0:ae[E]),B=Array.isArray(w.props.items)?w.props.items:[];return m(B,O).map((Y,J)=>{const P=!(Y.levels&&Y.levels.length>0&&(t!=null&&t.level)&&!Y.levels.includes(t.level)),ce=40,se=`https://emojicdn.elk.sh/${(je=>{const ve=je.emoji;if(ve&&ve.length>=2)return ve;const le=(je.code||"").toLowerCase();return le==="lb"||le==="ar"?"":le==="fr"?"":le==="en"||le==="uk"||le==="gb"?"":""})(Y)}?style=apple`;return n.jsx("div",{title:Y.label,style:{width:ce,height:ce,minWidth:ce,borderRadius:"50%",background:Y.active?"#fff":"rgba(255, 255, 255, 0.5)",border:Y.active?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Y.active?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",transform:Y.active?"scale(1.1)":"scale(1)",opacity:P?Y.active?1:.6:Y.active?.9:.5,filter:"none"},children:n.jsx("img",{src:se,style:{width:ce*.9,height:ce*.9,objectFit:"contain"},alt:""})},J)})})()}),w.type==="image"&&n.jsx(Fo,{src:w.props.url,displayWidth:w.props.width||120,displayHeight:w.props.height||120,cropData:w.props.cropData,borderRadius:8}),w.type==="student_photo"&&(t!=null&&t.avatarUrl?n.jsx("img",{src:t.avatarUrl,style:{width:w.props.width||100,height:w.props.height||100,objectFit:"cover",borderRadius:8},alt:"Student"}):n.jsx("div",{style:{width:w.props.width||100,height:w.props.height||100,borderRadius:8,background:"#f0f0f0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:n.jsx("div",{style:{fontSize:24},children:""})})),w.type==="rect"&&n.jsx("div",{style:{width:w.props.width,height:w.props.height,background:w.props.color,borderRadius:w.props.radius||8,border:w.props.stroke?`${w.props.strokeWidth||1}px solid ${w.props.stroke}`:"none"}}),w.type==="circle"&&n.jsx("div",{style:{width:(w.props.radius||60)*2,height:(w.props.radius||60)*2,background:w.props.color,borderRadius:"50%",border:w.props.stroke?`${w.props.strokeWidth||1}px solid ${w.props.stroke}`:"none"}}),w.type==="gradebook_pocket"&&n.jsx(nc,{number:w.props.number||"1",width:w.props.width||120,fontSize:w.props.fontSize}),w.type==="line"&&n.jsx("div",{style:{width:w.props.x2||100,height:w.props.strokeWidth||2,background:w.props.stroke||"#b2bec3"}}),w.type==="arrow"&&n.jsx("div",{style:{width:w.props.x2||100,height:w.props.strokeWidth||2,background:w.props.stroke||"#6c5ce7",position:"relative"},children:n.jsx("div",{style:{position:"absolute",right:0,top:-6,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`12px solid ${w.props.stroke||"#6c5ce7"}`}})}),w.type==="language_toggle"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:w.props.spacing||12},children:(()=>{var T,W,re,ae;const $=`language_toggle_${z}_${N}`,E=`language_toggle_${D}_${N}`,q=typeof((T=w==null?void 0:w.props)==null?void 0:T.blockId)=="string"&&w.props.blockId.trim()?w.props.blockId.trim():null,L=q?`language_toggle_${q}`:null,O=(L?(W=r==null?void 0:r.data)==null?void 0:W[L]:null)||((re=r==null?void 0:r.data)==null?void 0:re[$])||((ae=r==null?void 0:r.data)==null?void 0:ae[E]),B=Array.isArray(w.props.items)?w.props.items:[];return m(B,O).map((Y,J)=>{const P=!(Y.levels&&Y.levels.length>0&&(t!=null&&t.level)&&!Y.levels.includes(t.level)),pe=(w.props.radius||40)*2;return n.jsx("div",{style:{width:pe,height:pe,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:Y.active?"0 0 0 3px #6c5ce7":"0 0 0 1px #ddd",opacity:P||Y.active?.9:.5},children:Y.logo?n.jsx("img",{src:Y.logo,style:{width:"100%",height:"100%",objectFit:"cover",filter:Y.active?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},J)})})()}),w.type==="dropdown"&&n.jsxs("div",{style:{width:w.props.width||200,...b(w,z,N)?{}:{display:"none"}},children:[n.jsx("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:w.props.dropdownNumber&&`Dropdown #${w.props.dropdownNumber}`}),w.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:w.props.label}),n.jsx("div",{style:{width:"100%",minHeight:w.props.height||32,fontSize:w.props.fontSize||12,color:w.props.color||"#333",padding:"4px 8px",borderRadius:4,border:"1px solid #ccc",background:"#fff",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(()=>{var O,B,I;const $=typeof((O=w==null?void 0:w.props)==null?void 0:O.blockId)=="string"&&w.props.blockId.trim()?w.props.blockId.trim():null,E=$?`dropdown_${$}`:null,q=w.props.dropdownNumber?`dropdown_${w.props.dropdownNumber}`:w.props.variableName||null;return((E?(B=r==null?void 0:r.data)==null?void 0:B[E]:void 0)??(q?(I=r==null?void 0:r.data)==null?void 0:I[q]:void 0)??"")||"Slectionner..."})()})]}),w.type==="dropdown_reference"&&(()=>{var I,T,W;const $=w.props.dropdownNumber||1,E=typeof((I=w==null?void 0:w.props)==null?void 0:I.blockId)=="string"&&w.props.blockId.trim()?w.props.blockId.trim():null,q=E?`dropdown_${E}`:null,L=`dropdown_${$}`,O=(q?(T=r==null?void 0:r.data)==null?void 0:T[q]:void 0)??(L?(W=r==null?void 0:r.data)==null?void 0:W[L]:void 0),B=typeof O=="string"?O.trim():O;return B?n.jsx("div",{style:{color:w.props.color||"#333",fontSize:w.props.fontSize||12,width:w.props.width||200,minHeight:w.props.height||"auto",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:String(B)}):null})(),w.type==="promotion_info"&&n.jsx("div",{style:{width:w.props.width||(w.props.field?150:300),height:w.props.height||(w.props.field?30:100),border:w.props.field?"none":"1px solid #6c5ce7",padding:w.props.field?0:10,borderRadius:8,fontSize:w.props.fontSize||12,color:w.props.color||"#2d3436",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:(()=>{var O,B;const $=((O=r==null?void 0:r.data)==null?void 0:O.promotions)||[],E=h(w),q=w.props.targetLevel;if(w.props.field==="student")return n.jsxs("div",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]});if(w.props.field==="studentFirstName")return n.jsx("div",{children:t==null?void 0:t.firstName});if(w.props.field==="studentLastName")return n.jsx("div",{children:t==null?void 0:t.lastName});if(w.props.field==="currentLevel")return n.jsx("div",{children:t==null?void 0:t.level});let L=null;if(q&&(L=$.find(I=>I.to===q)),!L&&E&&(L=$.find(I=>I.from===E)),!L&&!q&&!E&&$.length===1&&(L={...$[0]}),!L&&E){const I=((B=r==null?void 0:r.data)==null?void 0:B.signatures)||[],T=w.props.period==="mid-year",W=w.props.period==="end-year",ae=I.filter(Y=>{if(W){if(Y.type!=="end_of_year")return!1}else if(T&&Y.type&&Y.type!=="standard")return!1;return!(Y.level&&Y.level!==E)}).sort((Y,J)=>{const P=new Date(Y.signedAt||0).getTime();return new Date(J.signedAt||0).getTime()-P})[0];if(ae){let Y=ae.schoolYearName;if(!Y&&ae.signedAt){const ce=new Date(ae.signedAt),pe=ce.getFullYear(),se=ce.getMonth()>=8?pe:pe-1;Y=`${se}/${se+1}`}if(!Y){const pe=new Date().getFullYear();Y=`${pe}/${pe+1}`}const J=E,P=q||f(J||"")||"";L={year:Y,from:J,to:P||"?",class:(t==null?void 0:t.className)||""}}}if(!L){const T=w.props.period==="end-year"&&i||s,W=String((T==null?void 0:T.level)||"").trim(),re=!E||!W||W===E;if(T&&T.signedAt&&re){let ae=String(T.schoolYearName||"").trim();if(!ae){const P=new Date(T.signedAt),ce=P.getFullYear(),ye=P.getMonth()>=8?ce:ce-1;ae=`${ye}/${ye+1}`}const Y=E||W||(t==null?void 0:t.level)||"",J=q||f(Y||"")||"";L={year:ae,from:Y,to:J||"?",class:(t==null?void 0:t.className)||""}}}if(L)!L.class&&(t!=null&&t.className)&&(L.class=t.className),L.from||(E?L.from=E:t!=null&&t.level&&(L.from=t.level));else{const I=!!E&&!!(t!=null&&t.level)&&E===t.level;if(!(w.props.period==="mid-year"?!!s&&(I||!E&&$.length===0):!!i&&(I||!E&&$.length===0)))return null;let Y=0;const J=o||(d?d.name:null);if(J){const ye=J.match(/(\d{4})/);ye&&(Y=parseInt(ye[1],10))}if(!Y)return null;const P=E||(t==null?void 0:t.level)||"",ce=q||f(P||"")||"";L={year:`${Y}/${Y+1}`,from:P,to:ce||"?",class:(t==null?void 0:t.className)||""}}if(L)if(w.props.field){if(w.props.field==="level")return n.jsx("div",{style:{fontWeight:"bold"},children:L.to});if(w.props.field==="student")return n.jsxs("div",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]});if(w.props.field==="studentFirstName")return n.jsx("div",{children:t==null?void 0:t.firstName});if(w.props.field==="studentLastName")return n.jsx("div",{children:t==null?void 0:t.lastName});if(w.props.field==="year")return n.jsx("div",{children:y(L,E)});if(w.props.field==="currentYear"){const I=v(L,E,w.props.period)||o||(d?d.name:null)||L.year||"";return n.jsx("div",{children:String(I)})}else if(w.props.field==="class"){const I=L.class||"",T=I.split(/\s*[-\s]\s*/),W=T.length?T[T.length-1]:I;return n.jsx("div",{children:W})}else if(w.props.field==="currentLevel")return n.jsx("div",{children:L.from||""})}else return n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:8},children:["Passage en ",L.to]}),n.jsxs("div",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),n.jsxs("div",{style:{fontSize:(w.props.fontSize||12)*.8,color:"#666",marginTop:8},children:["Next Year ",y(L,E)]})]});return null})()}),w.type==="teacher_text"&&n.jsxs("div",{style:{width:w.props.width||300,height:w.props.height||60,border:"1px solid #ddd",borderRadius:4,padding:8,fontSize:w.props.fontSize||12,color:w.props.color||"#2d3436",background:"#fff",position:"relative",whiteSpace:"pre-wrap"},children:[(()=>{var q;if(w.props.level&&(t!=null&&t.level)&&w.props.level!==t.level)return null;const $=w.id||`teacher_text_${z}_${N}`,E=((q=r==null?void 0:r.data)==null?void 0:q[$])||"";return n.jsx("div",{style:{width:"100%",height:"100%",color:E?"inherit":"#999"},children:E||w.props.placeholder||"Texte ditable par le prof polyvalent..."})})(),w.props.label&&n.jsx("div",{style:{position:"absolute",top:-10,left:8,background:"#fff",padding:"2px 6px",fontSize:10,color:"#e17055",fontWeight:"bold"},children:w.props.label})]}),w.type==="table"&&(()=>{const $=w.props.expandedRows||!1,E=w.props.expandedRowHeight||34,q=w.props.expandedDividerWidth||.5,L=w.props.expandedDividerColor||"rgba(255, 255, 255, 0.2)",O=w.props.rowGap||0,B=[{code:"lb",label:"Lebanese",emoji:"",active:!1},{code:"fr",label:"French",emoji:"",active:!1},{code:"en",label:"English",emoji:"",active:!1}],I=w.props.expandedLanguages||B;return n.jsx("div",{style:{display:"inline-block",border:O>0&&!$?"none":"1px solid #ddd",background:O>0?"transparent":"#fff"},children:(w.props.cells||[]).map((T,W)=>{var Y;const re=((Y=T[0])==null?void 0:Y.fill)||w.props.backgroundColor||"#f8f9fa",ae=W===(w.props.cells||[]).length-1;return n.jsxs("div",{style:{marginBottom:$&&!ae?O:0},children:[n.jsx("div",{style:{display:"flex"},children:T.map((J,P)=>{var ce,pe,ye,se,je,ve,le,oe,de,Pe;return n.jsx("div",{style:{width:((ce=w.props.columnWidths)==null?void 0:ce[P])||100,height:((pe=w.props.rowHeights)==null?void 0:pe[W])||40,borderLeft:(se=(ye=J.borders)==null?void 0:ye.l)!=null&&se.width?`${J.borders.l.width}px solid ${J.borders.l.color||"#000"}`:"none",borderRight:(ve=(je=J.borders)==null?void 0:je.r)!=null&&ve.width?`${J.borders.r.width}px solid ${J.borders.r.color||"#000"}`:"none",borderTop:(oe=(le=J.borders)==null?void 0:le.t)!=null&&oe.width?`${J.borders.t.width}px solid ${J.borders.t.color||"#000"}`:"none",borderBottom:(Pe=(de=J.borders)==null?void 0:de.b)!=null&&Pe.width?`${J.borders.b.width}px solid ${J.borders.b.color||"#000"}`:"none",background:J.fill||"transparent",padding:15,fontSize:J.fontSize||w.props.fontSize||10,color:J.color||"#333",display:"flex",alignItems:"center",overflow:"hidden"},children:J.text},P)})}),$&&n.jsxs("div",{style:{background:re,borderBottom:"none",position:"relative",height:E},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:q,background:L,margin:"0 15px"}}),n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",paddingLeft:15,gap:15},children:(()=>{var Z,ne,ee,te,G,H,ie;const J=typeof((Z=w==null?void 0:w.props)==null?void 0:Z.blockId)=="string"&&w.props.blockId.trim()?w.props.blockId.trim():null,P=Array.isArray((ne=w==null?void 0:w.props)==null?void 0:ne.rowIds)?w.props.rowIds:[],ce=typeof(P==null?void 0:P[W])=="string"&&P[W].trim()?P[W].trim():null,pe=J&&ce?`table_${J}_row_${ce}`:null,ye=`table_${z}_${N}_row_${W}`,se=`table_${D}_${N}_row_${W}`,je=`table_${N}_row_${W}`,ve=((ee=w.props.rowLanguages)==null?void 0:ee[W])||I,le=(pe?(te=r==null?void 0:r.data)==null?void 0:te[pe]:null)||((G=r==null?void 0:r.data)==null?void 0:G[ye])||((H=r==null?void 0:r.data)==null?void 0:H[se])||((ie=r==null?void 0:r.data)==null?void 0:ie[je]),oe=Array.isArray(ve)?ve:[],de=m(oe,le),Pe=w.props.expandedToggleStyle||"v2";return de.map((me,ke)=>{const Be=Math.min(E-10,12),Te=me.active;if(Pe==="v1"){const Ze=me.logo||(()=>{const ge=(me.code||"").toLowerCase();return ge==="en"||ge==="uk"||ge==="gb"?"https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg":ge==="fr"?"https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg":ge==="ar"||ge==="lb"?"https://upload.wikimedia.org/wikipedia/commons/5/59/Flag_of_Lebanon.svg":""})();return n.jsx("div",{style:{width:Be,height:Be,borderRadius:"50%",overflow:"hidden",position:"relative",boxShadow:Te?"0 0 0 2px #6c5ce7":"none",opacity:Te?1:.6},children:Ze?n.jsx("img",{src:Ze,style:{width:"100%",height:"100%",objectFit:"cover",filter:Te?"brightness(1.1)":"brightness(0.6)"},alt:""}):n.jsx("div",{style:{width:"100%",height:"100%",background:"#ddd"}})},ke)}const Qe=(Ze=>{const ge=Ze.emoji;if(ge&&ge.length>=2)return ge;const Ae=(Ze.code||"").toLowerCase();return Ae==="lb"||Ae==="ar"?"":Ae==="fr"?"":Ae==="en"||Ae==="uk"||Ae==="gb"?"":""})(me);return n.jsx("div",{title:me.label,style:{width:Be,height:Be,minWidth:Be,borderRadius:"50%",background:Te?"#fff":"rgba(255, 255, 255, 0.5)",border:Te?"2px solid #2563eb":"0.25px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:Te?"scale(1.1)":"scale(1)",boxShadow:Te?"0 0 0 2px rgba(37, 99, 235, 0.2)":"none",opacity:Te?1:.6,fontSize:Be*.8,lineHeight:1},children:Qe},ke)})})()})]})]},W)})})})(),w.type==="qr"&&n.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=${w.props.width||120}x${w.props.height||120}&data=${encodeURIComponent(w.props.url||"")}`,style:{width:w.props.width||120,height:w.props.height||120},alt:"QR Code"}),w.type==="signature_box"&&n.jsx("div",{style:{width:w.props.width||200,height:w.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999",...b(w,z,N)?{}:{display:"none"}},children:(()=>{var B,I;const $=h(w),E=s==null?void 0:s.level,q=i==null?void 0:i.level;if($){if(w.props.period==="end-year"){if(i&&(q&&q===$||!q&&(t==null?void 0:t.level)===$)){const T=x(i);return T?n.jsx("img",{src:T,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(s&&(E&&E===$||!E&&(t==null?void 0:t.level)===$)){const T=x(s);return T?n.jsx("img",{src:T,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}}else if(w.props.period==="end-year"){if(i){const T=x(i);return T?n.jsx("img",{src:T,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}}else if(s){const T=x(s);return T?n.jsx("img",{src:T,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign"}const L=((B=r==null?void 0:r.data)==null?void 0:B.signatures)||[],O=((I=r==null?void 0:r.data)==null?void 0:I.promotions)||[];if($){const T=L.find(W=>{if(w.props.period==="end-year"&&W.type!=="end_of_year"||(!w.props.period||w.props.period==="mid-year")&&W.type==="end_of_year")return!1;if(W.level&&W.level===$)return!0;if(W.schoolYearName){const re=O.find(ae=>ae.year===W.schoolYearName);if(re&&re.from===$)return!0}return!1});if(T){const W=x(T);return W?n.jsx("img",{src:W,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${T.schoolYearName||"Ancien"})`}}return null})()}),w.type==="final_signature_box"&&n.jsx("div",{style:{width:w.props.width||200,height:w.props.height||80,border:"none",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#999",...b(w,z,N)?{}:{display:"none"}},children:(()=>{var L,O;if(i){const B=x(i);return B?n.jsx("img",{src:B,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):" Sign Fin Anne"}const $=((L=r==null?void 0:r.data)==null?void 0:L.signatures)||[],E=((O=r==null?void 0:r.data)==null?void 0:O.promotions)||[],q=h(w);if(q){const B=$.find(I=>{if(I.type!=="end_of_year")return!1;if(I.schoolYearName){const T=E.find(W=>W.year===I.schoolYearName);if(T&&T.from===q)return!0}return!1});if(B){const I=x(B);return I?n.jsx("img",{src:I,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}}):` Sign (${B.schoolYearName||"Ancien"})`}}return null})()}),w.type==="final_signature_info"&&n.jsx("div",{style:{width:w.props.width||150,height:w.props.height||30,fontSize:w.props.fontSize||12,color:w.props.color||"#333",display:"flex",alignItems:"center",justifyContent:w.props.align||"flex-start"},children:(()=>{var T,W;const E=(((T=r==null?void 0:r.data)==null?void 0:T.signatures)||[]).filter(re=>(re==null?void 0:re.type)==="end_of_year").sort((re,ae)=>{const Y=new Date(re.signedAt||0).getTime();return new Date(ae.signedAt||0).getTime()-Y})[0];if(!(!!E||!!i))return n.jsx("span",{style:{color:"#ccc"},children:w.props.placeholder||"..."});const L=E&&(E.schoolYearName||"")||new Date().getFullYear(),O=((W=r==null?void 0:r.data)==null?void 0:W.promotions)||[],B=E?O.find(re=>String(re.year)===String(E.schoolYearName)):null,I=B?B.to:f((t==null?void 0:t.level)||"");return w.props.field==="year"?n.jsx("span",{children:String(L)}):w.props.field==="student"?n.jsxs("span",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}):w.props.field==="studentFirstName"?n.jsx("span",{children:t==null?void 0:t.firstName}):w.props.field==="studentLastName"?n.jsx("span",{children:t==null?void 0:t.lastName}):w.props.field==="nextLevel"?n.jsx("span",{children:I||""}):null})()}),w.type==="student_info"&&n.jsx("div",{style:{color:w.props.color,fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden"},children:t?`${t.firstName} ${t.lastName}, ${t.className||"Classe"}, ${t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString():"Date"}`:"Nom, Classe, Naissance"}),w.type==="category_title"&&n.jsx("div",{style:{color:w.props.color,fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden"},children:"Titre catgorie"}),w.type==="competency_list"&&n.jsx("div",{style:{color:w.props.color,fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden"},children:"Liste des comptences"}),w.type==="signature"&&n.jsx("div",{style:{fontSize:w.props.fontSize,width:w.props.width,height:w.props.height,overflow:"hidden"},children:(w.props.labels||[]).join(" / ")})]},N))},D))]})};function yse(){const{assignmentId:e}=oa(),t=Sn(),[r,s]=p.useState(null),[i,a]=p.useState(null),[o,l]=p.useState(null),[c,u]=p.useState(null),[d,f]=p.useState(null),[h,m]=p.useState(0),[g,x]=p.useState(!0),[y,v]=p.useState(!0),[S,k]=p.useState(""),[j,_]=p.useState(!1),[b,A]=p.useState(!1),[z,D]=p.useState(!1),[w,N]=p.useState(!1),[$,E]=p.useState(!1),[q,L]=p.useState(!1),[O,B]=p.useState(1),[I,T]=p.useState(!1),[W,re]=p.useState(!1),[ae,Y]=p.useState(null),[J,P]=p.useState(null),[ce,pe]=p.useState(""),ye=Od();p.useEffect(()=>{if(!e||!ye)return;const de=`assignment:${e}`;ye.emit("join-room",de);const Pe=Z=>{Z.type==="language-toggle"&&s(ne=>{var ie;if(!ne)return ne;const ee={...ne},{pageIndex:te,blockIndex:G,items:H}=Z;return(ie=ee.pages[te])!=null&&ie.blocks[G]&&(ee.pages[te].blocks[G].props.items=H),ee}),Z.type==="assignment-data"&&l(ne=>{if(!ne||Z.assignmentId&&Z.assignmentId!==ne._id)return ne;const ee={...ne.data||{},...Z.data||{}};return{...ne,data:ee}})};return ye.on("update-received",Pe),()=>{ye.emit("leave-room",de),ye.off("update-received",Pe)}},[e,ye]),p.useEffect(()=>{e&&(async()=>{try{v(!0);const Pe=await K.get(`/admin-extras/templates/${e}/review`);s(Pe.data.template),a(Pe.data.student),l(Pe.data.assignment),u(Pe.data.signature),f(Pe.data.finalSignature),T(Pe.data.canEdit),E(Pe.data.isPromoted),L(Pe.data.isSignedByMe),B(Pe.data.activeSemester||1);try{const Z=Pe.data.student;if(!(Z!=null&&Z.className)||!(Z!=null&&Z.level)){const ee=((await K.get("/admin-extras/all-gradebooks")).data||[]).find(te=>String(te._id)===String(e));ee&&a(te=>te&&{...te,className:ee.className||te.className,level:ee.level||te.level})}}catch{}}catch(Pe){k("Impossible de charger le carnet"),console.error(Pe)}finally{v(!1)}})()},[e]),p.useEffect(()=>{const de=()=>Y(null);if(ae)return document.addEventListener("click",de),()=>document.removeEventListener("click",de)},[ae]);const se=async()=>{try{_(!0),k(""),await K.post(`/admin-extras/templates/${e}/sign`,{type:"standard"});const de=await K.get(`/admin-extras/templates/${e}/review`);u(de.data.signature),f(de.data.finalSignature),l(de.data.assignment),L(de.data.isSignedByMe)}catch(de){k("chec de la signature"),console.error(de)}finally{_(!1)}},je=async()=>{try{A(!0),k(""),await K.delete(`/admin-extras/templates/${e}/sign`,{data:{type:"standard"}});const de=await K.get(`/admin-extras/templates/${e}/review`);u(de.data.signature),f(de.data.finalSignature),l(de.data.assignment),L(de.data.isSignedByMe)}catch(de){k("chec de la suppression de signature"),console.error(de)}finally{A(!1)}},ve=async()=>{try{D(!0),k(""),await K.post(`/admin-extras/templates/${e}/sign`,{type:"end_of_year"});const de=await K.get(`/admin-extras/templates/${e}/review`);u(de.data.signature),f(de.data.finalSignature),l(de.data.assignment),L(de.data.isSignedByMe)}catch(de){k("chec de la signature fin d'anne"),console.error(de)}finally{D(!1)}},le=async()=>{try{N(!0),k(""),await K.delete(`/admin-extras/templates/${e}/sign`,{data:{type:"end_of_year"}});const de=await K.get(`/admin-extras/templates/${e}/review`);u(de.data.signature),f(de.data.finalSignature),l(de.data.assignment),L(de.data.isSignedByMe)}catch(de){k("chec de la suppression de signature fin d'anne"),console.error(de)}finally{N(!1)}},oe=async()=>{if(r&&i)try{k("");const de=(K.defaults.baseURL||"").replace(/\/$/,""),Pe=vb(de,i._id,r._id||""),Z=`${i.firstName} ${i.lastName}`;wd(Pe,Z,"single",1)}catch(de){k("chec de l'export PDF"),console.error(de)}};return y?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Chargement..."})})}):S&&!r?n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",style:{color:"crimson"},children:S})})}):r?n.jsx("div",{style:{padding:24},children:n.jsxs("div",{className:"card",children:[n.jsx("button",{className:"btn secondary",onClick:()=>t("/admin/all-gradebooks"),style:{marginBottom:20,display:"inline-flex",alignItems:"center",gap:8,background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0"},children:" Retour  la liste"}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"title",style:{fontSize:28,marginBottom:8,color:"#1e293b"},children:[" Examen du carnet (Admin) - ",i?`${i.firstName} ${i.lastName}`:"lve"]}),n.jsx("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:r.name})]}),I&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{fontSize:14,fontWeight:500,color:W?"#10b981":"#64748b"},children:W?"Mode dition":"Mode Lecture"}),n.jsx("div",{onClick:()=>re(!W),style:{width:48,height:24,background:W?"#10b981":"#cbd5e1",borderRadius:12,position:"relative",cursor:"pointer",transition:"background 0.3s ease"},children:n.jsx("div",{style:{width:20,height:20,background:"white",borderRadius:"50%",position:"absolute",top:2,left:W?26:2,transition:"left 0.3s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})})]})]}),n.jsxs("div",{className:"note",style:{marginTop:8,fontSize:13},children:[n.jsx("span",{style:{fontWeight:500},children:"Statut:"})," ",(o==null?void 0:o.status)==="signed"?" Sign ":(o==null?void 0:o.status)==="completed"?" Termin":o==null?void 0:o.status]}),S&&n.jsx("div",{className:"note",style:{marginTop:12,color:"#dc2626",background:"#fef2f2",padding:12,borderRadius:8,border:"1px solid #fecaca"},children:S}),n.jsxs("div",{style:{marginTop:20,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[c?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"note",style:{padding:12,background:"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)",borderRadius:8,border:"1px solid #6ee7b7",color:"#065f46",fontWeight:500},children:[" Sign le ",new Date(c.signedAt).toLocaleString("fr-FR")]}),n.jsx("button",{className:"btn",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(245, 158, 11, 0.3)"},onClick:je,disabled:b,children:b?" Annulation...":" Annuler la signature"})]}):n.jsx("button",{className:"btn",onClick:se,disabled:j,style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(16, 185, 129, 0.3)",cursor:"pointer"},children:j?" Signature...":" Signer ce carnet (Force)"}),d?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"note",style:{padding:12,background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",borderRadius:8,border:"1px solid #93c5fd",color:"#1e40af",fontWeight:500},children:[" Sign fin anne le ",new Date(d.signedAt).toLocaleString("fr-FR")]}),n.jsx("button",{className:"btn",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(245, 158, 11, 0.3)"},onClick:le,disabled:w,children:w?" Annulation...":" Annuler la signature fin anne"})]}):n.jsx("button",{className:"btn",onClick:ve,disabled:z,style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",fontWeight:500,padding:"12px 20px",boxShadow:"0 2px 8px rgba(59, 130, 246, 0.3)",cursor:"pointer"},children:z?" Signature...":" Signer ce carnet fin annes (Force)"}),n.jsx("button",{className:"btn secondary",onClick:oe,style:{background:"#f1f5f9",color:"#475569",fontWeight:500,border:"1px solid #e2e8f0",padding:"12px 20px"},children:" Exporter en PDF"})]}),n.jsxs("div",{style:{marginTop:20,marginBottom:16,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",padding:16,background:"#f8fafc",borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>x(!g),style:{background:g?"linear-gradient(135deg, #6c5ce7 0%, #5b4bc4 100%)":"#f1f5f9",color:g?"white":"#475569",fontWeight:500,border:"1px solid #cbd5e1",padding:"10px 16px"},children:g?" Vue page par page":" Vue continue"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>m(Math.max(0,h-1)),disabled:h===0||g,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:h===0||g?.5:1},children:" Prcdent"}),n.jsx("select",{value:h,onChange:de=>{const Pe=Number(de.target.value);m(Pe),g&&setTimeout(()=>{const Z=document.getElementById(`page-${Pe}`);Z&&Z.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14,fontWeight:500,color:"#475569",background:"white"},children:r.pages.map((de,Pe)=>n.jsx("option",{value:Pe,children:de.title||`Page ${Pe+1}`},Pe))}),n.jsx("button",{className:"btn secondary",onClick:()=>m(Math.min(r.pages.length-1,h+1)),disabled:h===r.pages.length-1||g,style:{padding:"10px 16px",background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1",opacity:h===r.pages.length-1||g?.5:1},children:"Suivant "})]})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center"},children:r&&i&&o&&n.jsx(xse,{template:r,student:i,assignment:o,signature:c,finalSignature:d,visiblePages:g?void 0:[h]})})]})}):n.jsx("div",{className:"container",children:n.jsx("div",{className:"card",children:n.jsx("div",{className:"note",children:"Carnet introuvable"})})})}function vse(){const[e,t]=p.useState([]),[r,s]=p.useState(!1),[i,a]=p.useState(""),[o,l]=p.useState(""),[c,u]=p.useState(""),d=x=>{for(let y=1;y<=3;y++)if(!confirm(`${x}

Confirmation ${y}/3`))return!1;return!0};p.useEffect(()=>{f()},[]);const f=async()=>{try{const x=await K.get("/signatures/admin");t(x.data)}catch(x){console.error(x)}},h=async x=>{var S;const y=(S=x.target.files)==null?void 0:S[0];if(!y)return;if(!i){l("Veuillez entrer un nom pour la signature");return}const v=new FileReader;v.readAsDataURL(y),v.onload=async()=>{try{s(!0),l(""),u(""),await K.post("/signatures/admin",{name:i,dataUrl:v.result}),a(""),f(),u("Signature ajoute")}catch{l("Erreur lors de l'ajout")}finally{s(!1)}}},m=async x=>{try{await K.post(`/signatures/admin/${x}/activate`,{}),f(),u("Signature active")}catch{l("Erreur activation")}},g=async x=>{if(d("Supprimer cette signature ?"))try{await K.delete(`/signatures/admin/${x}`),f(),u("Signature supprime")}catch{l("Erreur suppression")}};return n.jsxs("div",{className:"container",style:{maxWidth:1e3,margin:"0 auto",padding:"20px"},children:[n.jsxs("div",{style:{marginBottom:32},children:[n.jsx(rr,{to:"/admin/permissions",className:"btn secondary",style:{textDecoration:"none",marginBottom:16,display:"inline-block"},children:" Retour"}),n.jsx("h2",{className:"title",children:"Signatures Admin"}),n.jsx("p",{className:"note",children:"Grez les signatures disponibles pour l'administrateur."})]}),o&&n.jsx("div",{className:"note",style:{background:"#fef2f2",color:"#dc2626",marginBottom:20,padding:10,borderRadius:8},children:o}),c&&n.jsx("div",{className:"note",style:{background:"#dcfce7",color:"#166534",marginBottom:20,padding:10,borderRadius:8},children:c}),n.jsxs("div",{className:"card",style:{padding:24,marginBottom:32},children:[n.jsx("h3",{children:"Ajouter une signature"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:16},children:[n.jsx("input",{type:"text",placeholder:"Nom (ex: Signature Directeur)",value:i,onChange:x=>a(x.target.value),style:{padding:"8px 12px",borderRadius:6,border:"1px solid #cbd5e1",flex:1}}),n.jsxs("label",{className:"btn",style:{cursor:"pointer",background:"#3b82f6",color:"white",display:"flex",alignItems:"center",gap:8},children:[r?"...":"Choisir image",n.jsx("input",{type:"file",accept:"image/*",onChange:h,style:{display:"none"},disabled:r})]})]})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:20},children:e.map(x=>n.jsxs("div",{className:"card",style:{padding:16,border:x.isActive?"2px solid #10b981":"1px solid #e2e8f0",position:"relative"},children:[x.isActive&&n.jsx("div",{style:{position:"absolute",top:10,right:10,background:"#10b981",color:"white",padding:"2px 8px",borderRadius:12,fontSize:12},children:"Active"}),n.jsx("h4",{style:{margin:"0 0 12px 0"},children:x.name}),n.jsx("div",{style:{height:100,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc",borderRadius:8,marginBottom:12},children:n.jsx("img",{src:x.dataUrl,alt:x.name,style:{maxHeight:"100%",maxWidth:"100%"}})}),n.jsxs("div",{style:{display:"flex",gap:8},children:[!x.isActive&&n.jsx("button",{className:"btn",onClick:()=>m(x._id),style:{flex:1,fontSize:13},children:"Activer"}),n.jsx("button",{className:"btn secondary",onClick:()=>g(x._id),style:{color:"#ef4444",borderColor:"#fee2e2",background:"#fef2f2"},children:""})]})]},x._id))})]})}function bse(){return n.jsx("div",{className:"container",style:{maxWidth:1e3,margin:"0 auto",padding:"20px"},children:n.jsxs("div",{style:{marginBottom:32},children:[n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:8},children:"Supervision Globale"}),n.jsx("p",{className:"note",style:{fontSize:16,color:"#64748b"},children:"Consulter l'ensemble des carnets et grer les signatures des prfets."}),n.jsxs("div",{style:{marginTop:16,display:"flex",gap:12},children:[n.jsx(rr,{to:"/admin/all-gradebooks",className:"btn primary",style:{textDecoration:"none",display:"inline-block"},children:"Voir tous les carnets (Admin)"}),n.jsx(rr,{to:"/admin/signatures",className:"btn secondary",style:{textDecoration:"none",display:"inline-block"},children:"Signatures"})]})]})})}const Ty=({role:e,label:t,icon:r,items:s,permissions:i,onToggle:a})=>{const o=e.toLowerCase();return n.jsxs("div",{className:"role-card",children:[n.jsxs("div",{className:"role-header",children:[n.jsx("div",{className:`role-icon ${o}`,children:r}),n.jsx("h3",{className:"role-title",children:t})]}),n.jsx("div",{className:"permissions-list",children:s.map(l=>{var u;const c=((u=i[e])==null?void 0:u[l.key])!==!1;return n.jsxs("div",{className:"permission-item",onClick:()=>a(e,l.key),children:[n.jsxs("div",{className:"permission-label",children:[n.jsx("span",{style:{color:"#64748b"},children:l.icon}),l.label]}),n.jsxs("label",{className:"toggle-switch",onClick:d=>d.stopPropagation(),children:[n.jsx("input",{type:"checkbox",checked:c,onChange:()=>a(e,l.key)}),n.jsx("span",{className:"slider"})]})]},l.key)})})]})};function jse(){const[e,t]=p.useState({}),[r,s]=p.useState(null),i=async()=>{try{const u=await K.get("/settings/public");t(u.data.nav_permissions||{})}catch(u){console.error(u),s({message:"Erreur lors du chargement des configurations",type:"error"})}};p.useEffect(()=>{i()},[]);const a=async(u,d)=>{const f={...e};f[u]||(f[u]={});const h=f[u][d]!==!1;f[u][d]=!h,t(f);try{await K.post("/settings",{key:"nav_permissions",value:f})}catch(m){console.error("Error saving permissions",m),s({message:"Erreur lors de la sauvegarde",type:"error"}),f[u][d]=h,t({...f})}},o=[{key:"classes",label:"Mes Classes",icon:n.jsx(Tl,{size:18})}],l=[{key:"dashboard",label:"Tableau de bord",icon:n.jsx(D2,{size:18})},{key:"progress",label:"Progression",icon:n.jsx(Uh,{size:18})},{key:"teacher-progress",label:"Suivi Enseignants",icon:n.jsx(W2,{size:18})},{key:"gradebooks",label:"Carnet",icon:n.jsx(Wh,{size:18})},{key:"eleves",label:"lves",icon:n.jsx(Kl,{size:18})},{key:"signature",label:"Ma signature",icon:n.jsx(xb,{size:18})}],c=[{key:"dashboard",label:"Tableau de bord",icon:n.jsx(D2,{size:18})},{key:"progress",label:"Progression",icon:n.jsx(Uh,{size:18})},{key:"teacher-progress",label:"Suivi Enseignants",icon:n.jsx(W2,{size:18})},{key:"gradebooks",label:"Carnet",icon:n.jsx(Wh,{size:18})}];return n.jsxs("div",{className:"admin-nav-visibility",children:[n.jsxs("header",{className:"nav-header",children:[n.jsxs("h1",{className:"nav-title",children:[n.jsx(QD,{size:40,strokeWidth:2.5}),"Visibilit du Menu"]}),n.jsx("p",{className:"nav-subtitle",children:"Personnalisez l'exprience utilisateur en contrlant l'accs aux diffrentes sections de l'application pour chaque rle."})]}),n.jsxs("div",{className:"roles-grid",children:[n.jsx(Ty,{role:"TEACHER",label:"Enseignants",icon:n.jsx(Ts,{}),items:o,permissions:e,onToggle:a}),n.jsx(Ty,{role:"SUBADMIN",label:"Prfets",icon:n.jsx(bd,{}),items:l,permissions:e,onToggle:a}),n.jsx(Ty,{role:"AEFE",label:"RPP et Direction",icon:n.jsx(Tl,{}),items:c,permissions:e,onToggle:a})]}),r&&n.jsx(ca,{message:r.message,type:r.type,onClose:()=>s(null)})]})}const __=[{key:"PS",label:"PS"},{key:"MS",label:"MS"},{key:"GS",label:"GS"},{key:"EB1",label:"EB1 / Archive"}],Bf=[{key:"dynamic_text",label:"Texte dynamique",icon:""},{key:"promotion_info",label:"Info promotion",icon:""},{key:"signature_box",label:"Signature",icon:""},{key:"final_signature_box",label:"Signature finale",icon:""},{key:"signature_date",label:"Date signature",icon:""},{key:"signature",label:"Bloc signature",icon:""}],A_=[{value:"always",label:"Toujours visible",shortLabel:" Toujours"},{value:"after_sem1",label:"Aprs signature Sem 1",shortLabel:"1 Aprs Sem1"},{value:"after_sem2",label:"Aprs signature Sem 2",shortLabel:"2 Aprs Sem2"},{value:"never",label:"Jamais visible",shortLabel:" Jamais"}],Ff={subadmin:{label:"Sous-admin",icon:n.jsx(bd,{size:14})},pdf:{label:"PDF",icon:n.jsx(yp,{size:14})},teacher:{label:"Enseignant",icon:n.jsx(Ts,{size:14})}};function wse(){var L;const[e,t]=p.useState({}),[r,s]=p.useState([]),[i,a]=p.useState(""),[o,l]=p.useState("PS"),[c,u]=p.useState([]),[d,f]=p.useState(null),[h,m]=p.useState(new Set(Bf.map(O=>O.key))),g=(O,B,I,T)=>T?`block:${T}`:`tpl:${O}:p:${B}:b:${I}`,x=O=>{var I,T;const B=((I=O==null?void 0:O.props)==null?void 0:I.semester)??((T=O==null?void 0:O.props)==null?void 0:T.semestre)??null;return B==null||B===""?null:B},y=async()=>{try{const O=await K.get("/settings/public");t(O.data.block_visibility_settings||{})}catch(O){console.error(O),f({message:"Erreur lors du chargement des configurations",type:"error"})}},v=async()=>{try{const O=await K.get("/templates"),I=(Array.isArray(O.data)?O.data:[]).map(T=>({_id:String(T._id),name:String(T.name||"Template")}));s(I),I.length>0&&!i&&a(I[0]._id)}catch(O){console.error(O),f({message:"Erreur lors du chargement des templates",type:"error"})}},S=async O=>{if(!O){u([]);return}try{const I=(await K.get(`/templates/${O}`)).data,T=[];(Array.isArray(I==null?void 0:I.pages)?I.pages:[]).forEach((re,ae)=>{(Array.isArray(re==null?void 0:re.blocks)?re.blocks:[]).forEach((J,P)=>{var se,je,ve,le,oe,de,Pe;if(!J||!J.type||!["dynamic_text","promotion_info","signature_box","final_signature_box","signature_date","signature"].includes(J.type))return;const ce=typeof((se=J==null?void 0:J.props)==null?void 0:se.blockId)=="string"&&J.props.blockId.trim()?J.props.blockId.trim():null,pe=g(String((I==null?void 0:I._id)||""),ae,P,ce),ye=String(((je=J==null?void 0:J.props)==null?void 0:je.label)||((ve=J==null?void 0:J.props)==null?void 0:ve.text)||((le=J==null?void 0:J.props)==null?void 0:le.field)||(J==null?void 0:J.type)||"Bloc");T.push({key:pe,type:J.type,label:ye,field:((oe=J==null?void 0:J.props)==null?void 0:oe.field)||void 0,templateId:String((I==null?void 0:I._id)||""),templateName:String((I==null?void 0:I.name)||"Template"),pageIndex:ae,blockIndex:P,level:((de=J==null?void 0:J.props)==null?void 0:de.level)||null,period:((Pe=J==null?void 0:J.props)==null?void 0:Pe.period)||null,semester:x(J)})})}),u(T)}catch(B){console.error(B),f({message:"Erreur lors du chargement du template",type:"error"})}},k=p.useMemo(()=>c.filter(O=>{var I;if(!h.has(O.type))return!1;const B=((I=O.level)==null?void 0:I.toUpperCase())||"_none";return B==="_none"?!0:B===o}),[c,h,o]),j=p.useMemo(()=>{const O=[];return Bf.forEach(B=>{if(!h.has(B.key))return;const I=k.filter(ae=>ae.type===B.key);if(I.length===0)return;const T=new Map;I.forEach(ae=>{const Y=ae.level||"_none";T.has(Y)||T.set(Y,[]),T.get(Y).push(ae)});const W={PS:0,MS:1,GS:2,EB1:3,_none:4},re=Array.from(T.entries()).sort((ae,Y)=>(W[ae[0]]??5)-(W[Y[0]]??5)).map(([ae,Y])=>({level:ae,levelLabel:ae==="_none"?"Sans niveau":ae,items:Y.sort((J,P)=>J.pageIndex-P.pageIndex||J.blockIndex-P.blockIndex)}));O.push({type:B.key,typeLabel:B.label,typeIcon:B.icon,levelGroups:re})}),O},[k,h]),_=O=>{m(B=>{const I=new Set(B);return I.has(O)?I.delete(O):I.add(O),I})},b=()=>m(new Set(Bf.map(O=>O.key))),A=()=>m(new Set);p.useEffect(()=>{y(),v()},[]),p.useEffect(()=>{i&&S(i)},[i]);const z=async O=>{t(O);try{await K.post("/settings",{key:"block_visibility_settings",value:O}),f({message:"Configuration sauvegardee",type:"success"})}catch(B){console.error(B),f({message:"Erreur lors de la sauvegarde",type:"error"})}},D=O=>{if(O.type==="signature_box"||O.type==="signature_date")return O.period==="mid-year"?"always":O.period==="end-year"?"after_sem1":"always";if(O.type==="final_signature_box")return"after_sem1";if(O.type==="signature")return"always";if(O.type==="promotion_info"){if(O.period==="mid-year")return"after_sem1";if(O.period==="end-year")return"after_sem2";if(O.field==="level"||O.field==="year")return"after_sem1"}return"always"},w=(O,B,I,T)=>{var W,re;return((re=(W=e==null?void 0:e[O])==null?void 0:W[B])==null?void 0:re[I])??D(T)},N=(O,B,I,T)=>{const W=JSON.parse(JSON.stringify(e));W[O]||(W[O]={}),W[O][B]||(W[O][B]={}),W[O][B][I]=T,z(W)},$=(O,B,I)=>{const T=JSON.parse(JSON.stringify(e));T[O]||(T[O]={}),T[O][B]||(T[O][B]={}),k.forEach(W=>{T[O][B][W.key]=I}),z(T)},E=O=>{if(O===o)return;const B=JSON.parse(JSON.stringify(e));e!=null&&e[O]&&(B[o]=JSON.parse(JSON.stringify(e[O])),z(B))},q=((L=r.find(O=>O._id===i))==null?void 0:L.name)||"";return n.jsxs("div",{className:"admin-block-visibility",children:[n.jsxs("header",{className:"block-visibility-hero",children:[n.jsxs("h1",{className:"block-visibility-hero-title",children:[n.jsx(Q4,{size:36})," Visibilite des blocs"]}),n.jsx("p",{className:"block-visibility-hero-subtitle",children:"Configurez quand les blocs sont visibles selon le niveau de l'eleve et l'etat des signatures."})]}),n.jsx("div",{className:"block-visibility-selectors",children:n.jsxs("div",{className:"selector-group",children:[n.jsx("label",{htmlFor:"template-select",children:"Template :"}),n.jsxs("div",{className:"template-select-wrapper",children:[n.jsx("select",{id:"template-select",value:i,onChange:O=>a(O.target.value),children:r.map(O=>n.jsx("option",{value:O._id,children:O.name},O._id))}),n.jsx(ub,{size:18,className:"select-icon"})]})]})}),n.jsx("div",{className:"student-level-tabs",children:__.map(O=>n.jsx("button",{className:`level-tab ${o===O.key?"active":""}`,onClick:()=>l(O.key),children:O.label},O.key))}),n.jsxs("div",{className:"type-filters",children:[n.jsxs("div",{className:"type-filters-header",children:[n.jsx(PD,{size:16}),n.jsx("span",{children:"Filtrer par type:"}),n.jsx("button",{className:"filter-action-btn",onClick:b,children:"Tous"}),n.jsx("button",{className:"filter-action-btn",onClick:A,children:"Aucun"})]}),n.jsx("div",{className:"type-filter-chips",children:Bf.map(O=>n.jsxs("button",{className:`type-chip ${h.has(O.key)?"active":""}`,onClick:()=>_(O.key),children:[O.icon," ",O.label]},O.key))})]}),n.jsxs("div",{className:"copy-controls",children:[n.jsx("span",{className:"copy-label",children:"Copier depuis:"}),__.filter(O=>O.key!==o).map(O=>n.jsx("button",{className:"copy-btn",onClick:()=>E(O.key),children:O.label},O.key))]}),i&&n.jsxs("div",{className:"block-visibility-content",children:[n.jsxs("div",{className:"content-header",children:[n.jsxs("h2",{className:"block-visibility-section-title",children:['Blocs de "',q,'" - Niveau ',o]}),n.jsxs("span",{className:"block-count",children:[k.length," bloc(s)"]})]}),n.jsx("div",{className:"bulk-actions",children:["subadmin","pdf","teacher"].map(O=>n.jsxs("div",{className:"bulk-action-group",children:[n.jsxs("span",{className:"bulk-label",children:[Ff[O].icon," ",Ff[O].label,":"]}),A_.map(B=>n.jsx("button",{className:`bulk-btn ${B.value}`,onClick:()=>$(o,O,B.value),title:`Mettre tous sur "${B.label}"`,children:B.shortLabel},B.value))]},O))}),j.length===0?n.jsx("p",{className:"block-visibility-empty",children:"Aucun bloc configurable trouve (vrifiez les filtres)."}):n.jsx("div",{className:"block-visibility-groups",children:j.map(O=>n.jsxs("div",{className:"type-group",children:[n.jsxs("div",{className:"type-group-header",children:[n.jsx("span",{className:"type-group-icon",children:O.typeIcon}),n.jsx("span",{className:"type-group-title",children:O.typeLabel})]}),O.levelGroups.map(B=>n.jsxs("div",{className:"level-group",children:[n.jsx("div",{className:"level-group-header",children:n.jsx("span",{className:"level-badge",children:B.levelLabel})}),n.jsxs("table",{className:"block-visibility-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Bloc"}),n.jsx("th",{children:"Semestre"}),n.jsx("th",{children:"Page"}),["subadmin","pdf","teacher"].map(I=>n.jsxs("th",{className:"view-header",children:[Ff[I].icon," ",Ff[I].label]},I))]})}),n.jsx("tbody",{children:B.items.map(I=>n.jsxs("tr",{children:[n.jsxs("td",{className:"block-label-cell",children:[n.jsx("span",{className:"block-label",children:I.label}),I.field&&n.jsxs("span",{className:"block-field",children:["(",I.field,")"]})]}),n.jsx("td",{className:"semester-cell",children:I.period==="mid-year"?n.jsx("span",{className:"semester-badge sem1",children:"Sem 1"}):I.period==="end-year"?n.jsx("span",{className:"semester-badge sem2",children:"Sem 2"}):I.semester?n.jsx("span",{className:"semester-badge",children:I.semester}):n.jsx("span",{className:"semester-none",children:""})}),n.jsx("td",{className:"page-cell",children:I.pageIndex+1}),["subadmin","pdf","teacher"].map(T=>n.jsx("td",{className:"visibility-cell",children:n.jsx("select",{className:`visibility-select ${w(o,T,I.key,I)}`,value:w(o,T,I.key,I),onChange:W=>N(o,T,I.key,W.target.value),children:A_.map(W=>n.jsx("option",{value:W.value,children:W.label},W.value))})},`${I.key}-${T}`))]},I.key))})]})]},B.level))]},O.type))})]}),d&&n.jsx(ca,{message:d.message,type:d.type,onClose:()=>f(null)})]})}const Sse=({levels:e,classes:t,students:r,activeSchoolYearId:s,onRefresh:i})=>{const[a,o]=p.useState(""),[l,c]=p.useState(""),[u,d]=p.useState(null),f=p.useMemo(()=>a?t.filter(g=>g.level===a):[],[t,a]),h=p.useMemo(()=>l?r.filter(g=>g.classId===l):[],[r,l]),m=async(g,x)=>{var y,v;if(confirm("Confirmer le passage de cet lve au niveau suprieur ?")){d(g);try{await K.post(`/students/${g}/promote`,{}),alert("lve promu avec succs"),i()}catch(S){alert("Erreur: "+(((v=(y=S.response)==null?void 0:y.data)==null?void 0:v.message)||S.message))}finally{d(null)}}};return n.jsxs("div",{className:"card",style:{padding:24,borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.05)",border:"1px solid #e2e8f0"},children:[n.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,alignItems:"center"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[n.jsx("label",{style:{fontSize:12,color:"#64748b",fontWeight:500},children:"Niveau"}),n.jsxs("select",{value:a,onChange:g=>{o(g.target.value),c("")},style:{padding:"8px 12px",borderRadius:6,border:"1px solid #cbd5e1"},children:[n.jsx("option",{value:"",children:"-- Choisir --"}),e.map(g=>n.jsx("option",{value:g.name,children:g.name},g._id))]})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[n.jsx("label",{style:{fontSize:12,color:"#64748b",fontWeight:500},children:"Classe"}),n.jsxs("select",{value:l,onChange:g=>c(g.target.value),disabled:!a,style:{padding:"8px 12px",borderRadius:6,border:"1px solid #cbd5e1",opacity:a?1:.5},children:[n.jsx("option",{value:"",children:"-- Choisir --"}),f.map(g=>n.jsx("option",{value:g._id,children:g.name},g._id))]})]})]}),l&&n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{textAlign:"left",borderBottom:"1px solid #eee",color:"#64748b",fontSize:13},children:[n.jsx("th",{style:{padding:10},children:"lve"}),n.jsx("th",{style:{padding:10},children:"Niveau Actuel"}),n.jsx("th",{style:{padding:10},children:"Statut"}),n.jsx("th",{style:{padding:10},children:"Action"})]})}),n.jsxs("tbody",{children:[h.map(g=>{var y;const x=(y=g.promotions)==null?void 0:y.some(v=>v.schoolYearId===s);return n.jsxs("tr",{style:{borderBottom:"1px solid #f8fafc"},children:[n.jsxs("td",{style:{padding:10},children:[g.firstName," ",g.lastName]}),n.jsx("td",{style:{padding:10},children:g.level}),n.jsx("td",{style:{padding:10},children:x?n.jsx("span",{style:{background:"#dcfce7",color:"#166534",padding:"2px 8px",borderRadius:12,fontSize:12},children:"Promu"}):n.jsx("span",{style:{color:"#64748b",fontSize:12},children:"En cours"})}),n.jsx("td",{style:{padding:10},children:!x&&n.jsx("button",{className:"btn",onClick:()=>m(g._id,g.level),disabled:u===g._id,style:{padding:"4px 12px",fontSize:12,height:"auto"},children:u===g._id?"...":"Promouvoir"})})]},g._id)}),h.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,style:{padding:20,textAlign:"center",color:"#94a3b8"},children:"Aucun lve dans cette classe."})})]})]})]})};function kse(){const[e,t]=p.useState([]),[r,s]=p.useState([]),[i,a]=p.useState([]),[o,l]=p.useState(""),c=async()=>{try{const[u,d]=await Promise.all([K.get("/levels"),K.get("/school-years")]);t(u.data);const f=d.data.find(h=>h.active);if(f){l(f._id);const[h,m]=await Promise.all([K.get(`/classes?schoolYearId=${f._id}`),K.get(`/students?schoolYearId=${f._id}`)]);s(h.data),a(m.data)}}catch(u){console.error(u)}};return p.useEffect(()=>{c()},[]),n.jsxs("div",{className:"container",style:{maxWidth:1e3,margin:"0 auto",padding:"20px"},children:[n.jsxs("div",{style:{marginTop:40,marginBottom:32},children:[n.jsx("h2",{className:"title",style:{fontSize:20,marginBottom:8},children:"Passage des lves (Admin)"}),n.jsx("p",{className:"note",style:{fontSize:16,color:"#64748b"},children:"Promouvoir les lves au niveau suprieur sans restriction de signature."})]}),n.jsx(Sse,{levels:e,classes:r,students:i,activeSchoolYearId:o,onRefresh:c})]})}const Ry=[{from:"PS",to:"MS",label:"PS  MS"},{from:"MS",to:"GS",label:"MS  GS"},{from:"GS",to:"EB1",label:"GS  EB1"}];function Nse(){const e=Sn(),[t,r]=p.useState([]),[s,i]=p.useState([]),[a,o]=p.useState(null),[l,c]=p.useState(null),[u,d]=p.useState([]),[f,h]=p.useState(""),[m,g]=p.useState([]),[x,y]=p.useState("PS"),[v,S]=p.useState(null),[k,j]=p.useState(!0),[_,b]=p.useState(!1),[A,z]=p.useState(new Set),[D,w]=p.useState(null),[N,$]=p.useState(new Set),[E,q]=p.useState("all"),[L,O]=p.useState("all"),[B,I]=p.useState("subadmin"),[T,W]=p.useState(""),[re,ae]=p.useState("both"),[Y,J]=p.useState(""),[P,ce]=p.useState(!1),[pe,ye]=p.useState(""),[se,je]=p.useState(""),ve=p.useMemo(()=>Ry.find(ge=>ge.from===x)||Ry[0],[x]);p.useEffect(()=>{le()},[]),p.useEffect(()=>{f&&Pe(f,x)},[f,x]),p.useEffect(()=>{if(D){const ge=setTimeout(()=>w(null),4e3);return()=>clearTimeout(ge)}},[D]);const le=async()=>{try{const Ae=(await K.get("/school-years")).data||[];d(Ae);const Le=Ae.find(Q=>Q.active);Le?h(Le._id):Ae.length>0&&h(Ae[0]._id)}catch(ge){console.error("Failed to load years:",ge),w({message:"Erreur lors du chargement des annes",type:"error"})}},oe=async ge=>{var Le,Q;const Ae=(Le=ge.target.files)==null?void 0:Le[0];if(Ae){if(!Ae.type.startsWith("image/")){w({message:"Veuillez slectionner une image",type:"error"});return}ce(!0);try{const be=new FormData;be.append("file",Ae);const we=await K.post("/admin-extras/ps-onboarding/custom-signature/upload",be,{headers:{"Content-Type":"multipart/form-data"}}),Ne=String(((Q=we==null?void 0:we.data)==null?void 0:Q.signatureUrl)||"");if(!Ne){w({message:"Erreur lors de l'upload de l'image",type:"error"});return}J(Ne),I("custom"),W("")}catch{w({message:"Erreur lors de l'upload de l'image",type:"error"})}finally{ce(!1),ge.target.value=""}}},de=async()=>{var Ae,Le;if(!a)return;const ge=A.size>0?Array.from(A):ne.filter(Q=>Q.isPromoted).map(Q=>Q._id);if(ge.length===0){w({message:"Aucun lve promu  annuler",type:"error"});return}for(let Q=0;Q<3;Q++)if(!confirm(`[${Q+1}/3] Annuler la promotion (${ve.to}  ${ve.from}) pour ${ge.length} lve(s) ?`))return;b(!0);try{const Q=await K.post("/admin-extras/ps-onboarding/batch-unpromote",{scope:A.size>0?"student":"all",studentIds:A.size>0?ge:void 0,schoolYearId:f,fromLevel:x});await Pe(f,x),z(new Set),w({message:`Annulation promotions: ${Q.data.success} russies, ${Q.data.failed} choues, ${Q.data.skipped} ignores`,type:Q.data.failed>0?"error":"success"})}catch(Q){w({message:"Erreur: "+(((Le=(Ae=Q.response)==null?void 0:Ae.data)==null?void 0:Le.message)||Q.message),type:"error"})}finally{b(!1)}},Pe=async(ge,Ae)=>{j(!0);try{const[Le,Q]=await Promise.all([K.get("/admin-extras/ps-onboarding/students",{params:{schoolYearId:ge,fromLevel:Ae}}),K.get("/admin-extras/ps-onboarding/subadmins")]);r(Le.data.students||[]),i(Le.data.previousYearClasses||[]),o(Le.data.selectedYear||null),c(Le.data.activeYear||null),g(Q.data||[]),S(Le.data.promotionEligibility||null),z(new Set),q("all")}catch(Le){console.error("Failed to load data:",Le),w({message:"Erreur lors du chargeur des donnes",type:"error"})}finally{j(!1)}},Z=p.useMemo(()=>{const ge=t.length,Ae=t.filter(be=>be.hasEnrollment).length,Le=t.filter(be=>be.signatures.sem1&&be.signatures.sem2).length,Q=t.filter(be=>be.isPromoted).length;return{total:ge,assigned:Ae,signedBoth:Le,promoted:Q}},[t]),ne=p.useMemo(()=>t.filter(ge=>!(E!=="all"&&ge.previousClassId!==E||L==="unassigned"&&ge.hasEnrollment||L==="unsigned"&&ge.signatures.sem2||L==="signed"&&!ge.signatures.sem2||L==="promoted"&&!ge.isPromoted)),[t,E,L]),ee=p.useMemo(()=>{const ge={},Ae=[];return ne.forEach(Le=>{Le.previousClassName?(ge[Le.previousClassName]||(ge[Le.previousClassName]=[]),ge[Le.previousClassName].push(Le)):Ae.push(Le)}),{groups:ge,unassigned:Ae}},[ne]),te=()=>{A.size===ne.length?z(new Set):z(new Set(ne.map(ge=>ge._id)))},G=ge=>{const Ae=new Set(A);Ae.has(ge)?Ae.delete(ge):Ae.add(ge),z(Ae)},H=ge=>{const Ae=new Set(N);Ae.has(ge)?Ae.delete(ge):Ae.add(ge),$(Ae)},ie=ge=>{const Ae=ge.map(be=>be._id),Le=Ae.every(be=>A.has(be)),Q=new Set(A);Le?Ae.forEach(be=>Q.delete(be)):Ae.forEach(be=>Q.add(be)),z(Q)},me=async(ge,Ae)=>{var Le,Q;if(a)try{await K.post("/admin-extras/ps-onboarding/assign-class",{studentId:ge,classId:Ae,schoolYearId:a._id,fromLevel:x}),await Pe(f,x),w({message:"Classe assigne avec succs",type:"success"})}catch(be){w({message:"Erreur: "+(((Q=(Le=be.response)==null?void 0:Le.data)==null?void 0:Q.message)||be.message),type:"error"})}},ke=async ge=>{var Le,Q;if(!a)return;if(B==="subadmin"&&!T){w({message:"Veuillez slectionner un sous-admin",type:"error"});return}if(B==="custom"&&!Y){w({message:"Veuillez tlcharger une image de signature",type:"error"});return}const Ae=A.size>0?Array.from(A):ne.map(be=>be._id);if(Ae.length===0){w({message:"Aucun lve slectionn",type:"error"});return}if(confirm(`Signer ${ge==="both"?"Sem1 + Sem2":ge.toUpperCase()} pour ${Ae.length} lve(s) ?`)){b(!0);try{const be=await K.post("/admin-extras/ps-onboarding/batch-sign",{scope:A.size>0?"student":"all",studentIds:A.size>0?Ae:void 0,signatureType:ge,signatureSource:B,subadminId:B==="subadmin"?T:void 0,customSignatureUrl:B==="custom"?Y:void 0,schoolYearId:a._id,fromLevel:x,sem1SignedAt:pe?new Date(pe).toISOString():void 0,sem2SignedAt:se?new Date(se).toISOString():void 0});await Pe(f,x),z(new Set),w({message:`Signatures cres: ${be.data.success} russies, ${be.data.failed} choues`,type:be.data.failed>0?"error":"success"})}catch(be){w({message:"Erreur: "+(((Q=(Le=be.response)==null?void 0:Le.data)==null?void 0:Q.message)||be.message),type:"error"})}finally{b(!1)}}},Be=async()=>{var Ae,Le;if(!a)return;const ge=A.size>0?Array.from(A):ne.map(Q=>Q._id);if(ge.length===0){w({message:"Aucun lve slectionn",type:"error"});return}for(let Q=0;Q<3;Q++)if(!confirm(`[${Q+1}/3] Annuler les signatures pour ${ge.length} lve(s) ?`))return;b(!0);try{const Q=await K.post("/admin-extras/ps-onboarding/batch-unsign",{scope:A.size>0?"student":"all",studentIds:A.size>0?ge:void 0,signatureType:"both",schoolYearId:a._id,fromLevel:x});await Pe(f,x),z(new Set),w({message:`${Q.data.deleted} signatures supprimes`,type:"success"})}catch(Q){w({message:"Erreur: "+(((Le=(Ae=Q.response)==null?void 0:Ae.data)==null?void 0:Le.message)||Q.message),type:"error"})}finally{b(!1)}},Te=async()=>{var Ae,Le;if(!a)return;if(v&&!v.hasNextYear){w({message:"Promotion impossible: l'anne scolaire suivante n'existe pas. Veuillez crer l'anne suivante dans les paramtres.",type:"error"});return}if(v&&!v.hasNextLevel){w({message:`Promotion impossible: le niveau ${ve.to} n'existe pas. Veuillez crer ce niveau dans les paramtres.`,type:"error"});return}const ge=A.size>0?Array.from(A):ne.filter(Q=>Q.signatures.sem1&&Q.signatures.sem2&&!Q.isPromoted).map(Q=>Q._id);if(A.size>0){const be=ne.filter(we=>A.has(we._id)).filter(we=>!(we.signatures.sem1&&we.signatures.sem2)||we.isPromoted);if(be.length>0){w({message:`Slection invalide: ${be.length} lve(s) non ligible(s) (doit tre sign Sem1+Sem2 et non promu)`,type:"error"});return}}if(ge.length===0){w({message:"Aucun lve ligible (doit tre sign Sem1+Sem2 et non promu)",type:"error"});return}for(let Q=0;Q<3;Q++)if(!confirm(`[${Q+1}/3] Promouvoir ${ge.length} lve(s) de ${ve.from} vers ${ve.to} ?`))return;b(!0);try{const Q=await K.post("/admin-extras/ps-onboarding/batch-promote",{scope:A.size>0?"student":"all",studentIds:A.size>0?ge:void 0,schoolYearId:f,fromLevel:x});await Pe(f,x),z(new Set),w({message:`Promotions: ${Q.data.success} russies, ${Q.data.failed} choues, ${Q.data.skipped} ignores`,type:Q.data.failed>0?"error":"success"})}catch(Q){w({message:"Erreur: "+(((Le=(Ae=Q.response)==null?void 0:Ae.data)==null?void 0:Le.message)||Q.message),type:"error"})}finally{b(!1)}},qe=async()=>{var Ae,Le;if(!a)return;const ge=A.size>0?Array.from(A):ne.map(Q=>Q._id);if(ge.length===0){w({message:"Aucun lve  exporter",type:"error"});return}if(confirm(`Exporter ${ge.length} carnet(s) en PDF ?`)){b(!0);try{const Q=await K.post("/admin-extras/ps-onboarding/batch-export",{scope:A.size>0?"student":"all",studentIds:A.size>0?ge:void 0,schoolYearId:a._id,fromLevel:x});if(!Q.data.assignmentIds||Q.data.assignmentIds.length===0){w({message:"Aucun carnet trouv pour ces lves",type:"error"});return}w({message:`Gnration de ${Q.data.count} PDF(s) en cours...`,type:"success"});const be=localStorage.getItem("token")||"",we=await fetch("/pdf-v2/assignments/zip",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${be}`},body:JSON.stringify({assignmentIds:Q.data.assignmentIds,groupLabel:Q.data.groupLabel,hideSignatures:!0})});if(!we.ok)throw new Error("Erreur lors de la gnration du ZIP");const Ne=await we.blob(),V=window.URL.createObjectURL(Ne),fe=document.createElement("a");fe.href=V,fe.download=`carnets-${Q.data.groupLabel||x}.zip`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),window.URL.revokeObjectURL(V),w({message:`Export termin: ${Q.data.count} carnet(s)`,type:"success"})}catch(Q){w({message:"Erreur: "+(((Le=(Ae=Q.response)==null?void 0:Ae.data)==null?void 0:Le.message)||Q.message),type:"error"})}finally{b(!1)}}},Qe=ge=>{if(!ge)return"-";try{return new Date(ge).toLocaleDateString("fr-FR")}catch{return ge}},Ze=(ge,Ae)=>`${(ge==null?void 0:ge.charAt(0))||""}${(Ae==null?void 0:Ae.charAt(0))||""}`.toUpperCase();return k?n.jsx("div",{className:"ps-onboarding",children:n.jsxs("div",{className:"ps-loading",children:[n.jsx("div",{className:"ps-loading-spinner"}),n.jsx("p",{children:"Chargement des donnes..."})]})}):n.jsxs("div",{className:"ps-onboarding",children:[n.jsxs("div",{className:"ps-onboarding-header",children:[n.jsxs("div",{className:"ps-header-top",children:[n.jsx("button",{className:"ps-back-btn",onClick:()=>e("/admin"),children:" Retour"}),n.jsxs("div",{className:"ps-year-selector",children:[n.jsx("span",{className:"ps-filter-label",children:" Anne  traiter:"}),n.jsx("select",{className:"ps-filter-select",value:f,onChange:ge=>h(ge.target.value),style:{minWidth:180},children:u.map(ge=>n.jsxs("option",{value:ge._id,children:[ge.name," ",ge.active?"(Active)":""]},ge._id))})]}),n.jsxs("div",{className:"ps-year-selector",children:[n.jsx("span",{className:"ps-filter-label",children:" Niveau:"}),n.jsx("select",{className:"ps-filter-select",value:x,onChange:ge=>y(ge.target.value),style:{minWidth:140},children:Ry.map(ge=>n.jsx("option",{value:ge.from,children:ge.label},ge.from))})]}),n.jsxs("div",{className:"ps-title-area",children:[n.jsxs("h1",{children:[" Onboarding ",ve.from,"  ",ve.to]}),n.jsxs("p",{children:["Prparer les lves ",ve.from," de ",(a==null?void 0:a.name)||"l'anne slectionne"," pour leur passage en ",ve.to]})]})]}),n.jsxs("div",{className:"ps-stats-grid",children:[n.jsxs("div",{className:"ps-stat-card",children:[n.jsx("div",{className:"ps-stat-icon total",children:""}),n.jsxs("div",{className:"ps-stat-info",children:[n.jsx("h3",{children:Z.total}),n.jsxs("p",{children:["Total lves ",ve.from]})]})]}),n.jsxs("div",{className:"ps-stat-card",children:[n.jsx("div",{className:"ps-stat-icon assigned",children:""}),n.jsxs("div",{className:"ps-stat-info",children:[n.jsx("h3",{children:Z.assigned}),n.jsx("p",{children:"Avec classe"})]})]}),n.jsxs("div",{className:"ps-stat-card",children:[n.jsx("div",{className:"ps-stat-icon signed",children:""}),n.jsxs("div",{className:"ps-stat-info",children:[n.jsx("h3",{children:Z.signedBoth}),n.jsx("p",{children:"Signs (Sem1+2)"})]})]}),n.jsxs("div",{className:"ps-stat-card",children:[n.jsx("div",{className:"ps-stat-icon promoted",children:""}),n.jsxs("div",{className:"ps-stat-info",children:[n.jsx("h3",{children:Z.promoted}),n.jsx("p",{children:"Promus"})]})]})]})]}),n.jsxs("div",{className:"ps-filter-bar",children:[n.jsxs("div",{className:"ps-filter-group",children:[n.jsx("span",{className:"ps-filter-label",children:"Classe:"}),n.jsxs("select",{className:"ps-filter-select",value:E,onChange:ge=>q(ge.target.value),children:[n.jsx("option",{value:"all",children:"Toutes les classes"}),s.map(ge=>n.jsx("option",{value:ge._id,children:ge.name},ge._id))]})]}),n.jsxs("div",{className:"ps-filter-group",children:[n.jsx("span",{className:"ps-filter-label",children:"Statut:"}),n.jsxs("select",{className:"ps-filter-select",value:L,onChange:ge=>O(ge.target.value),children:[n.jsx("option",{value:"all",children:"Tous"}),n.jsx("option",{value:"unassigned",children:"Non affects"}),n.jsx("option",{value:"unsigned",children:"Non signs"}),n.jsx("option",{value:"signed",children:"Signs"}),n.jsx("option",{value:"promoted",children:"Promus"})]})]}),n.jsxs("label",{className:"ps-select-all",children:[n.jsx("input",{type:"checkbox",checked:A.size===ne.length&&ne.length>0,onChange:te}),"Tout slectionner (",ne.length,")"]})]}),ne.length===0?n.jsxs("div",{className:"ps-empty-state",children:[n.jsx("div",{className:"emoji",children:""}),n.jsx("h3",{children:"Aucun lve trouv"}),n.jsx("p",{children:"Aucun lve ne correspond aux critres de filtrage."})]}):n.jsxs("div",{className:"ps-student-groups",children:[ee.unassigned.length>0&&(()=>{const ge=ee.unassigned,Ae=ge.filter(we=>we.signatures.sem1).length,Le=ge.filter(we=>we.signatures.sem2).length,Q=ge.filter(we=>we.isPromoted).length,be=N.has("__unassigned__");return n.jsxs("div",{className:"ps-group",children:[n.jsx("div",{className:"ps-group-header",onClick:()=>H("__unassigned__"),style:{cursor:"pointer"},children:n.jsxs("div",{className:"ps-group-title",children:[n.jsx("span",{className:"ps-expand-icon",children:be?"":""}),n.jsx("input",{type:"checkbox",checked:ge.every(we=>A.has(we._id)),onChange:we=>{we.stopPropagation(),ie(ge)},onClick:we=>we.stopPropagation(),style:{marginRight:8}}),n.jsx("h3",{children:" Non affects"}),n.jsx("span",{className:"ps-group-badge unassigned",children:ge.length}),!be&&n.jsxs("div",{className:"ps-group-summary",children:[n.jsxs("span",{className:`ps-summary-badge ${Ae===ge.length?"complete":"partial"}`,children:["S1: ",Ae,"/",ge.length]}),n.jsxs("span",{className:`ps-summary-badge ${Le===ge.length?"complete":"partial"}`,children:["S2: ",Le,"/",ge.length]}),n.jsxs("span",{className:`ps-summary-badge ${Q===ge.length?"complete":"partial"}`,children:[" ",Q,"/",ge.length]})]})]})}),N.has("__unassigned__")&&n.jsx("div",{className:"ps-student-list",children:ee.unassigned.map(we=>n.jsxs("div",{className:"ps-student-row",children:[n.jsx("div",{className:"ps-student-checkbox",children:n.jsx("input",{type:"checkbox",checked:A.has(we._id),onChange:()=>G(we._id)})}),n.jsxs("div",{className:"ps-student-info",children:[n.jsx("div",{className:"ps-student-avatar",children:we.avatarUrl?n.jsx("img",{src:we.avatarUrl,alt:""}):Ze(we.firstName,we.lastName)}),n.jsxs("div",{children:[n.jsxs("p",{className:"ps-student-name",children:[we.firstName," ",we.lastName]}),n.jsxs("p",{className:"ps-student-dob",children:["N(e) le ",Qe(we.dateOfBirth)]})]})]}),n.jsxs("select",{className:"ps-student-class-select",value:"",onChange:Ne=>me(we._id,Ne.target.value),children:[n.jsx("option",{value:"",children:"Slectionner classe..."}),s.map(Ne=>n.jsx("option",{value:Ne._id,children:Ne.name},Ne._id))]}),n.jsxs("div",{className:"ps-signature-status",children:[n.jsxs("span",{className:`ps-sig-badge ${we.signatures.sem1?"signed":"pending"}`,children:["S1 ",we.signatures.sem1?"":""]}),n.jsxs("span",{className:`ps-sig-badge ${we.signatures.sem2?"signed":"pending"}`,children:["S2 ",we.signatures.sem2?"":""]})]}),n.jsx("div",{className:"ps-promotion-status",children:n.jsx("span",{className:`ps-promo-badge ${we.isPromoted?"promoted":"not-promoted"}`,children:we.isPromoted?" Promu":" Non promu"})}),n.jsx("div",{className:"ps-student-actions",children:n.jsx("button",{className:"ps-view-btn",onClick:()=>window.open(`/student/${we._id}`,"_blank"),title:"Voir le livret",children:""})})]},we._id))})]})})(),Object.entries(ee.groups).map(([ge,Ae])=>{const Le=Ae.filter(Ne=>Ne.signatures.sem1).length,Q=Ae.filter(Ne=>Ne.signatures.sem2).length,be=Ae.filter(Ne=>Ne.isPromoted).length,we=N.has(ge);return n.jsxs("div",{className:"ps-group",children:[n.jsx("div",{className:"ps-group-header",onClick:()=>H(ge),style:{cursor:"pointer"},children:n.jsxs("div",{className:"ps-group-title",children:[n.jsx("span",{className:"ps-expand-icon",children:we?"":""}),n.jsx("input",{type:"checkbox",checked:Ae.every(Ne=>A.has(Ne._id)),onChange:Ne=>{Ne.stopPropagation(),ie(Ae)},onClick:Ne=>Ne.stopPropagation(),style:{marginRight:8}}),n.jsxs("h3",{children:[" ",ge]}),n.jsx("span",{className:"ps-group-badge",children:Ae.length}),!we&&n.jsxs("div",{className:"ps-group-summary",children:[n.jsxs("span",{className:`ps-summary-badge ${Le===Ae.length?"complete":"partial"}`,children:["S1: ",Le,"/",Ae.length]}),n.jsxs("span",{className:`ps-summary-badge ${Q===Ae.length?"complete":"partial"}`,children:["S2: ",Q,"/",Ae.length]}),n.jsxs("span",{className:`ps-summary-badge ${be===Ae.length?"complete":"partial"}`,children:[" ",be,"/",Ae.length]})]})]})}),N.has(ge)&&n.jsx("div",{className:"ps-student-list",children:Ae.map(Ne=>n.jsxs("div",{className:"ps-student-row",children:[n.jsx("div",{className:"ps-student-checkbox",children:n.jsx("input",{type:"checkbox",checked:A.has(Ne._id),onChange:()=>G(Ne._id)})}),n.jsxs("div",{className:"ps-student-info",children:[n.jsx("div",{className:"ps-student-avatar",children:Ne.avatarUrl?n.jsx("img",{src:Ne.avatarUrl,alt:""}):Ze(Ne.firstName,Ne.lastName)}),n.jsxs("div",{children:[n.jsxs("p",{className:"ps-student-name",children:[Ne.firstName," ",Ne.lastName]}),n.jsxs("p",{className:"ps-student-dob",children:["N(e) le ",Qe(Ne.dateOfBirth)]})]})]}),n.jsx("div",{className:"ps-student-class-display",children:Ne.previousClassName}),n.jsxs("div",{className:"ps-signature-status",children:[n.jsxs("span",{className:`ps-sig-badge ${Ne.signatures.sem1?"signed":"pending"}`,children:["S1 ",Ne.signatures.sem1?"":""]}),n.jsxs("span",{className:`ps-sig-badge ${Ne.signatures.sem2?"signed":"pending"}`,children:["S2 ",Ne.signatures.sem2?"":""]})]}),n.jsx("div",{className:"ps-promotion-status",children:n.jsx("span",{className:`ps-promo-badge ${Ne.isPromoted?"promoted":"not-promoted"}`,children:Ne.isPromoted?" Promu":" Non promu"})}),n.jsx("div",{className:"ps-student-actions",children:n.jsx("button",{className:"ps-view-btn",onClick:()=>window.open(`/student/${Ne._id}`,"_blank"),title:"Voir le livret",children:""})})]},Ne._id))})]},ge)})]}),n.jsxs("div",{className:"ps-actions-panel",children:[n.jsxs("div",{className:"ps-actions-header",children:[n.jsx("h3",{children:" Actions en lot"}),A.size>0&&n.jsxs("span",{className:"ps-selection-count",children:[A.size," slectionn(s)"]})]}),n.jsxs("div",{className:"ps-actions-grid",children:[n.jsxs("div",{className:"ps-action-section",children:[n.jsx("h4",{children:" Signatures"}),n.jsxs("div",{className:"ps-signature-options",children:[n.jsx("p",{className:"ps-option-label",style:{marginBottom:8},children:"Slectionner une signature:"}),n.jsxs("div",{className:"ps-signature-grid",children:[m.filter(ge=>ge.hasSignature&&ge.signatureUrl).map(ge=>n.jsxs("div",{className:`ps-signature-card ${B==="subadmin"&&T===ge._id?"selected":""}`,onClick:()=>{I("subadmin"),W(ge._id)},children:[n.jsx("img",{src:ge.signatureUrl,alt:ge.displayName,className:"ps-signature-preview"}),n.jsx("span",{className:"ps-signature-name",children:ge.displayName}),B==="subadmin"&&T===ge._id&&n.jsx("span",{className:"ps-signature-check",children:""})]},ge._id)),n.jsxs("div",{className:`ps-signature-card ${B==="custom"?"selected":""}`,onClick:()=>{I("custom"),W("")},children:[Y?n.jsx("img",{src:Y,alt:"Signature",className:"ps-signature-preview"}):n.jsx("div",{className:"ps-signature-preview",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc",borderRadius:8,border:"1px dashed #cbd5e1",color:"#64748b",fontSize:12},children:P?"...":" Upload"}),n.jsx("span",{className:"ps-signature-name",children:"Image (upload)"}),B==="custom"&&n.jsx("span",{className:"ps-signature-check",children:""}),n.jsxs("label",{style:{display:"inline-flex",marginTop:8,fontSize:12,cursor:P?"not-allowed":"pointer",color:"#6c5ce7",fontWeight:600},onClick:ge=>ge.stopPropagation(),children:[Y?"Remplacer":"Choisir image",n.jsx("input",{type:"file",accept:"image/*",onChange:oe,disabled:P,style:{display:"none"}})]}),Y&&n.jsx("button",{type:"button",className:"ps-btn secondary",style:{marginTop:8,padding:"6px 10px",fontSize:12,width:"100%"},onClick:ge=>{ge.stopPropagation(),J(""),B==="custom"&&I("subadmin")},children:"Retirer"})]},"__custom_signature__")]}),m.filter(ge=>ge.hasSignature).length===0&&n.jsx("p",{className:"ps-no-signatures",children:"Aucun sous-admin avec signature configure"})]}),n.jsxs("div",{className:"ps-date-pickers",style:{display:"flex",gap:16,marginBottom:16,flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[n.jsx("label",{style:{fontSize:12,color:"#64748b"},children:" Date Sem1 (Sign le):"}),n.jsx("input",{type:"date",value:pe,onChange:ge=>ye(ge.target.value),className:"ps-filter-select",style:{padding:"6px 10px"}})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[n.jsx("label",{style:{fontSize:12,color:"#64748b"},children:" Date Sem2 (Sign le):"}),n.jsx("input",{type:"date",value:se,onChange:ge=>je(ge.target.value),className:"ps-filter-select",style:{padding:"6px 10px"}})]})]}),n.jsxs("div",{className:"ps-sign-buttons",children:[n.jsx("button",{className:"ps-btn primary",onClick:()=>ke("sem1"),disabled:_||B==="subadmin"&&!T||B==="custom"&&!Y,children:_?"...":` Sem1 ${A.size>0?`(${A.size})`:""}`}),n.jsx("button",{className:"ps-btn primary",onClick:()=>ke("sem2"),disabled:_||B==="subadmin"&&!T||B==="custom"&&!Y,children:_?"...":` Sem2 ${A.size>0?`(${A.size})`:""}`}),n.jsx("button",{className:"ps-btn success",onClick:()=>ke("both"),disabled:_||B==="subadmin"&&!T||B==="custom"&&!Y,children:_?"...":` Les Deux ${A.size>0?`(${A.size})`:""}`})]}),n.jsx("div",{style:{marginTop:12},children:n.jsx("button",{className:"ps-btn danger",onClick:Be,disabled:_,children:_?" En cours...":` Annuler signatures ${A.size>0?`(${A.size})`:""}`})})]}),n.jsxs("div",{className:"ps-action-section",children:[n.jsxs("h4",{children:[" Promotion ",ve.from,"  ",ve.to]}),n.jsxs("p",{style:{fontSize:13,color:"#64748b",margin:"0 0 16px"},children:["Les lves doivent tre signs (Sem2) pour tre promus.",n.jsx("br",{}),`Aprs promotion, ils apparatront dans la page Ressources comme "Promus" pour l'assignation de classe `,ve.to,"."]}),n.jsx("div",{className:"ps-promote-buttons",children:n.jsx("button",{className:"ps-btn success",onClick:Te,disabled:_,children:_?" En cours...":` Promouvoir ${A.size>0?`(${A.size})`:"ligibles"}`})}),n.jsx("div",{style:{marginTop:12},children:n.jsx("button",{className:"ps-btn danger",onClick:de,disabled:_,children:_?" En cours...":` Annuler promotion ${A.size>0?`(${A.size})`:"promus"}`})})]}),n.jsxs("div",{className:"ps-action-section",children:[n.jsx("h4",{children:" Export PDF"}),n.jsx("p",{style:{fontSize:13,color:"#64748b",margin:"0 0 16px"},children:"Exporter les carnets en PDF (sans les blocs de signature)."}),n.jsx("div",{className:"ps-export-buttons",children:n.jsx("button",{className:"ps-btn primary",onClick:qe,disabled:_,children:_?" Export...":` Exporter ${A.size>0?`(${A.size})`:"tous"}`})})]})]})]}),D&&n.jsxs("div",{className:`ps-toast ${D.type}`,children:[D.type==="success"?"":""," ",D.message]})]})}function Cse(){const[e,t]=p.useState([]),[r,s]=p.useState(""),[i,a]=p.useState([]),[o,l]=p.useState([]),[c,u]=p.useState([]),[d,f]=p.useState(""),[h,m]=p.useState(""),[g,x]=p.useState(""),[y,v]=p.useState([]),[S,k]=p.useState(0),[j,_]=p.useState(!1),[b,A]=p.useState("");p.useEffect(()=>{K.get("/templates").then(w=>t(w.data)),K.get("/school-years").then(w=>{a(w.data);const N=w.data.find($=>$.active);N&&f(N._id)}),K.get("/levels").then(w=>l(w.data)),K.get("/classes").then(w=>u(w.data))},[]),p.useEffect(()=>{if(!r){v([]),A(""),k(0);return}_(!0);const w={};d&&(w.yearId=d),h&&(w.level=h),g&&(w.classId=g),K.get(`/analytics/skills/${r}`,{params:w}).then(N=>{v(N.data.stats),A(N.data.templateName),k(N.data.totalAssigned||0)}).catch(N=>console.error(N)).finally(()=>_(!1))},[r,d,h,g]);const z=(w,N)=>{if(w.allowedLanguages&&!w.allowedLanguages.includes(N))return n.jsx("td",{style:{padding:"12px 16px",textAlign:"center",background:`repeating-linear-gradient(
                        45deg,
                        #fff1f2,
                        #fff1f2 10px,
                        #ffe4e6 10px,
                        #ffe4e6 20px
                    )`,borderLeft:"1px solid #ffe4e6",borderRight:"1px solid #ffe4e6"}});const $=w.languages[N]||0,E=$>0;return n.jsx("td",{style:{padding:"12px 16px",textAlign:"center",color:E?"#16a34a":"#cbd5e1",fontWeight:E?600:400},children:E?$:"-"})},D=c.filter(w=>!(d&&w.schoolYearId!==d||h&&w.level!==h));return n.jsxs("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[n.jsx(rr,{to:"/admin",style:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",background:"#fff",border:"1px solid #ddd",color:"#666"},children:n.jsx(tD,{size:20})}),n.jsxs("div",{children:[n.jsxs("h1",{style:{fontSize:24,fontWeight:"bold",margin:0,display:"flex",alignItems:"center",gap:12},children:[n.jsx(Gv,{size:28,color:"#2563eb"}),"Analyse des Comptences"]}),n.jsx("p",{style:{margin:"4px 0 0",color:"#666"},children:"Suivi dtaill de l'acquisition des comptences par template"})]})]}),n.jsx("div",{className:"card",style:{padding:20,marginBottom:24,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:n.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",alignItems:"flex-end"},children:[n.jsxs("div",{style:{flex:2,minWidth:300},children:[n.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:14,color:"#475569"},children:"Modle (Template)"}),n.jsxs("select",{value:r,onChange:w=>s(w.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14},children:[n.jsx("option",{value:"",children:"-- Choisir un modle --"}),e.map(w=>n.jsx("option",{value:w._id,children:w.name},w._id))]})]}),n.jsxs("div",{style:{flex:1,minWidth:140},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8,fontWeight:500,fontSize:14,color:"#475569"},children:[n.jsx(Yl,{size:14})," Anne"]}),n.jsxs("select",{value:d,onChange:w=>f(w.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14},children:[n.jsx("option",{value:"",children:"Toutes"}),i.map(w=>n.jsx("option",{value:w._id,children:w.name},w._id))]})]}),n.jsxs("div",{style:{flex:1,minWidth:140},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8,fontWeight:500,fontSize:14,color:"#475569"},children:[n.jsx(Kl,{size:14})," Niveau"]}),n.jsxs("select",{value:h,onChange:w=>{m(w.target.value),x("")},style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14},children:[n.jsx("option",{value:"",children:"Tous"}),o.map(w=>n.jsx("option",{value:w.name,children:w.name},w._id))]})]}),n.jsxs("div",{style:{flex:1,minWidth:140},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8,fontWeight:500,fontSize:14,color:"#475569"},children:[n.jsx(Ts,{size:14})," Classe"]}),n.jsxs("select",{value:g,onChange:w=>x(w.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",fontSize:14},children:[n.jsx("option",{value:"",children:"Toutes"}),D.map(w=>n.jsx("option",{value:w._id,children:w.name},w._id))]})]})]})}),j&&n.jsx("div",{style:{textAlign:"center",padding:40,color:"#666"},children:"Chargement..."}),!j&&r&&y.length===0&&n.jsx("div",{style:{textAlign:"center",padding:40,color:"#666",background:"#f8f9fa",borderRadius:12},children:"Aucune donne de comptence trouve pour ce modle."}),!j&&y.length>0&&n.jsxs("div",{className:"card",style:{background:"#fff",borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid #eee",background:"#f8f9fa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("h3",{style:{margin:0,fontSize:16},children:[b," - ",y.length," Comptences suivies"]}),n.jsxs("div",{style:{fontSize:14,color:"#64748b"},children:["Total lves: ",n.jsx("strong",{children:S})]})]}),n.jsx("div",{style:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f1f5f9",color:"#475569"},children:[n.jsx("th",{style:{textAlign:"left",padding:"12px 24px",fontWeight:600},children:"Comptence"}),n.jsx("th",{style:{textAlign:"center",padding:"12px 16px",fontWeight:600,width:120},children:"Acquis / Total"}),n.jsx("th",{style:{textAlign:"center",padding:"12px 16px",fontWeight:600,width:100},children:"FR "}),n.jsx("th",{style:{textAlign:"center",padding:"12px 16px",fontWeight:600,width:100},children:"EN "}),n.jsx("th",{style:{textAlign:"center",padding:"12px 16px",fontWeight:600,width:100},children:"AR "})]})}),n.jsx("tbody",{children:y.map((w,N)=>n.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",background:N%2===0?"#fff":"#fcfcfc"},children:[n.jsx("td",{style:{padding:"12px 24px",color:"#1e293b"},children:w.skillText}),n.jsx("td",{style:{padding:"12px 16px",textAlign:"center"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:6},children:[n.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:w.totalStudents>0?"#eff6ff":"#f1f5f9",color:w.totalStudents>0?"#2563eb":"#94a3b8",fontWeight:600,borderRadius:20,padding:"4px 12px",minWidth:40},children:w.totalStudents}),n.jsxs("span",{style:{color:"#94a3b8",fontSize:12},children:["/ ",S]})]})}),z(w,"fr"),z(w,"en"),z(w,"ar")]},N))})]})})]})]})}function Oy(){const e=Sn(),r=wn().pathname.includes("/aefe/"),[s,i]=p.useState(!1),[a,o]=p.useState(!1),[l,c]=p.useState(""),[u,d]=p.useState(null),[f,h]=p.useState(""),[m,g]=p.useState(null),[x,y]=p.useState(1),[v,S]=p.useState(!0);p.useEffect(()=>{(async()=>{var A;try{const z=await K.get("/school-years/active");(A=z.data)!=null&&A.activeSemester&&y(z.data.activeSemester)}catch{}finally{S(!1)}})()},[]);const k=[{id:"semester_switch",icon:n.jsx(hb,{size:24}),title:"Passage au Semestre 2",description:"Demander l'ouverture de la saisie pour la deuxime priode de l'anne scolaire.",gradient:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",borderColor:"#3b82f6",bgColor:"#eff6ff",iconBg:"#3b82f6",apiType:"semester_request",originalText:"Passage Semestre 2",suggestedText:"Demande de passage au Semestre 2."},{id:"next_year_request",icon:n.jsx(Yl,{size:24}),title:"Passage  l'Anne Suivante",description:"Demander la transition vers la prochaine anne scolaire et la promotion des lves.",gradient:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",borderColor:"#8b5cf6",bgColor:"#f5f3ff",iconBg:"#8b5cf6",apiType:"next_year_request",originalText:"Passage Anne Suivante",suggestedText:"Demande de passage  l'anne scolaire suivante."}],j=k.find(b=>b.id===u),_=async b=>{var A,z;if(b.preventDefault(),!j){c("Veuillez slectionner un type de demande.");return}try{i(!0),c("");let D=j.suggestedText;f&&(D+=`

Note: ${f}`),await K.post("/suggestions",{type:j.apiType,originalText:j.originalText,suggestedText:D}),o(!0),h(""),d(null)}catch(D){const w=((z=(A=D.response)==null?void 0:A.data)==null?void 0:z.message)||D.message;c("Erreur lors de l'envoi de la demande: "+w)}finally{i(!1)}};return v?n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:300},children:[n.jsx("div",{style:{width:48,height:48,border:"3px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),n.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); }}"})]})}):a?n.jsx("div",{className:"container",children:n.jsxs("div",{className:"card",style:{textAlign:"center",padding:"80px 40px"},children:[n.jsx("div",{style:{width:100,height:100,background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 32px",boxShadow:"0 20px 40px -12px rgba(34, 197, 94, 0.35)",animation:"pulse 2s ease-in-out infinite"},children:n.jsx(fb,{size:48,color:"white"})}),n.jsx("h2",{style:{fontSize:32,color:"#1e293b",marginBottom:16,fontWeight:700},children:"Demande envoye avec succs !"}),n.jsx("p",{style:{color:"#64748b",fontSize:17,maxWidth:500,margin:"0 auto 40px",lineHeight:1.7},children:"Votre demande a t transmise  l'administration. Vous recevrez une notification une fois qu'elle aura t traite."}),n.jsxs("div",{style:{display:"flex",gap:16,justifyContent:"center",flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e(r?"/aefe/dashboard":"/subadmin/dashboard"),style:{padding:"14px 28px",borderRadius:12,fontSize:15},children:"Retour au tableau de bord"}),n.jsxs("button",{className:"btn primary",onClick:()=>o(!1),style:{padding:"14px 28px",borderRadius:12,fontSize:15,background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none"},children:[n.jsx(tP,{size:18,style:{marginRight:8}}),"Nouvelle demande"]})]}),n.jsx("style",{children:`
                        @keyframes pulse {
                            0%, 100% { transform: scale(1); }
                            50% { transform: scale(1.05); }
                        }
                    `})]})}):n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"card",style:{padding:"40px 48px",borderRadius:20,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 10px 15px -3px rgba(0, 0, 0, 0.05)",overflow:"hidden",position:"relative"},children:[n.jsxs("button",{className:"btn suggest-carnets-btn",onClick:()=>e(r?"/aefe/suggestion/gradebooks":"/subadmin/suggestion/gradebooks"),style:{position:"absolute",top:24,right:24,zIndex:10,padding:"14px 24px",borderRadius:14,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%)",border:"none",color:"white",display:"flex",alignItems:"center",gap:12,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",boxShadow:"0 8px 24px -6px rgba(139, 92, 246, 0.5), 0 0 0 0 rgba(139, 92, 246, 0.4)",fontWeight:700,fontSize:15},onMouseEnter:b=>{b.currentTarget.style.transform="translateY(-2px) scale(1.02)",b.currentTarget.style.boxShadow="0 12px 32px -6px rgba(139, 92, 246, 0.6), 0 0 20px rgba(139, 92, 246, 0.3)"},onMouseLeave:b=>{b.currentTarget.style.transform="translateY(0) scale(1)",b.currentTarget.style.boxShadow="0 8px 24px -6px rgba(139, 92, 246, 0.5), 0 0 0 0 rgba(139, 92, 246, 0.4)"},children:[n.jsx("div",{style:{width:32,height:32,background:"rgba(255, 255, 255, 0.2)",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(yp,{size:18,color:"white"})}),n.jsx("span",{children:"Suggrer modifications carnets"}),n.jsx(pb,{size:18,color:"rgba(255,255,255,0.9)"})]}),n.jsx("div",{style:{position:"absolute",top:-100,right:-100,width:300,height:300,background:"radial-gradient(circle, rgba(59, 130, 246, 0.08) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none"}}),n.jsxs("div",{style:{marginBottom:40,position:"relative"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:16,maxWidth:"calc(100% - 320px)"},children:[n.jsx("div",{style:{width:56,height:56,background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",borderRadius:16,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 20px -4px rgba(59, 130, 246, 0.4)",flexShrink:0},children:n.jsx(F2,{size:26,color:"white"})}),n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:32,color:"#1e293b",fontWeight:800,margin:0,letterSpacing:"-0.02em"},children:"Demandes Administratives"}),n.jsx("p",{style:{fontSize:15,color:"#64748b",margin:"4px 0 0 0"},children:"Communiquez avec l'administration pour les changements de priode"})]})]}),n.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,padding:"10px 16px",background:x===1?"#fef3c7":"#dcfce7",borderRadius:10,marginTop:8},children:[n.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:x===1?"#f59e0b":"#22c55e"}}),n.jsxs("span",{style:{fontSize:13,fontWeight:600,color:x===1?"#92400e":"#166534"},children:["Priode actuelle: Semestre ",x]})]})]}),n.jsxs("form",{onSubmit:_,children:[n.jsxs("div",{style:{marginBottom:32},children:[n.jsx("label",{style:{display:"block",fontSize:14,fontWeight:700,color:"#334155",marginBottom:16,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Type de demande"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:16},children:k.map(b=>{const A=u===b.id,z=m===b.id,D=b.id==="semester_switch"&&x!==1;return n.jsxs("div",{onClick:()=>!D&&d(b.id),onMouseEnter:()=>!D&&g(b.id),onMouseLeave:()=>g(null),style:{padding:"24px",border:`2px solid ${A?b.borderColor:z?"#cbd5e1":"#e2e8f0"}`,borderRadius:16,background:A?b.bgColor:"white",cursor:D?"not-allowed":"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:A||z?"translateY(-2px)":"translateY(0)",boxShadow:A?`0 12px 24px -8px ${b.borderColor}40`:z?"0 8px 16px -4px rgba(0, 0, 0, 0.1)":"none",opacity:D?.5:1,position:"relative",overflow:"hidden"},children:[A&&n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:4,background:b.gradient}}),n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:16},children:[n.jsx("div",{style:{width:52,height:52,background:A?b.gradient:"#f1f5f9",borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center",color:A?"white":"#64748b",transition:"all 0.3s ease",flexShrink:0},children:b.icon}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontWeight:700,color:"#1e293b",marginBottom:6,fontSize:16},children:b.title}),n.jsx("div",{style:{fontSize:14,color:"#64748b",lineHeight:1.5},children:b.description}),D&&n.jsx("div",{style:{marginTop:10,padding:"6px 10px",background:"#fef3c7",borderRadius:6,fontSize:12,color:"#92400e",display:"inline-block"},children:"Dj au Semestre 2"})]}),n.jsx("div",{style:{width:24,height:24,borderRadius:"50%",border:`2px solid ${A?b.borderColor:"#d1d5db"}`,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},children:A&&n.jsx("div",{style:{width:12,height:12,background:b.gradient,borderRadius:"50%"}})})]})]},b.id)})})]}),n.jsxs("div",{style:{marginBottom:28},children:[n.jsxs("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"#475569",marginBottom:10},children:["Message ou commentaire ",n.jsx("span",{style:{color:"#94a3b8",fontWeight:400},children:"(optionnel)"})]}),n.jsx("textarea",{value:f,onChange:b=>h(b.target.value),placeholder:"Ajoutez des prcisions si ncessaire...",style:{width:"100%",minHeight:120,padding:16,borderRadius:14,border:"2px solid #e2e8f0",fontSize:15,resize:"vertical",outline:"none",transition:"all 0.2s ease",fontFamily:"inherit",lineHeight:1.6},onFocus:b=>{b.target.style.borderColor="#3b82f6",b.target.style.boxShadow="0 0 0 4px rgba(59, 130, 246, 0.1)"},onBlur:b=>{b.target.style.borderColor="#e2e8f0",b.target.style.boxShadow="none"}})]}),l&&n.jsxs("div",{style:{padding:16,background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"1px solid #fecaca",borderRadius:12,color:"#dc2626",fontSize:14,display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[n.jsx("div",{style:{width:36,height:36,background:"#fee2e2",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:n.jsx(Lo,{size:20})}),n.jsx("span",{style:{fontWeight:500},children:l})]}),n.jsx("button",{type:"submit",className:"btn primary",disabled:s||!u,style:{width:"100%",padding:"18px",fontSize:16,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",gap:12,borderRadius:14,background:u?(j==null?void 0:j.gradient)||"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"#e2e8f0",border:"none",color:u?"white":"#94a3b8",cursor:!u||s?"not-allowed":"pointer",transition:"all 0.3s ease",boxShadow:u?"0 8px 20px -4px rgba(59, 130, 246, 0.4)":"none"},children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{width:20,height:20,border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Envoi en cours..."]}):n.jsxs(n.Fragment,{children:[n.jsx(F2,{size:20}),"Envoyer la demande",n.jsx(Tc,{size:18})]})})]}),n.jsx("div",{style:{marginTop:40,padding:28,background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",borderRadius:16,border:"1px solid #e2e8f0"},children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:16},children:[n.jsx("div",{style:{width:44,height:44,background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:n.jsx(Lo,{size:22,color:"white"})}),n.jsxs("div",{children:[n.jsx("h4",{style:{fontSize:16,color:"#1e293b",marginBottom:8,fontWeight:700},children:"Informations importantes"}),n.jsxs("ul",{style:{fontSize:14,color:"#64748b",lineHeight:1.8,margin:0,paddingLeft:18},children:[n.jsx("li",{children:"Les demandes sont traites par l'administration centrale"}),n.jsx("li",{children:"Assurez-vous que tous les carnets sont complets avant de demander un changement de priode"})]})]})]})})]}),n.jsx("style",{children:`
                @keyframes spin { to { transform: rotate(360deg); }}
            `})]})}const _se=800,Ase=1120;function E_(){const e=wn(),t=Sn(),r=e.pathname.includes("/aefe/"),[s,i]=p.useState([]),[a,o]=p.useState(!1),[l,c]=p.useState(""),[u,d]=p.useState(""),f=p.useMemo(()=>s.find(j=>String(j._id)===String(u))||null,[s,u]),[h,m]=p.useState(null),g=(j,_="info")=>m({message:j,type:_}),[x,y]=p.useState(null),[v,S]=p.useState("");p.useEffect(()=>{(async()=>{try{o(!0),c("");const _=await K.get("/templates"),b=Array.isArray(_.data)?_.data:[];i(b)}catch(_){c("Impossible de charger les templates"),console.error(_)}finally{o(!1)}})()},[]);const k=async()=>{if(!(!x||!f))try{await K.post("/suggestions",{type:"template_edit",templateId:f._id,templateVersion:f.currentVersion,pageIndex:x.pageIndex,blockIndex:x.blockIndex,blockId:x.blockId,originalText:x.originalText,suggestedText:v}),g("Suggestion envoye !","success"),y(null),S("")}catch(j){g("Erreur lors de l'envoi","error"),console.error(j)}};return n.jsxs("div",{className:"container",children:[h&&n.jsx(ca,{message:h.message,type:h.type,onClose:()=>m(null)}),n.jsxs(pd,{isOpen:!!x,onClose:()=>y(null),title:"Suggrer une modification",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn secondary",onClick:()=>y(null),children:"Annuler"}),n.jsx("button",{className:"btn",onClick:k,children:"Envoyer"})]}),children:[n.jsxs("div",{style:{marginBottom:12},children:[n.jsx("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:"Texte original"}),n.jsx("div",{style:{padding:8,background:"#f1f5f9",borderRadius:4,fontSize:14,whiteSpace:"pre-wrap"},children:x==null?void 0:x.originalText})]}),n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:"Suggestion"}),n.jsx("textarea",{value:v,onChange:j=>S(j.target.value),style:{width:"100%",height:120,padding:8,borderRadius:4,border:"1px solid #ccc"},placeholder:"Entrez votre suggestion...",autoFocus:!0})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:n.jsxs("div",{children:[n.jsx("button",{onClick:()=>t(r?"/aefe/suggestion":"/subadmin/suggestion"),style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 14px",background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:8,color:"#475569",fontSize:13,fontWeight:500,cursor:"pointer",marginBottom:16,transition:"all 0.2s"},onMouseEnter:j=>{j.currentTarget.style.background="#e2e8f0"},onMouseLeave:j=>{j.currentTarget.style.background="#f1f5f9"},children:" Retour aux demandes"}),n.jsx("h2",{className:"title",style:{fontSize:28,marginBottom:6,color:"#1e293b"},children:"Modifications des Carnets"}),n.jsxs("div",{className:"note",style:{fontSize:14,color:"#64748b"},children:[r?"RPP / Direction":"Sous-admin","  suggrez des modifications sur les carnets (templates)."]})]})}),n.jsx("div",{style:{marginTop:18,display:"grid",gridTemplateColumns:"1fr",gap:12,maxWidth:640},children:n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",marginBottom:6,fontSize:13,fontWeight:600,color:"#475569"},children:"Template (carnet)"}),n.jsxs("select",{className:"filter-select",value:u,onChange:j=>d(j.target.value),style:{width:"100%"},disabled:a,children:[n.jsx("option",{value:"",children:"Slectionner un template..."}),s.map(j=>n.jsx("option",{value:j._id,children:j.name},j._id))]}),l&&n.jsx("div",{className:"note",style:{color:"#dc2626",marginTop:8},children:l}),a&&n.jsx("div",{className:"note",style:{marginTop:8},children:"Chargement..."})]})}),f&&n.jsxs("div",{style:{marginTop:22},children:[n.jsxs("div",{style:{marginBottom:12,padding:12,borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc"},children:[n.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:f.name}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Cliquez sur  pour proposer une modification de texte/options."})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24,alignItems:"center"},children:f.pages.filter(j=>!j.excludeFromPdf).map((j,_)=>n.jsx("div",{className:"card page-canvas",style:{height:Ase,width:_se,background:j.bgColor||"#fff",overflow:"hidden",position:"relative"},children:j.blocks.map((b,A)=>{var w,N,$,E,q;if(!b||!b.props)return null;const z=typeof b.props.blockId=="string"&&b.props.blockId.trim()?b.props.blockId.trim():void 0,D=L=>{y({pageIndex:_,blockIndex:A,blockId:z,originalText:L,isOpen:!0}),S("")};if(b.type==="text"||b.type==="dynamic_text"){const L=(()=>{var O,B,I;return Array.isArray((O=b.props)==null?void 0:O.runs)&&b.props.runs.length?b.props.runs.map(T=>String((T==null?void 0:T.text)||"")).join(""):((B=b.props)==null?void 0:B.text)??((I=b.props)==null?void 0:I.content)??""})();return n.jsx("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:n.jsxs("div",{style:{position:"relative"},children:[n.jsx("div",{style:{color:b.props.color,fontSize:b.props.fontSize,whiteSpace:"pre-wrap"},children:L}),n.jsx("div",{onClick:O=>{O.stopPropagation(),D(String(L||""))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]})},A)}if(b.type==="dropdown"||b.type==="dropdown_reference"){const L=Array.isArray(b.props.options)?b.props.options:[];return n.jsx("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:n.jsxs("div",{style:{width:b.props.width||200,position:"relative"},children:[n.jsxs("div",{style:{fontSize:10,fontWeight:"bold",color:"#6c5ce7",marginBottom:2},children:["Dropdown #",b.props.dropdownNumber||"?"]}),b.props.label&&n.jsx("div",{style:{fontSize:10,color:"#666",marginBottom:2},children:b.props.label}),n.jsx("div",{style:{width:"100%",minHeight:b.props.height||32,fontSize:b.props.fontSize||12,color:b.props.color||"#333",padding:"4px 8px",borderRadius:4,border:"1px solid #ccc",background:"#f9f9f9",cursor:"default",whiteSpace:"pre-wrap"},children:"Slectionner..."}),n.jsx("div",{onClick:O=>{O.stopPropagation(),D(L.join(`
`))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification des options",children:""})]})},A)}if(b.type==="image"&&((w=b.props)!=null&&w.url))return n.jsx("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:n.jsxs("div",{style:{position:"relative",width:b.props.width||160,height:b.props.height||"auto",background:"#fafafa",border:"1px solid #eee",padding:6},children:[n.jsx("img",{src:b.props.url,alt:b.props.alt||"image",style:{maxWidth:"100%",maxHeight:"100%",display:"block"}}),n.jsx("div",{onClick:L=>{L.stopPropagation(),D(String(b.props.url||""))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification (URL)",children:""})]})},A);if(["rect","circle","line","arrow","qr"].includes(b.type))return n.jsxs("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:[n.jsx("div",{style:{width:b.props.width||80,height:b.props.height||40,background:"#fff",border:"1px dashed #cbd5e1",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:12},children:b.type.toUpperCase()}),n.jsx("div",{onClick:L=>{L.stopPropagation(),D(JSON.stringify(b.props||{}))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]},A);if(b.type==="table"){const L=Array.isArray(b.props.rows)?b.props.rows:b.props.data||[];return n.jsx("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:n.jsxs("div",{style:{background:"#fff",border:"1px solid #eee",padding:6,maxWidth:420,overflow:"auto"},children:[n.jsx("table",{style:{borderCollapse:"collapse",width:"100%"},children:n.jsx("tbody",{children:L.map((O,B)=>n.jsx("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:Array.isArray(O)?O.map((I,T)=>n.jsx("td",{style:{padding:6,fontSize:12},children:String(I)},T)):n.jsx("td",{style:{padding:6},children:String(O)})},B))})}),n.jsx("div",{onClick:O=>{O.stopPropagation(),D(JSON.stringify(b.props||{}))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]})},A)}if(b.type==="student_info"||b.type==="category_title"||b.type==="competency_list"||b.type==="promotion_info"){const L=((N=b.props)==null?void 0:N.title)||(($=b.props)==null?void 0:$.label)||((E=b.props)==null?void 0:E.category)||b.type;return n.jsxs("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:[n.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:L}),n.jsx("div",{onClick:O=>{var B;O.stopPropagation(),D(String(((B=b.props)==null?void 0:B.content)||L||""))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]},A)}if(b.type==="signature"||b.type==="signature_box")return n.jsxs("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:[n.jsx("div",{style:{width:b.props.width||180,height:b.props.height||60,border:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8"},children:((q=b.props)==null?void 0:q.label)||"Signature"}),n.jsx("div",{onClick:L=>{var O;L.stopPropagation(),D(String(((O=b.props)==null?void 0:O.label)||""))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]},A);if(b.type==="language_toggle"||b.type==="language_toggle_v2"){const L=Array.isArray(b.props.items)?b.props.items:[];return n.jsxs("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:[n.jsx("div",{style:{display:"flex",gap:6},children:L.map((O,B)=>n.jsx("div",{style:{padding:"6px 10px",background:"#f1f5f9",borderRadius:8,fontSize:12},children:O.label||O},B))}),n.jsx("div",{onClick:O=>{O.stopPropagation(),D(JSON.stringify(b.props||{}))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]},A)}return n.jsxs("div",{style:{position:"absolute",left:b.props.x||0,top:b.props.y||0,zIndex:b.props.z??A,padding:6},children:[n.jsxs("div",{style:{background:"#fff",border:"1px solid #eee",padding:8,maxWidth:420,fontSize:12,color:"#334155"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:6},children:b.type}),n.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0},children:JSON.stringify(b.props||{},null,2)})]}),n.jsx("div",{onClick:L=>{L.stopPropagation(),D(JSON.stringify(b.props||{}))},style:{position:"absolute",top:-10,right:-10,background:"#f59e0b",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:12,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Suggrer une modification",children:""})]},A)})},_))})]})]})]})}const Ese=e=>{if(!isFinite(e)||e<=0)return"0m";const t=Math.floor(e),r=Math.floor(t/86400),s=Math.floor(t%86400/3600),i=Math.floor(t%3600/60);return r>0?`${r}j ${s}h`:s>0?`${s}h ${i}m`:`${i}m`},Pse=e=>{if(!isFinite(e)||e<=0)return"0 B";const t=["B","KB","MB","GB","TB"];let r=e,s=0;for(;r>=1024&&s<t.length-1;)r/=1024,s++;return`${r.toFixed(s===0?0:1)} ${t[s]}`},Ise=e=>!e||!isFinite(e)?"":e<1e3?`${Math.round(e)}ms`:`${(e/1e3).toFixed(2)}s`,eu=e=>{var o,l,c,u,d;const t=(o=e==null?void 0:e.response)==null?void 0:o.status,r=(c=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:c.error,s=(d=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:d.message,i=e==null?void 0:e.message,a=[typeof t=="number"?`HTTP ${t}`:null,r?String(r):null,s?String(s):null,i?String(i):null].filter(Boolean);if(a.length)return a.join(" - ");try{return JSON.stringify(e)}catch{return String(e)}},Tse=({mode:e,setMode:t,running:r,results:s,summary:i,lastRunLabel:a,onRun:o,onReset:l})=>n.jsxs("div",{className:"server-tests-section",children:[n.jsxs("div",{className:"server-tests-header",children:[n.jsxs("div",{className:"header-title",children:[n.jsx("h2",{children:"Tests Automatiques (Client/API)"}),n.jsx("p",{children:"Vrifications de sant du systme, API, stockage navigateur et connectivit."})]}),n.jsx("div",{className:"header-actions",children:r?n.jsx("span",{className:"badge running",children:"En cours..."}):i.total>0?i.failed>0?n.jsxs("span",{className:"badge fail",children:["chec (",i.failed,")"]}):n.jsxs("span",{className:"badge success",children:["Succs (",i.passed,")"]}):n.jsx("span",{className:"badge idle",children:"Prt"})})]}),n.jsxs("div",{className:"diag-content-wrapper",children:[n.jsxs("div",{className:"diag-toolbar",children:[n.jsxs("div",{className:"diag-modes",children:[n.jsx("button",{className:`btn ${e==="core"?"primary":"secondary"} small`,onClick:()=>t("core"),disabled:r,children:"Essentiel"}),n.jsx("button",{className:`btn ${e==="extended"?"primary":"secondary"} small`,onClick:()=>t("extended"),disabled:r,children:"Complet"})]}),n.jsxs("div",{className:"diag-controls",children:[n.jsx("span",{className:"diag-last-run",children:a}),n.jsx("button",{className:"btn secondary small",onClick:l,disabled:r,children:"Rinitialiser"}),n.jsx("button",{className:"btn primary small",onClick:o,disabled:r,children:r?"...":"Lancer"})]})]}),n.jsx("div",{className:"diag-grid",children:s.length===0?n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("h3",{children:"Aucun diagnostic lanc"}),n.jsx("p",{children:`Slectionnez un mode et cliquez sur "Lancer" pour vrifier l'tat du systme.`})]}):n.jsx("div",{className:"diag-results-list",children:s.map(c=>n.jsxs("div",{className:`diag-result-card ${c.status}`,children:[n.jsxs("div",{className:"diag-card-status",children:[c.status==="running"&&n.jsx("div",{className:"spinner small"}),c.status==="pass"&&n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"20 6 9 17 4 12"})}),c.status==="fail"&&n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),c.status==="idle"&&n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("circle",{cx:"12",cy:"12",r:"10"})})]}),n.jsxs("div",{className:"diag-card-content",children:[n.jsxs("div",{className:"diag-card-header",children:[n.jsx("span",{className:"diag-card-title",children:c.name}),c.durationMs!==void 0&&n.jsx("span",{className:"diag-card-time",children:Ise(c.durationMs)})]}),n.jsx("div",{className:"diag-card-message",title:c.detail||c.message,children:c.message||"En attente..."})]})]},c.id))})})]})]});function Rse(){var Pe,Z;const e=Sn(),t=Od(),[r,s]=p.useState(!0),[i,a]=p.useState(null),[o,l]=p.useState([]),[c,u]=p.useState(null),[d,f]=p.useState(null),[h,m]=p.useState([]),[g,x]=p.useState(null),[y,v]=p.useState("core"),[S,k]=p.useState(!1),[j,_]=p.useState([]),[b,A]=p.useState(""),[z,D]=p.useState([]),[w,N]=p.useState([]),[$,E]=p.useState(""),[q,L]=p.useState(!1),[O,B]=p.useState(null),[I,T]=p.useState({}),W=p.useCallback(async()=>{s(!0);const ne=await Promise.allSettled([K.get("/settings/status"),K.get("/admin-extras/online-users"),K.get("/audit-logs/stats"),K.get("/analytics"),K.get("/backup/list"),K.get("/admin-extras/alert")]),[ee,te,G,H,ie,me]=ne;ee.status==="fulfilled"&&a(ee.value.data),te.status==="fulfilled"&&l(te.value.data||[]),G.status==="fulfilled"&&u(G.value.data),H.status==="fulfilled"&&f(H.value.data),ie.status==="fulfilled"&&m(ie.value.data||[]),me.status==="fulfilled"&&x(me.value.data||null),s(!1)},[]);p.useEffect(()=>{W()},[e,W]);const re=p.useCallback(ne=>{const ee=[{id:"browser-storage",name:"Navigateur: stockage local/session",run:async()=>{const te=`diag_${Date.now()}`;try{localStorage.setItem(te,"1");const G=localStorage.getItem(te);if(localStorage.removeItem(te),G!=="1")throw new Error("localStorage_read_mismatch")}catch(G){throw new Error(`localStorage_failed - ${eu(G)}`)}try{sessionStorage.setItem(te,"1");const G=sessionStorage.getItem(te);if(sessionStorage.removeItem(te),G!=="1")throw new Error("sessionStorage_read_mismatch")}catch(G){throw new Error(`sessionStorage_failed - ${eu(G)}`)}return{message:"OK"}}},{id:"settings-public",name:"API: /settings/public",run:async()=>{const G=(await K.get("/settings/public")).data;if(!(G&&typeof G=="object"))throw new Error("invalid_response_shape");return{message:"OK"}}},{id:"settings-status",name:"API: /settings/status (auth admin)",run:async()=>{const G=(await K.get("/settings/status")).data;if(!G||typeof G!="object")throw new Error("invalid_response_shape");if(G.backend!=="online")throw new Error(`backend_not_online - ${String(G.backend)}`);if(typeof G.database!="string")throw new Error("database_missing");if(typeof G.uptime!="number")throw new Error("uptime_missing");return{message:`${G.backend}  ${G.database}`}}},{id:"admin-online-users",name:"API: /admin-extras/online-users",run:async()=>{const te=await K.get("/admin-extras/online-users");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} en ligne`}}},{id:"audit-stats",name:"API: /audit-logs/stats",run:async()=>{const G=(await K.get("/audit-logs/stats")).data;if(!G||typeof G!="object")throw new Error("invalid_response_shape");if(typeof G.totalLogs!="number")throw new Error("missing_totalLogs");if(typeof G.recentLogs!="number")throw new Error("missing_recentLogs");if(!Array.isArray(G.actionCounts))throw new Error("missing_actionCounts");return{message:`${G.recentLogs} (24h)`}}},{id:"analytics",name:"API: /analytics",run:async()=>{var ke,Be,Te;const G=(await K.get("/analytics")).data;if(!G||typeof G!="object")throw new Error("invalid_response_shape");const H=(ke=G==null?void 0:G.counts)==null?void 0:ke.users,ie=(Be=G==null?void 0:G.counts)==null?void 0:Be.classes,me=(Te=G==null?void 0:G.counts)==null?void 0:Te.students;if(typeof H!="number"||typeof ie!="number"||typeof me!="number")throw new Error("missing_counts");return{message:`${H} users  ${ie} classes  ${me} lves`}}},{id:"backup-list",name:"API: /backup/list",run:async()=>{const te=await K.get("/backup/list");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} sauvegardes`}}},{id:"media-list",name:"API: /media/list",run:async()=>{const te=await K.get("/media/list");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} lments`}}},{id:"socket",name:"Socket: connexion temps-rel",run:async()=>{if(!t)throw new Error("socket_not_initialized");return t.connected?{message:"connect"}:(await new Promise((te,G)=>{let H=!1;const ie=Te=>{H||(H=!0,Te())},me=window.setTimeout(()=>{ie(()=>{t.off("connect",ke),t.off("connect_error",Be),G(new Error("socket_connect_timeout"))})},4e3),ke=()=>{ie(()=>{window.clearTimeout(me),t.off("connect_error",Be),te()})},Be=Te=>{ie(()=>{window.clearTimeout(me),t.off("connect",ke),G(new Error(eu(Te)))})};t.once("connect",ke),t.once("connect_error",Be)}),{message:"connect"})}}];return ne==="extended"&&ee.push({id:"levels",name:"API: /levels",run:async()=>{const te=await K.get("/levels");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} niveaux`}}},{id:"school-years",name:"API: /school-years",run:async()=>{const te=await K.get("/school-years");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} annes`}}},{id:"users",name:"API: /users",run:async()=>{const te=await K.get("/users");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} utilisateurs`}}},{id:"classes",name:"API: /classes",run:async()=>{const te=await K.get("/classes");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} classes`}}},{id:"students",name:"API: /students",run:async()=>{const te=await K.get("/students");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} lves`}}},{id:"templates",name:"API: /templates",run:async()=>{const te=await K.get("/templates");if(!Array.isArray(te.data))throw new Error("expected_array");return{message:`${te.data.length} templates`}}},{id:"bulk-assign-level",name:"Promotion: assignation en masse (bulk-level create/delete)",run:async()=>{var ke,Be;const G=(await K.get("/levels")).data;if(!Array.isArray(G)||G.length===0)throw new Error("no_levels");const H=G[0].name||G[0]._id,ie=await K.post("/templates",{name:`diag-template-${Date.now()}`,pages:[]}),me=((ke=ie.data)==null?void 0:ke._id)||((Be=ie.data)==null?void 0:Be.id);if(!me)throw new Error("template_create_failed");try{const Te=await K.post("/template-assignments/bulk-level",{templateId:me,level:H}),qe=Te.data&&typeof Te.data.count=="number"?Te.data.count:0;return await K.delete(`/template-assignments/bulk-level/${me}/${encodeURIComponent(H)}`),{message:`assigned ${qe} then removed`}}finally{try{await K.delete(`/templates/${me}`)}catch{}}}},{id:"signatures-admin",name:"Signatures: create/activate/delete admin signature",run:async()=>{var H,ie;const te=await K.post("/signatures/admin",{name:`diag-sig-${Date.now()}`,dataUrl:"data:image/png;base64,AAA"}),G=((H=te.data)==null?void 0:H._id)||((ie=te.data)==null?void 0:ie.id);if(!G)throw new Error("signature_create_failed");return await K.post(`/signatures/admin/${G}/activate`,{}),await K.delete(`/signatures/admin/${G}`),{message:"created/activated/deleted"}}},{id:"admin-sign-nonexistent",name:"Sign: admin sign non-existent assignment returns 404",run:async()=>{var te;try{throw await K.post("/admin-extras/templates/000000000000000000000000/sign"),new Error("expected_404")}catch(G){if(((te=G==null?void 0:G.response)==null?void 0:te.status)===404)return{message:"404 as expected"};throw G}}},{id:"subadmin-signature-endpoint",name:"SubAdmin signature endpoint",run:async()=>{var te,G,H,ie;try{const me=await K.get("/subadmin/signature");return Array.isArray(me.data)?{message:`${me.data.length} signatures`}:{message:"ok"}}catch(me){if(((te=me==null?void 0:me.response)==null?void 0:te.status)===403)return{message:"forbidden for admin"};if(((G=me==null?void 0:me.response)==null?void 0:G.status)===404&&((ie=(H=me==null?void 0:me.response)==null?void 0:H.data)==null?void 0:ie.error)==="no_signature")return{message:"no_signature"};throw me}}},{id:"levels-coverage",name:"Levels coverage (classes per level)",run:async()=>{const te=await K.get("/levels"),G=Array.isArray(te.data)?te.data:[];if(G.length===0)throw new Error("no_levels");const H=await K.get("/school-years"),ie=Array.isArray(H.data)?H.data:[],me=ie.find(qe=>qe.active)||ie[0];if(!me)throw new Error("no_school_years");const ke=await K.get(`/classes?schoolYearId=${String(me._id)}`),Be=Array.isArray(ke.data)?ke.data:[];return{message:G.map(qe=>{const Qe=Be.filter(Ze=>String(Ze.level||"").toUpperCase()===String(qe.name||"").toUpperCase());return`${qe.name}:${Qe.length}`}).join(", ")}}},{id:"impersonate-subadmin",name:"Impersonate SUBADMIN and check endpoints",run:async()=>{var Be,Te;const te=await K.get("/users"),H=(Array.isArray(te.data)?te.data:[]).find(qe=>qe.role==="SUBADMIN"||qe.role==="AEFE");if(!H)throw new Error("no_subadmin_user");const ie=sessionStorage.getItem("token")||localStorage.getItem("token")||"",ke=(Be=(await K.post("/impersonation/start",{targetUserId:H._id||H.id})).data)==null?void 0:Be.token;if(!ke)throw new Error("impersonation_failed");sessionStorage.setItem("token",ke);try{const qe=await K.get("/subadmin/promoted-students"),Qe=await K.get("/subadmin/classes");return{message:`promoted:${(qe.data||[]).length} classes:${(Qe.data||[]).length}`}}finally{try{const Qe=(Te=(await K.post("/impersonation/stop")).data)==null?void 0:Te.token;Qe?sessionStorage.setItem("token",Qe):ie&&(localStorage.getItem("token")?localStorage.setItem("token",ie):sessionStorage.setItem("token",ie))}catch{ie?localStorage.getItem("token")?localStorage.setItem("token",ie):sessionStorage.setItem("token",ie):sessionStorage.removeItem("token")}}}},{id:"impersonate-teacher",name:"Impersonate TEACHER and check endpoints",run:async()=>{var Be,Te;const te=await K.get("/users"),H=(Array.isArray(te.data)?te.data:[]).find(qe=>qe.role==="TEACHER");if(!H)throw new Error("no_teacher_user");const ie=sessionStorage.getItem("token")||localStorage.getItem("token")||"",ke=(Be=(await K.post("/impersonation/start",{targetUserId:H._id||H.id})).data)==null?void 0:Be.token;if(!ke)throw new Error("impersonation_failed");sessionStorage.setItem("token",ke);try{const qe=await K.get("/teacher/classes"),Qe=Array.isArray(qe.data)?qe.data:[];if(Qe.length===0)return{message:"no_classes"};const Ze=Qe[0]._id||Qe[0].id,ge=await K.get(`/teacher/classes/${Ze}/assignments`),Ae=Array.isArray(ge.data)?ge.data:[];return{message:`classes:${Qe.length} assignments:${Ae.length}`}}finally{try{const Qe=(Te=(await K.post("/impersonation/stop")).data)==null?void 0:Te.token;Qe?sessionStorage.setItem("token",Qe):ie&&(localStorage.getItem("token")?localStorage.setItem("token",ie):sessionStorage.setItem("token",ie))}catch{ie?localStorage.getItem("token")?localStorage.setItem("token",ie):sessionStorage.setItem("token",ie):sessionStorage.removeItem("token")}}}},{id:"subadmin-promote-protected",name:"SubAdmin promote endpoint protection",run:async()=>{var Qe,Ze,ge,Ae,Le;const te=await K.get("/users"),H=(Array.isArray(te.data)?te.data:[]).find(Q=>Q.role==="SUBADMIN"||Q.role==="AEFE");if(!H)throw new Error("no_subadmin_user");const ie=await K.get("/template-assignments"),me=Array.isArray(ie.data)?ie.data:[];if(me.length===0)return{message:"no_assignments"};const ke=me[0]._id||me[0].id,Be=sessionStorage.getItem("token")||localStorage.getItem("token")||"",qe=(Qe=(await K.post("/impersonation/start",{targetUserId:H._id||H.id})).data)==null?void 0:Qe.token;if(!qe)throw new Error("impersonation_failed");sessionStorage.setItem("token",qe);try{try{return await K.post(`/subadmin/templates/${ke}/promote`,{nextLevel:"TEST"}),{message:"promote_succeeded"}}catch(Q){const be=(Ze=Q==null?void 0:Q.response)==null?void 0:Ze.status,we=((Ae=(ge=Q==null?void 0:Q.response)==null?void 0:ge.data)==null?void 0:Ae.error)||(Q==null?void 0:Q.message);if(be===403||be===400)return{message:`protected:${String(we)}`};throw Q}}finally{try{const be=(Le=(await K.post("/impersonation/stop")).data)==null?void 0:Le.token;be?sessionStorage.setItem("token",be):Be&&(localStorage.getItem("token")?localStorage.setItem("token",Be):sessionStorage.setItem("token",Be))}catch{Be?localStorage.getItem("token")?localStorage.setItem("token",Be):sessionStorage.setItem("token",Be):sessionStorage.removeItem("token")}}}}),ee},[t]),ae=p.useMemo(()=>{const ne=j.length,ee=j.filter(H=>H.status==="pass").length,te=j.filter(H=>H.status==="fail").length,G=j.filter(H=>H.status==="running").length;return{total:ne,passed:ee,failed:te,running:G}},[j]),Y=p.useMemo(()=>{if(!b)return"Jamais excut";const ne=new Date(b);return Number.isNaN(ne.getTime())?"Dernire excution: ":`Dernire excution: ${ne.toLocaleString()}`},[b]),J=p.useCallback(()=>{const ne=re(y);_(ne.map(ee=>({id:ee.id,name:ee.name,status:"idle"}))),A(""),k(!1)},[re,y]),P=p.useCallback(async()=>{var ne;try{const ee=await K.get("/admin-extras/run-tests/list"),te=Array.isArray((ne=ee.data)==null?void 0:ne.tests)?ee.data.tests:[];D(te),N(G=>(G||[]).filter(H=>te.includes(H)))}catch(ee){console.error("failed to fetch server tests list",ee)}},[]);p.useEffect(()=>{P()},[P]);const ce=p.useMemo(()=>{const ne=$.trim().toLowerCase();return ne?z.filter(ee=>ee.toLowerCase().includes(ne)):z},[z,$]),pe=p.useCallback(ne=>{N(ee=>ee.includes(ne)?ee.filter(te=>te!==ne):[...ee,ne])},[]),ye=p.useMemo(()=>ce.length>0&&ce.every(ne=>w.includes(ne)),[ce,w]),se=p.useCallback(()=>{N(ne=>ye?ne.filter(ee=>!ce.includes(ee)):Array.from(new Set([...ne||[],...ce])))},[ce,ye]),je=p.useCallback(ne=>{T(ee=>({...ee,[ne]:!ee[ne]}))},[]),ve=p.useCallback(ne=>{var ee;try{(ee=navigator.clipboard)==null||ee.writeText(ne)}catch{}},[]),le=p.useCallback(async()=>{var ne;L(!0),B(null);try{const ee={};w&&w.length>0&&(ee.patterns=w);const te=await K.post("/admin-extras/run-tests",ee);B(te.data)}catch(ee){(ne=ee==null?void 0:ee.response)!=null&&ne.data?B(ee.response.data):B({error:eu(ee)})}finally{L(!1),P()}},[w,P]);p.useEffect(()=>{J()},[J]);const oe=p.useCallback(async()=>{const ne=re(y);k(!0),A(new Date().toISOString()),_(ne.map(ee=>({id:ee.id,name:ee.name,status:"running"})));for(const ee of ne){const te=performance.now();try{const G=await ee.run(),H=performance.now()-te;_(ie=>ie.map(me=>me.id===ee.id?{...me,status:"pass",durationMs:H,message:G&&G.message?String(G.message):"OK",detail:G&&G.detail?String(G.detail):void 0}:me))}catch(G){const H=performance.now()-te,ie=eu(G);_(me=>me.map(ke=>ke.id===ee.id?{...ke,status:"fail",durationMs:H,message:ie,detail:ie}:ke))}}k(!1)},[re,y]),de=p.useMemo(()=>{var Le,Q,be,we,Ne,V,fe,Oe,Fe;const ne=(i==null?void 0:i.backend)==="online",ee=(i==null?void 0:i.database)||"unknown",te=ee==="connected",G=(i==null?void 0:i.uptime)??0,H=(Q=(Le=c==null?void 0:c.actionCounts)==null?void 0:Le[0])==null?void 0:Q._id,ie=(we=(be=c==null?void 0:c.actionCounts)==null?void 0:be[0])==null?void 0:we.count,me=h==null?void 0:h[0],ke=(h==null?void 0:h.length)??0,Be=(Ne=d==null?void 0:d.counts)==null?void 0:Ne.users,Te=(V=d==null?void 0:d.counts)==null?void 0:V.classes,qe=(fe=d==null?void 0:d.counts)==null?void 0:fe.students,Qe=o.length,Ze=o.map(Ve=>new Date(Ve.lastActive).getTime()).filter(Ve=>Number.isFinite(Ve)).sort((Ve,tt)=>tt-Ve)[0],ge=(Fe=(Oe=import.meta)==null?void 0:Oe.env)==null?void 0:Fe.VITE_APP_VERSION,Ae=ge?`Version ${ge}`:`Client ${new Date().toLocaleDateString()}`;return[{title:"Statut Systme",status:ne&&te?"OK":ne?"Dgrad":"Hors ligne",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Backend"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:ne?"#16a34a":"#dc2626"},children:ne?"Online":"Offline"})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Base"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:te?"#16a34a":"#d97706"},children:ee})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Uptime"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:Ese(G)})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Client"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:Ae})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/settings"),style:{padding:"6px 12px",fontSize:14},children:"Paramtres"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Disponibilit",progress:ne&&te?100:ne?60:0,icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M20 7h-9"}),n.jsx("path",{d:"M14 17H5"}),n.jsx("circle",{cx:"17",cy:"17",r:"3"}),n.jsx("circle",{cx:"7",cy:"7",r:"3"})]}),color:ne&&te?"#22c55e":ne?"#f59e0b":"#ef4444"},{title:"Utilisateurs Actifs",status:Qe>0?`${Qe}`:"0",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Priode"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:"5 minutes"})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Dernier ping"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:Ze?new Date(Ze).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/online-users"),style:{padding:"6px 12px",fontSize:14},children:"Voir dtails"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Activit",progress:Math.min(100,Qe>0?100:20),icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),n.jsx("path",{d:"M20 8v6"}),n.jsx("path",{d:"M23 11h-6"})]}),color:"#3b82f6"},{title:"Audit & Traabilit",status:c?"Actif":"Indisponible",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Total logs"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:c?c.totalLogs.toLocaleString():""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"24h"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:c?c.recentLogs.toLocaleString():""})]}),n.jsxs("div",{style:{gridColumn:"1 / -1"},children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Action principale"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:H?`${H} (${ie})`:""})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/audit-logs"),style:{padding:"6px 12px",fontSize:14},children:"Ouvrir journal"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Traabilit",progress:c?100:0,icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),n.jsx("polyline",{points:"14 2 14 8 20 8"}),n.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),n.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),color:"#8b5cf6"},{title:"Statistiques Globales",status:d?"OK":"Indisponible",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Utilisateurs"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:typeof Be=="number"?Be.toLocaleString():""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Classes"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:typeof Te=="number"?Te.toLocaleString():""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"lves"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:typeof qe=="number"?qe.toLocaleString():""})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/analytics"),style:{padding:"6px 12px",fontSize:14},children:"Voir analytics"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Donnes",progress:d?100:0,icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),n.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),n.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),color:"#f59e0b"},{title:"Sauvegardes",status:ke>0?`${ke}`:"0",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Dernire"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:me!=null&&me.date?new Date(me.date).toLocaleString():""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Taille"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#0f172a"},children:typeof(me==null?void 0:me.size)=="number"?Pse(me.size):""})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/settings"),style:{padding:"6px 12px",fontSize:14},children:"Grer backups"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Rsilience",progress:ke>0?100:0,icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n.jsx("polyline",{points:"7 10 12 15 17 10"}),n.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),color:"#06b6d4"},{title:"Alerte Systme",status:g!=null&&g.message?"Active":"Aucune",description:n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{marginBottom:16},children:[n.jsx("div",{style:{fontSize:12,color:"#94a3b8",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Message"}),n.jsx("div",{style:{fontSize:14,fontWeight:600,color:g!=null&&g.message?"#c2410c":"#0f172a"},children:g!=null&&g.message?g.message:""}),(g==null?void 0:g.expiresAt)&&n.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#64748b"},children:["Expire: ",new Date(g.expiresAt).toLocaleString()]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/online-users"),style:{padding:"6px 12px",fontSize:14},children:"Grer alertes"}),n.jsx("button",{className:"btn secondary",onClick:W,style:{padding:"6px 12px",fontSize:14},children:"Actualiser"})]})]}),footerLabel:"Communication",progress:g!=null&&g.message?100:0,icon:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),n.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),n.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),color:"#fb7185"}]},[g,d,c,h,Y,y,j,S,ae.failed,ae.passed,ae.total,o,J,oe,i,$,w,q,O,z]);return n.jsxs("div",{className:"monitoring-page",children:[n.jsxs("div",{className:"monitoring-header",children:[n.jsxs("button",{className:"back-btn",onClick:()=>e("/admin/settings"),children:[n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),n.jsx("polyline",{points:"12 19 5 12 12 5"})]}),"Retour aux Paramtres"]}),n.jsx("h1",{className:"monitoring-title",children:"tat de la Surveillance & Diagnostics"}),n.jsx("p",{className:"monitoring-subtitle",children:"Vue densemble des indicateurs cls (statut, activit, audit, sauvegardes)."})]}),n.jsx("div",{className:"monitoring-grid",children:de.map((ne,ee)=>n.jsxs("div",{className:"monitoring-card",style:{"--accent-color":ne.color},children:[n.jsx("div",{className:"card-icon",children:ne.icon}),n.jsxs("div",{className:"card-content",children:[n.jsxs("div",{className:"card-header",children:[n.jsx("h3",{children:ne.title}),n.jsx("span",{className:"status-badge",children:ne.status})]}),n.jsx("div",{className:"card-description",children:ne.description}),n.jsxs("div",{className:"card-footer",children:[n.jsx("span",{className:"priority-tag",children:ne.footerLabel}),n.jsx("div",{className:"progress-bar",children:n.jsx("div",{className:"progress-fill",style:{width:`${ne.progress}%`}})})]})]})]},ee))}),n.jsx(Tse,{mode:y,setMode:v,running:S,results:j,summary:ae,lastRunLabel:Y,onRun:oe,onReset:J}),n.jsxs("div",{className:"server-tests-section",children:[n.jsxs("div",{className:"server-tests-header",children:[n.jsxs("div",{className:"header-title",children:[n.jsx("h2",{children:"Tests Serveur (Jest)"}),n.jsx("p",{children:"Excuter les tests d'intgration et unitaires ct serveur."})]}),n.jsx("div",{className:"header-actions",children:q?n.jsx("span",{className:"badge running",children:"Tests en cours..."}):O?((Pe=O.results)==null?void 0:Pe.numFailedTests)>0?n.jsxs("span",{className:"badge fail",children:["chec (",O.results.numFailedTests,")"]}):n.jsx("span",{className:"badge success",children:"Succs"}):n.jsx("span",{className:"badge idle",children:"Prt"})})]}),n.jsxs("div",{className:"server-tests-container",children:[n.jsxs("div",{className:"tests-sidebar",children:[n.jsx("div",{className:"sidebar-search",children:n.jsx("input",{type:"text",placeholder:"Filtrer les tests...",value:$,onChange:ne=>E(ne.target.value)})}),n.jsxs("div",{className:"sidebar-actions",children:[n.jsx("button",{className:"btn primary small",onClick:le,disabled:q,children:q?"...":"Lancer"}),n.jsx("button",{className:"btn secondary small",onClick:P,disabled:q,children:""})]}),n.jsxs("div",{className:"tests-list",children:[n.jsx("div",{className:"list-header",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:ye,onChange:se}),n.jsxs("span",{children:["Tout (",ce.length,")"]})]})}),ce.map(ne=>n.jsxs("label",{className:`test-item ${w.includes(ne)?"selected":""}`,children:[n.jsx("input",{type:"checkbox",checked:w.includes(ne),onChange:()=>pe(ne)}),n.jsx("span",{className:"test-name",title:ne,children:ne.split("/").pop()})]},ne))]})]}),n.jsxs("div",{className:"tests-content",children:[!O&&!q&&n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-icon",children:""}),n.jsx("h3",{children:"Aucun rsultat"}),n.jsx("p",{children:'Slectionnez des tests dans la colonne de gauche et cliquez sur "Lancer".'})]}),q&&n.jsxs("div",{className:"loading-state",children:[n.jsx("div",{className:"spinner"}),n.jsx("p",{children:"Excution des tests en cours..."})]}),O&&n.jsxs("div",{className:"results-view",children:[O.results&&n.jsxs("div",{className:"results-stats",children:[n.jsxs("div",{className:"stat-item success",children:[n.jsx("span",{className:"stat-value",children:O.results.numTotalTests-O.results.numFailedTests}),n.jsx("span",{className:"stat-label",children:"Passs"})]}),n.jsxs("div",{className:"stat-item fail",children:[n.jsx("span",{className:"stat-value",children:O.results.numFailedTests}),n.jsx("span",{className:"stat-label",children:"chous"})]}),n.jsxs("div",{className:"stat-item",children:[n.jsx("span",{className:"stat-value",children:O.results.numTotalTestSuites}),n.jsx("span",{className:"stat-label",children:"Suites"})]}),n.jsxs("div",{className:"stat-item",children:[n.jsx("span",{className:"stat-value",children:O.results.startTime?new Date(O.results.startTime).toLocaleTimeString():"-"}),n.jsx("span",{className:"stat-label",children:"Dmarr"})]})]}),O.error&&n.jsx("div",{className:"error-banner",children:String(O.error)}),O.stdout&&n.jsxs("div",{className:"console-output",children:[n.jsx("h4",{children:"Console Output"}),n.jsx("pre",{children:O.stdout})]}),((Z=O.results)==null?void 0:Z.testResults)&&n.jsx("div",{className:"suites-list",children:O.results.testResults.map(ne=>{var G;const ee=(ne.assertionResults||[]).filter(H=>H.status==="failed").length,te=!!I[ne.name];return n.jsxs("div",{className:`suite-card ${ee>0?"suite-fail":"suite-pass"}`,children:[n.jsxs("div",{className:"suite-header",onClick:()=>je(ne.name),children:[n.jsx("div",{className:`status-icon ${ee>0?"fail":"pass"}`,children:ee>0?"":""}),n.jsxs("div",{className:"suite-info",children:[n.jsx("div",{className:"suite-name",children:ne.name.split("/").pop()}),n.jsx("div",{className:"suite-path",children:ne.name})]}),n.jsxs("div",{className:"suite-meta",children:[(G=ne.assertionResults)==null?void 0:G.length," tests"]})]}),te&&n.jsx("div",{className:"suite-body",children:ne.assertionResults.map((H,ie)=>n.jsxs("div",{className:`assertion-row ${H.status}`,children:[n.jsx("div",{className:"assertion-status",children:H.status==="failed"?"":""}),n.jsxs("div",{className:"assertion-content",children:[n.jsx("div",{className:"assertion-title",children:H.title}),H.status==="failed"&&n.jsxs("div",{className:"assertion-error",children:[n.jsx("pre",{children:(H.failureMessages||[]).join(`
`)}),n.jsx("button",{className:"copy-btn btn secondary",onClick:()=>ve((H.failureMessages||[]).join(`

`)),children:"Copier"})]})]})]},ie))})]},ne.name)})})]})]})]})]}),n.jsxs("div",{className:"monitoring-footer-info",children:[n.jsx("div",{className:"info-icon",children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]})}),n.jsxs("div",{className:"info-text",children:[n.jsx("h3",{children:"Instantan"}),n.jsx("p",{children:r?"Chargement des indicateurs":"Les indicateurs sont mis  jour  la demande via Actualiser."})]})]})]})}function Ose(){const[e,t]=p.useState(null),s=wn().pathname.startsWith("/admin");return p.useEffect(()=>{if(!localStorage.getItem("token"))return;const a=async()=>{try{const l=await K.get("/admin-extras/alert");l.data&&l.data.message?t(l.data):t(null)}catch{}};a();const o=setInterval(a,3e4);return()=>clearInterval(o)},[]),e?s?n.jsxs("div",{style:{background:"#fff7ed",borderBottom:"1px solid #fdba74",padding:"8px 16px",textAlign:"center",color:"#c2410c"},children:[n.jsx("strong",{children:"Alerte Active:"})," ",e.message]}):n.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsxs("div",{style:{background:"white",padding:32,borderRadius:12,maxWidth:500,textAlign:"center"},children:[n.jsx("h2",{style:{color:"#dc2626",marginTop:0},children:" Alerte Systme"}),n.jsx("p",{style:{fontSize:18},children:e.message})]})}):null}function zse(){const[e,t]=p.useState(""),[r,s]=p.useState(!0),[i,a]=p.useState(null),[o,l]=p.useState(!1),[c,u]=p.useState(!1),d=String((i==null?void 0:i.baseUrl)||"https://localhost:4001"),f=p.useMemo(()=>{const oe=qr.create({baseURL:d});return oe.interceptors.request.use(de=>{const Pe=sessionStorage.getItem("token")||localStorage.getItem("token");return Pe&&(de.headers.Authorization=`Bearer ${Pe}`),de}),oe},[d]),[h,m]=p.useState([]),[g,x]=p.useState(""),[y,v]=p.useState(30),[S,k]=p.useState(5),[j,_]=p.useState(120),[b,A]=p.useState(500),[z,D]=p.useState(10),[w,N]=p.useState(!1),[$,E]=p.useState(!1),[q,L]=p.useState(null),[O,B]=p.useState(null),[I,T]=p.useState([]),[W,re]=p.useState("live"),[ae,Y]=p.useState(Date.now()),J=p.useMemo(()=>h.find(oe=>String(oe==null?void 0:oe._id)===String(g))||null,[h,g]);p.useEffect(()=>{try{const de=new URLSearchParams(window.location.search||"").get("token");de&&!sessionStorage.getItem("token")&&sessionStorage.setItem("token",de)}catch{}},[]),p.useEffect(()=>{const oe=setInterval(()=>Y(Date.now()),1e3);return()=>clearInterval(oe)},[]),p.useEffect(()=>{(async()=>(await Promise.all([P(),ye(),se(),je()]),s(!1)))()},[]),p.useEffect(()=>{if(!(q!=null&&q._id))return;const oe=setInterval(()=>{se().catch(()=>{})},2e3);return()=>clearInterval(oe)},[q==null?void 0:q._id]),p.useEffect(()=>{if(!e)return;const oe=setTimeout(()=>t(""),3500);return()=>clearTimeout(oe)},[e]);const P=async()=>{var oe;try{const de=await K.get("/simulations/sandbox/status");a(((oe=de.data)==null?void 0:oe.sandboxServer)||null)}catch{a(null)}},ce=async()=>{var oe,de;l(!0);try{const Pe=await K.post("/simulations/sandbox/start");a(((oe=Pe.data)==null?void 0:oe.sandboxServer)||null),t("Sandbox dmarr"),await se(),await je()}catch(Pe){const Z=(de=Pe==null?void 0:Pe.response)==null?void 0:de.data;console.error("sandbox start failed",Z||Pe),Z!=null&&Z.sandboxServer&&a(Z.sandboxServer),t("Erreur dmarrage sandbox: "+String((Z==null?void 0:Z.message)||(Pe==null?void 0:Pe.message)||"unknown")),await P().catch(()=>{})}finally{l(!1)}},pe=async()=>{var oe,de,Pe;u(!0);try{const Z=await K.post("/simulations/sandbox/stop");a(((oe=Z.data)==null?void 0:oe.sandboxServer)||null),t("Sandbox arrt"),await se(),await je()}catch(Z){t("Erreur arrt sandbox: "+(((Pe=(de=Z==null?void 0:Z.response)==null?void 0:de.data)==null?void 0:Pe.message)||(Z==null?void 0:Z.message)||"unknown"))}finally{u(!1)}},ye=async()=>{var oe;try{const de=await K.get("/templates"),Pe=Array.isArray(de.data)?de.data:[];m(Pe),!g&&Pe.length>0&&x(String(((oe=Pe[0])==null?void 0:oe._id)||""))}catch{m([])}},se=async()=>{var oe,de;try{const Pe=await f.get("/simulations/status");L(((oe=Pe.data)==null?void 0:oe.running)||null),B(((de=Pe.data)==null?void 0:de.live)||null)}catch{L(null),B(null)}},je=async()=>{var oe;try{const de=await f.get("/simulations/history");T(Array.isArray((oe=de.data)==null?void 0:oe.runs)?de.data.runs:[])}catch{T([])}},ve=async()=>{var oe,de;if(!(i!=null&&i.running)){t("Dmarre le serveur sandbox avant la simulation");return}if(!J){t("Slectionne un template");return}N(!0);try{await f.post("/simulations/start",{teachers:y,subAdmins:S,durationSec:j,thinkTimeMs:b,rampUpUsersPerSec:z,scenario:"mixed",template:J}),t("Simulation dmarre"),await se(),await je()}catch(Pe){t("Erreur dmarrage simulation: "+(((de=(oe=Pe==null?void 0:Pe.response)==null?void 0:oe.data)==null?void 0:de.message)||(Pe==null?void 0:Pe.message)||"unknown"))}finally{N(!1)}},le=async()=>{var oe,de;E(!0);try{await f.post("/simulations/stop",{runId:q==null?void 0:q._id}),t("Simulation arrte"),await se(),await je()}catch(Pe){t("Erreur arrt simulation: "+(((de=(oe=Pe==null?void 0:Pe.response)==null?void 0:oe.data)==null?void 0:de.message)||(Pe==null?void 0:Pe.message)||"unknown"))}finally{E(!1)}};return r?n.jsx("div",{className:"simulation-lab-container",children:n.jsxs("div",{className:"simulation-header",children:[n.jsx("h1",{className:"simulation-title",children:"Simulation Lab"}),n.jsx("p",{className:"simulation-subtitle",children:"Chargement"})]})}):n.jsx(Lse,{msg:e,sandboxServer:i,sandboxStarting:o,sandboxStopping:c,templateId:g,setTemplateId:x,templates:h,teachers:y,setTeachers:v,subAdmins:S,setSubAdmins:k,durationSec:j,setDurationSec:_,thinkTimeMs:b,setThinkTimeMs:A,rampUpUsersPerSec:z,setRampUpUsersPerSec:D,running:q,simStarting:w,simStopping:$,startSandbox:ce,stopSandbox:pe,loadSandboxServer:P,loadTemplates:ye,loadStatus:se,loadHistory:je,startSimulation:ve,stopSimulation:le,live:O,history:I,tab:W,setTab:re,now:ae})}function Lse({msg:e,sandboxServer:t,sandboxStarting:r,sandboxStopping:s,templateId:i,setTemplateId:a,templates:o,teachers:l,setTeachers:c,subAdmins:u,setSubAdmins:d,durationSec:f,setDurationSec:h,thinkTimeMs:m,setThinkTimeMs:g,rampUpUsersPerSec:x,setRampUpUsersPerSec:y,running:v,simStarting:S,simStopping:k,startSandbox:j,stopSandbox:_,loadSandboxServer:b,loadTemplates:A,loadStatus:z,loadHistory:D,startSimulation:w,stopSimulation:N,live:$,history:E,tab:q,setTab:L,now:O}){var pe,ye,se,je,ve,le;const B=($==null?void 0:$.lastMetrics)||(v==null?void 0:v.lastMetrics)||null,I=Array.isArray($==null?void 0:$.recentActions)?$.recentActions:Array.isArray(v==null?void 0:v.recentActions)?v.recentActions:[],T=I.slice(-80).reverse(),W=v;(pe=E==null?void 0:E[0])!=null&&pe.summary;const re=$!=null&&$.startedAt?(O-new Date($.startedAt).getTime())/1e3:0,ae=re>1&&($!=null&&$.totalActions)?$.totalActions/re:0,Y=$!=null&&$.totalActions?$.errorActions/$.totalActions:0,J=p.useMemo(()=>I.map(oe=>({time:new Date(oe.at).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),ms:oe.ms,ok:oe.ok})).slice(-100),[I]),P=oe=>{const de=Number(oe);return Number.isFinite(de)?de.toLocaleString():"-"},ce=oe=>{const de=Number(oe);return Number.isFinite(de)?`${de}ms`:"-"};return n.jsxs("div",{className:"simulation-lab-container",children:[n.jsx("div",{className:"simulation-header",children:n.jsxs("div",{className:"simulation-title-row",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"simulation-title",children:"Simulation Lab"}),n.jsx("p",{className:"simulation-subtitle",children:"Contrle du sandbox (DB isole) + excution/diagnostics."})]}),n.jsxs("div",{className:"simulation-status-badges",children:[n.jsxs("span",{className:`status-badge ${t!=null&&t.running?"running":"stopped"}`,children:["Sandbox: ",n.jsx("strong",{children:t!=null&&t.running?"RUNNING":"STOPPED"})]}),n.jsxs("span",{className:`status-badge ${v?"running":"idle"}`,children:["Simulation: ",n.jsx("strong",{children:v?"RUNNING":"IDLE"})]}),v!=null&&v._id?n.jsxs("span",{className:"status-badge info",children:["Run: ",n.jsx("strong",{children:String(v._id).slice(-8)})]}):null]})]})}),e&&n.jsx("div",{className:"toast-message",children:n.jsx("span",{children:e})}),n.jsxs("div",{className:"simulation-grid",children:[n.jsx("div",{className:"control-column",children:n.jsxs("div",{className:"simulation-card",children:[n.jsx("div",{className:"card-header",children:n.jsx("h2",{className:"card-title",children:"Contrle"})}),n.jsxs("div",{className:"control-item",children:[n.jsx("h3",{children:"Sandbox Server"}),n.jsx("p",{children:"Dmarre un serveur spar (port 4001) + DB isole."}),n.jsxs("div",{style:{display:"grid",gap:8},children:[n.jsxs("div",{style:{fontSize:12,color:"#475569"},children:["BaseUrl: ",n.jsx("strong",{children:(t==null?void 0:t.baseUrl)||"-"})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[t!=null&&t.running?n.jsx("button",{className:"btn",onClick:_,disabled:s,children:s?"Arrt":"Arrter sandbox"}):n.jsx("button",{className:"btn",onClick:j,disabled:r,children:r?"Dmarrage":"Dmarrer sandbox"}),n.jsx("button",{className:"btn",onClick:b,children:" Statut"})]}),t!=null&&t.lastError?n.jsxs("div",{style:{fontSize:12,color:"#b91c1c"},children:["Erreur: ",String(t.lastError)]}):null]})]}),n.jsxs("div",{className:"control-item",children:[n.jsx("h3",{children:"Template"}),n.jsx("p",{children:"Le template sera copi dans le sandbox avant la simulation."}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("select",{className:"select-field",value:i,onChange:oe=>a(oe.target.value),disabled:!!v,children:o.map(oe=>n.jsx("option",{value:String(oe._id),children:oe.name},String(oe._id)))}),n.jsx("button",{className:"btn",onClick:A,disabled:!!v,children:""})]})]}),n.jsxs("div",{className:"control-item",children:[n.jsx("h3",{children:"Charge"}),n.jsx("p",{children:"Concurrence + dure + performance."}),n.jsxs("div",{style:{width:"100%",display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[n.jsxs("label",{style:{fontSize:12,color:"#334155"},children:["Teachers",n.jsx("input",{type:"number",className:"input-field",value:l,onChange:oe=>c(Number(oe.target.value)),style:{marginTop:6},disabled:!!v})]}),n.jsxs("label",{style:{fontSize:12,color:"#334155"},children:["SubAdmins",n.jsx("input",{type:"number",className:"input-field",value:u,onChange:oe=>d(Number(oe.target.value)),style:{marginTop:6},disabled:!!v})]}),n.jsxs("label",{style:{fontSize:12,color:"#334155"},children:["Think Time (ms)",n.jsx("input",{type:"number",className:"input-field",value:m,onChange:oe=>g(Number(oe.target.value)),style:{marginTop:6},disabled:!!v})]}),n.jsxs("label",{style:{fontSize:12,color:"#334155"},children:["Ramp-up (users/s)",n.jsx("input",{type:"number",className:"input-field",value:x,onChange:oe=>y(Number(oe.target.value)),style:{marginTop:6},disabled:!!v})]}),n.jsxs("label",{style:{fontSize:12,color:"#334155",gridColumn:"1 / -1"},children:["Duration (sec)",n.jsx("input",{type:"number",className:"input-field",value:f,onChange:oe=>h(Number(oe.target.value)),style:{marginTop:6},disabled:!!v})]})]})]}),n.jsxs("div",{className:"control-item",children:[n.jsx("h3",{children:"Simulation"}),n.jsx("p",{children:"Dmarrer / arrter."}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[v?n.jsx("button",{className:"btn danger",onClick:N,disabled:k,children:k?"Arrt":"Arrter"}):n.jsx("button",{className:"btn primary",onClick:w,disabled:S||!(t!=null&&t.running)||!i,children:S?"Dmarrage":"Dmarrer"}),n.jsx("button",{className:"btn",onClick:async()=>{await z(),await D()},children:" Actualiser"})]})]})]})}),n.jsx("div",{className:"dashboard-column",children:n.jsxs("div",{className:"simulation-card",children:[n.jsxs("div",{className:"card-header",children:[n.jsx("h2",{className:"card-title",children:"Dashboard"}),n.jsxs("div",{className:"tab-group",children:[n.jsx("button",{className:`tab-btn ${q==="live"?"active":""}`,onClick:()=>L("live"),children:"Live"}),n.jsx("button",{className:`tab-btn ${q==="history"?"active":""}`,onClick:()=>L("history"),children:"History"}),n.jsx("button",{className:`tab-btn ${q==="raw"?"active":""}`,onClick:()=>L("raw"),children:"Raw"})]})]}),n.jsxs("div",{className:"metrics-grid",children:[n.jsxs("div",{className:"metric-card",children:[n.jsx("div",{className:"metric-label",children:"Total Actions"}),n.jsx("div",{className:"metric-value",children:P(($==null?void 0:$.totalActions)??0)}),n.jsxs("div",{style:{fontSize:11,color:"#64748b"},children:[P(($==null?void 0:$.errorActions)??0)," errors"]})]}),n.jsxs("div",{className:"metric-card",children:[n.jsx("div",{className:"metric-label",children:"RPS (avg)"}),n.jsx("div",{className:"metric-value",style:{color:"#2563eb"},children:ae.toFixed(1)}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"req/sec"})]}),n.jsxs("div",{className:"metric-card",children:[n.jsx("div",{className:"metric-label",children:"In-flight"}),n.jsx("div",{className:"metric-value",children:P(($==null?void 0:$.inFlight)??((ye=B==null?void 0:B.activeUsers)==null?void 0:ye.inFlight)??0)}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Active requests"})]}),n.jsxs("div",{className:"metric-card",children:[n.jsx("div",{className:"metric-label",children:"Error Rate"}),n.jsxs("div",{className:"metric-value",style:{color:Y>.05?"#dc2626":"#059669"},children:[(Y*100).toFixed(1),"%"]})]}),n.jsxs("div",{className:"metric-card",children:[n.jsx("div",{className:"metric-label",children:"Active Users"}),n.jsx("div",{className:"metric-value",children:P((($==null?void 0:$.activeTeacherUsers)||0)+(($==null?void 0:$.activeSubAdminUsers)||0))}),n.jsx("div",{style:{fontSize:11,color:"#64748b"},children:"Teachers + Admins"})]})]}),J.length>0&&n.jsxs("div",{style:{height:200,marginBottom:20,background:"#fff",padding:10,borderRadius:12,border:"1px solid #e2e8f0"},children:[n.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#64748b",marginBottom:10},children:"Response Time (ms) - Live"}),n.jsx(Gl,{width:"100%",height:"100%",children:n.jsxs(ore,{data:J,children:[n.jsx(qp,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),n.jsx(Gp,{dataKey:"time",hide:!0}),n.jsx(Xp,{stroke:"#94a3b8",fontSize:10,tickFormatter:oe=>`${oe}ms`}),n.jsx(ud,{contentStyle:{borderRadius:8,border:"none",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1)"},labelStyle:{color:"#64748b",fontSize:11}}),n.jsx(x8,{type:"monotone",dataKey:"ms",stroke:"#3b82f6",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})]}),q==="live"?n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[n.jsxs("div",{className:"data-table-container",children:[n.jsxs("div",{className:"data-table-header",children:[n.jsx("span",{children:"Actions rcentes"}),n.jsxs("span",{style:{color:"#64748b"},children:[T.length," items"]})]}),n.jsx("div",{style:{maxHeight:420,overflow:"auto"},children:n.jsxs("table",{className:"data-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Action"}),n.jsx("th",{style:{textAlign:"right"},children:"ms"}),n.jsx("th",{style:{textAlign:"right"},children:"HTTP"})]})}),n.jsx("tbody",{children:T.map((oe,de)=>n.jsxs("tr",{children:[n.jsxs("td",{children:[n.jsx("span",{style:{color:oe.ok?"#047857":"#b91c1c",fontWeight:600},children:oe.name}),oe.error?n.jsx("div",{style:{color:"#64748b",fontSize:11,marginTop:2},children:String(oe.error).slice(0,120)}):null]}),n.jsx("td",{style:{textAlign:"right",color:"#0f172a"},children:P(oe.ms)}),n.jsx("td",{style:{textAlign:"right",color:"#64748b"},children:oe.status??"-"})]},de))})]})})]}),n.jsxs("div",{className:"data-table-container",children:[n.jsx("div",{className:"data-table-header",children:n.jsx("span",{children:"System / Metrics"})}),n.jsxs("div",{style:{padding:10,maxHeight:420,overflow:"auto"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[n.jsxs("div",{className:"metric-card",style:{background:"#f8fafc",boxShadow:"none"},children:[n.jsx("div",{className:"metric-label",children:"RSS"}),n.jsx("div",{className:"metric-value",style:{fontSize:"1.25rem"},children:P((se=B==null?void 0:B.system)==null?void 0:se.memoryRss)})]}),n.jsxs("div",{className:"metric-card",style:{background:"#f8fafc",boxShadow:"none"},children:[n.jsx("div",{className:"metric-label",children:"Heap Used"}),n.jsx("div",{className:"metric-value",style:{fontSize:"1.25rem"},children:P((je=B==null?void 0:B.system)==null?void 0:je.heapUsed)})]}),n.jsxs("div",{className:"metric-card",style:{background:"#f8fafc",boxShadow:"none"},children:[n.jsx("div",{className:"metric-label",children:"CPU user"}),n.jsx("div",{className:"metric-value",style:{fontSize:"1.25rem"},children:P((ve=B==null?void 0:B.system)==null?void 0:ve.cpuUserMicros)})]}),n.jsxs("div",{className:"metric-card",style:{background:"#f8fafc",boxShadow:"none"},children:[n.jsx("div",{className:"metric-label",children:"CPU sys"}),n.jsx("div",{className:"metric-value",style:{fontSize:"1.25rem"},children:P((le=B==null?void 0:B.system)==null?void 0:le.cpuSystemMicros)})]})]}),W?n.jsxs("div",{style:{marginTop:12,border:"1px solid #f1f5f9",borderRadius:10,padding:10,background:"#f8fafc"},children:[n.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:6},children:"Run"}),n.jsxs("div",{style:{fontSize:12,color:"#0f172a"},children:[n.jsx("strong",{children:"Scenario:"})," ",String(W.scenario||"-")]}),n.jsxs("div",{style:{fontSize:12,color:"#0f172a"},children:[n.jsx("strong",{children:"Teachers/SubAdmins:"})," ",P(W.teachers)," / ",P(W.subAdmins)]}),n.jsxs("div",{style:{fontSize:12,color:"#0f172a"},children:[n.jsx("strong",{children:"Template:"})," ",String(W.templateName||"-")]})]}):null]})]})]}):null,q==="history"?n.jsxs("div",{className:"data-table-container",children:[n.jsxs("div",{className:"data-table-header",children:[n.jsx("span",{children:"Historique"}),n.jsxs("span",{style:{color:"#64748b"},children:[Array.isArray(E)?E.length:0," runs"]})]}),n.jsx("div",{style:{maxHeight:560,overflow:"auto"},children:n.jsxs("table",{className:"data-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Status"}),n.jsx("th",{style:{textAlign:"right"},children:"Actions"}),n.jsx("th",{style:{textAlign:"right"},children:"Errors"}),n.jsx("th",{style:{textAlign:"right"},children:"p95"})]})}),n.jsx("tbody",{children:(E||[]).map(oe=>{var de,Pe,Z,ne;return n.jsxs("tr",{children:[n.jsx("td",{style:{color:"#0f172a"},children:oe.startedAt?new Date(oe.startedAt).toLocaleString():String(oe._id).slice(-8)}),n.jsx("td",{children:n.jsx("span",{style:{color:oe.status==="completed"?"#047857":oe.status==="running"?"#1d4ed8":oe.status==="failed"?"#b91c1c":"#475569",fontWeight:700},children:String(oe.status||"-")})}),n.jsx("td",{style:{textAlign:"right",color:"#0f172a"},children:P((de=oe.summary)==null?void 0:de.totalActions)}),n.jsx("td",{style:{textAlign:"right",color:(Pe=oe.summary)!=null&&Pe.errorActions?"#b91c1c":"#0f172a"},children:P((Z=oe.summary)==null?void 0:Z.errorActions)}),n.jsx("td",{style:{textAlign:"right",color:"#0f172a"},children:ce((ne=oe.summary)==null?void 0:ne.p95Ms)})]},String(oe._id))})})]})})]}):null,q==="raw"?n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[n.jsxs("div",{className:"data-table-container",children:[n.jsx("div",{className:"data-table-header",children:n.jsx("strong",{children:"Running + Live (raw)"})}),n.jsx("div",{style:{padding:10,maxHeight:560,overflow:"auto"},children:n.jsx("pre",{style:{margin:0,fontSize:11,whiteSpace:"pre-wrap"},children:JSON.stringify({running:v,live:$},null,2)})})]}),n.jsxs("div",{className:"data-table-container",children:[n.jsx("div",{className:"data-table-header",children:n.jsx("strong",{children:"History (raw)"})}),n.jsx("div",{style:{padding:10,maxHeight:560,overflow:"auto"},children:n.jsx("pre",{style:{margin:0,fontSize:11,whiteSpace:"pre-wrap"},children:JSON.stringify(E,null,2)})})]})]}):null]})})]})]})}function $se({minWidth:e,schoolName:t}){const[r,s]=p.useState(!1),[i,a]=p.useState(window.innerWidth),o=p.useRef(!1);return p.useEffect(()=>{const l=()=>{const c=window.innerWidth;a(c),s(c<e)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[e]),p.useEffect(()=>{r&&!o.current&&(o.current=!0,K.post("/settings/mobile-access-log",{screenWidth:window.innerWidth,screenHeight:window.innerHeight,path:window.location.pathname}).catch(l=>{console.error("Failed to log mobile access:",l)}))},[r]),r?n.jsxs("div",{className:"mobile-blocker-overlay",children:[n.jsxs("div",{className:"mobile-blocker-bg",children:[n.jsx("div",{className:"bg-shape bg-shape-1"}),n.jsx("div",{className:"bg-shape bg-shape-2"}),n.jsx("div",{className:"bg-shape bg-shape-3"})]}),n.jsxs("div",{className:"mobile-blocker-content",children:[n.jsx("div",{className:"mobile-blocker-icon",children:n.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),n.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"}),n.jsx("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ef4444",strokeWidth:"2"})]})}),t&&n.jsx("p",{className:"mobile-blocker-school",children:t}),n.jsx("h1",{className:"mobile-blocker-title",children:"Accs non disponible"}),n.jsxs("p",{className:"mobile-blocker-message",children:["Cette application est optimise pour les ",n.jsx("strong",{children:"ordinateurs portables"})," et ",n.jsx("strong",{children:"ordinateurs de bureau"}),"."]}),n.jsx("p",{className:"mobile-blocker-submessage",children:"Pour accder  l'application, veuillez utiliser un appareil avec un cran plus grand."}),n.jsxs("div",{className:"mobile-blocker-devices",children:[n.jsxs("div",{className:"device-group",children:[n.jsxs("div",{className:"device laptop",children:[n.jsx("div",{className:"device-screen",children:n.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})})}),n.jsx("div",{className:"device-base"})]}),n.jsx("span",{className:"device-label",children:"Laptop"}),n.jsx("div",{className:"device-check",children:""})]}),n.jsxs("div",{className:"device-group",children:[n.jsxs("div",{className:"device desktop",children:[n.jsx("div",{className:"device-screen",children:n.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})})}),n.jsx("div",{className:"device-stand"})]}),n.jsx("span",{className:"device-label",children:"Bureau"}),n.jsx("div",{className:"device-check",children:""})]})]}),n.jsxs("div",{className:"mobile-blocker-info",children:[n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),n.jsxs("span",{children:["Largeur minimale requise : ",e,"px  Votre cran : ",i,"px"]})]})]})]}):null}function Dse(){const[e]=f4(),[t,r]=p.useState("preparing"),[s,i]=p.useState(0),[a,o]=p.useState(""),[l,c]=p.useState(""),[u,d]=p.useState(null),[f,h]=p.useState(0),m=p.useRef(Date.now()),g=p.useRef(null),x=p.useRef(!1),y=e.get("url")||"",v=e.get("type")||"single",S=e.get("name")||"Carnet",k=parseInt(e.get("count")||"1",10),j=e.get("exportId")||"";p.useEffect(()=>{const N=setInterval(()=>{h(Math.floor((Date.now()-m.current)/1e3))},1e3);return()=>clearInterval(N)},[]),p.useEffect(()=>{if(s>5&&s<100){const N=f/s*(100-s);d(Math.ceil(N))}},[s,f]),p.useEffect(()=>{if(x.current)return;x.current=!0;let N=null;if(v==="batch"&&j){const E=sessionStorage.getItem(`pdf-export-${j}`);if(E)try{N=JSON.parse(E),sessionStorage.removeItem(`pdf-export-${j}`)}catch{r("error"),o("Donnes d'export invalides");return}else{r("error"),o("Donnes d'export non trouves");return}}else if(!y){r("error"),o("URL d'export manquante");return}(async()=>{var E;g.current=new AbortController;try{r("generating"),i(10);const q=localStorage.getItem("token")||sessionStorage.getItem("token"),L=window.location.origin;let O;if(v==="batch"&&N){const le=setInterval(()=>{i(oe=>oe>=50?(clearInterval(le),oe):oe+Math.random()*2)},1e3);O=await fetch(N.url,{method:"POST",headers:{"Content-Type":"application/json",Authorization:q?`Bearer ${q}`:""},body:JSON.stringify({assignmentIds:N.assignmentIds,groupLabel:N.groupLabel,frontendOrigin:L}),signal:g.current.signal}),clearInterval(le)}else{let le=y;q&&!y.includes("token=")&&(le+=(y.includes("?")?"&":"?")+`token=${encodeURIComponent(q)}`),le.includes("frontendOrigin=")||(le+=`&frontendOrigin=${encodeURIComponent(L)}`);const oe=setInterval(()=>{i(de=>de>=60?(clearInterval(oe),de):de+Math.random()*5)},500);O=await fetch(le,{method:"GET",headers:{Authorization:q?`Bearer ${q}`:""},signal:g.current.signal}),clearInterval(oe)}if(!O.ok){let le=`Erreur serveur: ${O.status} ${O.statusText}`;try{const oe=await O.json();le=oe.message||oe.error||le}catch{try{le=await O.text()||le}catch{}}throw new Error(le)}r("downloading"),i(70);const B=O.headers.get("content-length"),I=B?parseInt(B,10):0,W=(O.headers.get("content-disposition")||"").match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);let re=v==="batch"?`carnets-${((N==null?void 0:N.groupLabel)||S).replace(/[^a-zA-Z0-9-_]/g,"_")}.zip`:`${S.replace(/[^a-zA-Z0-9-_]/g,"_")}.pdf`;W&&W[1]&&(re=W[1].replace(/['"]/g,"")),c(re);const ae=(E=O.body)==null?void 0:E.getReader();if(!ae)throw new Error("Impossible de lire la rponse");const Y=[];let J=0;for(;;){const{done:le,value:oe}=await ae.read();if(le)break;if(Y.push(oe),J+=oe.length,I>0){const de=70+J/I*25;i(Math.min(95,de))}else i(de=>Math.min(95,de+.5))}let P=0;for(const le of Y)P+=le.length;const ce=new Uint8Array(P);let pe=0;for(const le of Y)ce.set(le,pe),pe+=le.length;const ye=O.headers.get("content-type")||(v==="batch"?"application/zip":"application/pdf"),se=new Blob([ce.buffer],{type:ye});i(100),r("complete");const je=window.URL.createObjectURL(se),ve=document.createElement("a");ve.href=je,ve.download=re,document.body.appendChild(ve),ve.click(),document.body.removeChild(ve),window.URL.revokeObjectURL(je),setTimeout(()=>{window.close()},2500)}catch(q){q.name==="AbortError"?(r("error"),o("Export annul")):(r("error"),o(q.message||"Une erreur est survenue"))}})()},[]);const _=()=>{var N;(N=g.current)==null||N.abort(),r("error"),o("Export annul")},b=()=>{r("preparing"),i(0),o(""),m.current=Date.now(),h(0),window.location.reload()},A=()=>{window.close()},z=N=>{if(N<60)return`${N}s`;const $=Math.floor(N/60),E=N%60;return`${$}m ${E}s`},D=()=>{switch(t){case"preparing":return"Prparation de l'export...";case"generating":return v==="batch"?`Gnration de ${k} carnet${k>1?"s":""}...`:"Gnration du PDF...";case"downloading":return"Tlchargement en cours...";case"complete":return"Export termin !";case"error":return"Une erreur est survenue";default:return"Export en cours..."}},w=()=>{switch(t){case"complete":return n.jsx("div",{className:"status-icon success",children:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("polyline",{points:"20 6 9 17 4 12"})})});case"error":return n.jsx("div",{className:"status-icon error",children:n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[n.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})});default:return n.jsx("div",{className:"status-icon loading",children:n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),n.jsx("polyline",{points:"14 2 14 8 20 8"}),n.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),n.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),n.jsx("polyline",{points:"10 9 9 9 8 9"})]})})}};return n.jsxs("div",{className:"pdf-export-container",children:[n.jsxs("div",{className:"pdf-export-card",children:[n.jsx("div",{className:`card-background ${t}`}),n.jsxs("div",{className:"export-header",children:[n.jsx("h1",{children:"Export PDF"}),n.jsx("span",{className:"student-name",children:S})]}),n.jsxs("div",{className:"status-section",children:[w(),n.jsx("h2",{className:"status-message",children:D()}),t==="error"&&n.jsx("p",{className:"error-detail",children:a})]}),t!=="error"&&n.jsxs("div",{className:"progress-section",children:[n.jsxs("div",{className:"progress-bar-container",children:[n.jsx("div",{className:`progress-bar-fill ${t}`,style:{width:`${s}%`}}),n.jsx("div",{className:"progress-glow",style:{left:`${s}%`}})]}),n.jsxs("div",{className:"progress-info",children:[n.jsxs("span",{className:"progress-percentage",children:[Math.round(s),"%"]}),u!==null&&t!=="complete"&&n.jsxs("span",{className:"time-estimate",children:["~",z(u)," restant",u!==1?"s":""]})]})]}),l&&t==="complete"&&n.jsxs("div",{className:"file-info",children:[n.jsxs("svg",{className:"file-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),n.jsx("polyline",{points:"14 2 14 8 20 8"})]}),n.jsx("span",{children:l})]}),n.jsxs("div",{className:"elapsed-time",children:[n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("polyline",{points:"12 6 12 12 16 14"})]}),n.jsxs("span",{children:["Temps coul: ",z(f)]})]}),n.jsx("div",{className:"action-buttons",children:t==="error"?n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:"btn-retry",onClick:b,children:[n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("polyline",{points:"23 4 23 10 17 10"}),n.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]}),"Ressayer"]}),n.jsx("button",{className:"btn-close",onClick:A,children:"Fermer"})]}):t==="complete"?n.jsxs("button",{className:"btn-close success",onClick:A,children:[n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Fermer (auto dans 2s)"]}):n.jsxs("button",{className:"btn-cancel",onClick:_,children:[n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),n.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),"Annuler"]})}),n.jsxs("div",{className:"decorative-circles",children:[n.jsx("div",{className:"circle circle-1"}),n.jsx("div",{className:"circle circle-2"}),n.jsx("div",{className:"circle circle-3"})]})]}),n.jsxs("div",{className:"footer-tip",children:[n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),n.jsx("span",{children:"Cette fentre se fermera automatiquement une fois le tlchargement termin"})]})]})}const Ut=({children:e})=>{const t=wn();let r=sessionStorage.getItem("token")||localStorage.getItem("token");if(!r){const a=new URLSearchParams(t.search||"").get("token");a&&(sessionStorage.setItem("token",a),r=a)}if(r)return e;const s=t.search||"";return n.jsx(h3,{to:`/login${s}`,replace:!0})};function Mse(){Sn();const e=wn(),[t,r]=p.useState(()=>sessionStorage.getItem("token")||localStorage.getItem("token")),[s,i]=p.useState(!1),[a,o]=p.useState(null),[l,c]=p.useState(!1),[u,d]=p.useState(1024),[f,h]=p.useState(""),m=p.useRef([]),g=()=>{sessionStorage.removeItem("token"),sessionStorage.removeItem("role"),sessionStorage.removeItem("displayName"),localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("displayName")},x=k=>{try{const j=k.split(".")[1];if(!j)return null;const _=j.replace(/-/g,"+").replace(/_/g,"/"),b=(4-_.length%4)%4,A=JSON.parse(atob(_+"=".repeat(b))),z=Number(A==null?void 0:A.exp);return Number.isFinite(z)?z*1e3:null}catch{return null}},y=async()=>{var k;if(!s){i(!0);try{const _=(k=(await K.post("/auth/extend")).data)==null?void 0:k.token;if(!_)throw new Error("missing_token");sessionStorage.getItem("token")?sessionStorage.setItem("token",_):localStorage.setItem("token",_),r(_),o({message:"Session extended by 30 minutes.",type:"success",duration:4e3})}catch{o({message:"Unable to extend session.",type:"error",duration:5e3})}finally{i(!1)}}};p.useEffect(()=>{const k=()=>{const _=sessionStorage.getItem("token")||localStorage.getItem("token");r(b=>b===_?b:_)};k();const j=window.setInterval(k,3e3);return()=>window.clearInterval(j)},[]),p.useEffect(()=>{(async()=>{try{const j=await K.get("/settings/public");c(j.data.mobile_block_enabled===!0),d(j.data.mobile_min_width||1024),h(j.data.school_name||"")}catch(j){console.error("Failed to fetch mobile settings:",j)}})()},[]),p.useEffect(()=>{if(m.current.forEach(_=>window.clearTimeout(_)),m.current=[],!t){o(null);return}const k=x(t);if(!k)return;const j=(_,b)=>{const A=_-Date.now();if(A<=0)return;const z=window.setTimeout(b,A);m.current.push(z)};for(const _ of[5,4,3,2,1])j(k-_*60*1e3,()=>{o({message:`Your session will expire in ${_} minute${_===1?"":"s"}.`,type:"info",duration:59e3,actionLabel:"Extend +30 min",onAction:y})});return j(k,()=>{g(),r(null),window.location.pathname!=="/login"&&(window.location.href="/login"+window.location.search)}),()=>{m.current.forEach(_=>window.clearTimeout(_)),m.current=[]}},[t]);const v=e.pathname!=="/login"&&e.pathname!=="/admin/login"&&!e.pathname.startsWith("/print/")&&e.pathname!=="/export-progress",S=l&&!e.pathname.startsWith("/print/");return n.jsxs(n.Fragment,{children:[S&&n.jsx($se,{minWidth:u,schoolName:f}),n.jsx(Ose,{}),v&&n.jsxs(n.Fragment,{children:[n.jsx(Pne,{}),n.jsx(Ene,{})]}),n.jsxs(m3,{children:[n.jsx(Rt,{path:"/login",element:n.jsx(W$,{})}),n.jsx(Rt,{path:"/admin/login",element:n.jsx(U$,{})}),n.jsx(Rt,{path:"/print/carnet/:assignmentId",element:n.jsx(Iy,{})}),n.jsx(Rt,{path:"/print/saved/:savedId",element:n.jsx(Iy,{mode:"saved"})}),n.jsx(Rt,{path:"/print/preview/:templateId/student/:studentId",element:n.jsx(Iy,{mode:"preview"})}),n.jsx(Rt,{path:"/export-progress",element:n.jsx(Dse,{})}),n.jsx(Rt,{path:"/",element:n.jsx(Ut,{children:n.jsx(r_,{})})}),n.jsx(Rt,{path:"/admin",element:n.jsx(Ut,{children:n.jsx(SM,{})})}),n.jsx(Rt,{path:"/admin/settings",element:n.jsx(Ut,{children:n.jsx(ose,{})})}),n.jsx(Rt,{path:"/simulation-lab",element:n.jsx(Ut,{children:n.jsx(zse,{})})}),n.jsx(Rt,{path:"/admin/ressource",element:n.jsx(Ut,{children:n.jsx(_re,{})})}),n.jsx(Rt,{path:"/admin/media",element:n.jsx(Ut,{children:n.jsx(Ine,{})})}),n.jsx(Rt,{path:"/admin/users",element:n.jsx(Ut,{children:n.jsx(kre,{})})}),n.jsx(Rt,{path:"/admin/templates",element:n.jsx(Ut,{children:n.jsx(Cre,{})})}),n.jsx(Rt,{path:"/admin/template-builder",element:n.jsx(Ut,{children:n.jsx(Ane,{})})}),n.jsx(Rt,{path:"/admin/gradebooks",element:n.jsx(Ut,{children:n.jsx(kM,{})})}),n.jsx(Rt,{path:"/admin/gradebooks/view/:gradebookId",element:n.jsx(Ut,{children:n.jsx(RM,{})})}),n.jsx(Rt,{path:"/admin/assignments",element:n.jsx(Ut,{children:n.jsx(Kne,{})})}),n.jsx(Rt,{path:"/admin/assignment-list",element:n.jsx(Ut,{children:n.jsx(Vne,{})})}),n.jsx(Rt,{path:"/admin/skill-analytics",element:n.jsx(Ut,{children:n.jsx(Cse,{})})}),n.jsx(Rt,{path:"/admin/audit-logs",element:n.jsx(Ut,{children:n.jsx(Gne,{})})}),n.jsx(Rt,{path:"/admin/suggestions",element:n.jsx(Ut,{children:n.jsx(Xne,{})})}),n.jsx(Rt,{path:"/admin/classes",element:n.jsx(Ut,{children:n.jsx(Qne,{})})}),n.jsx(Rt,{path:"/admin/school-years",element:n.jsx(Ut,{children:n.jsx(Jne,{})})}),n.jsx(Rt,{path:"/admin/students",element:n.jsx(Ut,{children:n.jsx(nse,{})})}),n.jsx(Rt,{path:"/student/:id",element:n.jsx(Ut,{children:n.jsx(bre,{})})}),n.jsx(Rt,{path:"/teacher/classes",element:n.jsx(Ut,{children:n.jsx(r_,{})})}),n.jsx(Rt,{path:"/teacher/classes/:classId",element:n.jsx(Ut,{children:n.jsx(Tne,{})})}),n.jsx(Rt,{path:"/teacher/students/:studentId/templates",element:n.jsx(Ut,{children:n.jsx(Rne,{})})}),n.jsx(Rt,{path:"/teacher/templates/:assignmentId/edit",element:n.jsx(Ut,{children:n.jsx(One,{})})}),n.jsx(Rt,{path:"/teacher/templates/:assignmentId/quick",element:n.jsx(Ut,{children:n.jsx(zne,{})})}),n.jsx(Rt,{path:"/subadmin/dashboard",element:n.jsx(Ut,{children:n.jsx(u_,{})})}),n.jsx(Rt,{path:"/subadmin/teachers/:teacherId",element:n.jsx(Ut,{children:n.jsx(p_,{})})}),n.jsx(Rt,{path:"/subadmin/templates/:assignmentId/review",element:n.jsx(Ut,{children:n.jsx(h_,{})})}),n.jsx(Rt,{path:"/subadmin/signature",element:n.jsx(Ut,{children:n.jsx(Lne,{})})}),n.jsx(Rt,{path:"/subadmin/eleves",element:n.jsx(Ut,{children:n.jsx($ne,{})})}),n.jsx(Rt,{path:"/subadmin/progress",element:n.jsx(Ut,{children:n.jsx(x_,{})})}),n.jsx(Rt,{path:"/subadmin/teacher-progress",element:n.jsx(Ut,{children:n.jsx(v_,{})})}),n.jsx(Rt,{path:"/subadmin/gradebooks",element:n.jsx(Ut,{children:n.jsx(j_,{})})}),n.jsx(Rt,{path:"/subadmin/semester-request",element:n.jsx(Ut,{children:n.jsx(Oy,{})})}),n.jsx(Rt,{path:"/subadmin/suggestion",element:n.jsx(Ut,{children:n.jsx(Oy,{})})}),n.jsx(Rt,{path:"/subadmin/suggestion/gradebooks",element:n.jsx(Ut,{children:n.jsx(E_,{})})}),n.jsx(Rt,{path:"/aefe/dashboard",element:n.jsx(Ut,{children:n.jsx(u_,{})})}),n.jsx(Rt,{path:"/aefe/teachers/:teacherId",element:n.jsx(Ut,{children:n.jsx(p_,{})})}),n.jsx(Rt,{path:"/aefe/templates/:assignmentId/review",element:n.jsx(Ut,{children:n.jsx(h_,{})})}),n.jsx(Rt,{path:"/aefe/progress",element:n.jsx(Ut,{children:n.jsx(x_,{})})}),n.jsx(Rt,{path:"/aefe/teacher-progress",element:n.jsx(Ut,{children:n.jsx(v_,{})})}),n.jsx(Rt,{path:"/aefe/gradebooks",element:n.jsx(Ut,{children:n.jsx(j_,{})})}),n.jsx(Rt,{path:"/aefe/suggestion",element:n.jsx(Ut,{children:n.jsx(Oy,{})})}),n.jsx(Rt,{path:"/aefe/suggestion/gradebooks",element:n.jsx(Ut,{children:n.jsx(E_,{})})}),n.jsx(Rt,{path:"/admin/analytics",element:n.jsx(Ut,{children:n.jsx(ase,{})})}),n.jsx(Rt,{path:"/admin/progress",element:n.jsx(Ut,{children:n.jsx(lse,{})})}),n.jsx(Rt,{path:"/admin/signatures",element:n.jsx(Ut,{children:n.jsx(vse,{})})}),n.jsx(Rt,{path:"/admin/permissions",element:n.jsx(Ut,{children:n.jsx(pse,{})})}),n.jsx(Rt,{path:"/admin/global-permissions",element:n.jsx(Ut,{children:n.jsx(bse,{})})}),n.jsx(Rt,{path:"/admin/navigation-visibility",element:n.jsx(Ut,{children:n.jsx(jse,{})})}),n.jsx(Rt,{path:"/admin/block-visibility",element:n.jsx(Ut,{children:n.jsx(wse,{})})}),n.jsx(Rt,{path:"/admin/student-promotions",element:n.jsx(Ut,{children:n.jsx(kse,{})})}),n.jsx(Rt,{path:"/admin/ps-onboarding",element:n.jsx(Ut,{children:n.jsx(Nse,{})})}),n.jsx(Rt,{path:"/admin/all-gradebooks",element:n.jsx(Ut,{children:n.jsx(hse,{})})}),n.jsx(Rt,{path:"/admin/gradebooks/:assignmentId/review",element:n.jsx(Ut,{children:n.jsx(yse,{})})}),n.jsx(Rt,{path:"/admin/online-users",element:n.jsx(Ut,{children:n.jsx(fse,{})})}),n.jsx(Rt,{path:"/admin/monitoring",element:n.jsx(Ut,{children:n.jsx(Rse,{})})})]}),a&&n.jsx(ca,{message:a.message,type:a.type,duration:a.duration,onAction:a.onAction,actionLabel:a.actionLabel,actionDisabled:s,onClose:()=>o(null)})]})}const Bse=new Q3;r4(document.getElementById("root")).render(n.jsx(J_.StrictMode,{children:n.jsx(Z3,{client:Bse,children:n.jsx(k3,{children:n.jsx(CM,{children:n.jsx(NM,{children:n.jsx(Sne,{children:n.jsx(Mse,{})})})})})})}));
